(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Mapillary=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var rawAsap=require("./raw");var freeTasks=[];var pendingErrors=[];var requestErrorThrow=rawAsap.makeRequestCallFromTimer(throwFirstError);function throwFirstError(){if(pendingErrors.length){throw pendingErrors.shift()}}module.exports=asap;function asap(task){var rawTask;if(freeTasks.length){rawTask=freeTasks.pop()}else{rawTask=new RawTask}rawTask.task=task;rawAsap(rawTask)}function RawTask(){this.task=null}RawTask.prototype.call=function(){try{this.task.call()}catch(error){if(asap.onerror){asap.onerror(error)}else{pendingErrors.push(error);requestErrorThrow()}}finally{this.task=null;freeTasks[freeTasks.length]=this}}},{"./raw":2}],2:[function(require,module,exports){(function(global){"use strict";module.exports=rawAsap;function rawAsap(task){if(!queue.length){requestFlush();flushing=true}queue[queue.length]=task}var queue=[];var flushing=false;var requestFlush;var index=0;var capacity=1024;function flush(){while(index<queue.length){var currentIndex=index;index=index+1;queue[currentIndex].call();if(index>capacity){for(var scan=0,newLength=queue.length-index;scan<newLength;scan++){queue[scan]=queue[scan+index]}queue.length-=index;index=0}}queue.length=0;index=0;flushing=false}var BrowserMutationObserver=global.MutationObserver||global.WebKitMutationObserver;if(typeof BrowserMutationObserver==="function"){requestFlush=makeRequestCallFromMutationObserver(flush)}else{requestFlush=makeRequestCallFromTimer(flush)}rawAsap.requestFlush=requestFlush;function makeRequestCallFromMutationObserver(callback){var toggle=1;var observer=new BrowserMutationObserver(callback);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function requestCall(){toggle=-toggle;node.data=toggle}}function makeRequestCallFromTimer(callback){return function requestCall(){var timeoutHandle=setTimeout(handleTimer,0);var intervalHandle=setInterval(handleTimer,50);function handleTimer(){clearTimeout(timeoutHandle);clearInterval(intervalHandle);callback()}}}rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],3:[function(require,module,exports){"use strict";exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;function init(){var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63}init();function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}placeHolders=b64[len-2]==="="?2:b64[len-1]==="="?1:0;arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],4:[function(require,module,exports){},{}],5:[function(require,module,exports){module.exports=function split(undef){var nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef,self;self=function(str,separator,limit){if(Object.prototype.toString.call(separator)!=="[object RegExp]"){return nativeSplit.call(str,separator,limit)}var output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+(separator.sticky?"y":""),lastLastIndex=0,separator=new RegExp(separator.source,flags+"g"),separator2,match,lastIndex,lastLength;str+="";if(!compliantExecNpcg){separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags)}limit=limit===undef?-1>>>0:limit>>>0;while(match=separator.exec(str)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undef){match[i]=undef}}})}if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1))}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break}}if(separator.lastIndex===match.index){separator.lastIndex++}}if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("")}}else{output.push(str.slice(lastLastIndex))}return output.length>limit?output.slice(0,limit):output};return self}()},{}],6:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;(function(){try{cachedSetTimeout=setTimeout}catch(e){cachedSetTimeout=function(){throw new Error("setTimeout is not defined")}}try{cachedClearTimeout=clearTimeout}catch(e){cachedClearTimeout=function(){throw new Error("clearTimeout is not defined")}}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}else{return cachedSetTimeout.call(null,fun,0)}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){clearTimeout(marker)}else{cachedClearTimeout.call(null,marker)}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],7:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);that.write(string,encoding);return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function arrayIndexOf(arr,val,byteOffset,encoding){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var foundIndex=-1;for(var i=byteOffset;i<arrLength;++i){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}return-1}Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(this,val,byteOffset,encoding)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset,encoding)}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false);
}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":3,ieee754:177,isarray:181}],8:[function(require,module,exports){"use strict";module.exports=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}size=Math.max(maxX-minX,maxY-minY)}earcutLinked(outerNode,triangles,dim,minX,minY,size);return triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)return null;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(!ear)return;if(!pass&&size)indexCurve(ear,minX,minY,size);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(size?isEarHashed(ear,minX,minY,size):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1)}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,size,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,size)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,size);earcutLinked(c,triangles,dim,minX,minY,size);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,size){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,size);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize===0){e=q;q=q.nextZ;qSize--}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){x=32767*(x-minX)/size;y=32767*(y-minY)/size;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))return true;return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d])}if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex)}}return result}},{}],9:[function(require,module,exports){"use strict";var OneVersionConstraint=require("individual/one-version");var MY_VERSION="7";OneVersionConstraint("ev-store",MY_VERSION);var hashKey="__EV_STORE_KEY@"+MY_VERSION;module.exports=EvStore;function EvStore(elem){var hash=elem[hashKey];if(!hash){hash=elem[hashKey]={}}return hash}},{"individual/one-version":179}],10:[function(require,module,exports){"use strict";var request=require("./request");var buildQueryObject=require("./buildQueryObject");var isArray=Array.isArray;function simpleExtend(obj,obj2){var prop;for(prop in obj2){obj[prop]=obj2[prop]}return obj}function XMLHttpSource(jsongUrl,config){this._jsongUrl=jsongUrl;if(typeof config==="number"){var newConfig={timeout:config};config=newConfig}this._config=simpleExtend({timeout:15e3,headers:{}},config||{})}XMLHttpSource.prototype={constructor:XMLHttpSource,buildQueryObject:buildQueryObject,get:function httpSourceGet(pathSet){var method="GET";var queryObject=this.buildQueryObject(this._jsongUrl,method,{paths:pathSet,method:"get"});var config=simpleExtend(queryObject,this._config);var context=this;return request(method,config,context)},set:function httpSourceSet(jsongEnv){var method="POST";var queryObject=this.buildQueryObject(this._jsongUrl,method,{jsonGraph:jsongEnv,method:"set"});var config=simpleExtend(queryObject,this._config);config.headers["Content-Type"]="application/x-www-form-urlencoded";var context=this;return request(method,config,context)},call:function httpSourceCall(callPath,args,pathSuffix,paths){args=args||[];pathSuffix=pathSuffix||[];paths=paths||[];var method="POST";var queryData=[];queryData.push("method=call");queryData.push("callPath="+encodeURIComponent(JSON.stringify(callPath)));queryData.push("arguments="+encodeURIComponent(JSON.stringify(args)));queryData.push("pathSuffixes="+encodeURIComponent(JSON.stringify(pathSuffix)));queryData.push("paths="+encodeURIComponent(JSON.stringify(paths)));var queryObject=this.buildQueryObject(this._jsongUrl,method,queryData.join("&"));var config=simpleExtend(queryObject,this._config);config.headers["Content-Type"]="application/x-www-form-urlencoded";var context=this;return request(method,config,context)}};XMLHttpSource.XMLHttpSource=XMLHttpSource;XMLHttpSource["default"]=XMLHttpSource;module.exports=XMLHttpSource},{"./buildQueryObject":11,"./request":14}],11:[function(require,module,exports){"use strict";module.exports=function buildQueryObject(url,method,queryData){var qData=[];var keys;var data={url:url};var isQueryParamUrl=url.indexOf("?")!==-1;var startUrl=isQueryParamUrl?"&":"?";if(typeof queryData==="string"){qData.push(queryData)}else{keys=Object.keys(queryData);keys.forEach(function(k){var value=typeof queryData[k]==="object"?JSON.stringify(queryData[k]):queryData[k];qData.push(k+"="+encodeURIComponent(value))})}if(method==="GET"){data.url+=startUrl+qData.join("&")}else{data.data=qData.join("&")}return data}},{}],12:[function(require,module,exports){(function(global){"use strict";module.exports=function getCORSRequest(){var xhr=new global.XMLHttpRequest;if("withCredentials"in xhr){return xhr}else if(!!global.XDomainRequest){return new XDomainRequest}else{throw new Error("CORS is not supported by your browser")}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(require,module,exports){(function(global){"use strict";module.exports=function getXMLHttpRequest(){var progId,progIds,i;if(global.XMLHttpRequest){return new global.XMLHttpRequest}else{try{progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(i=0;i<3;i++){try{progId=progIds[i];if(new global.ActiveXObject(progId)){break}}catch(e){}}return new global.ActiveXObject(progId)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],14:[function(require,module,exports){"use strict";var getXMLHttpRequest=require("./getXMLHttpRequest");var getCORSRequest=require("./getCORSRequest");var hasOwnProp=Object.prototype.hasOwnProperty;var noop=function(){};function Observable(){}Observable.create=function(subscribe){var o=new Observable;o.subscribe=function(onNext,onError,onCompleted){var observer;var disposable;if(typeof onNext==="function"){observer={onNext:onNext,onError:onError||noop,onCompleted:onCompleted||noop}}else{observer=onNext}disposable=subscribe(observer);if(typeof disposable==="function"){return{dispose:disposable}}else{return disposable}};return o};function request(method,options,context){return Observable.create(function requestObserver(observer){var config={method:method||"GET",crossDomain:false,async:true,headers:{},responseType:"json"};var xhr,isDone,headers,header,prop;for(prop in options){if(hasOwnProp.call(options,prop)){config[prop]=options[prop]}}if(!config.crossDomain&&!config.headers["X-Requested-With"]){config.headers["X-Requested-With"]="XMLHttpRequest"}if(context.onBeforeRequest!=null){context.onBeforeRequest(config)}try{xhr=config.crossDomain?getCORSRequest():getXMLHttpRequest()}catch(err){observer.onError(err)}try{if(config.user){xhr.open(config.method,config.url,config.async,config.user,config.password)}else{xhr.open(config.method,config.url,config.async)}xhr.timeout=config.timeout;xhr.withCredentials=config.withCredentials!==false;headers=config.headers;for(header in headers){if(hasOwnProp.call(headers,header)){xhr.setRequestHeader(header,headers[header])}}if(config.responseType){try{xhr.responseType=config.responseType}catch(e){if(config.responseType!=="json"){throw e}}}xhr.onreadystatechange=function onreadystatechange(e){if(xhr.readyState===4){if(!isDone){isDone=true;onXhrLoad(observer,xhr,e)}}};xhr.ontimeout=function ontimeout(e){if(!isDone){isDone=true;onXhrError(observer,xhr,"timeout error",e)}};xhr.send(config.data)}catch(e){observer.onError(e)}return function dispose(){if(!isDone&&xhr.readyState!==4){isDone=true;xhr.abort()}}})}function _handleXhrError(observer,textStatus,errorThrown){if(!errorThrown){errorThrown=new Error(textStatus)}observer.onError(errorThrown)}function onXhrLoad(observer,xhr,e){var responseData,responseObject,responseType;if(xhr&&observer){responseType=xhr.responseType;responseData="response"in xhr?xhr.response:xhr.responseText;var status=xhr.status===1223?204:xhr.status;if(status>=200&&status<=399){try{if(responseType!=="json"){responseData=JSON.parse(responseData||"")}if(typeof responseData==="string"){responseData=JSON.parse(responseData||"")}}catch(e){_handleXhrError(observer,"invalid json",e)}observer.onNext(responseData);observer.onCompleted();return}else if(status===401||status===403||status===407){return _handleXhrError(observer,responseData)}else if(status===410){return _handleXhrError(observer,responseData)}else if(status===408||status===504){return _handleXhrError(observer,responseData)}else{return _handleXhrError(observer,responseData||"Response code "+status)}}}function onXhrError(observer,xhr,status,e){_handleXhrError(observer,status||xhr.statusText||"request error",e)}module.exports=request},{"./getCORSRequest":12,"./getXMLHttpRequest":13}],15:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");function sentinel(type,value,props){var copy=Object.create(null);if(props!=null){for(var key in props){copy[key]=props[key]}copy["$type"]=type;copy.value=value;return copy}else{return{$type:type,value:value}}}module.exports={ref:function ref(path,props){return sentinel("ref",pathSyntax.fromPath(path),props)},atom:function atom(value,props){return sentinel("atom",value,props)},undefined:function(){return sentinel("atom")},error:function error(errorValue,props){return sentinel("error",errorValue,props)},pathValue:function pathValue(path,value){return{path:pathSyntax.fromPath(path),value:value}},pathInvalidation:function pathInvalidation(path){return{path:pathSyntax.fromPath(path),invalidated:true}}}},{"falcor-path-syntax":19}],16:[function(require,module,exports){module.exports={integers:"integers",ranges:"ranges",keys:"keys"}},{}],17:[function(require,module,exports){var TokenTypes={token:"token",dotSeparator:".",commaSeparator:",",openingBracket:"[",closingBracket:"]",openingBrace:"{",closingBrace:"}",escape:"\\",space:" ",colon:":",quote:"quote",unknown:"unknown"};module.exports=TokenTypes},{}],18:[function(require,module,exports){module.exports={indexer:{nested:"Indexers cannot be nested.",needQuotes:"unquoted indexers must be numeric.",empty:"cannot have empty indexers.",leadingDot:"Indexers cannot have leading dots.",leadingComma:"Indexers cannot have leading comma.",requiresComma:"Indexers require commas between indexer args.",routedTokens:"Only one token can be used per indexer when specifying routed tokens."},range:{precedingNaN:"ranges must be preceded by numbers.",suceedingNaN:"ranges must be suceeded by numbers."},routed:{invalid:"Invalid routed token.  only integers|ranges|keys are supported."},quote:{empty:"cannot have empty quoted keys.",illegalEscape:"Invalid escape character.  Only quotes are escapable."},unexpectedToken:"Unexpected token.",invalidIdentifier:"Invalid Identifier.",invalidPath:"Please provide a valid path.",throwError:function(err,tokenizer,token){if(token){throw err+" -- "+tokenizer.parseString+" with next token: "+token}throw err+" -- "+tokenizer.parseString}}},{}],19:[function(require,module,exports){var Tokenizer=require("./tokenizer");var head=require("./parse-tree/head");var RoutedTokens=require("./RoutedTokens");var parser=function parser(string,extendedRules){return head(new Tokenizer(string,extendedRules))};module.exports=parser;parser.fromPathsOrPathValues=function(paths,ext){if(!paths){return[]}var out=[];for(var i=0,len=paths.length;i<len;i++){if(typeof paths[i]==="string"){out[i]=parser(paths[i],ext)}else if(typeof paths[i].path==="string"){out[i]={path:parser(paths[i].path,ext),value:paths[i].value}}else{out[i]=paths[i]}}return out};parser.fromPath=function(path,ext){if(!path){return[]}if(typeof path==="string"){return parser(path,ext)}return path};parser.RoutedTokens=RoutedTokens},{"./RoutedTokens":16,"./parse-tree/head":20,"./tokenizer":25}],20:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var indexer=require("./indexer");module.exports=function head(tokenizer){var token=tokenizer.next();var state={};var out=[];while(!token.done){switch(token.type){case TokenTypes.token:var first=+token.token[0];if(!isNaN(first)){E.throwError(E.invalidIdentifier,tokenizer)}out[out.length]=token.token;break;case TokenTypes.dotSeparator:if(out.length===0){E.throwError(E.unexpectedToken,tokenizer)}break;case TokenTypes.space:break;case TokenTypes.openingBracket:indexer(tokenizer,token,state,out);break;default:E.throwError(E.unexpectedToken,tokenizer);break}token=tokenizer.next()}if(out.length===0){E.throwError(E.invalidPath,tokenizer)}return out}},{"./../TokenTypes":17,"./../exceptions":18,"./indexer":21}],21:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var idxE=E.indexer;var range=require("./range");var quote=require("./quote");var routed=require("./routed");module.exports=function indexer(tokenizer,openingToken,state,out){var token=tokenizer.next();var done=false;var allowedMaxLength=1;var routedIndexer=false;state.indexer=[];while(!token.done){switch(token.type){case TokenTypes.token:case TokenTypes.quote:if(state.indexer.length===allowedMaxLength){E.throwError(idxE.requiresComma,tokenizer)}break}switch(token.type){case TokenTypes.openingBrace:routedIndexer=true;routed(tokenizer,token,state,out);break;case TokenTypes.token:var t=+token.token;if(isNaN(t)){E.throwError(idxE.needQuotes,tokenizer)}state.indexer[state.indexer.length]=t;break;case TokenTypes.dotSeparator:if(!state.indexer.length){E.throwError(idxE.leadingDot,tokenizer)}range(tokenizer,token,state,out);break;case TokenTypes.space:break;case TokenTypes.closingBracket:done=true;break;case TokenTypes.quote:quote(tokenizer,token,state,out);break;case TokenTypes.openingBracket:E.throwError(idxE.nested,tokenizer);break;case TokenTypes.commaSeparator:++allowedMaxLength;break;default:E.throwError(E.unexpectedToken,tokenizer);break}if(done){break}token=tokenizer.next()}if(state.indexer.length===0){E.throwError(idxE.empty,tokenizer)}if(state.indexer.length>1&&routedIndexer){E.throwError(idxE.routedTokens,tokenizer)}if(state.indexer.length===1){state.indexer=state.indexer[0]}out[out.length]=state.indexer;state.indexer=undefined}},{"./../TokenTypes":17,"./../exceptions":18,"./quote":22,"./range":23,"./routed":24}],22:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var quoteE=E.quote;module.exports=function quote(tokenizer,openingToken,state,out){var token=tokenizer.next();var innerToken="";var openingQuote=openingToken.token;var escaping=false;var done=false;while(!token.done){switch(token.type){case TokenTypes.token:case TokenTypes.space:case TokenTypes.dotSeparator:case TokenTypes.commaSeparator:case TokenTypes.openingBracket:case TokenTypes.closingBracket:case TokenTypes.openingBrace:case TokenTypes.closingBrace:if(escaping){E.throwError(quoteE.illegalEscape,tokenizer)}innerToken+=token.token;break;case TokenTypes.quote:if(escaping){innerToken+=token.token;escaping=false}else if(token.token!==openingQuote){innerToken+=token.token}else{done=true}break;case TokenTypes.escape:escaping=true;break;default:E.throwError(E.unexpectedToken,tokenizer)}if(done){break}token=tokenizer.next()}if(innerToken.length===0){E.throwError(quoteE.empty,tokenizer)}state.indexer[state.indexer.length]=innerToken}},{"./../TokenTypes":17,"./../exceptions":18}],23:[function(require,module,exports){var Tokenizer=require("./../tokenizer");var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");module.exports=function range(tokenizer,openingToken,state,out){var token=tokenizer.peek();var dotCount=1;var done=false;var inclusive=true;var idx=state.indexer.length-1;var from=Tokenizer.toNumber(state.indexer[idx]);var to;if(isNaN(from)){E.throwError(E.range.precedingNaN,tokenizer)}while(!done&&!token.done){switch(token.type){case TokenTypes.dotSeparator:if(dotCount===3){E.throwError(E.unexpectedToken,tokenizer)}++dotCount;if(dotCount===3){inclusive=false}break;case TokenTypes.token:to=Tokenizer.toNumber(tokenizer.next().token);if(isNaN(to)){E.throwError(E.range.suceedingNaN,tokenizer)}done=true;break;default:done=true;break}if(!done){tokenizer.next();token=tokenizer.peek()}else{break}}state.indexer[idx]={from:from,to:inclusive?to:to-1}}},{"./../TokenTypes":17,"./../exceptions":18,"./../tokenizer":25}],24:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var RoutedTokens=require("./../RoutedTokens");var E=require("./../exceptions");var routedE=E.routed;module.exports=function routed(tokenizer,openingToken,state,out){var routeToken=tokenizer.next();var named=false;var name="";switch(routeToken.token){case RoutedTokens.integers:case RoutedTokens.ranges:case RoutedTokens.keys:break;default:E.throwError(routedE.invalid,tokenizer);break}var next=tokenizer.next();if(next.type===TokenTypes.colon){
named=true;next=tokenizer.next();if(next.type!==TokenTypes.token){E.throwError(routedE.invalid,tokenizer)}name=next.token;next=tokenizer.next()}if(next.type===TokenTypes.closingBrace){var outputToken={type:routeToken.token,named:named,name:name};state.indexer[state.indexer.length]=outputToken}else{E.throwError(routedE.invalid,tokenizer)}}},{"./../RoutedTokens":16,"./../TokenTypes":17,"./../exceptions":18}],25:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var DOT_SEPARATOR=".";var COMMA_SEPARATOR=",";var OPENING_BRACKET="[";var CLOSING_BRACKET="]";var OPENING_BRACE="{";var CLOSING_BRACE="}";var COLON=":";var ESCAPE="\\";var DOUBLE_OUOTES='"';var SINGE_OUOTES="'";var SPACE=" ";var SPECIAL_CHARACTERS="\\'\"[]., ";var EXT_SPECIAL_CHARACTERS="\\{}'\"[]., :";var Tokenizer=module.exports=function(string,ext){this._string=string;this._idx=-1;this._extended=ext;this.parseString=""};Tokenizer.prototype={next:function(){var nextToken=this._nextToken?this._nextToken:getNext(this._string,this._idx,this._extended);this._idx=nextToken.idx;this._nextToken=false;this.parseString+=nextToken.token.token;return nextToken.token},peek:function(){var nextToken=this._nextToken?this._nextToken:getNext(this._string,this._idx,this._extended);this._nextToken=nextToken;return nextToken.token}};Tokenizer.toNumber=function toNumber(x){if(!isNaN(+x)){return+x}return NaN};function toOutput(token,type,done){return{token:token,done:done,type:type}}function getNext(string,idx,ext){var output=false;var token="";var specialChars=ext?EXT_SPECIAL_CHARACTERS:SPECIAL_CHARACTERS;var done;do{done=idx+1>=string.length;if(done){break}var character=string[idx+1];if(character!==undefined&&specialChars.indexOf(character)===-1){token+=character;++idx;continue}else if(token.length){break}++idx;var type;switch(character){case DOT_SEPARATOR:type=TokenTypes.dotSeparator;break;case COMMA_SEPARATOR:type=TokenTypes.commaSeparator;break;case OPENING_BRACKET:type=TokenTypes.openingBracket;break;case CLOSING_BRACKET:type=TokenTypes.closingBracket;break;case OPENING_BRACE:type=TokenTypes.openingBrace;break;case CLOSING_BRACE:type=TokenTypes.closingBrace;break;case SPACE:type=TokenTypes.space;break;case DOUBLE_OUOTES:case SINGE_OUOTES:type=TokenTypes.quote;break;case ESCAPE:type=TokenTypes.escape;break;case COLON:type=TokenTypes.colon;break;default:type=TokenTypes.unknown;break}output=toOutput(character,type,false);break}while(!done);if(!output&&token.length){output=toOutput(token,TokenTypes.token,false)}if(!output){output={done:true}}return{token:output,idx:idx}}},{"./../TokenTypes":17}],26:[function(require,module,exports){var toPaths=require("./toPaths");var toTree=require("./toTree");module.exports=function collapse(paths){var collapseMap=paths.reduce(function(acc,path){var len=path.length;if(!acc[len]){acc[len]=[]}acc[len].push(path);return acc},{});Object.keys(collapseMap).forEach(function(collapseKey){collapseMap[collapseKey]=toTree(collapseMap[collapseKey])});return toPaths(collapseMap)}},{"./toPaths":32,"./toTree":33}],27:[function(require,module,exports){var iterateKeySet=require("./iterateKeySet");module.exports=function hasIntersection(tree,path,depth){var current=tree;var intersects=true;for(;intersects&&depth<path.length;++depth){var key=path[depth];var keyType=typeof key;if(key&&keyType==="object"){var note={};var innerKey=iterateKeySet(key,note);var nextDepth=depth+1;do{var next=current[innerKey];intersects=next!==undefined;if(intersects){intersects=hasIntersection(next,path,nextDepth)}innerKey=iterateKeySet(key,note)}while(intersects&&!note.done);break}current=current[key];intersects=current!==undefined}return intersects}},{"./iterateKeySet":29}],28:[function(require,module,exports){module.exports={iterateKeySet:require("./iterateKeySet"),toTree:require("./toTree"),toTreeWithUnion:require("./toTreeWithUnion"),pathsComplementFromTree:require("./pathsComplementFromTree"),pathsComplementFromLengthTree:require("./pathsComplementFromLengthTree"),hasIntersection:require("./hasIntersection"),toPaths:require("./toPaths"),collapse:require("./collapse")}},{"./collapse":26,"./hasIntersection":27,"./iterateKeySet":29,"./pathsComplementFromLengthTree":30,"./pathsComplementFromTree":31,"./toPaths":32,"./toTree":33,"./toTreeWithUnion":34}],29:[function(require,module,exports){var isArray=Array.isArray;module.exports=function iterateKeySet(keySet,note){if(note.isArray===undefined){initializeNote(keySet,note)}if(note.isArray){var nextValue;do{if(note.loaded&&note.rangeOffset>note.to){++note.arrayOffset;note.loaded=false}var idx=note.arrayOffset,length=keySet.length;if(idx>=length){note.done=true;break}var el=keySet[note.arrayOffset];var type=typeof el;if(type==="object"){if(!note.loaded){initializeRange(el,note)}if(note.empty){continue}nextValue=note.rangeOffset++}else{++note.arrayOffset;nextValue=el}}while(nextValue===undefined);return nextValue}else if(note.isObject){if(!note.loaded){initializeRange(keySet,note)}if(note.rangeOffset>note.to){note.done=true;return undefined}return note.rangeOffset++}else{note.done=true;return keySet}};function initializeRange(key,memo){var from=memo.from=key.from||0;var to=memo.to=key.to||(typeof key.length==="number"&&memo.from+key.length-1||0);memo.rangeOffset=memo.from;memo.loaded=true;if(from>to){memo.empty=true}}function initializeNote(key,note){note.done=false;var isObject=note.isObject=!!(key&&typeof key==="object");note.isArray=isObject&&isArray(key);note.arrayOffset=0}},{}],30:[function(require,module,exports){var hasIntersection=require("./hasIntersection");module.exports=function pathsComplementFromLengthTree(paths,tree){var out=[];var outLength=-1;for(var i=0,len=paths.length;i<len;++i){var path=paths[i];if(!hasIntersection(tree[path.length],path,0)){out[++outLength]=path}}return out}},{"./hasIntersection":27}],31:[function(require,module,exports){var hasIntersection=require("./hasIntersection");module.exports=function pathsComplementFromTree(paths,tree){var out=[];var outLength=-1;for(var i=0,len=paths.length;i<len;++i){if(!hasIntersection(tree,paths[i],0)){out[++outLength]=paths[i]}}return out}},{"./hasIntersection":27}],32:[function(require,module,exports){var isArray=Array.isArray;var typeOfObject="object";module.exports=function toPaths(lengths){var pathmap;var allPaths=[];var allPathsLength=0;for(var length in lengths){if(isNumber(length)&&isObject(pathmap=lengths[length])){var paths=collapsePathMap(pathmap,0,parseInt(length,10)).sets;var pathsIndex=-1;var pathsCount=paths.length;while(++pathsIndex<pathsCount){allPaths[allPathsLength++]=collapsePathSetIndexes(paths[pathsIndex])}}}return allPaths};function isObject(value){return value!==null&&typeof value===typeOfObject}function collapsePathMap(pathmap,depth,length){var key;var code=getHashCode(String(depth));var subs=Object.create(null);var codes=[];var codesIndex=-1;var codesCount=0;var pathsets=[];var pathsetsCount=0;var subPath,subCode,subKeys,subKeysIndex,subKeysCount,subSets,subSetsIndex,subSetsCount,pathset,pathsetIndex,pathsetCount,firstSubKey,pathsetClone;subKeys=[];subKeysIndex=-1;if(depth<length-1){subKeysCount=getSortedKeys(pathmap,subKeys);while(++subKeysIndex<subKeysCount){key=subKeys[subKeysIndex];subPath=collapsePathMap(pathmap[key],depth+1,length);subCode=subPath.code;if(subs[subCode]){subPath=subs[subCode]}else{codes[codesCount++]=subCode;subPath=subs[subCode]={keys:[],sets:subPath.sets}}code=getHashCode(code+key+subCode);isNumber(key)&&subPath.keys.push(parseInt(key,10))||subPath.keys.push(key)}while(++codesIndex<codesCount){key=codes[codesIndex];subPath=subs[key];subKeys=subPath.keys;subKeysCount=subKeys.length;if(subKeysCount>0){subSets=subPath.sets;subSetsIndex=-1;subSetsCount=subSets.length;firstSubKey=subKeys[0];while(++subSetsIndex<subSetsCount){pathset=subSets[subSetsIndex];pathsetIndex=-1;pathsetCount=pathset.length;pathsetClone=new Array(pathsetCount+1);pathsetClone[0]=subKeysCount>1&&subKeys||firstSubKey;while(++pathsetIndex<pathsetCount){pathsetClone[pathsetIndex+1]=pathset[pathsetIndex]}pathsets[pathsetsCount++]=pathsetClone}}}}else{subKeysCount=getSortedKeys(pathmap,subKeys);if(subKeysCount>1){pathsets[pathsetsCount++]=[subKeys]}else{pathsets[pathsetsCount++]=subKeys}while(++subKeysIndex<subKeysCount){code=getHashCode(code+subKeys[subKeysIndex])}}return{code:code,sets:pathsets}}function collapsePathSetIndexes(pathset){var keysetIndex=-1;var keysetCount=pathset.length;while(++keysetIndex<keysetCount){var keyset=pathset[keysetIndex];if(isArray(keyset)){pathset[keysetIndex]=collapseIndex(keyset)}}return pathset}function collapseIndex(keyset){var keyIndex=-1;var keyCount=keyset.length-1;var isSparseRange=keyCount>0;while(++keyIndex<=keyCount){var key=keyset[keyIndex];if(!isNumber(key)){isSparseRange=false;break}keyset[keyIndex]=parseInt(key,10)}if(isSparseRange===true){keyset.sort(sortListAscending);var from=keyset[0];var to=keyset[keyCount];if(to-from<=keyCount){return{from:from,to:to}}}return keyset}function sortListAscending(a,b){return a-b}function getSortedKeys(map,keys,sort){var len=0;for(var key in map){keys[len++]=key}if(len>1){keys.sort(sort)}return len}function getHashCode(key){var code=5381;var index=-1;var count=key.length;while(++index<count){code=(code<<5)+code+key.charCodeAt(index)}return String(code)}function isNumber(val){return!isArray(val)&&val-parseFloat(val)+1>=0}},{}],33:[function(require,module,exports){var iterateKeySet=require("./../lib/iterateKeySet");var isArray=Array.isArray;module.exports=function toTree(paths){return paths.reduce(function(acc,path){innerToTree(acc,path,0);return acc},{})};function innerToTree(seed,path,depth){var keySet=path[depth];var iteratorNote={};var key;var nextDepth=depth+1;key=iterateKeySet(keySet,iteratorNote);do{var next=seed[key];if(!next){if(nextDepth===path.length){seed[key]=null}else{next=seed[key]={}}}if(nextDepth<path.length){innerToTree(next,path,nextDepth)}if(!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(!iteratorNote.done)}},{"./../lib/iterateKeySet":29}],34:[function(require,module,exports){arguments[4][4][0].apply(exports,arguments)},{dup:4}],35:[function(require,module,exports){var ModelRoot=require("./ModelRoot");var ModelDataSourceAdapter=require("./ModelDataSourceAdapter");var RequestQueue=require("./request/RequestQueueRx");var ModelResponse=require("./response/ModelResponse");var SetResponse=require("./response/SetResponse");var CallResponse=require("./response/CallResponse");var InvalidateResponse=require("./response/InvalidateResponse");var ASAPScheduler=require("./schedulers/ASAPScheduler");var TimeoutScheduler=require("./schedulers/TimeoutScheduler");var ImmediateScheduler=require("./schedulers/ImmediateScheduler");var arrayClone=require("./support/array-clone");var arraySlice=require("./support/array-slice");var collectLru=require("./lru/collect");var pathSyntax=require("falcor-path-syntax");var getSize=require("./support/getSize");var isObject=require("./support/isObject");var isFunction=require("./support/isFunction");var isPrimitive=require("./support/isPrimitive");var isJSONEnvelope=require("./support/isJSONEnvelope");var isJSONGraphEnvelope=require("./support/isJSONGraphEnvelope");var setCache=require("./set/setPathMaps");var setJSONGraphs=require("./set/setJSONGraphs");var jsong=require("falcor-json-graph");var ID=0;var validateInput=require("./support/validateInput");var noOp=function(){};var getCache=require("./get/getCache");var get=require("./get");var SET_VALID_INPUT={pathValue:true,pathSyntax:true,json:true,jsonGraph:true};var GET_VALID_INPUT=require("./response/get/validInput");module.exports=Model;Model.ref=jsong.ref;Model.atom=jsong.atom;Model.error=jsong.error;Model.pathValue=jsong.pathValue;function Model(o){var options=o||{};this._root=options._root||new ModelRoot(options);this._path=options.path||options._path||[];this._scheduler=options.scheduler||options._scheduler||new ImmediateScheduler;this._source=options.source||options._source;this._request=options.request||options._request||new RequestQueue(this,this._scheduler);this._ID=ID++;if(typeof options.maxSize==="number"){this._maxSize=options.maxSize}else{this._maxSize=options._maxSize||Model.prototype._maxSize}if(typeof options.collectRatio==="number"){this._collectRatio=options.collectRatio}else{this._collectRatio=options._collectRatio||Model.prototype._collectRatio}if(options.boxed||options.hasOwnProperty("_boxed")){this._boxed=options.boxed||options._boxed}if(options.materialized||options.hasOwnProperty("_materialized")){this._materialized=options.materialized||options._materialized}if(typeof options.treatErrorsAsValues==="boolean"){this._treatErrorsAsValues=options.treatErrorsAsValues}else if(options.hasOwnProperty("_treatErrorsAsValues")){this._treatErrorsAsValues=options._treatErrorsAsValues}if(options.cache){this.setCache(options.cache)}}Model.prototype.constructor=Model;Model.prototype._materialized=false;Model.prototype._boxed=false;Model.prototype._progressive=false;Model.prototype._treatErrorsAsValues=false;Model.prototype._maxSize=Math.pow(2,53)-1;Model.prototype._collectRatio=.75;Model.prototype.get=require("./response/get");Model.prototype._getWithPaths=require("./response/get/getWithPaths");Model.prototype.set=function set(){var out=validateInput(arguments,SET_VALID_INPUT,"set");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}return this._set.apply(this,arguments)};Model.prototype.preload=function preload(){var out=validateInput(arguments,GET_VALID_INPUT,"preload");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}var args=Array.prototype.slice.call(arguments);var self=this;return new ModelResponse(function(obs){return self.get.apply(self,args).subscribe(function(){},function(err){obs.onError(err)},function(){obs.onCompleted()})})};Model.prototype._set=function _set(){var args;var argsIdx=-1;var argsLen=arguments.length;var selector=arguments[argsLen-1];if(isFunction(selector)){argsLen=argsLen-1}else{selector=void 0}args=new Array(argsLen);while(++argsIdx<argsLen){args[argsIdx]=arguments[argsIdx]}return SetResponse.create(this,args,selector)};Model.prototype.call=function call(){var args;var argsIdx=-1;var argsLen=arguments.length;args=new Array(argsLen);while(++argsIdx<argsLen){var arg=arguments[argsIdx];args[argsIdx]=arg;var argType=typeof arg;if(argsIdx>1&&!Array.isArray(arg)||argsIdx===0&&!Array.isArray(arg)&&argType!=="string"||argsIdx===1&&!Array.isArray(arg)&&!isPrimitive(arg)){return new ModelResponse(function(o){o.onError(new Error("Invalid argument"))})}}return CallResponse.create(this,args)};Model.prototype.invalidate=function invalidate(){var args;var argsIdx=-1;var argsLen=arguments.length;var selector=arguments[argsLen-1];args=new Array(argsLen);while(++argsIdx<argsLen){args[argsIdx]=pathSyntax.fromPath(arguments[argsIdx]);if(typeof args[argsIdx]!=="object"){throw new Error("Invalid argument")}}InvalidateResponse.create(this,args,selector).subscribe(noOp,function(e){throw e})};Model.prototype.deref=require("./deref");Model.prototype.getValue=require("./get/getValue");Model.prototype.setValue=require("./set/setValue");Model.prototype._getValueSync=require("./get/sync");Model.prototype._setValueSync=require("./set/sync");Model.prototype._derefSync=require("./deref/sync");Model.prototype.setCache=function modelSetCache(cacheOrJSONGraphEnvelope){var cache=this._root.cache;if(cacheOrJSONGraphEnvelope!==cache){var modelRoot=this._root;var boundPath=this._path;this._path=[];this._root.cache={};if(typeof cache!=="undefined"){collectLru(modelRoot,modelRoot.expired,getSize(cache),0)}if(isJSONGraphEnvelope(cacheOrJSONGraphEnvelope)){setJSONGraphs(this,[cacheOrJSONGraphEnvelope])}else if(isJSONEnvelope(cacheOrJSONGraphEnvelope)){setCache(this,[cacheOrJSONGraphEnvelope])}else if(isObject(cacheOrJSONGraphEnvelope)){setCache(this,[{json:cacheOrJSONGraphEnvelope}])}this._path=boundPath}else if(typeof cache==="undefined"){this._root.cache={}}return this};Model.prototype.getCache=function _getCache(){var paths=arraySlice(arguments);if(paths.length===0){return getCache(this._root.cache)}var result=[{}];var path=this._path;get.getWithPathsAsJSONGraph(this,paths,result);this._path=path;return result[0].jsonGraph};Model.prototype.getVersion=function getVersion(pathArg){var path=pathArg&&pathSyntax.fromPath(pathArg)||[];if(Array.isArray(path)===false){throw new Error("Model#getVersion must be called with an Array path.")}if(this._path.length){path=this._path.concat(path)}return this._getVersion(this,path)};Model.prototype._syncCheck=function syncCheck(name){if(Boolean(this._source)&&this._root.syncRefCount<=0&&this._root.unsafeMode===false){throw new Error("Model#"+name+" may only be called within the context of a request selector.")}return true};Model.prototype._clone=function cloneModel(opts){var clone=new Model(this);for(var key in opts){var value=opts[key];if(value==="delete"){delete clone[key]}else{clone[key]=value}}clone.setCache=void 0;return clone};Model.prototype.batch=function batch(schedulerOrDelayArg){var schedulerOrDelay=schedulerOrDelayArg;if(typeof schedulerOrDelay==="number"){schedulerOrDelay=new TimeoutScheduler(Math.round(Math.abs(schedulerOrDelay)))}else if(!schedulerOrDelay||!schedulerOrDelay.schedule){schedulerOrDelay=new ASAPScheduler}var clone=this._clone();clone._request=new RequestQueue(clone,schedulerOrDelay);return clone};Model.prototype.unbatch=function unbatch(){var clone=this._clone();clone._request=new RequestQueue(clone,new ImmediateScheduler);return clone};Model.prototype.treatErrorsAsValues=function treatErrorsAsValues(){return this._clone({_treatErrorsAsValues:true})};Model.prototype.asDataSource=function asDataSource(){return new ModelDataSourceAdapter(this)};Model.prototype._materialize=function materialize(){return this._clone({_materialized:true})};Model.prototype._dematerialize=function dematerialize(){return this._clone({_materialized:"delete"})};Model.prototype.boxValues=function boxValues(){return this._clone({_boxed:true})};Model.prototype.unboxValues=function unboxValues(){return this._clone({_boxed:"delete"})};Model.prototype.withoutDataSource=function withoutDataSource(){return this._clone({_source:"delete"})};Model.prototype.toJSON=function toJSON(){return{$type:"ref",value:this._path}};Model.prototype.getPath=function getPath(){return arrayClone(this._path)};Model.prototype._getBoundValue=require("./get/getBoundValue");Model.prototype._getVersion=require("./get/getVersion");Model.prototype._getValueSync=require("./get/getValueSync");Model.prototype._getPathValuesAsPathMap=get.getWithPathsAsPathMap;Model.prototype._getPathValuesAsJSONG=get.getWithPathsAsJSONGraph;Model.prototype._setPathValuesAsJSON=require("./set/setPathValues");Model.prototype._setPathValuesAsJSONG=require("./set/setPathValues");Model.prototype._setPathValuesAsPathMap=require("./set/setPathValues");Model.prototype._setPathValuesAsValues=require("./set/setPathValues");Model.prototype._setPathMapsAsJSON=require("./set/setPathMaps");Model.prototype._setPathMapsAsJSONG=require("./set/setPathMaps");Model.prototype._setPathMapsAsPathMap=require("./set/setPathMaps");Model.prototype._setPathMapsAsValues=require("./set/setPathMaps");Model.prototype._setJSONGsAsJSON=require("./set/setJSONGraphs");Model.prototype._setJSONGsAsJSONG=require("./set/setJSONGraphs");Model.prototype._setJSONGsAsPathMap=require("./set/setJSONGraphs");Model.prototype._setJSONGsAsValues=require("./set/setJSONGraphs");Model.prototype._setCache=require("./set/setPathMaps");Model.prototype._invalidatePathValuesAsJSON=require("./invalidate/invalidatePathSets");Model.prototype._invalidatePathMapsAsJSON=require("./invalidate/invalidatePathMaps")},{"./ModelDataSourceAdapter":36,"./ModelRoot":37,"./deref":38,"./deref/sync":39,"./get":52,"./get/getBoundValue":46,"./get/getCache":47,"./get/getValue":49,"./get/getValueSync":50,"./get/getVersion":51,"./get/sync":57,"./invalidate/invalidatePathMaps":80,"./invalidate/invalidatePathSets":81,"./lru/collect":82,"./request/RequestQueueRx":88,"./response/CallResponse":94,"./response/InvalidateResponse":96,"./response/ModelResponse":97,"./response/SetResponse":98,"./response/get":104,"./response/get/getWithPaths":103,"./response/get/validInput":105,"./schedulers/ASAPScheduler":106,"./schedulers/ImmediateScheduler":107,"./schedulers/TimeoutScheduler":108,"./set/setJSONGraphs":109,"./set/setPathMaps":110,"./set/setPathValues":111,"./set/setValue":112,"./set/sync":113,"./support/array-clone":114,"./support/array-slice":117,"./support/getSize":121,"./support/isFunction":129,"./support/isJSONEnvelope":131,"./support/isJSONGraphEnvelope":132,"./support/isObject":133,"./support/isPrimitive":135,"./support/validateInput":149,"falcor-json-graph":15,"falcor-path-syntax":19}],36:[function(require,module,exports){function ModelDataSourceAdapter(model){this._model=model._materialize().treatErrorsAsValues()}ModelDataSourceAdapter.prototype.get=function get(pathSets){return this._model.get.apply(this._model,pathSets)._toJSONG()};ModelDataSourceAdapter.prototype.set=function set(jsongResponse){return this._model.set(jsongResponse)._toJSONG()};ModelDataSourceAdapter.prototype.call=function call(path,args,suffixes,paths){var params=[path,args,suffixes].concat(paths);return this._model.call.apply(this._model,params)._toJSONG()};module.exports=ModelDataSourceAdapter},{}],37:[function(require,module,exports){var isFunction=require("./support/isFunction");var hasOwn=require("./support/hasOwn");var ImmediateScheduler=require("./schedulers/ImmediateScheduler");function ModelRoot(o){var options=o||{};this.syncRefCount=0;this.expired=options.expired||[];this.unsafeMode=options.unsafeMode||false;this.collectionScheduler=options.collectionScheduler||new ImmediateScheduler;this.cache={};if(isFunction(options.comparator)){this.comparator=options.comparator}if(isFunction(options.errorSelector)){this.errorSelector=options.errorSelector}if(isFunction(options.onChange)){this.onChange=options.onChange}}ModelRoot.prototype.errorSelector=function errorSelector(x,y){return y};ModelRoot.prototype.comparator=function comparator(cacheNode,messageNode){if(hasOwn(cacheNode,"value")&&hasOwn(messageNode,"value")){return cacheNode.value===messageNode.value&&cacheNode.$type===messageNode.$type&&cacheNode.$expires===messageNode.$expires}return cacheNode===messageNode};module.exports=ModelRoot},{"./schedulers/ImmediateScheduler":107,"./support/hasOwn":124,"./support/isFunction":129}],38:[function(require,module,exports){var Rx=require("rx/dist/rx");var pathSyntax=require("falcor-path-syntax");module.exports=function deref(boundPathArg){var model=this;var pathsIndex=-1;var pathsCount=arguments.length-1;var paths=new Array(pathsCount);var boundPath=pathSyntax.fromPath(boundPathArg);while(++pathsIndex<pathsCount){paths[pathsIndex]=pathSyntax.fromPath(arguments[pathsIndex+1])}if(pathsCount===0){throw new Error("Model#deref requires at least one value path.")}return Rx.Observable.defer(function(){return derefSync(model,boundPath)}).flatMap(function(boundModel){if(Boolean(boundModel)){if(pathsCount>0){var ofBoundModel=Rx.Observable.of(boundModel);return boundModel.get.apply(boundModel,paths).catch(Rx.Observable.empty()).concat(ofBoundModel).last().flatMap(function getNextBoundModel(){return derefSync(model,boundPath)}).filter(function(x){return x})}return Rx.Observable.return(boundModel)}else if(pathsCount>0){var modifiedPaths=paths.map(function(path){return boundPath.concat(path)});return model.get.apply(model,modifiedPaths).concat(Rx.Observable.defer(function(){return derefSync(model,boundPath)})).last().filter(function(x){return x})}return Rx.Observable.empty()})};function derefSync(model,boundPath){var value;var errorHappened=false;try{++model._root.syncRefCount;value=model._derefSync(boundPath)}catch(e){value=e;errorHappened=true}finally{--model._root.syncRefCount}return errorHappened?Rx.Observable.throw(value):Rx.Observable.return(value)}},{"falcor-path-syntax":19,"rx/dist/rx":222}],39:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var getBoundValue=require("./../get/getBoundValue");var InvalidModelError=require("./../errors/InvalidModelError");var $atom=require("./../types/atom");module.exports=function derefSync(boundPathArg){var boundPath=pathSyntax.fromPath(boundPathArg);if(!Array.isArray(boundPath)){throw new Error("Model#derefSync must be called with an Array path.")}var boundValue=getBoundValue(this,this._path.concat(boundPath),false);var path=boundValue.path;var node=boundValue.value;var found=boundValue.found;if(!found||node===undefined||node.$type===$atom&&node.value===undefined){return undefined}if(node.$type){throw new InvalidModelError}return this._clone({_path:path})}},{"./../errors/InvalidModelError":41,"./../get/getBoundValue":46,"./../types/atom":151,"falcor-path-syntax":19}],40:[function(require,module,exports){function BoundJSONGraphModelError(){this.message=BoundJSONGraphModelError.message;this.stack=(new Error).stack}BoundJSONGraphModelError.prototype=new Error;BoundJSONGraphModelError.prototype.name="BoundJSONGraphModelError";BoundJSONGraphModelError.message="It is not legal to use the JSON Graph "+"format from a bound Model. JSON Graph format"+" can only be used from a root model.";module.exports=BoundJSONGraphModelError},{}],41:[function(require,module,exports){var NAME="InvalidModelError";var MESSAGE="The boundPath of the model is not valid since a value or error was found before the path end.";function InvalidModelError(boundPath,shortedPath){this.message=MESSAGE;this.stack=(new Error).stack;this.boundPath=boundPath;this.shortedPath=shortedPath}InvalidModelError.prototype=new Error;InvalidModelError.prototype.name=NAME;InvalidModelError.message=MESSAGE;module.exports=InvalidModelError},{}],42:[function(require,module,exports){var NAME="InvalidSourceError";function InvalidSourceError(error){this.message="An exception was thrown when making a request.";this.stack=(new Error).stack;this.innerError=error}InvalidSourceError.prototype=new Error;InvalidSourceError.prototype.name=NAME;InvalidSourceError.is=function(e){return e&&e.name===NAME};module.exports=InvalidSourceError},{}],43:[function(require,module,exports){var NAME="MaxRetryExceededError";function MaxRetryExceededError(){this.message="The allowed number of retries have been exceeded.";this.stack=(new Error).stack}MaxRetryExceededError.prototype=new Error;MaxRetryExceededError.prototype.name=NAME;MaxRetryExceededError.is=function(e){return e&&e.name===NAME};module.exports=MaxRetryExceededError},{}],44:[function(require,module,exports){var hardLink=require("./../get/util/hardlink");var createHardlink=hardLink.create;var onValue=require("./../get/onValue");var isExpired=require("./../get/util/isExpired");var $ref=require("./../types/ref");var __context=require("./../internal/context");var promote=require("./../get/util/lru").promote;function followReference(model,root,nodeArg,referenceContainerArg,referenceArg,seed,isJSONG){var node=nodeArg;var reference=referenceArg;var referenceContainer=referenceContainerArg;var depth=0;var k,next;while(true){if(depth===0&&referenceContainer[__context]){depth=reference.length;next=referenceContainer[__context]}else{k=reference[depth++];next=node[k]}if(next){var type=next.$type;var value=type&&next.value||next;if(depth<reference.length){if(type){node=next;break}node=next;continue}else{node=next;if(type&&isExpired(next)){break}if(!referenceContainer[__context]){createHardlink(referenceContainer,next)}if(type===$ref){if(isJSONG){onValue(model,next,seed,null,null,null,reference,reference.length,isJSONG)}else{promote(model,next)}depth=0;reference=value;referenceContainer=next;node=root;continue}break}}else{node=void 0}break}if(depth<reference.length&&node!==void 0){var ref=[];for(var i=0;i<depth;i++){ref[i]=reference[i]}reference=ref}return[node,reference]}module.exports=followReference},{"./../get/onValue":55,"./../get/util/hardlink":59,"./../get/util/isExpired":60,"./../get/util/lru":62,"./../internal/context":66,"./../types/ref":153}],45:[function(require,module,exports){var getCachePosition=require("./../get/getCachePosition");var InvalidModelError=require("./../errors/InvalidModelError");var BoundJSONGraphModelError=require("./../errors/BoundJSONGraphModelError");module.exports=function get(walk,isJSONG){return function innerGet(model,paths,seed){var valueNode=seed[0];var results={values:seed,optimizedPaths:[]};var cache=model._root.cache;var boundPath=model._path;var currentCachePosition=cache;var optimizedPath,optimizedLength=boundPath.length;var i,len;var requestedPath=[];if(optimizedLength){if(isJSONG){return{criticalError:new BoundJSONGraphModelError}}currentCachePosition=getCachePosition(model,boundPath);if(currentCachePosition.$type){return{criticalError:new InvalidModelError(boundPath,boundPath)}}optimizedPath=[];for(i=0;i<optimizedLength;++i){optimizedPath[i]=boundPath[i]}}else{optimizedPath=[];optimizedLength=0}for(i=0,len=paths.length;i<len;i++){walk(model,cache,currentCachePosition,paths[i],0,valueNode,results,requestedPath,optimizedPath,optimizedLength,isJSONG)}return results}}},{"./../errors/BoundJSONGraphModelError":40,"./../errors/InvalidModelError":41,"./../get/getCachePosition":48}],46:[function(require,module,exports){var getValueSync=require("./../get/getValueSync");var InvalidModelError=require("./../errors/InvalidModelError");module.exports=function getBoundValue(model,pathArg,materialized){var path=pathArg;var boundPath=pathArg;var boxed,treatErrorsAsValues,value,shorted,found;boxed=model._boxed;materialized=model._materialized;treatErrorsAsValues=model._treatErrorsAsValues;model._boxed=true;model._materialized=materialized===undefined||materialized;model._treatErrorsAsValues=true;value=getValueSync(model,path.concat(null),true);model._boxed=boxed;model._materialized=materialized;model._treatErrorsAsValues=treatErrorsAsValues;path=value.optimizedPath;shorted=value.shorted;found=value.found;value=value.value;while(path.length&&path[path.length-1]===null){path.pop()}if(found&&shorted){throw new InvalidModelError(boundPath,path)}return{path:path,value:value,shorted:shorted,found:found}}},{"./../errors/InvalidModelError":41,"./../get/getValueSync":50}],47:[function(require,module,exports){var $modelCreated=require("./../internal/model-created");var isInternalKey=require("./../support/isInternalKey");module.exports=function getCache(cache){var out={};_copyCache(cache,out);return out};function cloneBoxedValue(boxedValue){var clonedValue={};var keys=Object.keys(boxedValue);var key;var i;var l;for(i=0,l=keys.length;i<l;i++){key=keys[i];if(!isInternalKey(key)){clonedValue[key]=boxedValue[key]}}return clonedValue}function _copyCache(node,out,fromKey){Object.keys(node).filter(function(k){return!isInternalKey(k)&&node[k]}).forEach(function(key){var cacheNext=node[key];var outNext=out[key];if(!outNext){outNext=out[key]={}}if(cacheNext.$type){var isObject=cacheNext.value&&typeof cacheNext.value==="object";var isUserCreatedcacheNext=!node[$modelCreated];var value;if(isObject||isUserCreatedcacheNext){value=cloneBoxedValue(cacheNext)}else{value=cacheNext.value}out[key]=value;return}_copyCache(cacheNext,outNext,key)})}},{"./../internal/model-created":70,"./../support/isInternalKey":130}],48:[function(require,module,exports){module.exports=function getCachePosition(model,path){var currentCachePosition=model._root.cache;var depth=-1;var maxDepth=path.length;while(++depth<maxDepth&&currentCachePosition&&!currentCachePosition.$type){currentCachePosition=currentCachePosition[path[depth]]}return currentCachePosition}},{}],49:[function(require,module,exports){var ModelResponse=require("./../response/ModelResponse");var pathSyntax=require("falcor-path-syntax");module.exports=function getValue(path){var parsedPath=pathSyntax.fromPath(path);var pathIdx=0;var pathLen=parsedPath.length;while(++pathIdx<pathLen){if(typeof parsedPath[pathIdx]==="object"){return new ModelResponse(function(o){
o.onError(new Error("Paths must be simple paths"))})}}var self=this;return new ModelResponse(function(obs){return self.get(parsedPath).subscribe(function(data){var curr=data.json;var depth=-1;var length=parsedPath.length;while(curr&&++depth<length){curr=curr[parsedPath[depth]]}obs.onNext(curr)},function(err){obs.onError(err)},function(){obs.onCompleted()})})}},{"./../response/ModelResponse":97,"falcor-path-syntax":19}],50:[function(require,module,exports){var followReference=require("./../get/followReference");var clone=require("./../get/util/clone");var isExpired=require("./../get/util/isExpired");var promote=require("./../get/util/lru").promote;var $ref=require("./../types/ref");var $atom=require("./../types/atom");var $error=require("./../types/error");module.exports=function getValueSync(model,simplePath,noClone){var root=model._root.cache;var len=simplePath.length;var optimizedPath=[];var shorted=false,shouldShort=false;var depth=0;var key,i,next=root,curr=root,out=root,type,ref,refNode;var found=true;var expired=false;while(next&&depth<len){key=simplePath[depth++];if(key!==null){next=curr[key];optimizedPath[optimizedPath.length]=key}if(!next){out=undefined;shorted=true;found=false;break}type=next.$type;if(type===$atom&&next.value===undefined){out=undefined;found=false;shorted=depth<len;break}if(depth<len){if(type===$ref){if(isExpired(next)){expired=true;out=undefined;found=false;break}ref=followReference(model,root,root,next,next.value);refNode=ref[0];if(!refNode){out=void 0;next=void 0;found=false;break}type=refNode.$type;next=refNode;optimizedPath=ref[1].slice(0)}if(type){break}}else{out=next}curr=next}if(depth<len&&!expired){for(i=depth;i<len;++i){if(simplePath[depth]!==null){shouldShort=true;break}}if(shouldShort){shorted=true;out=void 0}else{out=next}for(i=depth;i<len;++i){if(simplePath[i]!==null){optimizedPath[optimizedPath.length]=simplePath[i]}}}if(out&&type){if(isExpired(out)){out=void 0}else{promote(model,out)}}if(out&&type===$error&&!model._treatErrorsAsValues){throw{path:depth===len?simplePath:simplePath.slice(0,depth),value:out.value}}else if(out&&model._boxed){out=Boolean(type)&&!noClone?clone(out):out}else if(!out&&model._materialized){out={$type:$atom}}else if(out){out=out.value}return{value:out,shorted:shorted,optimizedPath:optimizedPath,found:found}}},{"./../get/followReference":44,"./../get/util/clone":58,"./../get/util/isExpired":60,"./../get/util/lru":62,"./../types/atom":151,"./../types/error":152,"./../types/ref":153}],51:[function(require,module,exports){var __version=require("./../internal/version");module.exports=function _getVersion(model,path){var gen=model._getValueSync({_boxed:true,_root:model._root,_treatErrorsAsValues:model._treatErrorsAsValues},path,true).value;var version=gen&&gen[__version];return version==null?-1:version}},{"./../internal/version":79}],52:[function(require,module,exports){var get=require("./get");var walkPath=require("./walkPath");var getWithPathsAsPathMap=get(walkPath,false);var getWithPathsAsJSONGraph=get(walkPath,true);module.exports={getValueSync:require("./../get/getValueSync"),getBoundValue:require("./../get/getBoundValue"),getWithPathsAsPathMap:getWithPathsAsPathMap,getWithPathsAsJSONGraph:getWithPathsAsJSONGraph}},{"./../get/getBoundValue":46,"./../get/getValueSync":50,"./get":45,"./walkPath":64}],53:[function(require,module,exports){var lru=require("./../get/util/lru");var clone=require("./../get/util/clone");var promote=lru.promote;module.exports=function onError(model,node,depth,requestedPath,outerResults){var value=node.value;if(!outerResults.errors){outerResults.errors=[]}if(model._boxed){value=clone(node)}outerResults.errors.push({path:requestedPath.slice(0,depth+1),value:value});promote(model,node)}},{"./../get/util/clone":58,"./../get/util/lru":62}],54:[function(require,module,exports){var support=require("./util/support");var fastCopy=support.fastCopy;module.exports=function onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength){var pathSlice;if(!outerResults.requestedMissingPaths){outerResults.requestedMissingPaths=[];outerResults.optimizedMissingPaths=[]}if(depth<path.length){pathSlice=fastCopy(path,depth)}else{pathSlice=[]}concatAndInsertMissing(model,pathSlice,depth,requestedPath,optimizedPath,optimizedLength,outerResults)};function concatAndInsertMissing(model,remainingPath,depth,requestedPath,optimizedPath,optimizedLength,results){results.requestedMissingPaths.push(requestedPath.slice(0,depth).concat(remainingPath));results.optimizedMissingPaths.push(optimizedPath.slice(0,optimizedLength).concat(remainingPath))}},{"./util/support":63}],55:[function(require,module,exports){var lru=require("./util/lru");var clone=require("./util/clone");var promote=lru.promote;var $ref=require("./../types/ref");var $atom=require("./../types/atom");var $error=require("./../types/error");var $modelCreated=require("./../internal/model-created");module.exports=function onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference){if(!seed){return}var i,len,k,key,curr,prev,prevK;var materialized=false,valueNode;if(node){promote(model,node)}if(!node||node.value===undefined){materialized=model._materialized}if(materialized){valueNode={$type:$atom}}else if(model._boxed){valueNode=clone(node)}else if(node.$type===$ref||node.$type===$error){if(isJSONG){valueNode=clone(node)}else{valueNode=node.value}}else if(isJSONG){var isObject=node.value&&typeof node.value==="object";var isUserCreatedNode=!node[$modelCreated];if(isObject||isUserCreatedNode){valueNode=clone(node)}else{valueNode=node.value}}else{valueNode=node.value}if(outerResults){outerResults.hasValue=true}if(isJSONG){curr=seed.jsonGraph;if(!curr){curr=seed.jsonGraph={};seed.paths=[]}for(i=0,len=optimizedLength-1;i<len;i++){key=optimizedPath[i];if(!curr[key]){curr[key]={}}curr=curr[key]}key=optimizedPath[i];curr[key]=materialized?{$type:$atom}:valueNode;if(requestedPath){seed.paths.push(requestedPath.slice(0,depth))}}else if(depth===0){seed.json=valueNode}else{curr=seed.json;if(!curr){curr=seed.json={}}for(i=0;i<depth-1;i++){k=requestedPath[i];if(!curr[k]){curr[k]={}}prev=curr;prevK=k;curr=curr[k]}k=requestedPath[i];if(k!==null){curr[k]=valueNode}else{prev[prevK]=valueNode}}}},{"./../internal/model-created":70,"./../types/atom":151,"./../types/error":152,"./../types/ref":153,"./util/clone":58,"./util/lru":62}],56:[function(require,module,exports){var isExpired=require("./util/isExpired");var hardLink=require("./util/hardlink");var lru=require("./util/lru");var removeHardlink=hardLink.remove;var splice=lru.splice;var $error=require("./../types/error");var onError=require("./onError");var onValue=require("./onValue");var onMissing=require("./onMissing");var isMaterialized=require("./util/isMaterialzed");var __invalidated=require("./../internal/invalidated");module.exports=function onValueType(model,node,path,depth,seed,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference){var currType=node&&node.$type;var requiresMaterializedToReport=node&&node.value===undefined;if(!node||!currType){if(isMaterialized(model)){onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference)}else{onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength)}return}else if(isExpired(node)){if(!node[__invalidated]){splice(model,node);removeHardlink(node)}onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength)}else if(currType===$error){if(fromReference){requestedPath[depth]=null}if(isJSONG||model._treatErrorsAsValues){onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference)}else{onError(model,node,depth,requestedPath,outerResults)}}else{if(fromReference){requestedPath[depth]=null}if(!requiresMaterializedToReport||requiresMaterializedToReport&&model._materialized){onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference)}}}},{"./../internal/invalidated":68,"./../types/error":152,"./onError":53,"./onMissing":54,"./onValue":55,"./util/hardlink":59,"./util/isExpired":60,"./util/isMaterialzed":61,"./util/lru":62}],57:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");module.exports=function getValueSync(pathArg){var path=pathSyntax.fromPath(pathArg);if(Array.isArray(path)===false){throw new Error("Model#getValueSync must be called with an Array path.")}if(this._path.length){path=this._path.concat(path)}return this._syncCheck("getValueSync")&&this._getValueSync(this,path).value}},{"falcor-path-syntax":19}],58:[function(require,module,exports){var prefix=require("./../../internal/prefix");module.exports=function clone(node){var outValue,i,len;var keys=Object.keys(node);outValue={};for(i=0,len=keys.length;i<len;i++){var k=keys[i];if(k[0]===prefix){continue}outValue[k]=node[k]}return outValue}},{"./../../internal/prefix":73}],59:[function(require,module,exports){var __ref=require("./../../internal/ref");var __context=require("./../../internal/context");var __refIndex=require("./../../internal/ref-index");var __refsLength=require("./../../internal/refs-length");function createHardlink(from,to){var backRefs=to[__refsLength]||0;to[__ref+backRefs]=from;to[__refsLength]=backRefs+1;from[__refIndex]=backRefs;from[__context]=to}function removeHardlink(cacheObject){var context=cacheObject[__context];if(context){var idx=cacheObject[__refIndex];var len=context[__refsLength];while(idx<len){context[__ref+idx]=context[__ref+idx+1];++idx}context[__refsLength]=len-1;cacheObject[__context]=void 0;cacheObject[__refIndex]=void 0}}module.exports={create:createHardlink,remove:removeHardlink}},{"./../../internal/context":66,"./../../internal/ref":76,"./../../internal/ref-index":75,"./../../internal/refs-length":77}],60:[function(require,module,exports){var now=require("./../../support/now");module.exports=function isExpired(node){var $expires=node.$expires===void 0&&-1||node.$expires;return $expires!==-1&&$expires!==1&&($expires===0||$expires<now())}},{"./../../support/now":139}],61:[function(require,module,exports){module.exports=function isMaterialized(model){return model._materialized&&!model._source}},{}],62:[function(require,module,exports){var __head=require("./../../internal/head");var __tail=require("./../../internal/tail");var __next=require("./../../internal/next");var __prev=require("./../../internal/prev");var __invalidated=require("./../../internal/invalidated");function lruPromote(model,object){var root=model._root;var head=root[__head];if(head===object){return}var prev=object[__prev];var next=object[__next];if(next){next[__prev]=prev}if(prev){prev[__next]=next}object[__prev]=void 0;root[__head]=object;object[__next]=head;head[__prev]=object}function lruSplice(model,object){var root=model._root;var prev=object[__prev];var next=object[__next];if(next){next[__prev]=prev}if(prev){prev[__next]=next}object[__prev]=void 0;if(object===root[__head]){root[__head]=void 0}if(object===root[__tail]){root[__tail]=void 0}object[__invalidated]=true;root.expired.push(object)}module.exports={promote:lruPromote,splice:lruSplice}},{"./../../internal/head":67,"./../../internal/invalidated":68,"./../../internal/next":71,"./../../internal/prev":74,"./../../internal/tail":78}],63:[function(require,module,exports){function fastCopy(arr,iArg){var a=[],len,j,i;for(j=0,i=iArg||0,len=arr.length;i<len;j++,i++){a[j]=arr[i]}return a}function fastCatSkipNulls(arr1,arr2){var a=[],i,len,j;for(i=0,len=arr1.length;i<len;i++){a[i]=arr1[i]}for(j=0,len=arr2.length;j<len;j++){if(arr2[j]!==null){a[i++]=arr2[j]}}return a}function fastCat(arr1,arr2){var a=[],i,len,j;for(i=0,len=arr1.length;i<len;i++){a[i]=arr1[i]}for(j=0,len=arr2.length;j<len;j++){a[i++]=arr2[j]}return a}module.exports={fastCat:fastCat,fastCatSkipNulls:fastCatSkipNulls,fastCopy:fastCopy}},{}],64:[function(require,module,exports){var followReference=require("./followReference");var onValueType=require("./onValueType");var isExpired=require("./util/isExpired");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var $ref=require("./../types/ref");var promote=require("./util/lru").promote;module.exports=function walkPath(model,root,curr,path,depth,seed,outerResults,requestedPath,optimizedPathArg,optimizedLength,isJSONG,fromReferenceArg){var fromReference=fromReferenceArg;var optimizedPath=optimizedPathArg;if(!curr||curr&&curr.$type||depth===path.length){onValueType(model,curr,path,depth,seed,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference);return}var keySet,i;keySet=path[depth];var isKeySet=typeof keySet==="object";var nextDepth=depth+1;var iteratorNote=false;var key=keySet;if(isKeySet){iteratorNote={};key=iterateKeySet(keySet,iteratorNote)}if(key===undefined&&iteratorNote.done){return}var optimizedLengthPlus1=optimizedLength+1;do{fromReference=false;var next;if(key===null){next=curr}else{next=curr[key];optimizedPath[optimizedLength]=key;requestedPath[depth]=key}var nextOptimizedPath=optimizedPath;var nextOptimizedLength=optimizedLengthPlus1;if(next){var nType=next.$type;var value=nType&&next.value||next;if(nextDepth<path.length&&nType&&nType===$ref&&!isExpired(next)){if(isJSONG){onValueType(model,next,path,nextDepth,seed,outerResults,null,optimizedPath,nextOptimizedLength,isJSONG,fromReference)}promote(model,next);var ref=followReference(model,root,root,next,value,seed,isJSONG);fromReference=true;next=ref[0];var refPath=ref[1];nextOptimizedPath=[];nextOptimizedLength=refPath.length;for(i=0;i<nextOptimizedLength;++i){nextOptimizedPath[i]=refPath[i]}}}walkPath(model,root,next,path,nextDepth,seed,outerResults,requestedPath,nextOptimizedPath,nextOptimizedLength,isJSONG,fromReference);if(iteratorNote&&!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(iteratorNote&&!iteratorNote.done)}},{"./../types/ref":153,"./followReference":44,"./onValueType":56,"./util/isExpired":60,"./util/lru":62,"falcor-path-utils":28}],65:[function(require,module,exports){"use strict";function falcor(opts){return new falcor.Model(opts)}if(typeof Promise==="function"){falcor.Promise=Promise}else{falcor.Promise=require("promise")}module.exports=falcor;falcor.Model=require("./Model")},{"./Model":35,promise:187}],66:[function(require,module,exports){module.exports=require("./../internal/prefix")+"context"},{"./../internal/prefix":73}],67:[function(require,module,exports){module.exports=require("./../internal/prefix")+"head"},{"./../internal/prefix":73}],68:[function(require,module,exports){module.exports=require("./../internal/prefix")+"invalidated"},{"./../internal/prefix":73}],69:[function(require,module,exports){module.exports=require("./../internal/prefix")+"key"},{"./../internal/prefix":73}],70:[function(require,module,exports){module.exports="$modelCreated"},{}],71:[function(require,module,exports){module.exports=require("./../internal/prefix")+"next"},{"./../internal/prefix":73}],72:[function(require,module,exports){module.exports=require("./../internal/prefix")+"parent"},{"./../internal/prefix":73}],73:[function(require,module,exports){module.exports=String.fromCharCode(30)},{}],74:[function(require,module,exports){module.exports=require("./../internal/prefix")+"prev"},{"./../internal/prefix":73}],75:[function(require,module,exports){module.exports=require("./../internal/prefix")+"ref-index"},{"./../internal/prefix":73}],76:[function(require,module,exports){module.exports=require("./../internal/prefix")+"ref"},{"./../internal/prefix":73}],77:[function(require,module,exports){module.exports=require("./../internal/prefix")+"refs-length"},{"./../internal/prefix":73}],78:[function(require,module,exports){module.exports=require("./../internal/prefix")+"tail"},{"./../internal/prefix":73}],79:[function(require,module,exports){module.exports=require("./../internal/prefix")+"version"},{"./../internal/prefix":73}],80:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __prefix=require("./../internal/prefix");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var getSize=require("./../support/getSize");var hasOwn=require("./../support/hasOwn");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var incrementVersion=require("./../support/incrementVersion");var updateNodeAncestors=require("./../support/updateNodeAncestors");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function invalidatePathMaps(model,pathMapEnvelopes){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var comparator=modelRoot._comparator;var errorSelector=modelRoot._errorSelector;var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var pathMapIndex=-1;var pathMapCount=pathMapEnvelopes.length;while(++pathMapIndex<pathMapCount){var pathMapEnvelope=pathMapEnvelopes[pathMapIndex];invalidatePathMap(pathMapEnvelope.json,0,cache,parent,node,version,expired,lru,comparator,errorSelector)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}};function invalidatePathMap(pathMap,depth,root,parent,node,version,expired,lru,comparator,errorSelector){if(isPrimitive(pathMap)||pathMap.$type){return}for(var key in pathMap){if(key[0]!==__prefix&&key[0]!=="$"&&hasOwn(pathMap,key)){var child=pathMap[key];var branch=isObject(child)&&!child.$type;var results=invalidateNode(root,parent,node,key,child,branch,false,version,expired,lru,comparator,errorSelector);var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){invalidatePathMap(child,depth+1,root,nextParent,nextNode,version,expired,lru,comparator,errorSelector)}else if(removeNodeAndDescendants(nextNode,nextParent,key,lru)){updateNodeAncestors(nextParent,getSize(nextNode),lru,version)}}}}}function invalidateReference(value,root,node,version,expired,lru,comparator,errorSelector){if(isExpired(node)){expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var reference=node.value;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=invalidateNode(root,parent,node,key,value,branch,true,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1]}while(index++<count);if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function invalidateNode(root,parent,node,key,value,branch,reference,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=invalidateReference(value,root,node,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node&&node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}return[node,parent]}},{"./../get/getBoundValue":46,"./../internal/context":66,"./../internal/key":69,"./../internal/parent":72,"./../internal/prefix":73,"./../internal/ref":76,"./../internal/ref-index":75,"./../internal/refs-length":77,"./../internal/version":79,"./../lru/promote":83,"./../support/expireNode":119,"./../support/getSize":121,"./../support/hasOwn":124,"./../support/incrementVersion":125,"./../support/isExpired":128,"./../support/isFunction":129,"./../support/isObject":133,"./../support/isPrimitive":135,"./../support/removeNodeAndDescendants":142,"./../support/updateNodeAncestors":148,"./../types/ref":153}],81:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var getSize=require("./../support/getSize");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var updateNodeAncestors=require("./../support/updateNodeAncestors");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function invalidatePathSets(model,paths){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var pathIndex=-1;var pathCount=paths.length;while(++pathIndex<pathCount){var path=paths[pathIndex];invalidatePathSet(path,0,cache,parent,node,version,expired,lru)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}};function invalidatePathSet(path,depth,root,parent,node,version,expired,lru){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);do{var results=invalidateNode(root,parent,node,key,branch,false,version,expired,lru);var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){invalidatePathSet(path,depth+1,root,nextParent,nextNode,version,expired,lru)}else if(removeNodeAndDescendants(nextNode,nextParent,key,lru)){updateNodeAncestors(nextParent,getSize(nextNode),lru,version)}}key=iterateKeySet(keySet,note)}while(!note.done)}function invalidateReference(root,node,version,expired,lru){if(isExpired(node)){expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var reference=node.value;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=invalidateNode(root,parent,node,key,branch,true,version,expired,lru);node=results[0];if(isPrimitive(node)){return results}parent=results[1]}while(index++<count);if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function invalidateNode(root,parent,node,key,branch,reference,version,expired,lru){var type=node.$type;while(type===$ref){var results=invalidateReference(root,node,version,expired,lru);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}return[node,parent]}},{"./../get/getBoundValue":46,"./../internal/context":66,"./../internal/key":69,"./../internal/parent":72,"./../internal/ref":76,"./../internal/ref-index":75,"./../internal/refs-length":77,"./../internal/version":79,"./../lru/promote":83,"./../support/expireNode":119,"./../support/getSize":121,"./../support/incrementVersion":125,"./../support/isExpired":128,"./../support/isFunction":129,"./../support/isPrimitive":135,"./../support/removeNodeAndDescendants":142,"./../support/updateNodeAncestors":148,"./../types/ref":153,"falcor-path-utils":28}],82:[function(require,module,exports){var __key=require("./../internal/key");var __parent=require("./../internal/parent");var __head=require("./../internal/head");var __tail=require("./../internal/tail");var __next=require("./../internal/next");var __prev=require("./../internal/prev");var removeNode=require("./../support/removeNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");module.exports=function collect(lru,expired,totalArg,max,ratioArg,version){var total=totalArg;var ratio=ratioArg;if(typeof ratio!=="number"){ratio=.75}var shouldUpdate=typeof version==="number";var targetSize=max*ratio;var parent,node,size;node=expired.pop();while(node){size=node.$size||0;total-=size;if(shouldUpdate===true){updateNodeAncestors(node,size,lru,version)}else if(parent=node[__parent]){removeNode(node,parent,node[__key],lru)}node=expired.pop()}if(total>=max){var prev=lru[__tail];node=prev;while(total>=targetSize&&node){prev=prev[__prev];size=node.$size||0;total-=size;if(shouldUpdate===true){updateNodeAncestors(node,size,lru,version)}node=prev}lru[__tail]=lru[__prev]=node;if(node==null){lru[__head]=lru[__next]=void 0}else{node[__next]=void 0}}}},{"./../internal/head":67,"./../internal/key":69,"./../internal/next":71,"./../internal/parent":72,"./../internal/prev":74,"./../internal/tail":78,"./../support/removeNode":141,"./../support/updateNodeAncestors":148}],83:[function(require,module,exports){var $expiresNever=require("./../values/expires-never");var __head=require("./../internal/head");var __tail=require("./../internal/tail");var __next=require("./../internal/next");var __prev=require("./../internal/prev");var isObject=require("./../support/isObject");module.exports=function lruPromote(root,node){if(isObject(node)&&node.$expires!==$expiresNever){var head=root[__head],tail=root[__tail],next=node[__next],prev=node[__prev];if(node!==head){if(next!=null&&typeof next==="object"){next[__prev]=prev}if(prev!=null&&typeof prev==="object"){prev[__next]=next}next=head;if(head!=null&&typeof head==="object"){head[__prev]=node}root[__head]=root[__next]=head=node;head[__next]=next;head[__prev]=void 0}if(tail==null||node===tail){root[__tail]=root[__prev]=tail=prev||node}}return node}},{"./../internal/head":67,"./../internal/next":71,"./../internal/prev":74,"./../internal/tail":78,"./../support/isObject":133,"./../values/expires-never":154}],84:[function(require,module,exports){var __head=require("./../internal/head");var __tail=require("./../internal/tail");var __next=require("./../internal/next");var __prev=require("./../internal/prev");module.exports=function lruSplice(root,node){var head=root[__head],tail=root[__tail],next=node[__next],prev=node[__prev];if(next!=null&&typeof next==="object"){next[__prev]=prev}if(prev!=null&&typeof prev==="object"){prev[__next]=next}if(node===head){root[__head]=root[__next]=next}if(node===tail){root[__tail]=root[__prev]=prev}node[__next]=node[__prev]=void 0;head=tail=next=prev=void 0}},{"./../internal/head":67,"./../internal/next":71,"./../internal/prev":74,"./../internal/tail":78}],85:[function(require,module,exports){var complement=require("./complement");var flushGetRequest=require("./flushGetRequest");var REQUEST_ID=0;var GetRequestType=require("./RequestTypes").GetRequest;var setJSONGraphs=require("./../set/setJSONGraphs");var setPathValues=require("./../set/setPathValues");var $error=require("./../types/error");var emptyArray=[];var GetRequestV2=function(scheduler,requestQueue){this.sent=false;this.scheduled=false;this.requestQueue=requestQueue;this.id=++REQUEST_ID;this.type=GetRequestType;this._scheduler=scheduler;this._pathMap={};this._optimizedPaths=[];this._requestedPaths=[];this._callbacks=[];this._count=0;this._disposable=null;this._collapsed=null;this._disposed=false};GetRequestV2.prototype={batch:function(requestedPaths,optimizedPaths,callback){var self=this;var oPaths=self._optimizedPaths;var rPaths=self._requestedPaths;var callbacks=self._callbacks;var idx=oPaths.length;oPaths[idx]=optimizedPaths;rPaths[idx]=requestedPaths;callbacks[idx]=callback;++self._count;if(!self.scheduled){self.scheduled=true;self._disposable=self._scheduler.schedule(function(){flushGetRequest(self,oPaths,function(err,data){self.requestQueue.removeRequest(self);self._disposed=true;if(self._count){self._merge(rPaths,err,data);for(var i=0,len=callbacks.length;i<len;++i){var fn=callbacks[i];if(fn){fn(err,data)}}}})})}return createDisposable(self,idx)},add:function(requested,optimized,callback){var self=this;var complementTuple=complement(requested,optimized,self._pathMap);var optimizedComplement;var requestedComplement;if(complementTuple){requestedComplement=complementTuple[2];optimizedComplement=complementTuple[1]}else{requestedComplement=requested;optimizedComplement=optimized}var inserted=false;var disposable=false;if(optimizedComplement.length<optimized.length){inserted=true;var idx=self._callbacks.length;self._callbacks[idx]=callback;self._requestedPaths[idx]=complementTuple[0];self._optimizedPaths[idx]=[];++self._count;disposable=createDisposable(self,idx)}return[inserted,requestedComplement,optimizedComplement,disposable]},_merge:function(requested,err,data){var self=this;var model=self.requestQueue.model;var modelRoot=model._root;var errorSelector=modelRoot.errorSelector;var comparator=modelRoot.comparator;var boundPath=model._path;model._path=emptyArray;var nextPaths=flattenRequestedPaths(requested);if(err){var error=err;if(error instanceof Error){error={message:error.message}}if(!error.$type){error={$type:$error,value:error}}var pathValues=nextPaths.map(function(x){return{path:x,value:error}});setPathValues(model,pathValues,null,errorSelector,comparator)}else{setJSONGraphs(model,[{paths:nextPaths,jsonGraph:data.jsonGraph}],null,errorSelector,comparator)}model._path=boundPath}};function createDisposable(request,idx){var disposed=false;return function(){if(disposed||request._disposed){return}disposed=true;request._callbacks[idx]=null;request._optimizedPaths[idx]=[];request._requestedPaths[idx]=[];var count=--request._count;if(count===0&&!request.sent){request._disposable.dispose();request.requestQueue.removeRequest(request)}}}function flattenRequestedPaths(requested){var out=[];var outLen=-1;for(var i=0,len=requested.length;i<len;++i){var paths=requested[i];for(var j=0,innerLen=paths.length;j<innerLen;++j){out[++outLen]=paths[j]}}return out}module.exports=GetRequestV2},{"./../set/setJSONGraphs":109,"./../set/setPathValues":111,"./../types/error":152,"./RequestTypes":90,"./complement":92,"./flushGetRequest":93}],86:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observer=Rx.Observer;var Observable=Rx.Observable;var Disposable=Rx.Disposable;var SerialDisposable=Rx.SerialDisposable;var CompositeDisposable=Rx.CompositeDisposable;var InvalidSourceError=require("./../errors/InvalidSourceError");var falcorPathUtils=require("falcor-path-utils");var iterateKeySet=falcorPathUtils.iterateKeySet;function Request(){this.length=0;this.pending=false;this.pathmaps=[];Observable.call(this,this._subscribe)}Request.create=function create(queue,model,index){var request=new this;request.queue=queue;request.model=model;request.index=index;return request};Request.prototype=Object.create(Observable.prototype);Request.prototype.constructor=Request;Request.prototype.insertPath=function insertPathIntoRequest(path,union,parentArg,indexArg,countArg){
var index=indexArg||0;var count=countArg||path.length-1;var parent=parentArg||this.pathmaps[count+1]||(this.pathmaps[count+1]=Object.create(null));if(parent===void 0||parent===null){return false}var key,node;var keySet=path[index];var iteratorNote={};key=iterateKeySet(keySet,iteratorNote);do{node=parent[key];if(index<count){if(node==null){if(union){return false}node=parent[key]=Object.create(null)}if(this.insertPath(path,union,node,index+1,count)===false){return false}}else{parent[key]=(node||0)+1;this.length+=1}if(!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(!iteratorNote.done);return true};Request.prototype.removePath=function removePathFromRequest(path,parentArg,indexArg,countArg){var index=indexArg||0;var count=countArg||path.length-1;var parent=parentArg||this.pathmaps[count+1];if(parent===void 0||parent===null){return true}var key,node,deleted=0;var keySet=path[index];var iteratorNote={};key=iterateKeySet(keySet,iteratorNote);do{node=parent[key];if(node===void 0||node===null){continue}else if(index<count){deleted+=this.removePath(path,node,index+1,count);var emptyNodeKey=void 0;for(emptyNodeKey in node){break}if(emptyNodeKey===void 0){delete parent[key]}}else{node=parent[key]=(node||1)-1;if(node===0){delete parent[key]}deleted+=1;this.length-=1}if(!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(!iteratorNote.done);return deleted};Request.prototype.getSourceObserver=function getSourceObserver(observer){var request=this;return Observer.create(function onNext(envelope){envelope.jsonGraph=envelope.jsonGraph||envelope.jsong||envelope.values||envelope.value;envelope.index=request.index;observer.onNext(envelope)},function onError(e){observer.onError(e)},function onCompleted(){observer.onCompleted()})};Request.prototype._subscribe=function _subscribe(observer){var request=this;var queue=this.queue;request.pending=true;var isDisposed=false;var sourceSubscription=new SerialDisposable;var queueDisposable=Disposable.create(function(){if(!isDisposed){isDisposed=true;if(queue){queue._remove(request)}}});var disposables=new CompositeDisposable(sourceSubscription,queueDisposable);try{sourceSubscription.setDisposable(this.model._source[this.method](this.getSourceArgs()).subscribe(this.getSourceObserver(observer)))}catch(e){throw new InvalidSourceError(e)}return disposables};module.exports=Request},{"./../errors/InvalidSourceError":42,"falcor-path-utils":28,"rx/dist/rx":222}],87:[function(require,module,exports){var SetRequest=require("./../request/SetRequest");var prefix=require("./../internal/prefix");var getType=require("./../support/getType");var isObject=require("./../support/isObject");var falcorPathUtils=require("falcor-path-utils");function RequestQueue(model,scheduler){this.total=0;this.model=model;this.requests=[];this.scheduler=scheduler}RequestQueue.prototype.set=function setRequest(jsonGraphEnvelope){jsonGraphEnvelope.paths=falcorPathUtils.collapse(jsonGraphEnvelope.paths);return SetRequest.create(this.model,jsonGraphEnvelope)};RequestQueue.prototype._remove=function removeRequest(request){var requests=this.requests;var index=requests.indexOf(request);if(index!==-1){requests.splice(index,1)}};RequestQueue.prototype.distributePaths=function distributePathsAcrossRequests(paths,requests,RequestType){var model=this.model;var pathsIndex=-1;var pathsCount=paths.length;var requestIndex=-1;var requestCount=requests.length;var participatingRequests=[];var pendingRequest;var request;insertPath:while(++pathsIndex<pathsCount){var path=paths[pathsIndex];requestIndex=-1;while(++requestIndex<requestCount){request=requests[requestIndex];if(request.insertPath(path,request.pending)){participatingRequests[requestIndex]=request;continue insertPath}}if(!pendingRequest){pendingRequest=RequestType.create(this,model,this.total++);requests[requestIndex]=pendingRequest;participatingRequests[requestCount++]=pendingRequest}pendingRequest.insertPath(path,false)}var pathRequests=[];var pathRequestsIndex=-1;requestIndex=-1;while(++requestIndex<requestCount){request=participatingRequests[requestIndex];if(request!=null){pathRequests[++pathRequestsIndex]=request}}return pathRequests};RequestQueue.prototype.mergeJSONGraphs=function mergeJSONGraphs(aggregate,response){var depth=0;var contexts=[];var messages=[];var keystack=[];var latestIndex=aggregate.index;var responseIndex=response.index;aggregate.index=Math.max(latestIndex,responseIndex);contexts[-1]=aggregate.jsonGraph||{};messages[-1]=response.jsonGraph||{};recursing:while(depth>-1){var context=contexts[depth-1];var message=messages[depth-1];var keys=keystack[depth-1]||(keystack[depth-1]=Object.keys(message));while(keys.length>0){var key=keys.pop();if(key[0]===prefix){continue}if(context.hasOwnProperty(key)){var node=context[key];var nodeType=getType(node);var messageNode=message[key];var messageType=getType(messageNode);if(isObject(node)&&isObject(messageNode)&&!nodeType&&!messageType){contexts[depth]=node;messages[depth]=messageNode;depth+=1;continue recursing}else if(responseIndex>latestIndex){context[key]=messageNode}}else{context[key]=message[key]}}depth-=1}return aggregate};module.exports=RequestQueue},{"./../internal/prefix":73,"./../request/SetRequest":91,"./../support/getType":123,"./../support/isObject":133,"falcor-path-utils":28}],88:[function(require,module,exports){var RequestQueue=require("./RequestQueue");var RequestQueueV2=require("./RequestQueueV2");function RequestQueueRx(model,scheduler){this.model=model;this.scheduler=scheduler;this.requests=this._requests=[]}RequestQueueRx.prototype.get=RequestQueueV2.prototype.get;RequestQueueRx.prototype.removeRequest=RequestQueueV2.prototype.removeRequest;RequestQueueRx.prototype.set=RequestQueue.prototype.set;RequestQueueRx.prototype.call=RequestQueue.prototype.call;module.exports=RequestQueueRx},{"./RequestQueue":87,"./RequestQueueV2":89}],89:[function(require,module,exports){var RequestTypes=require("./RequestTypes");var GetRequest=require("./GetRequestV2");function RequestQueueV2(model,scheduler){this.model=model;this.scheduler=scheduler;this.requests=this._requests=[]}RequestQueueV2.prototype={setScheduler:function(scheduler){this.scheduler=scheduler},get:function(requestedPaths,optimizedPaths,cb){var self=this;var disposables=[];var count=0;var requests=self._requests;var i,len;var oRemainingPaths=optimizedPaths;var rRemainingPaths=requestedPaths;var disposed=false;var request;for(i=0,len=requests.length;i<len;++i){request=requests[i];if(request.type!==RequestTypes.GetRequest){continue}if(request.sent){var results=request.add(rRemainingPaths,oRemainingPaths,refCountCallback);if(results[0]){rRemainingPaths=results[1];oRemainingPaths=results[2];disposables[disposables.length]=results[3];++count}}else{request.batch(rRemainingPaths,oRemainingPaths,refCountCallback);oRemainingPaths=[];rRemainingPaths=[];++count}if(!oRemainingPaths.length){break}}if(oRemainingPaths.length){request=new GetRequest(self.scheduler,self);requests[requests.length]=request;++count;var disposable=request.batch(rRemainingPaths,oRemainingPaths,refCountCallback);disposables[disposables.length]=disposable}function refCountCallback(){if(disposed){return}--count;if(count===0){cb()}}return function(){if(disposed||count===0){return}disposed=true;var length=disposables.length;for(var idx=0;idx<length;++idx){disposables[idx]()}}},removeRequest:function(request){var requests=this._requests;var i=requests.length;while(--i>=0){if(requests[i].id===request.id){requests.splice(i,1);break}}}};module.exports=RequestQueueV2},{"./GetRequestV2":85,"./RequestTypes":90}],90:[function(require,module,exports){module.exports={GetRequest:"GET"}},{}],91:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observer=Rx.Observer;var Request=require("./../request/Request");var arrayMap=require("./../support/array-map");var setJSONGraphs=require("./../set/setJSONGraphs");var setPathValues=require("./../set/setPathValues");var emptyArray=new Array(0);function SetRequest(){Request.call(this)}SetRequest.create=function create(model,jsonGraphEnvelope){var request=new SetRequest;request.model=model;request.jsonGraphEnvelope=jsonGraphEnvelope;return request};SetRequest.prototype=Object.create(Request.prototype);SetRequest.prototype.constructor=SetRequest;SetRequest.prototype.method="set";SetRequest.prototype.insertPath=function(){return false};SetRequest.prototype.removePath=function(){return 0};SetRequest.prototype.getSourceArgs=function getSourceArgs(){return this.jsonGraphEnvelope};SetRequest.prototype.getSourceObserver=function getSourceObserver(observer){var model=this.model;var bound=model._path;var paths=this.jsonGraphEnvelope.paths;var modelRoot=model._root;var errorSelector=modelRoot.errorSelector;var comparator=modelRoot.comparator;return Request.prototype.getSourceObserver.call(this,Observer.create(function onNext(jsonGraphEnvelope){model._path=emptyArray;var successfulPaths=setJSONGraphs(model,[{paths:paths,jsonGraph:jsonGraphEnvelope.jsonGraph}],null,errorSelector,comparator);jsonGraphEnvelope.paths=successfulPaths[1];model._path=bound;observer.onNext(jsonGraphEnvelope)},function onError(error){model._path=emptyArray;setPathValues(model,arrayMap(paths,function(path){return{path:path,value:error}}),null,errorSelector,comparator);model._path=bound;observer.onError(error)},function onCompleted(){observer.onCompleted()}))};module.exports=SetRequest},{"./../request/Request":86,"./../set/setJSONGraphs":109,"./../set/setPathValues":111,"./../support/array-map":116,"rx/dist/rx":222}],92:[function(require,module,exports){var hasIntersection=require("falcor-path-utils").hasIntersection;var arraySlice=require("./../support/array-slice");module.exports=function complement(requested,optimized,tree){var optimizedComplement=[];var requestedComplement=[];var requestedIntersection=[];var intersectionLength=-1,complementLength=-1;var intersectionFound=false;for(var i=0,len=optimized.length;i<len;++i){var path=optimized[i];var subTree=tree[path.length];if(!subTree||!hasIntersection(subTree,path,0)){if(intersectionFound){optimizedComplement[++complementLength]=path;requestedComplement[complementLength]=requested[i]}}else{if(!intersectionFound&&i>0){requestedComplement=arraySlice(requested,0,i);optimizedComplement=arraySlice(optimized,0,i)}requestedIntersection[++intersectionLength]=requested[i];intersectionFound=true}}if(!intersectionFound){return null}return[requestedIntersection,optimizedComplement,requestedComplement]}},{"./../support/array-slice":117,"falcor-path-utils":28}],93:[function(require,module,exports){var pathUtils=require("falcor-path-utils");var toTree=pathUtils.toTree;var toPaths=pathUtils.toPaths;module.exports=function flushGetRequest(request,listOfPaths,callback){if(request._count===0){request.requestQueue.removeRequest(request);return}request.sent=true;request.scheduled=false;var pathMap=request._pathMap;var listKeys=Object.keys(listOfPaths);var listIdx=0,listLen=listKeys.length;for(;listIdx<listLen;++listIdx){var paths=listOfPaths[listIdx];for(var j=0,pathLen=paths.length;j<pathLen;++j){var pathSet=paths[j];var len=pathSet.length;if(!pathMap[len]){pathMap[len]=[pathSet]}else{var pathSetsByLength=pathMap[len];pathSetsByLength[pathSetsByLength.length]=pathSet}}}var pathMapKeys=Object.keys(pathMap);var pathMapIdx=0,pathMapLen=pathMapKeys.length;for(;pathMapIdx<pathMapLen;++pathMapIdx){var pathMapKey=pathMapKeys[pathMapIdx];pathMap[pathMapKey]=toTree(pathMap[pathMapKey])}var collapsedPaths=request._collasped=toPaths(pathMap);var jsonGraphData;request.requestQueue.model._source.get(collapsedPaths).subscribe(function(data){jsonGraphData=data},function(err){callback(err,jsonGraphData)},function(){callback(null,jsonGraphData)})}},{"falcor-path-utils":28}],94:[function(require,module,exports){var Rx=require("rx/dist/rx")&&require("rx/dist/rx.aggregates");var Observable=Rx.Observable;var CompositeDisposable=Rx.CompositeDisposable;var ModelResponse=require("./../response/ModelResponse");var InvalidSourceError=require("./../errors/InvalidSourceError");var pathSyntax=require("falcor-path-syntax");var $ref=require("./../types/ref");function CallResponse(subscribe){Observable.call(this,subscribe||subscribeToResponse)}CallResponse.create=ModelResponse.create;CallResponse.prototype=Object.create(Observable.prototype);CallResponse.prototype.constructor=CallResponse;CallResponse.prototype.invokeSourceRequest=function invokeSourceRequest(model){return this};CallResponse.prototype.ensureCollect=function ensureCollect(model){return this};CallResponse.prototype.initialize=function initializeResponse(){return this};function toObservable(x){return Rx.Observable.defer(function(){return x})}function subscribeToResponse(observer){var args=this.args;var model=this.model;var callPath=pathSyntax.fromPath(args[0]);var callArgs=args[1]||[];var suffixes=(args[2]||[]).map(pathSyntax.fromPath);var extraPaths=(args[3]||[]).map(pathSyntax.fromPath);var rootModel=model._clone({_path:[]});var localRoot=rootModel.withoutDataSource();var boundPath=model._path;var boundCallPath=boundPath.concat(callPath);var boundThisPath=boundCallPath.slice(0,-1);var setCallValuesObs=toObservable(model.withoutDataSource().get(callPath)).map(function(data){var curr=data.json;var depth=-1;var length=callPath.length;while(curr&&++depth<length){curr=curr[callPath[depth]]}var boundModel=rootModel._derefSync(boundThisPath).boxValues();return{model:boundModel,localFn:curr}}).flatMap(getLocalCallObs).defaultIfEmpty(getRemoteCallObs(model._source)).mergeAll().flatMap(setCallEnvelope);var disposables=new CompositeDisposable;disposables.add(setCallValuesObs.subscribe(function(envelope){var paths=envelope.paths;var invalidated=envelope.invalidated;var innerObs=model.get.apply(model,paths);if(observer.outputFormat==="AsJSONG"){innerObs=toObservable(innerObs._toJSONG()).doAction(function(envelope2){envelope2.invalidated=invalidated})}disposables.add(innerObs.subscribe(observer))},function(e){observer.onError(e)}));return disposables;function getLocalCallObs(tuple){var localFn=tuple&&tuple.localFn;if(typeof localFn==="function"){var localFnModel=tuple.model;var localThisPath=localFnModel._path;var remoteGetValues=localFn.apply(localFnModel,callArgs).reduce(aggregateFnResults,{values:[],references:[],invalidations:[],localThisPath:localThisPath}).flatMap(setLocalValues).flatMap(getRemoteValues);return Observable.return(remoteGetValues)}return Observable.empty();function aggregateFnResults(results,pathValue){if(Boolean(pathValue.invalidated)){results.invalidations.push(results.localThisPath.concat(pathValue.path))}else{var path=pathValue.path;var value=pathValue.value;if(Boolean(value)&&typeof value==="object"&&value.$type===$ref){results.references.push({path:prependThisPath(path),value:pathValue.value})}else{results.values.push({path:prependThisPath(path),value:pathValue.value})}}return results}function setLocalValues(results){var values=results.values.concat(results.references);if(values.length>0){return toObservable(localRoot.set.apply(localRoot,values)._toJSONG()).map(function(envelope){return{results:results,envelope:envelope}})}else{return Observable.return({results:results,envelope:{jsonGraph:{},paths:[]}})}}function getRemoteValues(tuple2){var envelope=tuple2.envelope;var results=tuple2.results;var values=results.values;var references=results.references;var invalidations=results.invalidations;var rootValues=values.map(pluckPath).map(prependThisPath);var rootSuffixes=references.reduce(prependRefToSuffixes,[]);var rootExtraPaths=extraPaths.map(prependThisPath);var rootPaths=rootSuffixes.concat(rootExtraPaths);var envelopeObs;if(rootPaths.length>0){envelopeObs=toObservable(rootModel.get.apply(rootModel,rootValues.concat(rootPaths))._toJSONG())}else{envelopeObs=Observable.return(envelope)}return envelopeObs.doAction(function(envelope2){envelope2.invalidated=invalidations})}function prependRefToSuffixes(refPaths,refPathValue){var refPath=refPathValue.path;refPaths.push.apply(refPaths,suffixes.map(function(pathSuffix){return refPath.concat(pathSuffix)}));return refPaths}function pluckPath(pathValue){return pathValue.path}}function getRemoteCallObs(dataSource){if(dataSource&&typeof dataSource==="object"){return Rx.Observable.defer(function(){var obs;try{obs=dataSource.call(boundCallPath,callArgs,suffixes,extraPaths)}catch(e){obs=Observable.throw(new InvalidSourceError(e))}return obs}).map(invalidateLocalValues)}return Observable.empty();function invalidateLocalValues(envelope){var invalidations=envelope.invalidated;if(invalidations&&invalidations.length){rootModel.invalidate.apply(rootModel,invalidations)}return envelope}}function setCallEnvelope(envelope){return toObservable(localRoot.set(envelope)).reduce(function(acc){return acc},null).map(function(){return{invalidated:envelope.invalidated,paths:envelope.paths.map(function(path){return path.slice(boundPath.length)})}})}function prependThisPath(path){return boundThisPath.concat(path)}}module.exports=CallResponse},{"./../errors/InvalidSourceError":42,"./../response/ModelResponse":97,"./../types/ref":153,"falcor-path-syntax":19,"rx/dist/rx":222,"rx/dist/rx.aggregates":221}],95:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observable=Rx.Observable;var ModelResponse=require("./../response/ModelResponse");var pathSyntax=require("falcor-path-syntax");var getSize=require("./../support/getSize");var collectLru=require("./../lru/collect");var arrayClone=require("./../support/array-clone");var __version=require("./../internal/version");var isArray=Array.isArray;var isPathValue=require("./../support/isPathValue");var isJSONEnvelope=require("./../support/isJSONEnvelope");var isJSONGraphEnvelope=require("./../support/isJSONGraphEnvelope");function IdempotentResponse(subscribe){Observable.call(this,subscribe)}IdempotentResponse.create=ModelResponse.create;IdempotentResponse.prototype=Object.create(Observable.prototype);IdempotentResponse.prototype.constructor=IdempotentResponse;IdempotentResponse.prototype.subscribeCount=0;IdempotentResponse.prototype.subscribeLimit=10;IdempotentResponse.prototype.initialize=function initializeResponse(){var model=this.model;var outputFormat=this.outputFormat||"AsPathMap";var isProgressive=this.isProgressive;var values=[{}];var groups=[];var args=this.args;var group,groupType;var argIndex=-1;var argCount=args.length;while(++argIndex<argCount){var arg=args[argIndex];var argType;if(isArray(arg)||typeof arg==="string"){arg=pathSyntax.fromPath(arg);argType="PathValues"}else if(isPathValue(arg)){arg.path=pathSyntax.fromPath(arg.path);argType="PathValues"}else if(isJSONGraphEnvelope(arg)){argType="JSONGs"}else if(isJSONEnvelope(arg)){argType="PathMaps"}if(groupType!==argType){groupType=argType;group={inputType:argType,arguments:[]};groups.push(group);group.values=values}group.arguments.push(arg)}this.boundPath=arrayClone(model._path);this.groups=groups;this.outputFormat=outputFormat;this.isProgressive=isProgressive;this.isCompleted=false;this.isMaster=model._source==null;this.values=values;return this};IdempotentResponse.prototype.invokeSourceRequest=function invokeSourceRequest(model){return this};IdempotentResponse.prototype.ensureCollect=function ensureCollect(model){var ensured=this.finally(function ensureCollect(){var modelRoot=model._root;var modelCache=modelRoot.cache;modelRoot.collectionScheduler.schedule(function collectThisPass(){collectLru(modelRoot,modelRoot.expired,getSize(modelCache),model._maxSize,model._collectRatio,modelCache[__version])})});return new this.constructor(function(observer){return ensured.subscribe(observer)})};module.exports=IdempotentResponse},{"./../internal/version":79,"./../lru/collect":82,"./../response/ModelResponse":97,"./../support/array-clone":114,"./../support/getSize":121,"./../support/isJSONEnvelope":131,"./../support/isJSONGraphEnvelope":132,"./../support/isPathValue":134,"falcor-path-syntax":19,"rx/dist/rx":222}],96:[function(require,module,exports){var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;var IdempotentResponse=require("./../response/IdempotentResponse");function InvalidateResponse(subscribe){IdempotentResponse.call(this,subscribe||subscribeToInvalidateResponse)}InvalidateResponse.create=IdempotentResponse.create;InvalidateResponse.prototype=Object.create(IdempotentResponse.prototype);InvalidateResponse.prototype.method="invalidate";InvalidateResponse.prototype.constructor=InvalidateResponse;function subscribeToInvalidateResponse(observer){var model=this.model;var method=this.method;var groups=this.groups;var groupIndex=-1;var groupCount=groups.length;while(++groupIndex<groupCount){var group=groups[groupIndex];var inputType=group.inputType;var methodArgs=group.arguments;if(methodArgs.length>0){var operationName="_"+method+inputType+"AsJSON";var operationFunc=model[operationName];operationFunc(model,methodArgs)}}observer.onCompleted();return Disposable.empty}module.exports=InvalidateResponse},{"./../response/IdempotentResponse":95,"rx/dist/rx":222}],97:[function(require,module,exports){var falcor=require("./../");var Rx=require("rx/dist/rx")&&require("rx/dist/rx.aggregates");var Observable=Rx.Observable;var arraySlice=require("./../support/array-slice");var noop=require("./../support/noop");var jsongMixin={outputFormat:{value:"AsJSONG"}};var progressiveMixin={isProgressive:{value:true}};function ModelResponse(subscribe){this._subscribe=subscribe}ModelResponse.create=function create(model,args){var response=new ModelResponse(subscribeToResponse);response.args=args;response.type=this;response.model=model;return response};ModelResponse.prototype=Object.create(Observable.prototype);ModelResponse.prototype.constructor=ModelResponse;ModelResponse.prototype._mixin=function mixin(){var self=this;var mixins=arraySlice(arguments);return new self.constructor(function(observer){return self.subscribe(mixins.reduce(function(proto,mixin2){return Object.create(proto,mixin2)},observer))})};ModelResponse.prototype._toJSONG=function toJSONG(){return this._mixin(jsongMixin)};ModelResponse.prototype.progressively=function progressively(){return this._mixin(progressiveMixin)};ModelResponse.prototype.subscribe=function subscribe(a,b,c){var observer=a;if(!observer||typeof observer!=="object"){observer={onNext:a||noop,onError:b||noop,onCompleted:c||noop}}var subscription=this._subscribe(observer);switch(typeof subscription){case"function":return{dispose:subscription};case"object":return subscription||{dispose:noop};default:return{dispose:noop}}};ModelResponse.prototype.then=function then(onNext,onError){var self=this;return new falcor.Promise(function(resolve,reject){var value,rejected=false;self.toArray().subscribe(function(values){if(values.length<=1){value=values[0]}else{value=values}},function(errors){rejected=true;reject(errors)},function(){if(rejected===false){resolve(value)}})}).then(onNext,onError)};function subscribeToResponse(observer){var model=this.model;var response=new this.type;response.model=model;response.args=this.args;response.outputFormat=observer.outputFormat||"AsPathMap";response.isProgressive=observer.isProgressive||false;response.subscribeCount=0;response.subscribeLimit=observer.retryLimit||10;return response.initialize().invokeSourceRequest(model).ensureCollect(model).subscribe(observer)}module.exports=ModelResponse},{"./../":65,"./../support/array-slice":117,"./../support/noop":138,"rx/dist/rx":222,"rx/dist/rx.aggregates":221}],98:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observable=Rx.Observable;var Disposable=Rx.Disposable;var GetResponse=require("./get/GetResponse");var IdempotentResponse=require("./../response/IdempotentResponse");var InvalidSourceError=require("./../errors/InvalidSourceError");var arrayFlatMap=require("./../support/array-flat-map");var emptyArray=new Array(0);function SetResponse(subscribe){IdempotentResponse.call(this,subscribe||subscribeToSetResponse)}SetResponse.create=IdempotentResponse.create;SetResponse.prototype=Object.create(IdempotentResponse.prototype);SetResponse.prototype.method="set";SetResponse.prototype.constructor=SetResponse;SetResponse.prototype.invokeSourceRequest=function invokeSourceRequest(model){var source=this;var caught=this.catch(function setJSONGraph(results){var requestObs;if(results&&results.invokeSourceRequest===true){var envelope={};var boundPath=model._path;var optimizedPaths=results.optimizedPaths;model._path=emptyArray;model._getPathValuesAsJSONG(model._materialize().withoutDataSource(),optimizedPaths,[envelope]);model._path=boundPath;requestObs=model._request.set(envelope).do(function setResponseEnvelope(envelope2){source.isCompleted=optimizedPaths.length===envelope2.paths.length},function setResponseError(){source.isCompleted=true}).materialize().flatMap(function(notification){if(notification.kind==="C"){return Observable.empty()}if(notification.kind==="E"){var ex=notification.exception;if(InvalidSourceError.is(ex)){return Observable.throw(notification.exception)}}return caught})}else{requestObs=Observable.throw(results)}return requestObs});return new this.constructor(function(observer){return caught.subscribe(observer)})};function subscribeToSetResponse(observer){if(this.isCompleted){return subscribeToFollowupGet.call(this,observer)}return subscribeToLocalSet.call(this,observer)}function subscribeToLocalSet(observer){if(this.subscribeCount++>this.subscribeLimit){observer.onError("Loop kill switch thrown.");return Disposable.empty}var requestedPaths=[];var optimizedPaths=[];var model=this.model;var isMaster=this.isMaster;var modelRoot=model._root;var outputFormat=this.outputFormat;var errorSelector=modelRoot.errorSelector;var method=this.method;var groups=this.groups;var groupIndex=-1;var groupCount=groups.length;while(++groupIndex<groupCount){var group=groups[groupIndex];var inputType=group.inputType;var methodArgs=group.arguments;if(methodArgs.length>0){var operationName="_"+method+inputType+outputFormat;var operationFunc=model[operationName];var successfulPaths=operationFunc(model,methodArgs,null,errorSelector);optimizedPaths.push.apply(optimizedPaths,successfulPaths[1]);if(inputType==="PathValues"){requestedPaths.push.apply(requestedPaths,methodArgs.map(pluckPath))}else if(inputType==="JSONGs"){requestedPaths.push.apply(requestedPaths,arrayFlatMap(methodArgs,pluckEnvelopePaths))}else{requestedPaths.push.apply(requestedPaths,successfulPaths[0])}}}this.requestedPaths=requestedPaths;if(isMaster){this.isCompleted=true;return subscribeToFollowupGet.call(this,observer)}else{observer.onError({method:method,optimizedPaths:optimizedPaths,invokeSourceRequest:true})}}function subscribeToFollowupGet(observer){var response=new GetResponse(this.model,this.requestedPaths);if(this.outputFormat==="AsJSONG"){response=response._toJSONG()}if(this.isProgressive){response=response.progressively()}return response.subscribe(observer)}function pluckPath(pathValue){return pathValue.path}function pluckEnvelopePaths(jsonGraphEnvelope){return jsonGraphEnvelope.paths}module.exports=SetResponse},{"./../errors/InvalidSourceError":42,"./../response/IdempotentResponse":95,"./../support/array-flat-map":115,"./get/GetResponse":100,"rx/dist/rx":222}],99:[function(require,module,exports){var AssignableDisposable=function AssignableDisposable(disosableCallback){this.disposed=false;this.currentDisposable=disosableCallback};AssignableDisposable.prototype={dispose:function dispose(){if(this.disposed||!this.currentDisposable){return}this.disposed=true;var currentDisposable=this.currentDisposable;if(currentDisposable.dispose){currentDisposable.dispose()}else{currentDisposable()}}};module.exports=AssignableDisposable},{}],100:[function(require,module,exports){var ModelResponse=require("./../ModelResponse");var checkCacheAndReport=require("./checkCacheAndReport");var getRequestCycle=require("./getRequestCycle");var empty={dispose:function(){}};var Observable=require("rx/dist/rx").Observable;var GetResponse=module.exports=function GetResponse(model,paths,isJSONGraph,isProgressive){this.model=model;this.currentRemainingPaths=paths;this.isJSONGraph=isJSONGraph||false;this.isProgressive=isProgressive||false};GetResponse.prototype=Object.create(Observable.prototype);GetResponse.prototype.subscribe=ModelResponse.prototype.subscribe;GetResponse.prototype.then=ModelResponse.prototype.then;GetResponse.prototype._toJSONG=function _toJSONGraph(){return new GetResponse(this.model,this.currentRemainingPaths,true,this.isProgressive)};GetResponse.prototype.progressively=function progressively(){return new GetResponse(this.model,this.currentRemainingPaths,this.isJSONGraph,true)};GetResponse.prototype._subscribe=function _subscribe(observer){var seed=[{}];var errors=[];var isJSONG=observer.isJSONG=this.isJSONGraph;var isProgressive=this.isProgressive;var results=checkCacheAndReport(this.model,this.currentRemainingPaths,observer,isProgressive,isJSONG,seed,errors);if(!results){return empty}return getRequestCycle(this,this.model,results,observer,seed,errors,1)}},{"./../ModelResponse":97,"./checkCacheAndReport":101,"./getRequestCycle":102,"rx/dist/rx":222}],101:[function(require,module,exports){var gets=require("./../../get");var getWithPathsAsJSONGraph=gets.getWithPathsAsJSONGraph;var getWithPathsAsPathMap=gets.getWithPathsAsPathMap;module.exports=function checkCacheAndReport(model,requestedPaths,observer,progressive,isJSONG,seed,errors){var results;if(isJSONG){results=getWithPathsAsJSONGraph(model,requestedPaths,seed)}else{results=getWithPathsAsPathMap(model,requestedPaths,seed)}if(results.criticalError){observer.onError(results.criticalError);return null}var hasValues=results.hasValue;var completed=!results.requestedMissingPaths||!model._source;var hasValueOverall=seed[0].json||seed[0].jsonGraph;if(results.errors){var errs=results.errors;var errorsLength=errors.length;for(var i=0,len=errs.length;i<len;++i,++errorsLength){errors[errorsLength]=errs[i]}}if(hasValues&&progressive||hasValueOverall&&completed){try{++model._root.syncRefCount;observer.onNext(seed[0])}catch(e){throw e}finally{--model._root.syncRefCount}}if(completed){if(errors.length){observer.onError(errors)}else{observer.onCompleted()}return null}return results}},{"./../../get":52}],102:[function(require,module,exports){var checkCacheAndReport=require("./checkCacheAndReport");var MaxRetryExceededError=require("./../../errors/MaxRetryExceededError");var fastCat=require("./../../get/util/support").fastCat;var collectLru=require("./../../lru/collect");var getSize=require("./../../support/getSize");var AssignableDisposable=require("./AssignableDisposable");var __version=require("./../../internal/version");module.exports=function getRequestCycle(getResponse,model,results,observer,seed,errors,count){if(count===10){throw new MaxRetryExceededError}var requestQueue=model._request;var requestedMissingPaths=results.requestedMissingPaths;var optimizedMissingPaths=results.optimizedMissingPaths;var disposable=new AssignableDisposable;var boundRequestedMissingPaths=[];var boundPath=model._path;if(boundPath.length){for(var i=0,len=requestedMissingPaths.length;i<len;++i){boundRequestedMissingPaths[i]=fastCat(boundPath,requestedMissingPaths[i])}}else{boundRequestedMissingPaths=requestedMissingPaths}var currentRequestDisposable=requestQueue.get(boundRequestedMissingPaths,optimizedMissingPaths,function(){var nextResults=checkCacheAndReport(model,requestedMissingPaths,observer,getResponse.isProgressive,getResponse.isJSONGraph,seed,errors);if(nextResults){disposable.currentDisposable=getRequestCycle(getResponse,model,nextResults,observer,seed,errors,count+1)}else{var modelRoot=model._root;var modelCache=modelRoot.cache;var currentVersion=modelCache[__version];collectLru(modelRoot,modelRoot.expired,getSize(modelCache),model._maxSize,model._collectRatio,currentVersion)}});disposable.currentDisposable=currentRequestDisposable;return disposable}},{"./../../errors/MaxRetryExceededError":43,"./../../get/util/support":63,"./../../internal/version":79,"./../../lru/collect":82,
"./../../support/getSize":121,"./AssignableDisposable":99,"./checkCacheAndReport":101}],103:[function(require,module,exports){var GetResponse=require("./GetResponse");module.exports=function getWithPaths(paths){return new GetResponse(this,paths)}},{"./GetResponse":100}],104:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var ModelResponse=require("./../ModelResponse");var GET_VALID_INPUT=require("./validInput");var validateInput=require("./../../support/validateInput");var GetResponse=require("./GetResponse");module.exports=function get(){var out=validateInput(arguments,GET_VALID_INPUT,"get");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}var paths=pathSyntax.fromPathsOrPathValues(arguments);return new GetResponse(this,paths)}},{"./../../support/validateInput":149,"./../ModelResponse":97,"./GetResponse":100,"./validInput":105,"falcor-path-syntax":19}],105:[function(require,module,exports){module.exports={path:true,pathSyntax:true}},{}],106:[function(require,module,exports){var asap=require("asap");var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;function ASAPScheduler(){}ASAPScheduler.prototype.schedule=function schedule(action){asap(action);return Disposable.empty};ASAPScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){var self=this;asap(function(){action(self,state)});return Disposable.empty};module.exports=ASAPScheduler},{asap:1,"rx/dist/rx":222}],107:[function(require,module,exports){var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;function ImmediateScheduler(){}ImmediateScheduler.prototype.schedule=function schedule(action){action();return Disposable.empty};ImmediateScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){action(this,state);return Disposable.empty};module.exports=ImmediateScheduler},{"rx/dist/rx":222}],108:[function(require,module,exports){var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;function TimeoutScheduler(delay){this.delay=delay}TimeoutScheduler.prototype.schedule=function schedule(action){var id=setTimeout(action,this.delay);return Disposable.create(function(){if(id!==void 0){clearTimeout(id);id=void 0}})};TimeoutScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){var self=this;var id=setTimeout(function(){action(self,state)},this.delay);return Disposable.create(function(){if(id!==void 0){clearTimeout(id);id=void 0}})};module.exports=TimeoutScheduler},{"rx/dist/rx":222}],109:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var promote=require("./../lru/promote");var isExpired=require("./../support/isAlreadyExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var mergeJSONGraphNode=require("./../support/mergeJSONGraphNode");module.exports=function setJSONGraphs(model,jsonGraphEnvelopes,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var cache=modelRoot.cache;var initialVersion=cache[__version];var requestedPath=[];var optimizedPath=[];var requestedPaths=[];var optimizedPaths=[];var jsonGraphEnvelopeIndex=-1;var jsonGraphEnvelopeCount=jsonGraphEnvelopes.length;while(++jsonGraphEnvelopeIndex<jsonGraphEnvelopeCount){var jsonGraphEnvelope=jsonGraphEnvelopes[jsonGraphEnvelopeIndex];var paths=jsonGraphEnvelope.paths;var jsonGraph=jsonGraphEnvelope.jsonGraph;var pathIndex=-1;var pathCount=paths.length;while(++pathIndex<pathCount){var path=paths[pathIndex];optimizedPath.index=0;setJSONGraphPathSet(path,0,cache,cache,cache,jsonGraph,jsonGraph,jsonGraph,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setJSONGraphPathSet(path,depth,root,parent,node,messageRoot,messageParent,message,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);var optimizedIndex=optimizedPath.index;do{requestedPath.depth=depth;var results=setNode(root,parent,node,messageRoot,messageParent,message,key,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setJSONGraphPathSet(path,depth+1,root,nextParent,nextNode,messageRoot,results[3],results[2],requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{promote(lru,nextNode);requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}key=iterateKeySet(keySet,note);if(note.done){break}optimizedPath.index=optimizedIndex}while(true)}function setReference(root,node,messageRoot,message,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root,message,messageRoot]}promote(lru,node);var index=0;var container=node;var count=reference.length-1;var parent=node=root;var messageParent=message=messageRoot;do{var key=reference[index];var branch=index<count;var results=setNode(root,parent,node,messageRoot,messageParent,message,key,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1];message=results[2];messageParent=results[3]}while(index++<count);optimizedPath.index=index;if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}return[node,parent,message,messageParent]}function setNode(root,parent,node,messageRoot,messageParent,message,key,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(root,node,messageRoot,message,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];message=results[2];messageParent=results[3];type=node.$type}if(type!==void 0){return[node,parent,message,messageParent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;messageParent=message;node=parent[key];message=messageParent&&messageParent[key]}node=mergeJSONGraphNode(parent,node,message,key,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent,message,messageParent]}},{"./../internal/context":66,"./../internal/key":69,"./../internal/ref":76,"./../internal/ref-index":75,"./../internal/refs-length":77,"./../internal/version":79,"./../lru/promote":83,"./../support/expireNode":119,"./../support/incrementVersion":125,"./../support/isAlreadyExpired":127,"./../support/isFunction":129,"./../support/isPrimitive":135,"./../support/mergeJSONGraphNode":136,"./../types/ref":153,"falcor-path-utils":28}],110:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __prefix=require("./../internal/prefix");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var isArray=Array.isArray;var promote=require("./../lru/promote");var hasOwn=require("./../support/hasOwn");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var incrementVersion=require("./../support/incrementVersion");var mergeValueOrInsertBranch=require("./../support/mergeValueOrInsertBranch");module.exports=function setPathMaps(model,pathMapEnvelopes,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var requestedPath=[];var requestedPaths=[];var optimizedPaths=[];var optimizedIndex=bound.length;var pathMapIndex=-1;var pathMapCount=pathMapEnvelopes.length;while(++pathMapIndex<pathMapCount){var pathMapEnvelope=pathMapEnvelopes[pathMapIndex];var optimizedPath=bound.slice(0);optimizedPath.index=optimizedIndex;setPathMap(pathMapEnvelope.json,0,cache,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setPathMap(pathMap,depth,root,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var keys=getKeys(pathMap);if(keys&&keys.length){var keyIndex=0;var keyCount=keys.length;var optimizedIndex=optimizedPath.index;do{var key=keys[keyIndex];var child=pathMap[key];var branch=isObject(child)&&!child.$type;requestedPath.depth=depth;var results=setNode(root,parent,node,key,child,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setPathMap(child,depth+1,root,nextParent,nextNode,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{promote(lru,nextNode);requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}if(++keyIndex>=keyCount){break}optimizedPath.index=optimizedIndex}while(true)}}function setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root;optimizedPath.index=reference.length}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=setNode(root,parent,node,key,value,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1]}while(index++<count);optimizedPath.index=index;if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function setNode(root,parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node&&node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}node=mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent]}function getKeys(pathMap){if(isObject(pathMap)&&!pathMap.$type){var keys=[];var itr=0;if(isArray(pathMap)){keys[itr++]="length"}for(var key in pathMap){if(key[0]===__prefix||key[0]==="$"||!hasOwn(pathMap,key)){continue}keys[itr++]=key}return keys}return void 0}},{"./../get/getBoundValue":46,"./../internal/context":66,"./../internal/key":69,"./../internal/parent":72,"./../internal/prefix":73,"./../internal/ref":76,"./../internal/ref-index":75,"./../internal/refs-length":77,"./../internal/version":79,"./../lru/promote":83,"./../support/expireNode":119,"./../support/hasOwn":124,"./../support/incrementVersion":125,"./../support/isExpired":128,"./../support/isFunction":129,"./../support/isObject":133,"./../support/isPrimitive":135,"./../support/mergeValueOrInsertBranch":137,"./../types/ref":153}],111:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var mergeValueOrInsertBranch=require("./../support/mergeValueOrInsertBranch");module.exports=function setPathValues(model,pathValues,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var requestedPath=[];var requestedPaths=[];var optimizedPaths=[];var optimizedIndex=bound.length;var pathValueIndex=-1;var pathValueCount=pathValues.length;while(++pathValueIndex<pathValueCount){var pathValue=pathValues[pathValueIndex];var path=pathValue.path;var value=pathValue.value;var optimizedPath=bound.slice(0);optimizedPath.index=optimizedIndex;setPathSet(value,path,0,cache,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setPathSet(value,path,depth,root,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);var optimizedIndex=optimizedPath.index;do{requestedPath.depth=depth;var results=setNode(root,parent,node,key,value,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setPathSet(value,path,depth+1,root,nextParent,nextNode,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{promote(lru,nextNode);requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}key=iterateKeySet(keySet,note);if(note.done){break}optimizedPath.index=optimizedIndex}while(true)}function setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root;optimizedPath.index=reference.length}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=setNode(root,parent,node,key,value,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1]}while(index++<count);optimizedPath.index=index;if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function setNode(root,parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}node=mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent]}},{"./../get/getBoundValue":46,"./../internal/context":66,"./../internal/key":69,"./../internal/parent":72,"./../internal/ref":76,"./../internal/ref-index":75,"./../internal/refs-length":77,"./../internal/version":79,"./../lru/promote":83,"./../support/expireNode":119,"./../support/incrementVersion":125,"./../support/isExpired":128,"./../support/isFunction":129,"./../support/isPrimitive":135,"./../support/mergeValueOrInsertBranch":137,"./../types/ref":153,"falcor-path-utils":28}],112:[function(require,module,exports){var jsong=require("falcor-json-graph");var ModelResponse=require("./../response/ModelResponse");var isPathValue=require("./../support/isPathValue");module.exports=function setValue(pathArg,valueArg){var value=isPathValue(pathArg)?pathArg:jsong.pathValue(pathArg,valueArg);var pathIdx=0;var path=value.path;var pathLen=path.length;while(++pathIdx<pathLen){if(typeof path[pathIdx]==="object"){return new ModelResponse(function(o){o.onError(new Error("Paths must be simple paths"))})}}var self=this;return new ModelResponse(function(obs){return self._set(value).subscribe(function(data){var curr=data.json;var depth=-1;var length=path.length;while(curr&&++depth<length){curr=curr[path[depth]]}obs.onNext(curr)},function(err){obs.onError(err)},function(){obs.onCompleted()})})}},{"./../response/ModelResponse":97,"./../support/isPathValue":134,"falcor-json-graph":15}],113:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var isPathValue=require("./../support/isPathValue");var setPathValues=require("./../set/setPathValues");module.exports=function setValueSync(pathArg,valueArg,errorSelectorArg,comparatorArg){var path=pathSyntax.fromPath(pathArg);var value=valueArg;var errorSelector=errorSelectorArg;var comparator=comparatorArg;if(isPathValue(path)){comparator=errorSelector;errorSelector=value;value=path}else{value={path:path,value:value}}if(isPathValue(value)===false){throw new Error("Model#setValueSync must be called with an Array path.")}if(typeof errorSelector!=="function"){errorSelector=this._root._errorSelector}if(typeof comparator!=="function"){comparator=this._root._comparator}if(this._syncCheck("setValueSync")){setPathValues(this,[value]);return this._getValueSync(this,value.path).value}}},{"./../set/setPathValues":111,"./../support/isPathValue":134,"falcor-path-syntax":19}],114:[function(require,module,exports){module.exports=function arrayClone(array){if(!array){return array}var i=-1;var n=array.length;var array2=[];while(++i<n){array2[i]=array[i]}return array2}},{}],115:[function(require,module,exports){module.exports=function arrayFlatMap(array,selector){var index=-1;var i=-1;var n=array.length;var array2=[];while(++i<n){var array3=selector(array[i],i,array);var j=-1;var k=array3.length;while(++j<k){array2[++index]=array3[j]}}return array2}},{}],116:[function(require,module,exports){module.exports=function arrayMap(array,selector){var i=-1;var n=array.length;var array2=new Array(n);while(++i<n){array2[i]=selector(array[i],i,array)}return array2}},{}],117:[function(require,module,exports){module.exports=function arraySlice(array,indexArg,endArg){var index=indexArg||0;var i=-1;var n=array.length-index;if(n<0){n=0}if(endArg>0&&n>endArg){n=endArg}var array2=new Array(n);while(++i<n){array2[i]=array[i+index]}return array2}},{}],118:[function(require,module,exports){var prefix=require("./../internal/prefix");var hasOwn=require("./../support/hasOwn");var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function clone(value){var dest=value;if(isObject(dest)){dest=isArray(value)?[]:{};var src=value;for(var key in src){if(key[0]===prefix||!hasOwn(src,key)){continue}dest[key]=src[key]}}return dest}},{"./../internal/prefix":73,"./../support/hasOwn":124,"./../support/isObject":133}],119:[function(require,module,exports){var splice=require("./../lru/splice");var __invalidated=require("./../internal/invalidated");module.exports=function expireNode(node,expired,lru){if(!node[__invalidated]){node[__invalidated]=true;expired.push(node);splice(lru,node)}return node}},{"./../internal/invalidated":68,"./../lru/splice":84}],120:[function(require,module,exports){var isObject=require("./isObject");module.exports=function getSize(node){return isObject(node)&&node.$expires||undefined}},{"./isObject":133}],121:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getSize(node){return isObject(node)&&node.$size||0}},{"./../support/isObject":133}],122:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getTimestamp(node){return isObject(node)&&node.$timestamp||undefined}},{"./../support/isObject":133}],123:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getType(node,anyType){var type=isObject(node)&&node.$type||void 0;if(anyType&&type){return"branch"}return type}},{"./../support/isObject":133}],124:[function(require,module,exports){var isObject=require("./isObject");var hasOwn=Object.prototype.hasOwnProperty;module.exports=function(obj,prop){return isObject(obj)&&hasOwn.call(obj,prop)}},{"./isObject":133}],125:[function(require,module,exports){var version=1;module.exports=function incrementVersion(){return version++}},{}],126:[function(require,module,exports){var __key=require("./../internal/key");var __parent=require("./../internal/parent");var __version=require("./../internal/version");module.exports=function insertNode(node,parent,key,version){node[__key]=key;node[__parent]=parent;node[__version]=version;parent[key]=node;return node}},{"./../internal/key":69,"./../internal/parent":72,"./../internal/version":79}],127:[function(require,module,exports){var now=require("./../support/now");var $now=require("./../values/expires-now");var $never=require("./../values/expires-never");module.exports=function isAlreadyExpired(node){var exp=node.$expires;return exp!=null&&exp!==$never&&exp!==$now&&exp<now()}},{"./../support/now":139,"./../values/expires-never":154,"./../values/expires-now":155}],128:[function(require,module,exports){var now=require("./../support/now");var $now=require("../values/expires-now");var $never=require("../values/expires-never");module.exports=function isExpired(node){var exp=node.$expires;return exp!=null&&exp!==$never&&(exp===$now||exp<now())}},{"../values/expires-never":154,"../values/expires-now":155,"./../support/now":139}],129:[function(require,module,exports){var functionTypeof="function";module.exports=function isFunction(func){return Boolean(func)&&typeof func===functionTypeof}},{}],130:[function(require,module,exports){var prefix=require("./../internal/prefix");module.exports=function isInternalKey(x){return x==="$size"||x&&x.charAt(0)===prefix}},{"./../internal/prefix":73}],131:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function isJSONEnvelope(envelope){return isObject(envelope)&&"json"in envelope}},{"./../support/isObject":133}],132:[function(require,module,exports){var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function isJSONGraphEnvelope(envelope){return isObject(envelope)&&isArray(envelope.paths)&&(isObject(envelope.jsonGraph)||isObject(envelope.jsong)||isObject(envelope.json)||isObject(envelope.values)||isObject(envelope.value))}},{"./../support/isObject":133}],133:[function(require,module,exports){var objTypeof="object";module.exports=function isObject(value){return value!==null&&typeof value===objTypeof}},{}],134:[function(require,module,exports){var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function isPathValue(pathValue){return isObject(pathValue)&&(isArray(pathValue.path)||typeof pathValue.path==="string")}},{"./../support/isObject":133}],135:[function(require,module,exports){var objTypeof="object";module.exports=function isPrimitive(value){return value==null||typeof value!==objTypeof}},{}],136:[function(require,module,exports){var __key=require("./../internal/key");var __parent=require("./../internal/parent");var $ref=require("./../types/ref");var $error=require("./../types/error");var getSize=require("./../support/getSize");var getTimestamp=require("./../support/getTimestamp");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var promote=require("./../lru/promote");var wrapNode=require("./../support/wrapNode");var insertNode=require("./../support/insertNode");var expireNode=require("./../support/expireNode");var replaceNode=require("./../support/replaceNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");var reconstructPath=require("./../support/reconstructPath");module.exports=function mergeJSONGraphNode(parent,node,message,key,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var sizeOffset;var cType,mType,cIsObject,mIsObject,cTimestamp,mTimestamp;if(node===message){if(message===null){node=wrapNode(message,undefined,message);parent=updateNodeAncestors(parent,-node.$size,lru,version);node=insertNode(node,parent,key);promote(lru,node);return node}else if(message===undefined){return message}else{cIsObject=isObject(node);if(cIsObject){cType=node.$type;if(cType==null){if(node[__parent]==null){node[__key]=key;node[__parent]=parent}return node}}}}else{cIsObject=isObject(node);if(cIsObject){cType=node.$type}}if(cType!==$ref){mIsObject=isObject(message);if(mIsObject){mType=message.$type}if(cIsObject&&!cType){if(message==null||mIsObject&&!mType){return node}}}else{if(message==null){if(isExpired(node)){expireNode(node,expired,lru);return void 0}return node}mIsObject=isObject(message);if(mIsObject){mType=message.$type;if(mType===$ref){if(node===message){if(node[__parent]!=null){return node}}else{cTimestamp=node.$timestamp;mTimestamp=message.$timestamp;if(!isExpired(node)&&!isExpired(message)&&mTimestamp<cTimestamp){return void 0}}}}}if(cType&&mIsObject&&!mType){return insertNode(replaceNode(node,message,parent,key,lru),parent,key)}else if(mType||!mIsObject){if(mType===$error&&isFunction(errorSelector)){message=errorSelector(reconstructPath(requestedPath,key),message)}if(mType&&node===message){if(node[__parent]==null){node=wrapNode(node,cType,node.value);parent=updateNodeAncestors(parent,-node.$size,lru,version);node=insertNode(node,parent,key,version)}}else{var isDistinct=true;if(cType||!cIsObject){isDistinct=getTimestamp(message)<getTimestamp(node)===false;if((cType||mType)&&isFunction(comparator)){isDistinct=!comparator(node,message,optimizedPath.slice(0,optimizedPath.index))}}if(isDistinct){message=wrapNode(message,mType,mType?message.value:message);sizeOffset=getSize(node)-getSize(message);node=replaceNode(node,message,parent,key,lru);parent=updateNodeAncestors(parent,sizeOffset,lru,version);node=insertNode(node,parent,key,version)}}if(isExpired(node)){expireNode(node,expired,lru)}else{promote(lru,node)}}else if(node==null){node=insertNode(message,parent,key)}return node}},{"./../internal/key":69,"./../internal/parent":72,"./../lru/promote":83,"./../support/expireNode":119,"./../support/getSize":121,"./../support/getTimestamp":122,"./../support/insertNode":126,"./../support/isExpired":128,"./../support/isFunction":129,"./../support/isObject":133,"./../support/reconstructPath":140,"./../support/replaceNode":143,"./../support/updateNodeAncestors":148,"./../support/wrapNode":150,"./../types/error":152,"./../types/ref":153}],137:[function(require,module,exports){var $ref=require("./../types/ref");var $error=require("./../types/error");var getType=require("./../support/getType");var getSize=require("./../support/getSize");var getTimestamp=require("./../support/getTimestamp");var isExpired=require("./../support/isExpired");var isPrimitive=require("./../support/isPrimitive");var isFunction=require("./../support/isFunction");var wrapNode=require("./../support/wrapNode");var expireNode=require("./../support/expireNode");var insertNode=require("./../support/insertNode");var replaceNode=require("./../support/replaceNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");var updateBackReferenceVersions=require("./../support/updateBackReferenceVersions");var reconstructPath=require("./../support/reconstructPath");module.exports=function mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=getType(node,reference);if(branch||reference){if(type&&isExpired(node)){type="expired";expireNode(node,expired,lru)}if(type&&type!==$ref||isPrimitive(node)){node=replaceNode(node,{},parent,key,lru);node=insertNode(node,parent,key,version);node=updateBackReferenceVersions(node,version)}}else{var message=value;var mType=getType(message);var isDistinct=getTimestamp(message)<getTimestamp(node)===false;if((type||mType)&&isFunction(comparator)){isDistinct=!comparator(node,message,optimizedPath.slice(0,optimizedPath.index))}if(isDistinct){if(mType===$error&&isFunction(errorSelector)){message=errorSelector(reconstructPath(requestedPath,key),message)}message=wrapNode(message,mType,mType?message.value:message);var sizeOffset=getSize(node)-getSize(message);node=replaceNode(node,message,parent,key,lru);parent=updateNodeAncestors(parent,sizeOffset,lru,version);node=insertNode(node,parent,key,version);
}}return node}},{"./../support/expireNode":119,"./../support/getSize":121,"./../support/getTimestamp":122,"./../support/getType":123,"./../support/insertNode":126,"./../support/isExpired":128,"./../support/isFunction":129,"./../support/isPrimitive":135,"./../support/reconstructPath":140,"./../support/replaceNode":143,"./../support/updateBackReferenceVersions":147,"./../support/updateNodeAncestors":148,"./../support/wrapNode":150,"./../types/error":152,"./../types/ref":153}],138:[function(require,module,exports){module.exports=function noop(){}},{}],139:[function(require,module,exports){module.exports=Date.now},{}],140:[function(require,module,exports){module.exports=function reconstructPath(currentPath,key){var path=currentPath.slice(0,currentPath.depth);path[path.length]=key;return path}},{}],141:[function(require,module,exports){var $ref=require("./../types/ref");var __parent=require("./../internal/parent");var splice=require("./../lru/splice");var isObject=require("./../support/isObject");var unlinkBackReferences=require("./../support/unlinkBackReferences");var unlinkForwardReference=require("./../support/unlinkForwardReference");module.exports=function removeNode(node,parent,key,lru){if(isObject(node)){var type=node.$type;if(Boolean(type)){if(type===$ref){unlinkForwardReference(node)}splice(lru,node)}unlinkBackReferences(node);parent[key]=node[__parent]=void 0;return true}return false}},{"./../internal/parent":72,"./../lru/splice":84,"./../support/isObject":133,"./../support/unlinkBackReferences":145,"./../support/unlinkForwardReference":146,"./../types/ref":153}],142:[function(require,module,exports){var hasOwn=require("./../support/hasOwn");var prefix=require("./../internal/prefix");var removeNode=require("./../support/removeNode");module.exports=function removeNodeAndDescendants(node,parent,key,lru){if(removeNode(node,parent,key,lru)){if(node.$type==null){for(var key2 in node){if(key2[0]!==prefix&&key2[0]!=="$"&&hasOwn(node,key2)){removeNodeAndDescendants(node[key2],node,key2,lru)}}}return true}return false}},{"./../internal/prefix":73,"./../support/hasOwn":124,"./../support/removeNode":141}],143:[function(require,module,exports){var isObject=require("./../support/isObject");var transferBackReferences=require("./../support/transferBackReferences");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function replaceNode(node,replacement,parent,key,lru){if(node===replacement){return node}else if(isObject(node)){transferBackReferences(node,replacement);removeNodeAndDescendants(node,parent,key,lru)}parent[key]=replacement;return replacement}},{"./../support/isObject":133,"./../support/removeNodeAndDescendants":142,"./../support/transferBackReferences":144}],144:[function(require,module,exports){var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __refsLength=require("./../internal/refs-length");module.exports=function transferBackReferences(fromNode,destNode){var fromNodeRefsLength=fromNode[__refsLength]||0,destNodeRefsLength=destNode[__refsLength]||0,i=-1;while(++i<fromNodeRefsLength){var ref=fromNode[__ref+i];if(ref!==void 0){ref[__context]=destNode;destNode[__ref+(destNodeRefsLength+i)]=ref;fromNode[__ref+i]=void 0}}destNode[__refsLength]=fromNodeRefsLength+destNodeRefsLength;fromNode[__refsLength]=void 0;return destNode}},{"./../internal/context":66,"./../internal/ref":76,"./../internal/refs-length":77}],145:[function(require,module,exports){var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");module.exports=function unlinkBackReferences(node){var i=-1,n=node[__refsLength]||0;while(++i<n){var ref=node[__ref+i];if(ref!=null){ref[__context]=ref[__refIndex]=node[__ref+i]=void 0}}node[__refsLength]=void 0;return node}},{"./../internal/context":66,"./../internal/ref":76,"./../internal/ref-index":75,"./../internal/refs-length":77}],146:[function(require,module,exports){var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");module.exports=function unlinkForwardReference(reference){var destination=reference[__context];if(destination){var i=(reference[__refIndex]||0)-1,n=(destination[__refsLength]||0)-1;while(++i<=n){destination[__ref+i]=destination[__ref+(i+1)]}destination[__refsLength]=n;reference[__refIndex]=reference[__context]=destination=void 0}return reference}},{"./../internal/context":66,"./../internal/ref":76,"./../internal/ref-index":75,"./../internal/refs-length":77}],147:[function(require,module,exports){var __ref=require("./../internal/ref");var __parent=require("./../internal/parent");var __version=require("./../internal/version");var __refsLength=require("./../internal/refs-length");module.exports=function updateBackReferenceVersions(nodeArg,version){var stack=[nodeArg];var count=0;do{var node=stack[count--];if(node&&node[__version]!==version){node[__version]=version;stack[count++]=node[__parent];var i=-1;var n=node[__refsLength]||0;while(++i<n){stack[count++]=node[__ref+i]}}}while(count>-1);return nodeArg}},{"./../internal/parent":72,"./../internal/ref":76,"./../internal/refs-length":77,"./../internal/version":79}],148:[function(require,module,exports){var __key=require("./../internal/key");var __version=require("./../internal/version");var __parent=require("./../internal/parent");var removeNode=require("./../support/removeNode");var updateBackReferenceVersions=require("./../support/updateBackReferenceVersions");module.exports=function updateNodeAncestors(nodeArg,offset,lru,version){var child=nodeArg;do{var node=child[__parent];var size=child.$size=(child.$size||0)-offset;if(size<=0&&node!=null){removeNode(child,node,child[__key],lru)}else if(child[__version]!==version){updateBackReferenceVersions(child,version)}child=node}while(child);return nodeArg}},{"./../internal/key":69,"./../internal/parent":72,"./../internal/version":79,"./../support/removeNode":141,"./../support/updateBackReferenceVersions":147}],149:[function(require,module,exports){var isArray=Array.isArray;var isPathValue=require("./../support/isPathValue");var isJSONGraphEnvelope=require("./../support/isJSONGraphEnvelope");var isJSONEnvelope=require("./../support/isJSONEnvelope");var pathSyntax=require("falcor-path-syntax");module.exports=function validateInput(args,allowedInput,method){for(var i=0,len=args.length;i<len;++i){var arg=args[i];var valid=false;if(isArray(arg)&&allowedInput.path){valid=true}else if(typeof arg==="string"&&allowedInput.pathSyntax){valid=true}else if(isPathValue(arg)&&allowedInput.pathValue){arg.path=pathSyntax.fromPath(arg.path);valid=true}else if(isJSONGraphEnvelope(arg)&&allowedInput.jsonGraph){valid=true}else if(isJSONEnvelope(arg)&&allowedInput.json){valid=true}else if(typeof arg==="function"&&i+1===len&&allowedInput.selector){valid=true}if(!valid){return new Error("Unrecognized argument "+typeof arg+" ["+String(arg)+"] "+"to Model#"+method+"")}}return true}},{"./../support/isJSONEnvelope":131,"./../support/isJSONGraphEnvelope":132,"./../support/isPathValue":134,"falcor-path-syntax":19}],150:[function(require,module,exports){var jsong=require("falcor-json-graph");var $atom=jsong.atom;var now=require("./../support/now");var expiresNow=require("../values/expires-now");var __modelCreated=require("./../internal/model-created");var atomSize=50;var clone=require("./../support/clone");var isArray=Array.isArray;var getSize=require("./../support/getSize");var getExpires=require("./../support/getExpires");module.exports=function wrapNode(nodeArg,typeArg,value){var size=0;var node=nodeArg;var type=typeArg;if(type){node=clone(node);size=getSize(node);node.$type=type}else{node=$atom(value);type=node.$type;node[__modelCreated]=true}if(value==null){size=atomSize+1}else if(size==null||size<=0){switch(typeof value){case"object":if(isArray(value)){size=atomSize+value.length}else{size=atomSize+1}break;case"string":size=atomSize+value.length;break;default:size=atomSize+1;break}}var expires=getExpires(node);if(typeof expires==="number"&&expires<expiresNow){node.$expires=now()+expires*-1}node.$size=size;return node}},{"../values/expires-now":155,"./../internal/model-created":70,"./../support/clone":118,"./../support/getExpires":120,"./../support/getSize":121,"./../support/now":139,"falcor-json-graph":15}],151:[function(require,module,exports){module.exports="atom"},{}],152:[function(require,module,exports){module.exports="error"},{}],153:[function(require,module,exports){module.exports="ref"},{}],154:[function(require,module,exports){module.exports=1},{}],155:[function(require,module,exports){module.exports=0},{}],156:[function(require,module,exports){(function(global){var topLevel=typeof global!=="undefined"?global:typeof window!=="undefined"?window:{};var minDoc=require("min-document");if(typeof document!=="undefined"){module.exports=document}else{var doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"];if(!doccy){doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc}module.exports=doccy}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":4}],157:[function(require,module,exports){var lib=require("./lib");module.exports={Graph:lib.Graph,json:require("./lib/json"),alg:require("./lib/alg"),version:lib.version}},{"./lib":173,"./lib/alg":164,"./lib/json":174}],158:[function(require,module,exports){var _=require("../lodash");module.exports=components;function components(g){var visited={},cmpts=[],cmpt;function dfs(v){if(_.has(visited,v))return;visited[v]=true;cmpt.push(v);_.each(g.successors(v),dfs);_.each(g.predecessors(v),dfs)}_.each(g.nodes(),function(v){cmpt=[];dfs(v);if(cmpt.length){cmpts.push(cmpt)}});return cmpts}},{"../lodash":175}],159:[function(require,module,exports){var _=require("../lodash");module.exports=dfs;function dfs(g,vs,order){if(!_.isArray(vs)){vs=[vs]}var navigation=(g.isDirected()?g.successors:g.neighbors).bind(g);var acc=[],visited={};_.each(vs,function(v){if(!g.hasNode(v)){throw new Error("Graph does not have node: "+v)}doDfs(g,v,order==="post",visited,navigation,acc)});return acc}function doDfs(g,v,postorder,visited,navigation,acc){if(!_.has(visited,v)){visited[v]=true;if(!postorder){acc.push(v)}_.each(navigation(v),function(w){doDfs(g,w,postorder,visited,navigation,acc)});if(postorder){acc.push(v)}}}},{"../lodash":175}],160:[function(require,module,exports){var dijkstra=require("./dijkstra"),_=require("../lodash");module.exports=dijkstraAll;function dijkstraAll(g,weightFunc,edgeFunc){return _.transform(g.nodes(),function(acc,v){acc[v]=dijkstra(g,v,weightFunc,edgeFunc)},{})}},{"../lodash":175,"./dijkstra":161}],161:[function(require,module,exports){var _=require("../lodash"),PriorityQueue=require("../data/priority-queue");module.exports=dijkstra;var DEFAULT_WEIGHT_FUNC=_.constant(1);function dijkstra(g,source,weightFn,edgeFn){return runDijkstra(g,String(source),weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})}function runDijkstra(g,source,weightFn,edgeFn){var results={},pq=new PriorityQueue,v,vEntry;var updateNeighbors=function(edge){var w=edge.v!==v?edge.v:edge.w,wEntry=results[w],weight=weightFn(edge),distance=vEntry.distance+weight;if(weight<0){throw new Error("dijkstra does not allow negative edge weights. "+"Bad edge: "+edge+" Weight: "+weight)}if(distance<wEntry.distance){wEntry.distance=distance;wEntry.predecessor=v;pq.decrease(w,distance)}};g.nodes().forEach(function(v){var distance=v===source?0:Number.POSITIVE_INFINITY;results[v]={distance:distance};pq.add(v,distance)});while(pq.size()>0){v=pq.removeMin();vEntry=results[v];if(vEntry.distance===Number.POSITIVE_INFINITY){break}edgeFn(v).forEach(updateNeighbors)}return results}},{"../data/priority-queue":171,"../lodash":175}],162:[function(require,module,exports){var _=require("../lodash"),tarjan=require("./tarjan");module.exports=findCycles;function findCycles(g){return _.filter(tarjan(g),function(cmpt){return cmpt.length>1||cmpt.length===1&&g.hasEdge(cmpt[0],cmpt[0])})}},{"../lodash":175,"./tarjan":169}],163:[function(require,module,exports){var _=require("../lodash");module.exports=floydWarshall;var DEFAULT_WEIGHT_FUNC=_.constant(1);function floydWarshall(g,weightFn,edgeFn){return runFloydWarshall(g,weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})}function runFloydWarshall(g,weightFn,edgeFn){var results={},nodes=g.nodes();nodes.forEach(function(v){results[v]={};results[v][v]={distance:0};nodes.forEach(function(w){if(v!==w){results[v][w]={distance:Number.POSITIVE_INFINITY}}});edgeFn(v).forEach(function(edge){var w=edge.v===v?edge.w:edge.v,d=weightFn(edge);results[v][w]={distance:d,predecessor:v}})});nodes.forEach(function(k){var rowK=results[k];nodes.forEach(function(i){var rowI=results[i];nodes.forEach(function(j){var ik=rowI[k];var kj=rowK[j];var ij=rowI[j];var altDistance=ik.distance+kj.distance;if(altDistance<ij.distance){ij.distance=altDistance;ij.predecessor=kj.predecessor}})})});return results}},{"../lodash":175}],164:[function(require,module,exports){module.exports={components:require("./components"),dijkstra:require("./dijkstra"),dijkstraAll:require("./dijkstra-all"),findCycles:require("./find-cycles"),floydWarshall:require("./floyd-warshall"),isAcyclic:require("./is-acyclic"),postorder:require("./postorder"),preorder:require("./preorder"),prim:require("./prim"),tarjan:require("./tarjan"),topsort:require("./topsort")}},{"./components":158,"./dijkstra":161,"./dijkstra-all":160,"./find-cycles":162,"./floyd-warshall":163,"./is-acyclic":165,"./postorder":166,"./preorder":167,"./prim":168,"./tarjan":169,"./topsort":170}],165:[function(require,module,exports){var topsort=require("./topsort");module.exports=isAcyclic;function isAcyclic(g){try{topsort(g)}catch(e){if(e instanceof topsort.CycleException){return false}throw e}return true}},{"./topsort":170}],166:[function(require,module,exports){var dfs=require("./dfs");module.exports=postorder;function postorder(g,vs){return dfs(g,vs,"post")}},{"./dfs":159}],167:[function(require,module,exports){var dfs=require("./dfs");module.exports=preorder;function preorder(g,vs){return dfs(g,vs,"pre")}},{"./dfs":159}],168:[function(require,module,exports){var _=require("../lodash"),Graph=require("../graph"),PriorityQueue=require("../data/priority-queue");module.exports=prim;function prim(g,weightFunc){var result=new Graph,parents={},pq=new PriorityQueue,v;function updateNeighbors(edge){var w=edge.v===v?edge.w:edge.v,pri=pq.priority(w);if(pri!==undefined){var edgeWeight=weightFunc(edge);if(edgeWeight<pri){parents[w]=v;pq.decrease(w,edgeWeight)}}}if(g.nodeCount()===0){return result}_.each(g.nodes(),function(v){pq.add(v,Number.POSITIVE_INFINITY);result.setNode(v)});pq.decrease(g.nodes()[0],0);var init=false;while(pq.size()>0){v=pq.removeMin();if(_.has(parents,v)){result.setEdge(v,parents[v])}else if(init){throw new Error("Input graph is not connected: "+g)}else{init=true}g.nodeEdges(v).forEach(updateNeighbors)}return result}},{"../data/priority-queue":171,"../graph":172,"../lodash":175}],169:[function(require,module,exports){var _=require("../lodash");module.exports=tarjan;function tarjan(g){var index=0,stack=[],visited={},results=[];function dfs(v){var entry=visited[v]={onStack:true,lowlink:index,index:index++};stack.push(v);g.successors(v).forEach(function(w){if(!_.has(visited,w)){dfs(w);entry.lowlink=Math.min(entry.lowlink,visited[w].lowlink)}else if(visited[w].onStack){entry.lowlink=Math.min(entry.lowlink,visited[w].index)}});if(entry.lowlink===entry.index){var cmpt=[],w;do{w=stack.pop();visited[w].onStack=false;cmpt.push(w)}while(v!==w);results.push(cmpt)}}g.nodes().forEach(function(v){if(!_.has(visited,v)){dfs(v)}});return results}},{"../lodash":175}],170:[function(require,module,exports){var _=require("../lodash");module.exports=topsort;topsort.CycleException=CycleException;function topsort(g){var visited={},stack={},results=[];function visit(node){if(_.has(stack,node)){throw new CycleException}if(!_.has(visited,node)){stack[node]=true;visited[node]=true;_.each(g.predecessors(node),visit);delete stack[node];results.push(node)}}_.each(g.sinks(),visit);if(_.size(visited)!==g.nodeCount()){throw new CycleException}return results}function CycleException(){}},{"../lodash":175}],171:[function(require,module,exports){var _=require("../lodash");module.exports=PriorityQueue;function PriorityQueue(){this._arr=[];this._keyIndices={}}PriorityQueue.prototype.size=function(){return this._arr.length};PriorityQueue.prototype.keys=function(){return this._arr.map(function(x){return x.key})};PriorityQueue.prototype.has=function(key){return _.has(this._keyIndices,key)};PriorityQueue.prototype.priority=function(key){var index=this._keyIndices[key];if(index!==undefined){return this._arr[index].priority}};PriorityQueue.prototype.min=function(){if(this.size()===0){throw new Error("Queue underflow")}return this._arr[0].key};PriorityQueue.prototype.add=function(key,priority){var keyIndices=this._keyIndices;key=String(key);if(!_.has(keyIndices,key)){var arr=this._arr;var index=arr.length;keyIndices[key]=index;arr.push({key:key,priority:priority});this._decrease(index);return true}return false};PriorityQueue.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var min=this._arr.pop();delete this._keyIndices[min.key];this._heapify(0);return min.key};PriorityQueue.prototype.decrease=function(key,priority){var index=this._keyIndices[key];if(priority>this._arr[index].priority){throw new Error("New priority is greater than current priority. "+"Key: "+key+" Old: "+this._arr[index].priority+" New: "+priority)}this._arr[index].priority=priority;this._decrease(index)};PriorityQueue.prototype._heapify=function(i){var arr=this._arr;var l=2*i,r=l+1,largest=i;if(l<arr.length){largest=arr[l].priority<arr[largest].priority?l:largest;if(r<arr.length){largest=arr[r].priority<arr[largest].priority?r:largest}if(largest!==i){this._swap(i,largest);this._heapify(largest)}}};PriorityQueue.prototype._decrease=function(index){var arr=this._arr;var priority=arr[index].priority;var parent;while(index!==0){parent=index>>1;if(arr[parent].priority<priority){break}this._swap(index,parent);index=parent}};PriorityQueue.prototype._swap=function(i,j){var arr=this._arr;var keyIndices=this._keyIndices;var origArrI=arr[i];var origArrJ=arr[j];arr[i]=origArrJ;arr[j]=origArrI;keyIndices[origArrJ.key]=i;keyIndices[origArrI.key]=j}},{"../lodash":175}],172:[function(require,module,exports){"use strict";var _=require("./lodash");module.exports=Graph;var DEFAULT_EDGE_NAME="\0",GRAPH_NODE="\0",EDGE_KEY_DELIM="";function Graph(opts){this._isDirected=_.has(opts,"directed")?opts.directed:true;this._isMultigraph=_.has(opts,"multigraph")?opts.multigraph:false;this._isCompound=_.has(opts,"compound")?opts.compound:false;this._label=undefined;this._defaultNodeLabelFn=_.constant(undefined);this._defaultEdgeLabelFn=_.constant(undefined);this._nodes={};if(this._isCompound){this._parent={};this._children={};this._children[GRAPH_NODE]={}}this._in={};this._preds={};this._out={};this._sucs={};this._edgeObjs={};this._edgeLabels={}}Graph.prototype._nodeCount=0;Graph.prototype._edgeCount=0;Graph.prototype.isDirected=function(){return this._isDirected};Graph.prototype.isMultigraph=function(){return this._isMultigraph};Graph.prototype.isCompound=function(){return this._isCompound};Graph.prototype.setGraph=function(label){this._label=label;return this};Graph.prototype.graph=function(){return this._label};Graph.prototype.setDefaultNodeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault)}this._defaultNodeLabelFn=newDefault;return this};Graph.prototype.nodeCount=function(){return this._nodeCount};Graph.prototype.nodes=function(){return _.keys(this._nodes)};Graph.prototype.sources=function(){return _.filter(this.nodes(),_.bind(function(v){return _.isEmpty(this._in[v])},this))};Graph.prototype.sinks=function(){return _.filter(this.nodes(),_.bind(function(v){return _.isEmpty(this._out[v])},this))};Graph.prototype.setNodes=function(vs,value){var args=arguments;_.each(vs,_.bind(function(v){if(args.length>1){this.setNode(v,value)}else{this.setNode(v)}},this));return this};Graph.prototype.setNode=function(v,value){if(_.has(this._nodes,v)){if(arguments.length>1){this._nodes[v]=value}return this}this._nodes[v]=arguments.length>1?value:this._defaultNodeLabelFn(v);if(this._isCompound){this._parent[v]=GRAPH_NODE;this._children[v]={};this._children[GRAPH_NODE][v]=true}this._in[v]={};this._preds[v]={};this._out[v]={};this._sucs[v]={};++this._nodeCount;return this};Graph.prototype.node=function(v){return this._nodes[v]};Graph.prototype.hasNode=function(v){return _.has(this._nodes,v)};Graph.prototype.removeNode=function(v){var self=this;if(_.has(this._nodes,v)){var removeEdge=function(e){self.removeEdge(self._edgeObjs[e])};delete this._nodes[v];if(this._isCompound){this._removeFromParentsChildList(v);delete this._parent[v];_.each(this.children(v),_.bind(function(child){this.setParent(child)},this));delete this._children[v]}_.each(_.keys(this._in[v]),removeEdge);delete this._in[v];delete this._preds[v];_.each(_.keys(this._out[v]),removeEdge);delete this._out[v];delete this._sucs[v];--this._nodeCount}return this};Graph.prototype.setParent=function(v,parent){if(!this._isCompound){throw new Error("Cannot set parent in a non-compound graph")}if(_.isUndefined(parent)){parent=GRAPH_NODE}else{parent+="";for(var ancestor=parent;!_.isUndefined(ancestor);ancestor=this.parent(ancestor)){if(ancestor===v){throw new Error("Setting "+parent+" as parent of "+v+" would create create a cycle")}}this.setNode(parent)}this.setNode(v);this._removeFromParentsChildList(v);this._parent[v]=parent;this._children[parent][v]=true;return this};Graph.prototype._removeFromParentsChildList=function(v){delete this._children[this._parent[v]][v]};Graph.prototype.parent=function(v){if(this._isCompound){var parent=this._parent[v];if(parent!==GRAPH_NODE){return parent}}};Graph.prototype.children=function(v){if(_.isUndefined(v)){v=GRAPH_NODE}if(this._isCompound){var children=this._children[v];if(children){return _.keys(children)}}else if(v===GRAPH_NODE){return this.nodes()}else if(this.hasNode(v)){return[]}};Graph.prototype.predecessors=function(v){var predsV=this._preds[v];if(predsV){return _.keys(predsV)}};Graph.prototype.successors=function(v){var sucsV=this._sucs[v];if(sucsV){return _.keys(sucsV)}};Graph.prototype.neighbors=function(v){var preds=this.predecessors(v);if(preds){return _.union(preds,this.successors(v))}};Graph.prototype.filterNodes=function(filter){var copy=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});copy.setGraph(this.graph());_.each(this._nodes,_.bind(function(value,v){if(filter(v)){copy.setNode(v,value)}},this));_.each(this._edgeObjs,_.bind(function(e){if(copy.hasNode(e.v)&&copy.hasNode(e.w)){copy.setEdge(e,this.edge(e))}},this));var self=this;var parents={};function findParent(v){var parent=self.parent(v);if(parent===undefined||copy.hasNode(parent)){parents[v]=parent;return parent}else if(parent in parents){return parents[parent]}else{return findParent(parent)}}if(this._isCompound){_.each(copy.nodes(),function(v){copy.setParent(v,findParent(v))})}return copy};Graph.prototype.setDefaultEdgeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault)}this._defaultEdgeLabelFn=newDefault;return this};Graph.prototype.edgeCount=function(){return this._edgeCount};Graph.prototype.edges=function(){return _.values(this._edgeObjs)};Graph.prototype.setPath=function(vs,value){var self=this,args=arguments;_.reduce(vs,function(v,w){if(args.length>1){self.setEdge(v,w,value)}else{self.setEdge(v,w)}return w});return this};Graph.prototype.setEdge=function(){var v,w,name,value,valueSpecified=false,arg0=arguments[0];if(typeof arg0==="object"&&arg0!==null&&"v"in arg0){v=arg0.v;w=arg0.w;name=arg0.name;if(arguments.length===2){value=arguments[1];valueSpecified=true}}else{v=arg0;w=arguments[1];name=arguments[3];if(arguments.length>2){value=arguments[2];valueSpecified=true}}v=""+v;w=""+w;if(!_.isUndefined(name)){name=""+name}var e=edgeArgsToId(this._isDirected,v,w,name);if(_.has(this._edgeLabels,e)){if(valueSpecified){this._edgeLabels[e]=value}return this}if(!_.isUndefined(name)&&!this._isMultigraph){throw new Error("Cannot set a named edge when isMultigraph = false")}this.setNode(v);this.setNode(w);this._edgeLabels[e]=valueSpecified?value:this._defaultEdgeLabelFn(v,w,name);var edgeObj=edgeArgsToObj(this._isDirected,v,w,name);v=edgeObj.v;w=edgeObj.w;Object.freeze(edgeObj);this._edgeObjs[e]=edgeObj;incrementOrInitEntry(this._preds[w],v);incrementOrInitEntry(this._sucs[v],w);this._in[w][e]=edgeObj;this._out[v][e]=edgeObj;this._edgeCount++;return this};Graph.prototype.edge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name);return this._edgeLabels[e]};Graph.prototype.hasEdge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name);return _.has(this._edgeLabels,e)};Graph.prototype.removeEdge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name),edge=this._edgeObjs[e];if(edge){v=edge.v;w=edge.w;delete this._edgeLabels[e];delete this._edgeObjs[e];decrementOrRemoveEntry(this._preds[w],v);decrementOrRemoveEntry(this._sucs[v],w);delete this._in[w][e];delete this._out[v][e];this._edgeCount--}return this};Graph.prototype.inEdges=function(v,u){var inV=this._in[v];if(inV){var edges=_.values(inV);if(!u){return edges}return _.filter(edges,function(edge){return edge.v===u})}};Graph.prototype.outEdges=function(v,w){var outV=this._out[v];if(outV){var edges=_.values(outV);if(!w){return edges}return _.filter(edges,function(edge){return edge.w===w})}};Graph.prototype.nodeEdges=function(v,w){var inEdges=this.inEdges(v,w);if(inEdges){return inEdges.concat(this.outEdges(v,w))}};function incrementOrInitEntry(map,k){if(map[k]){map[k]++}else{map[k]=1}}function decrementOrRemoveEntry(map,k){if(!--map[k]){delete map[k]}}function edgeArgsToId(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp}return v+EDGE_KEY_DELIM+w+EDGE_KEY_DELIM+(_.isUndefined(name)?DEFAULT_EDGE_NAME:name)}function edgeArgsToObj(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp}var edgeObj={v:v,w:w};if(name){edgeObj.name=name}return edgeObj}function edgeObjToId(isDirected,edgeObj){return edgeArgsToId(isDirected,edgeObj.v,edgeObj.w,edgeObj.name)}},{"./lodash":175}],173:[function(require,module,exports){module.exports={Graph:require("./graph"),version:require("./version")}},{"./graph":172,"./version":176}],174:[function(require,module,exports){var _=require("./lodash"),Graph=require("./graph");module.exports={write:write,read:read};function write(g){var json={options:{directed:g.isDirected(),multigraph:g.isMultigraph(),compound:g.isCompound()},nodes:writeNodes(g),edges:writeEdges(g)};if(!_.isUndefined(g.graph())){json.value=_.clone(g.graph())}return json}function writeNodes(g){return _.map(g.nodes(),function(v){var nodeValue=g.node(v),parent=g.parent(v),node={v:v};if(!_.isUndefined(nodeValue)){node.value=nodeValue}if(!_.isUndefined(parent)){node.parent=parent}return node})}function writeEdges(g){return _.map(g.edges(),function(e){var edgeValue=g.edge(e),edge={v:e.v,w:e.w};if(!_.isUndefined(e.name)){edge.name=e.name}if(!_.isUndefined(edgeValue)){edge.value=edgeValue}return edge})}function read(json){var g=new Graph(json.options).setGraph(json.value);_.each(json.nodes,function(entry){g.setNode(entry.v,entry.value);if(entry.parent){g.setParent(entry.v,entry.parent)}});_.each(json.edges,function(entry){g.setEdge({v:entry.v,w:entry.w,name:entry.name},entry.value)});return g}},{"./graph":172,"./lodash":175}],175:[function(require,module,exports){var lodash;if(typeof require==="function"){try{lodash=require("lodash")}catch(e){}}if(!lodash){lodash=window._}module.exports=lodash},{lodash:183}],176:[function(require,module,exports){module.exports="2.1.1"},{}],177:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],178:[function(require,module,exports){(function(global){"use strict";var root=typeof window!=="undefined"?window:typeof global!=="undefined"?global:{};module.exports=Individual;function Individual(key,value){if(key in root){return root[key]}root[key]=value;return value}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],179:[function(require,module,exports){"use strict";var Individual=require("./index.js");module.exports=OneVersion;function OneVersion(moduleName,version,defaultValue){var key="__INDIVIDUAL_ONE_VERSION_"+moduleName;var enforceKey=key+"_ENFORCE_SINGLETON";var versionValue=Individual(enforceKey,version);if(versionValue!==version){throw new Error("Can only have one copy of "+moduleName+".\n"+"You already have version "+versionValue+" installed.\n"+"This means you cannot install version "+version)}return Individual(key,defaultValue)}},{"./index.js":178}],180:[function(require,module,exports){"use strict";module.exports=function isObject(x){return typeof x==="object"&&x!==null}},{}],181:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],182:[function(require,module,exports){"use strict";var Geohash={};Geohash.base32="0123456789bcdefghjkmnpqrstuvwxyz";Geohash.encode=function(lat,lon,precision){if(typeof precision=="undefined"){for(var p=1;p<=12;p++){var hash=Geohash.encode(lat,lon,p);var posn=Geohash.decode(hash);if(posn.lat==lat&&posn.lon==lon)return hash}precision=12}lat=Number(lat);lon=Number(lon);precision=Number(precision);if(isNaN(lat)||isNaN(lon)||isNaN(precision))throw new Error("Invalid geohash");var idx=0;var bit=0;var evenBit=true;var geohash="";var latMin=-90,latMax=90;var lonMin=-180,lonMax=180;while(geohash.length<precision){if(evenBit){var lonMid=(lonMin+lonMax)/2;if(lon>lonMid){idx=idx*2+1;lonMin=lonMid}else{idx=idx*2;lonMax=lonMid}}else{var latMid=(latMin+latMax)/2;if(lat>latMid){idx=idx*2+1;latMin=latMid}else{idx=idx*2;latMax=latMid}}evenBit=!evenBit;if(++bit==5){geohash+=Geohash.base32.charAt(idx);bit=0;idx=0}}return geohash};Geohash.decode=function(geohash){var bounds=Geohash.bounds(geohash);
var latMin=bounds.sw.lat,lonMin=bounds.sw.lon;var latMax=bounds.ne.lat,lonMax=bounds.ne.lon;var lat=(latMin+latMax)/2;var lon=(lonMin+lonMax)/2;lat=lat.toFixed(Math.floor(2-Math.log(latMax-latMin)/Math.LN10));lon=lon.toFixed(Math.floor(2-Math.log(lonMax-lonMin)/Math.LN10));return{lat:Number(lat),lon:Number(lon)}};Geohash.bounds=function(geohash){if(geohash.length===0)throw new Error("Invalid geohash");geohash=geohash.toLowerCase();var evenBit=true;var latMin=-90,latMax=90;var lonMin=-180,lonMax=180;for(var i=0;i<geohash.length;i++){var chr=geohash.charAt(i);var idx=Geohash.base32.indexOf(chr);if(idx==-1)throw new Error("Invalid geohash");for(var n=4;n>=0;n--){var bitN=idx>>n&1;if(evenBit){var lonMid=(lonMin+lonMax)/2;if(bitN==1){lonMin=lonMid}else{lonMax=lonMid}}else{var latMid=(latMin+latMax)/2;if(bitN==1){latMin=latMid}else{latMax=latMid}}evenBit=!evenBit}}var bounds={sw:{lat:latMin,lon:lonMin},ne:{lat:latMax,lon:lonMax}};return bounds};Geohash.adjacent=function(geohash,direction){geohash=geohash.toLowerCase();direction=direction.toLowerCase();if(geohash.length===0)throw new Error("Invalid geohash");if("nsew".indexOf(direction)==-1)throw new Error("Invalid direction");var neighbour={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]};var border={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]};var lastCh=geohash.slice(-1);var parent=geohash.slice(0,-1);var type=geohash.length%2;if(border[direction][type].indexOf(lastCh)!=-1&&parent!==""){parent=Geohash.adjacent(parent,direction)}return parent+Geohash.base32.charAt(neighbour[direction][type].indexOf(lastCh))};Geohash.neighbours=function(geohash){return{n:Geohash.adjacent(geohash,"n"),ne:Geohash.adjacent(Geohash.adjacent(geohash,"n"),"e"),e:Geohash.adjacent(geohash,"e"),se:Geohash.adjacent(Geohash.adjacent(geohash,"s"),"e"),s:Geohash.adjacent(geohash,"s"),sw:Geohash.adjacent(Geohash.adjacent(geohash,"s"),"w"),w:Geohash.adjacent(geohash,"w"),nw:Geohash.adjacent(Geohash.adjacent(geohash,"n"),"w")}};if(typeof module!="undefined"&&module.exports)module.exports=Geohash;if(typeof define=="function"&&define.amd)define([],function(){return Geohash})},{}],183:[function(require,module,exports){(function(global){(function(){var undefined;var VERSION="4.14.1";var LARGE_ARRAY_SIZE=200;var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var PLACEHOLDER="__lodash_placeholder__";var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256,FLIP_FLAG=512;var UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=150,HOT_SPAN=16;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=0/0;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var wrapFlags=[["ary",ARY_FLAG],["bind",BIND_FLAG],["bindKey",BIND_KEY_FLAG],["curry",CURRY_FLAG],["curryRight",CURRY_RIGHT_FLAG],["flip",FLIP_FLAG],["partial",PARTIAL_FLAG],["partialRight",PARTIAL_RIGHT_FLAG],["rearg",REARG_FLAG]];var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",promiseTag="[object Promise]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);var reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/;var reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /;var reBasicWord=/[a-zA-Z0-9]+/g;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reHasHexPrefix=/^0x/i;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f\\ufe20-\\ufe23",rsComboSymbolsRange="\\u20d0-\\u20f0",rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange;var rsApos="[']",rsAstral="["+rsAstralRange+"]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboMarksRange+rsComboSymbolsRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d";var rsLowerMisc="(?:"+rsLower+"|"+rsMisc+")",rsUpperMisc="(?:"+rsUpper+"|"+rsMisc+")",rsOptLowerContr="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptUpperContr="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reApos=RegExp(rsApos,"g");var reComboMark=RegExp(rsCombo,"g");var reComplexSymbol=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");var reComplexWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptLowerContr+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsUpperMisc+"+"+rsOptUpperContr+"(?="+[rsBreak,rsUpper+rsLowerMisc,"$"].join("|")+")",rsUpper+"?"+rsLowerMisc+"+"+rsOptLowerContr,rsUpper+"+"+rsOptUpperContr,rsDigits,rsEmoji].join("|"),"g");var reHasComplexSymbol=RegExp("["+rsZWJ+rsAstralRange+rsComboMarksRange+rsComboSymbolsRange+rsVarRange+"]");var reHasComplexWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var deburredLetters={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeParseFloat=parseFloat,freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding("util")}catch(e){}}();var nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map}function addSetEntry(set,value){set.add(value);return set}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array?array.length:0;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){var index=-1,length=array?array.length:0;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array?array.length:0;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array?array.length:0;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array?array.length:0,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}function arrayIncludes(array,value){var length=array?array.length:0;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=array?array.length:0;while(++index<length){if(comparator(value,array[index])){return true}}return false}function arrayMap(array,iteratee){var index=-1,length=array?array.length:0,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array?array.length:0;if(initAccum&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array?array.length:0;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function baseFindKey(collection,predicate,eachFunc){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=key;return false}});return result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){if(value!==value){return baseFindIndex(array,baseIsNaN,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index}}return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=array?array.length:0;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyOf(object){return function(key){return object==null?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)});return accumulator}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:result+current}}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){result++}}return result}var deburrLetter=basePropertyOf(deburredLetters);var escapeHtmlChar=basePropertyOf(htmlEscapes);function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value)}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index}}return result}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}function setToPairs(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=[value,value]});return result}function stringSize(string){if(!(string&&reHasComplexSymbol.test(string))){return string.length}var result=reComplexSymbol.lastIndex=0;while(reComplexSymbol.test(string)){result++}return result}function stringToArray(string){return string.match(reComplexSymbol)}var unescapeHtmlChar=basePropertyOf(htmlUnescapes);function runInContext(context){context=context?_.defaults({},context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Math=context.Math,RegExp=context.RegExp,TypeError=context.TypeError;var arrayProto=context.Array.prototype,objectProto=context.Object.prototype,stringProto=context.String.prototype;var coreJsData=context["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=context.Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var objectCtorString=funcToString.call(Object);var objectToString=objectProto.toString;var oldDash=root._;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?context.Buffer:undefined,Reflect=context.Reflect,Symbol=context.Symbol,Uint8Array=context.Uint8Array,enumerate=Reflect?Reflect.enumerate:undefined,iteratorSymbol=Symbol?Symbol.iterator:undefined,objectCreate=context.Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined;var clearTimeout=function(id){return context.clearTimeout.call(root,id)},setTimeout=function(func,wait){return context.setTimeout.call(root,func,wait)};var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetPrototype=Object.getPrototypeOf,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=Object.keys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReplace=stringProto.replace,nativeReverse=arrayProto.reverse,nativeSplit=stringProto.split;var DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(context.Object,"create");var defineProperty=function(){var func=getNative(context.Object,"defineProperty"),name=getNative.name;return name&&name.length>2?func:undefined}();var metaMap=WeakMap&&new WeakMap;var nonEnumShadows=!propertyIsEnumerable.call({valueOf:1},"valueOf");var realNames={};var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};lodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||arrLength<LARGE_ARRAY_SIZE||arrLength==length&&takeCount==length){return baseWrapperValue(array,this.__actions__)}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}result[resIndex++]=value}return result}LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function SetCache(values){var index=-1,length=values?values.length:0;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}function setCacheHas(value){return this.__data__.has(value)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function Stack(entries){this.__data__=new ListCache(entries)}function stackClear(){this.__data__=new ListCache}function stackDelete(key){return this.__data__["delete"](key)}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);return this}cache=this.__data__=new MapCache(pairs)}cache.set(key,value);return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function assignInDefaults(objValue,srcValue,key,object){if(objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)){return srcValue}return objValue}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||typeof key=="number"&&value===undefined&&!(key in object)){object[key]=value}}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAt(object,paths){var index=-1,isNil=object==null,length=paths.length,result=Array(length);while(++index<length){result[index]=isNil?undefined:get(object,paths[index])}return result}function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper}if(lower!==undefined){number=number>=lower?number:lower}}return number}function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){if(isHostObject(value)){return object?value:{}}result=initCloneObject(isFunc?{}:value);if(!isDeep){return copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);if(!isArr){var props=isFull?getAllKeys(value):keys(value)}arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack))});return result}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(object==null){return!length}var index=length;while(index--){var key=props[index],predicate=source[key],value=object[key];if(value===undefined&&!(key in Object(object))||!predicate(value)){return false}}return true}function baseCreate(proto){return isObject(proto)?objectCreate(proto):{}}function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result}if(iteratee){values=arrayMap(values,baseUnary(iteratee))}if(comparator){includes=arrayIncludesWith;isCommon=false}else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values)}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer}}result.push(value)}else if(!includes(values,computed,comparator)){result.push(value)}}return result}var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:toInteger(end);if(end<0){end+=length}end=start>end?0:toLength(end);while(start<end){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);
result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=isKey(path,object)?[path]:castPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return objectToString.call(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return object!=null&&(hasOwnProperty.call(object,key)||typeof object=="object"&&key in object&&getPrototype(object)===null)}function baseHasIn(object,key){return object!=null&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee))}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer}}if(seen){seen.push(computed)}result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)});return accumulator}function baseInvoke(object,path,args){if(!isKey(path,object)){path=castPath(path);object=parent(object,path);path=last(path)}var func=object==null?object:object[toKey(path)];return func==null?undefined:apply(func,object,args)}function baseIsArrayBuffer(value){return isObjectLike(value)&&objectToString.call(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&objectToString.call(value)==dateTag}function baseIsEqual(value,other,customizer,bitmask,stack){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,bitmask,stack)}function baseIsEqualDeep(object,other,equalFunc,customizer,bitmask,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=getTag(object);objTag=objTag==argsTag?objectTag:objTag}if(!othIsArr){othTag=getTag(other);othTag=othTag==argsTag?objectTag:othTag}var objIsObj=objTag==objectTag&&!isHostObject(object),othIsObj=othTag==objectTag&&!isHostObject(other),isSameTag=objTag==othTag;if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,equalFunc,customizer,bitmask,stack):equalByTag(object,other,objTag,equalFunc,customizer,bitmask,stack)}if(!(bitmask&PARTIAL_COMPARE_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,customizer,bitmask,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,equalFunc,customizer,bitmask,stack)}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG,stack):result)){return false}}}return true}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsRegExp(value){return isObject(value)&&objectToString.call(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)]}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if(typeof value=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}var baseKeys=overArg(nativeKeys,Object);function baseKeysIn(object){object=object==null?object:Object(object);var result=[];for(var key in object){result.push(key)}return result}if(enumerate&&!propertyIsEnumerable.call({valueOf:1},"valueOf")){baseKeysIn=function(object){return iteratorToArray(enumerate(object))}}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,undefined,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}if(!(isArray(source)||isTypedArray(source))){var props=keysIn(source)}arrayEach(props||source,function(srcValue,key){if(props){key=srcValue;srcValue=source[key]}if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}})}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){newValue=srcValue;if(isArray(srcValue)||isTypedArray(srcValue)){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else{isCommon=false;newValue=baseClone(srcValue,true)}}else if(isPlainObject(srcValue)||isArguments(srcValue)){if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){isCommon=false;newValue=baseClone(srcValue,true)}else{newValue=objValue}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(!length){return}n+=n<0?length:0;return isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee()));var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,props){object=Object(object);return basePickBy(object,props,function(value,key){return key in object})}function basePickBy(object,props,predicate){var index=-1,length=props.length,result={};while(++index<length){var key=props[index],value=object[key];if(predicate(value,key)){result[key]=value}}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values)}if(iteratee){seen=arrayMap(array,baseUnary(iteratee))}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1)}splice.call(array,fromIndex,1)}}return array}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1)}else if(!isKey(index,array)){var path=castPath(index),object=parent(array,path);if(object!=null){delete object[toKey(last(path))]}}else{delete array[toKey(index)]}}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER){return result}do{if(n%2){result+=string}n=nativeFloor(n/2);if(n){string+=string}}while(n);return result}function baseRest(func,start){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=array;return apply(func,this,otherArgs)}}function baseSet(object,path,value,customizer){path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]);if(isObject(nested)){var newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=objValue==null?isIndex(path[index+1])?[]:{}:objValue}}assignValue(nested,key,newValue)}nested=nested[key]}return object}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=array?array.length:low;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(computed!==null&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)){low=mid+1}else{high=mid}}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsNull=value===null,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=computed===null,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN){var setLow=retHighest||othIsReflexive}else if(valIsUndefined){setLow=othIsReflexive&&(retHighest||othIsDefined)}else if(valIsNull){setLow=othIsReflexive&&othIsDefined&&(retHighest||!othIsNull)}else if(valIsSymbol){setLow=othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol)}else if(othIsNull||othIsSymbol){setLow=false}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=value===0?0:value}}return result}function baseToNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}return+value}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}function baseUnset(object,path){path=isKey(path,object)?[path]:castPath(path);object=parent(object,path);var key=toKey(last(path));return!(object!=null&&baseHas(object,key))||delete object[key]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var index=-1,length=arrays.length;while(++index<length){var result=result?arrayPush(baseDifference(result,arrays[index],iteratee,comparator),baseDifference(arrays[index],result,iteratee,comparator)):arrays[index]}return result&&result.length?baseUniq(result,iteratee,comparator):[]}function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return typeof value=="function"?value:identity}function castPath(value){return isArray(value)?value:stringToPath(value)}function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end)}function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var result=new buffer.constructor(buffer.length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),true):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),true):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order=="desc"?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex]}}while(rangeLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}}return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;assignValue(object,key,newValue===undefined?source[key]:newValue)}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function createBind(func,bitmask,thisArg){var isBind=bitmask&BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=reHasComplexSymbol.test(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--){args[index]=arguments[index]}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length)}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection);predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return baseRest(function(funcs){funcs=baseFlatten(funcs,1);var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse()}while(index--){var func=funcs[index];if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(prereq&&!wrapper&&getFuncName(func)=="wrapper"){var wrapper=new LodashWrapper([],true)}}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=="wrapper"?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3])}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)&&value.length>=LARGE_ARRAY_SIZE){return wrapper.plant(value).value()}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result)}return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurried=bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG),isFlip=bitmask&FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--){args[index]=arguments[index]}if(isCurried){var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder)}if(partials){args=composeArgs(args,partials,holders,isCurried)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried)}length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos)}else if(isFlip&&length>1){args.reverse()}if(isAry&&ary<length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtor(fn)}return fn.apply(thisBinding,args)}return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined){return defaultValue}if(value!==undefined){result=value}if(other!==undefined){if(result===undefined){return other}if(typeof value=="string"||typeof other=="string"){value=baseToString(value);other=baseToString(other)}else{value=baseToNumber(value);other=baseToNumber(other)}result=operator(value,other)}return result}}function createOver(arrayFunc){return baseRest(function(iteratees){iteratees=iteratees.length==1&&isArray(iteratees[0])?arrayMap(iteratees[0],baseUnary(getIteratee())):arrayMap(baseFlatten(iteratees,1),baseUnary(getIteratee()));return baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2){return charsLength?baseRepeat(chars,length):chars}var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return reHasComplexSymbol.test(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}step=step===undefined?start<end?1:-1:toFinite(step);return baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){if(!(typeof value=="string"&&typeof other=="string")){value=toNumber(value);other=toNumber(other)}return operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!(bitmask&CURRY_BOUND_FLAG)){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG)}var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData)}result.placeholder=placeholder;return setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=nativeMin(toInteger(precision),292);if(precision){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));pair=(toString(value)+"e").split("e");return+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values)};function createToPairs(keysFunc){return function(object){var tag=getTag(object);if(tag==mapTag){return mapToArray(object)}if(tag==setTag){return setToPairs(object)}return baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=undefined}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data)}func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]==null?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG)){bitmask&=~(CURRY_FLAG|CURRY_RIGHT_FLAG);
}if(!bitmask||bitmask==BIND_FLAG){var result=createBind(func,bitmask,thisArg)}else if(bitmask==CURRY_FLAG||bitmask==CURRY_RIGHT_FLAG){result=createCurry(func,bitmask,arity)}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!holders.length){result=createPartial(func,bitmask,thisArg,partials)}else{result=createHybrid.apply(undefined,newData)}var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask)}function equalArrays(array,other,equalFunc,customizer,bitmask,stack){var isPartial=bitmask&PARTIAL_COMPARE_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other}var index=-1,result=true,seen=bitmask&UNORDERED_COMPARE_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!seen.has(othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack))){return seen.add(othIndex)}})){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack))){result=false;break}}stack["delete"](array);stack["delete"](other);return result}function equalByTag(object,other,tag,equalFunc,customizer,bitmask,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&PARTIAL_COMPARE_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=UNORDERED_COMPARE_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),equalFunc,customizer,bitmask,stack);stack["delete"](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}function equalObjects(object,other,equalFunc,customizer,bitmask,stack){var isPartial=bitmask&PARTIAL_COMPARE_FLAG,objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:baseHas(other,key))){return false}}var stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,customizer,bitmask,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);stack["delete"](other);return result}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getFuncName(func){var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name}}return result}function getHolder(func){var object=hasOwnProperty.call(lodash,"placeholder")?lodash:func;return object.placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result}var getLength=baseProperty("length");function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}var getPrototype=overArg(nativeGetPrototype,Object);var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):stubArray;var getSymbolsIn=!nativeGetSymbols?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):undefined;if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=isKey(path,object)?[path]:castPath(path);var result,index=-1,length=path.length;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result){return result}var length=object?object.length:0;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isString(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor((+object));case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object)}}function indexKeys(object){var length=object?object.length:undefined;if(isLength(length)&&(isArray(object)||isString(object)||isArguments(object))){return baseTimes(length,String)}return null}function insertWrapDetails(source,details){var length=details.length,lastIndex=length-1;details[lastIndex]=(length>1?"& ":"")+details[lastIndex];details=details.join(length>2?", ":" ");return source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!="function"||!(funcName in LazyWrapper.prototype)){return false}if(func===other){return true}var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(BIND_FLAG|BIND_KEY_FLAG|ARY_FLAG);var isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&source[7].length<=source[8]&&bitmask==CURRY_FLAG;if(!(isCommon||isCombo)){return data}if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value;data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):value;data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]}value=source[7];if(value){data[7]=value}if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function mergeDefaults(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){stack.set(srcValue,objValue);baseMerge(objValue,srcValue,undefined,mergeDefaults,stack);stack["delete"](srcValue)}return objValue}function parent(object,path){return path.length==1?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key}}else{count=0}return baseSetData(key,value)}}();var setWrapToString=!defineProperty?identity:function(wrapper,reference,bitmask){var source=reference+"";return defineProperty(wrapper,"toString",{configurable:true,enumerable:false,value:constant(insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))})};var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){arrayEach(wrapFlags,function(pair){var value="_."+pair[0];if(bitmask&pair[1]&&!arrayIncludes(details,value)){details.push(value)}});return details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone()}var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size===undefined){size=1}else{size=nativeMax(toInteger(size),0)}var length=array?array.length:0;if(!length||size<1){return[]}var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array?array.length:0,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value}}return result}function concat(){var length=arguments.length,args=Array(length?length-1:0),array=arguments[0],index=length;while(index--){args[index-1]=arguments[index]}return length?arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1)):[]}var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true)):[]});var differenceBy=baseRest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),getIteratee(iteratee,2)):[]});var differenceWith=baseRest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),undefined,comparator):[]});function drop(array,n,guard){var length=array?array.length:0;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,n<0?0:n,length)}function dropRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true,true):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true):[]}function fill(array,value,start,end){var length=array?array.length:0;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length-1;if(fromIndex!==undefined){index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)}return baseFindIndex(array,getIteratee(predicate,3),index,true)}function flatten(array){var length=array?array.length:0;return length?baseFlatten(array,1):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){var length=array?array.length:0;if(!length){return[]}depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth)}function fromPairs(pairs){var index=-1,length=pairs?pairs.length:0,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseIndexOf(array,value,index)}function initial(array){return dropRight(array,1)}var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]});var intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]});var intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(comparator===last(mapped)){comparator=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]});function join(array,separator){return array?nativeJoin.call(array,separator):""}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=(index<0?nativeMax(length+index,0):nativeMin(index,length-1))+1}if(value!==value){return baseFindIndex(array,baseIsNaN,index-1,true)}while(index--){if(array[index]===value){return index}}return-1}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}var pullAt=baseRest(function(array,indexes){indexes=baseFlatten(indexes,1);var length=array?array.length:0,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending));return result});function remove(array,predicate){var result=[];if(!(array&&array.length)){return result}var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index)}}basePullAt(array,indexes);return result}function reverse(array){return array?nativeReverse.call(array):array}function slice(array,start,end){var length=array?array.length:0;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end)}return baseSlice(array,start,end)}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=array?array.length:0;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index}}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,true)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),true)}function sortedLastIndexOf(array,value){var length=array?array.length:0;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index}}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){return drop(array,1)}function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length)}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),false,true):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))});var unionBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),getIteratee(iteratee,2))});var unionWith=baseRest(function(arrays){var comparator=last(arrays);if(isArrayLikeObject(comparator)){comparator=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),undefined,comparator)});function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){return array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!(array&&array.length)){return[]}var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!(array&&array.length)){return[]}var result=unzip(array);if(iteratee==null){return result}return arrayMap(result,function(group){return apply(iteratee,undefined,group)})}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});var xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))});var xorBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))});var xorWith=baseRest(function(arrays){var comparator=last(arrays);if(isArrayLikeObject(comparator)){comparator=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)});var zip=baseRest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=="function"?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee)});function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor){interceptor(value);return value}function thru(value,interceptor){return interceptor(value)}var wrapperAt=baseRest(function(paths){paths=baseFlatten(paths,1);var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor)}value=value.slice(start,+start+(length?1:0));value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined)}return array})});function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value())}var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{done:done,value:value}}function wrapperToIterator(){return this}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this)}wrapped=wrapped.reverse();wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined});return new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3))}var find=createFind(findIndex);var findLast=createFind(findLastIndex);function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){depth=depth===undefined?1:toInteger(depth);return baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{result[key]=[value]}});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc=typeof path=="function",isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){var func=isFunc?path:isProp&&value!=null?value[path]:undefined;result[++index]=func?apply(func,value,args):baseInvoke(value,path,args)});return result});var keyBy=createAggregator(function(result,value,key){result[key]=value});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){if(collection==null){return[]}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees]}orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseOrderBy(collection,iteratees,orders)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)))}function sample(collection){var array=isArrayLike(collection)?collection:values(collection),length=array.length;return length>0?array[baseRandom(0,length-1)]:undefined}function sampleSize(collection,n,guard){var index=-1,result=toArray(collection),length=result.length,lastIndex=length-1;if(guard?isIterateeCall(collection,n,guard):n===undefined){n=1}else{n=baseClamp(toInteger(n),0,length)}while(++index<n){var rand=baseRandom(index,lastIndex),value=result[rand];result[rand]=result[index];result[index]=value}result.length=n;return result}function shuffle(collection){return sampleSize(collection,MAX_ARRAY_LENGTH)}function size(collection){if(collection==null){return 0}if(isArrayLike(collection)){var result=collection.length;return result&&isString(collection)?stringSize(collection):result}if(isObjectLike(collection)){var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size}}return keys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}var sortBy=baseRest(function(collection,iteratees){if(collection==null){return[]}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[]}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]]}return baseOrderBy(collection,baseFlatten(iteratees,1),[])});function now(){return Date.now()}function after(n,func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){n=guard?undefined:n;n=func&&n==null?func.length:n;return createWrap(func,ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}var bind=baseRest(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)});var bindKey=baseRest(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;
trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}var defer=baseRest(function(func,args){return baseDelay(func,1,args)});var delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});function flip(func){return createWrap(func,FLIP_FLAG)}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}var overArgs=baseRest(function(func,transforms){transforms=transforms.length==1&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index])}return apply(func,this,args)})});var partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,PARTIAL_FLAG,undefined,partials,holders)});var partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,PARTIAL_RIGHT_FLAG,undefined,partials,holders)});var rearg=baseRest(function(func,indexes){return createWrap(func,REARG_FLAG,undefined,undefined,undefined,baseFlatten(indexes,1))});function rest(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?start:toInteger(start);return baseRest(func,start)}function spread(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?0:nativeMax(toInteger(start),0);return baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);if(array){arrayPush(otherArgs,array)}return apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return partial(wrapper,value)}function castArray(){if(!arguments.length){return[]}var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,false,true)}function cloneWith(value,customizer){return baseClone(value,false,true,customizer)}function cloneDeep(value){return baseClone(value,true,true)}function cloneDeepWith(value,customizer){return baseClone(value,true,true,customizer)}function conformsTo(object,source){return source==null||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}var gt=createRelationalOperation(baseGt);var gte=createRelationalOperation(function(value,other){return value>=other});function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;var isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;function isArrayLike(value){return value!=null&&isLength(getLength(value))&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return value===true||value===false||isObjectLike(value)&&objectToString.call(value)==boolTag}var isBuffer=nativeIsBuffer||stubFalse;var isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;function isElement(value){return!!value&&value.nodeType===1&&isObjectLike(value)&&!isPlainObject(value)}function isEmpty(value){if(isArrayLike(value)&&(isArray(value)||isString(value)||isFunction(value.splice)||isArguments(value)||isBuffer(value))){return!value.length}if(isObjectLike(value)){var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size}}for(var key in value){if(hasOwnProperty.call(value,key)){return false}}return!(nonEnumShadows&&keys(value).length)}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer=typeof customizer=="function"?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}function isError(value){if(!isObjectLike(value)){return false}return objectToString.call(value)==errorTag||typeof value.message=="string"&&typeof value.name=="string"}function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isInteger(value){return typeof value=="number"&&value==toInteger(value)}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value)){throw new Error("This method is not supported with core-js. Try https://github.com/es-shims.")}return baseIsNative(value)}function isNull(value){return value===null}function isNil(value){return value==null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&objectToString.call(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||objectToString.call(value)!=objectTag||isHostObject(value)){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&objectToString.call(value)==stringTag}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&objectToString.call(value)==weakSetTag}var lt=createRelationalOperation(baseLt);var lte=createRelationalOperation(function(value,other){return value<=other});function toArray(value){if(!value){return[]}if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value)}if(iteratorSymbol&&value[iteratorSymbol]){return iteratorToArray(value[iteratorSymbol]())}var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value)}function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=isFunction(value.valueOf)?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER)}function toString(value){return value==null?"":baseToString(value)}var assign=createAssigner(function(object,source){if(nonEnumShadows||isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});var assignIn=createAssigner(function(object,source){if(nonEnumShadows||isPrototype(source)||isArrayLike(source)){copyObject(source,keysIn(source),object);return}for(var key in source){assignValue(object,key,source[key])}});var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)});var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)});var at=baseRest(function(object,paths){return baseAt(object,baseFlatten(paths,1))});function create(prototype,properties){var result=baseCreate(prototype);return properties?baseAssign(result,properties):result}var defaults=baseRest(function(args){args.push(undefined,assignInDefaults);return apply(assignInWith,undefined,args)});var defaultsDeep=baseRest(function(args){args.push(undefined,mergeDefaults);return apply(mergeWith,undefined,args)});function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return object==null?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return object==null?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return object==null?[]:baseFunctions(object,keys(object))}function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return object!=null&&hasPath(object,path,baseHas)}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var invert=createInverter(function(result,value,key){result[value]=key},constant(identity));var invertBy=createInverter(function(result,value,key){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}},getIteratee);var invoke=baseRest(baseInvoke);function keys(object){var isProto=isPrototype(object);if(!(isProto||isArrayLike(object))){return baseKeys(object)}var indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;for(var key in object){if(baseHas(object,key)&&!(skipIndexes&&(key=="length"||isIndex(key,length)))&&!(isProto&&key=="constructor")){result.push(key)}}return result}function keysIn(object){var index=-1,isProto=isPrototype(object),props=baseKeysIn(object),propsLength=props.length,indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;while(++index<propsLength){var key=props[index];if(!(skipIndexes&&(key=="length"||isIndex(key,length)))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){result[iteratee(value,key,object)]=value});return result}function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){result[key]=iteratee(value,key,object)});return result}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)});var omit=baseRest(function(object,props){if(object==null){return{}}props=arrayMap(baseFlatten(props,1),toKey);return basePick(object,baseDifference(getAllKeysIn(object),props))});function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}var pick=baseRest(function(object,props){return object==null?{}:basePick(object,arrayMap(baseFlatten(props,1),toKey))});function pickBy(object,predicate){return object==null?{}:basePickBy(object,getAllKeysIn(object),getIteratee(predicate))}function result(object,path,defaultValue){path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length;if(!length){object=undefined;length=1}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return object==null?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer)}var toPairs=createToPairs(keys);var toPairsIn=createToPairs(keysIn);function transform(object,iteratee,accumulator){var isArr=isArray(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{}}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function unset(object,path){return object==null?true:baseUnset(object,path)}function update(object,path,updater){return object==null?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return object?baseValues(object,keys(object)):[]}function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined}if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0}if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0}return baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}number=toNumber(number);return baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&typeof floating!="boolean"&&isIterateeCall(lower,upper,floating)){upper=floating=undefined}if(floating===undefined){if(typeof upper=="boolean"){floating=upper;upper=undefined}else if(typeof lower=="boolean"){floating=lower;lower=undefined}}if(lower===undefined&&upper===undefined){lower=0;upper=1}else{lower=toFinite(lower);if(upper===undefined){upper=lower;lower=0}else{upper=toFinite(upper)}}if(lower>upper){var temp=lower;lower=upper;upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word)});function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){string=toString(string);return string&&string.replace(reLatin1,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string);target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;position-=target.length;return position>=0&&string.slice(position,end)==target}function escape(string){string=toString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=toString(string);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});var lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()});var lowerFirst=createCaseFirst("toLowerCase");function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length){return string}var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){if(guard||radix==null){radix=0}else if(radix){radix=+radix}string=toString(string).replace(reTrim,"");return nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10))}function repeat(string,n,guard){if(guard?isIterateeCall(string,n,guard):n===undefined){n=1}else{n=toInteger(n)}return baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:nativeReplace.call(string,args[1],args[2])}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});function split(string,separator,limit){if(limit&&typeof limit!="number"&&isIterateeCall(string,separator,limit)){separator=limit=undefined}limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0;if(!limit){return[]}string=toString(string);if(string&&(typeof separator=="string"||separator!=null&&!isRegExp(separator))){separator=baseToString(separator);if(separator==""&&reHasComplexSymbol.test(string)){return castSlice(stringToArray(string),0,limit)}}return nativeSplit.call(string,separator,limit)}var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)});function startsWith(string,target,position){string=toString(string);position=baseClamp(toInteger(position),0,string.length);target=baseToString(target);return string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined}string=toString(string);options=assignInWith({},options,settings,assignInDefaults);var imports=assignInWith({},options.imports,settings.imports,assignInDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrim,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join("")}function trimEnd(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimEnd,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join("")}function trimStart(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimStart,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length;omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(reHasComplexSymbol.test(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength){return string}var end=length-stringSize(omission);if(end<1){return omission}var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined){return result+omission}if(strSymbols){end+=result.length-end}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){var newEnd=match.index}result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}var upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()});var upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){pattern=reHasComplexWord.test(string)?reComplexWord:reBasicWord}return string.match(pattern)||[]}var attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}});var bindAll=baseRest(function(object,methodNames){arrayEach(baseFlatten(methodNames,1),function(key){key=toKey(key);object[key]=bind(object[key],object)});return object});function cond(pairs){var length=pairs?pairs.length:0,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return[toIteratee(pair[0]),pair[1]]});return baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args)}}})}function conforms(source){return baseConforms(baseClone(source,true))}function constant(value){return function(){return value}}function defaultTo(value,defaultValue){return value==null||value!==value?defaultValue:value}var flow=createFlow();var flowRight=createFlow(true);function identity(value){return value}function iteratee(func){return baseIteratee(typeof func=="function"?func:baseClone(func,true))}function matches(source){return baseMatches(baseClone(source,true))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,true))}var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}});var methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source))}var chain=!(isObject(options)&&"chain"in options)||!!options.chain,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}return func.apply(object,arrayPush([this.value()],arguments))}}});return object}function noConflict(){if(root._===this){root._=oldDash}return this}function noop(){}function nthArg(n){n=toInteger(n);return baseRest(function(args){return baseNth(args,n)})}var over=createOver(arrayMap);var overEvery=createOver(arrayEvery);var overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path)}}var range=createRange();var rangeRight=createRange(true);function stubArray(){return[]}function stubFalse(){return false}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return true}function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[]}var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index)}return result}function toPath(value){if(isArray(value)){return arrayMap(value,toKey)}return isSymbol(value)?[value]:copyArray(stringToPath(value))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}var add=createMathOperation(function(augend,addend){return augend+addend},0);var ceil=createRound("ceil");var divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1);var floor=createRound("floor");function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1);var round=createRound("round");var subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatMapDeep=flatMapDeep;lodash.flatMapDepth=flatMapDepth;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;
lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;lodash.entries=toPairs;lodash.entriesIn=toPairsIn;lodash.extend=assignIn;lodash.extendWith=assignInWith;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.conformsTo=conformsTo;lodash.deburr=deburr;lodash.defaultTo=defaultTo;lodash.divide=divide;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.meanBy=meanBy;lodash.min=min;lodash.minBy=minBy;lodash.stubArray=stubArray;lodash.stubFalse=stubFalse;lodash.stubObject=stubObject;lodash.stubString=stubString;lodash.stubTrue=stubTrue;lodash.multiply=multiply;lodash.nth=nth;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toFinite=toFinite;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func}});return source}(),{chain:false});lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__;if(filtered&&!index){return new LazyWrapper(this)}n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.clone();if(filtered){result.__takeCount__=nativeMin(n,result.__takeCount__)}else{result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}});arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type});result.__filtered__=result.__filtered__||isFilter;return result}});arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)};LazyWrapper.prototype.invokeMap=baseRest(function(path,args){if(typeof path=="function"){return new LazyWrapper(this)}return this.map(function(value){return baseInvoke(value,path,args)})});LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result)}if(start<0){result=result.takeRight(-start)}else if(start){result=result.drop(start)}if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+(methodName=="last"?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return}lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(result,chainAll)}if(isUnwrapped&&onlyLazy){return func.apply(this,args)}result=this.thru(interceptor);return isUnwrapped?isTaker?result.value()[0]:result.value():result}});arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"",names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}});realNames[createHybrid(undefined,BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.first=lodash.prototype.head;if(iteratorSymbol){lodash.prototype[iteratorSymbol]=wrapperToIterator}return lodash}var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeModule){(freeModule.exports=_)._=_;freeExports._=_}else{root._=_}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],184:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:6}],185:[function(require,module,exports){"use strict";module.exports=Buffer;var ieee754=require("ieee754");var BufferMethods;function Buffer(length){var arr;if(length&&length.length){arr=length;length=arr.length}var buf=new Uint8Array(length||0);if(arr)buf.set(arr);buf.readUInt32LE=BufferMethods.readUInt32LE;buf.writeUInt32LE=BufferMethods.writeUInt32LE;buf.readInt32LE=BufferMethods.readInt32LE;buf.writeInt32LE=BufferMethods.writeInt32LE;buf.readFloatLE=BufferMethods.readFloatLE;buf.writeFloatLE=BufferMethods.writeFloatLE;buf.readDoubleLE=BufferMethods.readDoubleLE;buf.writeDoubleLE=BufferMethods.writeDoubleLE;buf.toString=BufferMethods.toString;buf.write=BufferMethods.write;buf.slice=BufferMethods.slice;buf.copy=BufferMethods.copy;buf._isBuffer=true;return buf}var lastStr,lastStrEncoded;BufferMethods={readUInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+this[pos+3]*16777216},writeUInt32LE:function(val,pos){this[pos]=val;this[pos+1]=val>>>8;this[pos+2]=val>>>16;this[pos+3]=val>>>24},readInt32LE:function(pos){return(this[pos]|this[pos+1]<<8|this[pos+2]<<16)+(this[pos+3]<<24)},readFloatLE:function(pos){return ieee754.read(this,pos,true,23,4)},readDoubleLE:function(pos){return ieee754.read(this,pos,true,52,8)},writeFloatLE:function(val,pos){return ieee754.write(this,val,pos,true,23,4)},writeDoubleLE:function(val,pos){return ieee754.write(this,val,pos,true,52,8)},toString:function(encoding,start,end){var str="",tmp="";start=start||0;end=Math.min(this.length,end||this.length);for(var i=start;i<end;i++){var ch=this[i];if(ch<=127){str+=decodeURIComponent(tmp)+String.fromCharCode(ch);tmp=""}else{tmp+="%"+ch.toString(16)}}str+=decodeURIComponent(tmp);return str},write:function(str,pos){var bytes=str===lastStr?lastStrEncoded:encodeString(str);for(var i=0;i<bytes.length;i++){this[pos+i]=bytes[i]}},slice:function(start,end){return this.subarray(start,end)},copy:function(buf,pos){pos=pos||0;for(var i=0;i<this.length;i++){buf[pos+i]=this[i]}}};BufferMethods.writeInt32LE=BufferMethods.writeUInt32LE;Buffer.byteLength=function(str){lastStr=str;lastStrEncoded=encodeString(str);return lastStrEncoded.length};Buffer.isBuffer=function(buf){return!!(buf&&buf._isBuffer)};function encodeString(str){var length=str.length,bytes=[];for(var i=0,c,lead;i<length;i++){c=str.charCodeAt(i);if(c>55295&&c<57344){if(lead){if(c<56320){bytes.push(239,191,189);lead=c;continue}else{c=lead-55296<<10|c-56320|65536;lead=null}}else{if(c>56319||i+1===length)bytes.push(239,191,189);else lead=c;continue}}else if(lead){bytes.push(239,191,189);lead=null}if(c<128)bytes.push(c);else if(c<2048)bytes.push(c>>6|192,c&63|128);else if(c<65536)bytes.push(c>>12|224,c>>6&63|128,c&63|128);else bytes.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}return bytes}},{ieee754:177}],186:[function(require,module,exports){(function(global){"use strict";module.exports=Pbf;var Buffer=global.Buffer||require("./buffer");function Pbf(buf){this.buf=!Buffer.isBuffer(buf)?new Buffer(buf||0):buf;this.pos=0;this.length=this.buf.length}Pbf.Varint=0;Pbf.Fixed64=1;Pbf.Bytes=2;Pbf.Fixed32=5;var SHIFT_LEFT_32=(1<<16)*(1<<16),SHIFT_RIGHT_32=1/SHIFT_LEFT_32,POW_2_63=Math.pow(2,63);Pbf.prototype={destroy:function(){this.buf=null},readFields:function(readField,result,end){end=end||this.length;while(this.pos<end){var val=this.readVarint(),tag=val>>3,startPos=this.pos;readField(tag,result,this);if(this.pos===startPos)this.skip(val)}return result},readMessage:function(readField,result){return this.readFields(readField,result,this.readVarint()+this.pos)},readFixed32:function(){var val=this.buf.readUInt32LE(this.pos);this.pos+=4;return val},readSFixed32:function(){var val=this.buf.readInt32LE(this.pos);this.pos+=4;return val},readFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*SHIFT_LEFT_32;this.pos+=8;return val},readSFixed64:function(){var val=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*SHIFT_LEFT_32;this.pos+=8;return val},readFloat:function(){var val=this.buf.readFloatLE(this.pos);this.pos+=4;return val},readDouble:function(){var val=this.buf.readDoubleLE(this.pos);this.pos+=8;return val},readVarint:function(){var buf=this.buf,val,b;b=buf[this.pos++];val=b&127;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<7;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<14;if(b<128)return val;b=buf[this.pos++];val|=(b&127)<<21;if(b<128)return val;return readVarintRemainder(val,this)},readVarint64:function(){var startPos=this.pos,val=this.readVarint();if(val<POW_2_63)return val;var pos=this.pos-2;while(this.buf[pos]===255)pos--;if(pos<startPos)pos=startPos;val=0;for(var i=0;i<pos-startPos+1;i++){var b=~this.buf[startPos+i]&127;val+=i<4?b<<i*7:b*Math.pow(2,i*7)}return-val-1},readSVarint:function(){var num=this.readVarint();return num%2===1?(num+1)/-2:num/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var end=this.readVarint()+this.pos,str=this.buf.toString("utf8",this.pos,end);this.pos=end;return str},readBytes:function(){var end=this.readVarint()+this.pos,buffer=this.buf.slice(this.pos,end);this.pos=end;return buffer},readPackedVarint:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readVarint());return arr},readPackedSVarint:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSVarint());return arr},readPackedBoolean:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readBoolean());return arr},readPackedFloat:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFloat());return arr},readPackedDouble:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readDouble());return arr},readPackedFixed32:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFixed32());return arr},readPackedSFixed32:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSFixed32());return arr},readPackedFixed64:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readFixed64());return arr},readPackedSFixed64:function(){var end=this.readVarint()+this.pos,arr=[];while(this.pos<end)arr.push(this.readSFixed64());return arr},skip:function(val){var type=val&7;if(type===Pbf.Varint)while(this.buf[this.pos++]>127){}else if(type===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(type===Pbf.Fixed32)this.pos+=4;else if(type===Pbf.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+type)},writeTag:function(tag,type){this.writeVarint(tag<<3|type)},realloc:function(min){var length=this.length||16;while(length<this.pos+min)length*=2;if(length!==this.length){var buf=new Buffer(length);this.buf.copy(buf);this.buf=buf;this.length=length}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.slice(0,this.length)},writeFixed32:function(val){this.realloc(4);this.buf.writeUInt32LE(val,this.pos);this.pos+=4},writeSFixed32:function(val){this.realloc(4);this.buf.writeInt32LE(val,this.pos);this.pos+=4},writeFixed64:function(val){this.realloc(8);this.buf.writeInt32LE(val&-1,this.pos);this.buf.writeUInt32LE(Math.floor(val*SHIFT_RIGHT_32),this.pos+4);this.pos+=8},writeSFixed64:function(val){this.realloc(8);this.buf.writeInt32LE(val&-1,this.pos);this.buf.writeInt32LE(Math.floor(val*SHIFT_RIGHT_32),this.pos+4);this.pos+=8},writeVarint:function(val){val=+val;if(val>268435455){writeBigVarint(val,this);return}this.realloc(4);this.buf[this.pos++]=val&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=(val>>>=7)&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=(val>>>=7)&127|(val>127?128:0);if(val<=127)return;this.buf[this.pos++]=val>>>7&127},writeSVarint:function(val){this.writeVarint(val<0?-val*2-1:val*2)},writeBoolean:function(val){this.writeVarint(Boolean(val))},writeString:function(str){str=String(str);var bytes=Buffer.byteLength(str);this.writeVarint(bytes);this.realloc(bytes);this.buf.write(str,this.pos);this.pos+=bytes},writeFloat:function(val){this.realloc(4);this.buf.writeFloatLE(val,this.pos);this.pos+=4},writeDouble:function(val){this.realloc(8);this.buf.writeDoubleLE(val,this.pos);this.pos+=8},writeBytes:function(buffer){var len=buffer.length;this.writeVarint(len);this.realloc(len);for(var i=0;i<len;i++)this.buf[this.pos++]=buffer[i]},writeRawMessage:function(fn,obj){this.pos++;var startPos=this.pos;fn(obj,this);var len=this.pos-startPos;if(len>=128)reallocForRawMessage(startPos,len,this);this.pos=startPos-1;this.writeVarint(len);this.pos+=len},writeMessage:function(tag,fn,obj){this.writeTag(tag,Pbf.Bytes);this.writeRawMessage(fn,obj)},writePackedVarint:function(tag,arr){this.writeMessage(tag,writePackedVarint,arr)},writePackedSVarint:function(tag,arr){this.writeMessage(tag,writePackedSVarint,arr)},writePackedBoolean:function(tag,arr){this.writeMessage(tag,writePackedBoolean,arr)},writePackedFloat:function(tag,arr){this.writeMessage(tag,writePackedFloat,arr)},writePackedDouble:function(tag,arr){this.writeMessage(tag,writePackedDouble,arr)},writePackedFixed32:function(tag,arr){this.writeMessage(tag,writePackedFixed32,arr)},writePackedSFixed32:function(tag,arr){this.writeMessage(tag,writePackedSFixed32,arr)},writePackedFixed64:function(tag,arr){this.writeMessage(tag,writePackedFixed64,arr)},writePackedSFixed64:function(tag,arr){this.writeMessage(tag,writePackedSFixed64,arr)},writeBytesField:function(tag,buffer){this.writeTag(tag,Pbf.Bytes);this.writeBytes(buffer)},writeFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeFixed32(val)},writeSFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeSFixed32(val)},writeFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeFixed64(val)},writeSFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeSFixed64(val)},writeVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint);this.writeVarint(val)},writeSVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint);this.writeSVarint(val)},writeStringField:function(tag,str){this.writeTag(tag,Pbf.Bytes);this.writeString(str)},writeFloatField:function(tag,val){this.writeTag(tag,Pbf.Fixed32);this.writeFloat(val)},writeDoubleField:function(tag,val){this.writeTag(tag,Pbf.Fixed64);this.writeDouble(val)},writeBooleanField:function(tag,val){this.writeVarintField(tag,Boolean(val))}};function readVarintRemainder(val,pbf){var buf=pbf.buf,b;b=buf[pbf.pos++];val+=(b&127)*268435456;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*34359738368;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*4398046511104;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*562949953421312;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*72057594037927940;if(b<128)return val;b=buf[pbf.pos++];val+=(b&127)*0x8000000000000000;if(b<128)return val;throw new Error("Expected varint not more than 10 bytes")}function writeBigVarint(val,pbf){pbf.realloc(10);var maxPos=pbf.pos+10;while(val>=1){if(pbf.pos>=maxPos)throw new Error("Given varint doesn't fit into 10 bytes");var b=val&255;pbf.buf[pbf.pos++]=b|(val>=128?128:0);val/=128}}function reallocForRawMessage(startPos,len,pbf){var extraLen=len<=16383?1:len<=2097151?2:len<=268435455?3:Math.ceil(Math.log(len)/(Math.LN2*7));pbf.realloc(extraLen);for(var i=pbf.pos-1;i>=startPos;i--)pbf.buf[i+extraLen]=pbf.buf[i]}function writePackedVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeVarint(arr[i])}function writePackedSVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSVarint(arr[i])}function writePackedFloat(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFloat(arr[i])}function writePackedDouble(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeDouble(arr[i])}function writePackedBoolean(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeBoolean(arr[i])}function writePackedFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed32(arr[i])}function writePackedSFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed32(arr[i])}function writePackedFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed64(arr[i])}function writePackedSFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed64(arr[i])}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./buffer":185}],187:[function(require,module,exports){"use strict";module.exports=require("./lib")},{"./lib":192}],188:[function(require,module,exports){"use strict";var asap=require("asap/raw");function noop(){}var LAST_ERROR=null;var IS_ERROR={};function getThen(obj){try{return obj.then}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallOne(fn,a){try{return fn(a)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallTwo(fn,a,b){try{fn(a,b)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}module.exports=Promise;function Promise(fn){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof fn!=="function"){throw new TypeError("not a function")}this._37=0;this._12=null;this._59=[];if(fn===noop)return;doResolve(fn,this)}Promise._99=noop;Promise.prototype.then=function(onFulfilled,onRejected){if(this.constructor!==Promise){return safeThen(this,onFulfilled,onRejected)}var res=new Promise(noop);handle(this,new Handler(onFulfilled,onRejected,res));return res};function safeThen(self,onFulfilled,onRejected){return new self.constructor(function(resolve,reject){var res=new Promise(noop);res.then(resolve,reject);handle(self,new Handler(onFulfilled,onRejected,res))})}function handle(self,deferred){while(self._37===3){self=self._12}if(self._37===0){self._59.push(deferred);return}asap(function(){var cb=self._37===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){if(self._37===1){resolve(deferred.promise,self._12)}else{reject(deferred.promise,self._12)}return}var ret=tryCallOne(cb,self._12);if(ret===IS_ERROR){reject(deferred.promise,LAST_ERROR)}else{resolve(deferred.promise,ret)}})}function resolve(self,newValue){if(newValue===self){return reject(self,new TypeError("A promise cannot be resolved with itself."))}if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=getThen(newValue);if(then===IS_ERROR){return reject(self,LAST_ERROR)}if(then===self.then&&newValue instanceof Promise){self._37=3;self._12=newValue;finale(self);return}else if(typeof then==="function"){doResolve(then.bind(newValue),self);return}}self._37=1;self._12=newValue;finale(self)}function reject(self,newValue){self._37=2;self._12=newValue;finale(self)}function finale(self){for(var i=0;i<self._59.length;i++){handle(self,self._59[i])}self._59=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.promise=promise}function doResolve(fn,promise){var done=false;var res=tryCallTwo(fn,function(value){if(done)return;done=true;resolve(promise,value)},function(reason){if(done)return;done=true;reject(promise,reason)});if(!done&&res===IS_ERROR){done=true;reject(promise,LAST_ERROR)}}},{"asap/raw":2}],189:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype.done=function(onFulfilled,onRejected){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){setTimeout(function(){throw err},0)})}},{"./core.js":188}],190:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;var TRUE=valuePromise(true);var FALSE=valuePromise(false);var NULL=valuePromise(null);var UNDEFINED=valuePromise(undefined);var ZERO=valuePromise(0);var EMPTYSTRING=valuePromise("");function valuePromise(value){var p=new Promise(Promise._99);p._37=1;p._12=value;return p}Promise.resolve=function(value){if(value instanceof Promise)return value;if(value===null)return NULL;if(value===undefined)return UNDEFINED;if(value===true)return TRUE;if(value===false)return FALSE;if(value===0)return ZERO;if(value==="")return EMPTYSTRING;if(typeof value==="object"||typeof value==="function"){try{var then=value.then;if(typeof then==="function"){return new Promise(then.bind(value))}}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}}return valuePromise(value)};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){if(val&&(typeof val==="object"||typeof val==="function")){if(val instanceof Promise&&val.then===Promise.prototype.then){while(val._37===3){val=val._12}if(val._37===1)return res(i,val._12);if(val._37===2)reject(val._12);val.then(function(val){res(i,val)},reject);return}else{var then=val.then;if(typeof then==="function"){var p=new Promise(then.bind(val));p.then(function(val){res(i,val);
},reject);return}}}args[i]=val;if(--remaining===0){resolve(args)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})};Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)}},{"./core.js":188}],191:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype["finally"]=function(f){return this.then(function(value){return Promise.resolve(f()).then(function(){return value})},function(err){return Promise.resolve(f()).then(function(){throw err})})}},{"./core.js":188}],192:[function(require,module,exports){"use strict";module.exports=require("./core.js");require("./done.js");require("./finally.js");require("./es6-extensions.js");require("./node-extensions.js")},{"./core.js":188,"./done.js":189,"./es6-extensions.js":190,"./finally.js":191,"./node-extensions.js":193}],193:[function(require,module,exports){"use strict";var Promise=require("./core.js");var asap=require("asap");module.exports=Promise;Promise.denodeify=function(fn,argumentCount){argumentCount=argumentCount||Infinity;return function(){var self=this;var args=Array.prototype.slice.call(arguments,0,argumentCount>0?argumentCount:0);return new Promise(function(resolve,reject){args.push(function(err,res){if(err)reject(err);else resolve(res)});var res=fn.apply(self,args);if(res&&(typeof res==="object"||typeof res==="function")&&typeof res.then==="function"){resolve(res)}})}};Promise.nodeify=function(fn){return function(){var args=Array.prototype.slice.call(arguments);var callback=typeof args[args.length-1]==="function"?args.pop():null;var ctx=this;try{return fn.apply(this,arguments).nodeify(callback,ctx)}catch(ex){if(callback===null||typeof callback=="undefined"){return new Promise(function(resolve,reject){reject(ex)})}else{asap(function(){callback.call(ctx,ex)})}}}};Promise.prototype.nodeify=function(callback,ctx){if(typeof callback!="function")return this;this.then(function(value){asap(function(){callback.call(ctx,null,value)})},function(err){asap(function(){callback.call(ctx,err)})})}},{"./core.js":188,asap:1}],194:[function(require,module,exports){"use strict";module.exports=partialSort;function partialSort(arr,k,left,right,compare){left=left||0;right=right||arr.length-1;compare=compare||defaultCompare;while(right>left){if(right-left>600){var n=right-left+1;var m=k-left+1;var z=Math.log(n);var s=.5*Math.exp(2*z/3);var sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);var newLeft=Math.max(left,Math.floor(k-m*s/n+sd));var newRight=Math.min(right,Math.floor(k+(n-m)*s/n+sd));partialSort(arr,k,newLeft,newRight,compare)}var t=arr[k];var i=left;var j=right;swap(arr,left,k);if(compare(arr[right],t)>0)swap(arr,left,right);while(i<j){swap(arr,i,j);i++;j--;while(compare(arr[i],t)<0)i++;while(compare(arr[j],t)>0)j--}if(compare(arr[left],t)===0)swap(arr,left,j);else{j++;swap(arr,j,right)}if(j<=k)left=j+1;if(k<=j)right=j-1}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}},{}],195:[function(require,module,exports){"use strict";module.exports=rbush;var quickselect=require("quickselect");function rbush(maxEntries,format){if(!(this instanceof rbush))return new rbush(maxEntries,format);this._maxEntries=Math.max(4,maxEntries||9);this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4));if(format){this._initFormat(format)}this.clear()}rbush.prototype={all:function(){return this._all(this.data,[])},search:function(bbox){var node=this.data,result=[],toBBox=this.toBBox;if(!intersects(bbox,node))return result;var nodesToSearch=[],i,len,child,childBBox;while(node){for(i=0,len=node.children.length;i<len;i++){child=node.children[i];childBBox=node.leaf?toBBox(child):child;if(intersects(bbox,childBBox)){if(node.leaf)result.push(child);else if(contains(bbox,childBBox))this._all(child,result);else nodesToSearch.push(child)}}node=nodesToSearch.pop()}return result},collides:function(bbox){var node=this.data,toBBox=this.toBBox;if(!intersects(bbox,node))return false;var nodesToSearch=[],i,len,child,childBBox;while(node){for(i=0,len=node.children.length;i<len;i++){child=node.children[i];childBBox=node.leaf?toBBox(child):child;if(intersects(bbox,childBBox)){if(node.leaf||contains(bbox,childBBox))return true;nodesToSearch.push(child)}}node=nodesToSearch.pop()}return false},load:function(data){if(!(data&&data.length))return this;if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++){this.insert(data[i])}return this}var node=this._build(data.slice(),0,data.length-1,0);if(!this.data.children.length){this.data=node}else if(this.data.height===node.height){this._splitRoot(this.data,node)}else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node;node=tmpNode}this._insert(node,this.data.height-node.height-1,true)}return this},insert:function(item){if(item)this._insert(item,this.data.height-1);return this},clear:function(){this.data=createNode([]);return this},remove:function(item,equalsFn){if(!item)return this;var node=this.data,bbox=this.toBBox(item),path=[],indexes=[],i,parent,index,goingUp;while(node||path.length){if(!node){node=path.pop();parent=path[path.length-1];i=indexes.pop();goingUp=true}if(node.leaf){index=findItem(item,node.children,equalsFn);if(index!==-1){node.children.splice(index,1);path.push(node);this._condense(path);return this}}if(!goingUp&&!node.leaf&&contains(node,bbox)){path.push(node);indexes.push(i);i=0;parent=node;node=node.children[0]}else if(parent){i++;node=parent.children[i];goingUp=false}else node=null}return this},toBBox:function(item){return item},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data},fromJSON:function(data){this.data=data;return this},_all:function(node,result){var nodesToSearch=[];while(node){if(node.leaf)result.push.apply(result,node.children);else nodesToSearch.push.apply(nodesToSearch,node.children);node=nodesToSearch.pop()}return result},_build:function(items,left,right,height){var N=right-left+1,M=this._maxEntries,node;if(N<=M){node=createNode(items.slice(left,right+1));calcBBox(node,this.toBBox);return node}if(!height){height=Math.ceil(Math.log(N)/Math.log(M));M=Math.ceil(N/Math.pow(M,height-1))}node=createNode([]);node.leaf=false;node.height=height;var N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M)),i,j,right2,right3;multiSelect(items,left,right,N1,this.compareMinX);for(i=left;i<=right;i+=N1){right2=Math.min(i+N1-1,right);multiSelect(items,i,right2,N2,this.compareMinY);for(j=i;j<=right2;j+=N2){right3=Math.min(j+N2-1,right2);node.children.push(this._build(items,j,right3,height-1))}}calcBBox(node,this.toBBox);return node},_chooseSubtree:function(bbox,node,level,path){var i,len,child,targetNode,area,enlargement,minArea,minEnlargement;while(true){path.push(node);if(node.leaf||path.length-1===level)break;minArea=minEnlargement=Infinity;for(i=0,len=node.children.length;i<len;i++){child=node.children[i];area=bboxArea(child);enlargement=enlargedArea(bbox,child)-area;if(enlargement<minEnlargement){minEnlargement=enlargement;minArea=area<minArea?area:minArea;targetNode=child}else if(enlargement===minEnlargement){if(area<minArea){minArea=area;targetNode=child}}}node=targetNode||node.children[0]}return node},_insert:function(item,level,isNode){var toBBox=this.toBBox,bbox=isNode?item:toBBox(item),insertPath=[];var node=this._chooseSubtree(bbox,this.data,level,insertPath);node.children.push(item);extend(node,bbox);while(level>=0){if(insertPath[level].children.length>this._maxEntries){this._split(insertPath,level);level--}else break}this._adjustParentBBoxes(bbox,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M);var newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height;newNode.leaf=node.leaf;calcBBox(node,this.toBBox);calcBBox(newNode,this.toBBox);if(level)insertPath[level-1].children.push(newNode);else this._splitRoot(node,newNode)},_splitRoot:function(node,newNode){this.data=createNode([node,newNode]);this.data.height=node.height+1;this.data.leaf=false;calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap,area,minOverlap,minArea,index;minOverlap=minArea=Infinity;for(i=m;i<=M-m;i++){bbox1=distBBox(node,0,i,this.toBBox);bbox2=distBBox(node,i,M,this.toBBox);overlap=intersectionArea(bbox1,bbox2);area=bboxArea(bbox1)+bboxArea(bbox2);if(overlap<minOverlap){minOverlap=overlap;index=i;minArea=area<minArea?area:minArea}else if(overlap===minOverlap){if(area<minArea){minArea=area;index=i}}}return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY,xMargin=this._allDistMargin(node,m,M,compareMinX),yMargin=this._allDistMargin(node,m,M,compareMinY);if(xMargin<yMargin)node.children.sort(compareMinX)},_allDistMargin:function(node,m,M,compare){node.children.sort(compare);var toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox),margin=bboxMargin(leftBBox)+bboxMargin(rightBBox),i,child;for(i=m;i<M-m;i++){child=node.children[i];extend(leftBBox,node.leaf?toBBox(child):child);margin+=bboxMargin(leftBBox)}for(i=M-m-1;i>=m;i--){child=node.children[i];extend(rightBBox,node.leaf?toBBox(child):child);margin+=bboxMargin(rightBBox)}return margin},_adjustParentBBoxes:function(bbox,path,level){for(var i=level;i>=0;i--){extend(path[i],bbox)}},_condense:function(path){for(var i=path.length-1,siblings;i>=0;i--){if(path[i].children.length===0){if(i>0){siblings=path[i-1].children;siblings.splice(siblings.indexOf(path[i]),1)}else this.clear()}else calcBBox(path[i],this.toBBox)}},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0]));this.compareMinY=new Function("a","b",compareArr.join(format[1]));this.toBBox=new Function("a","return {minX: a"+format[0]+", minY: a"+format[1]+", maxX: a"+format[2]+", maxY: a"+format[3]+"};")}};function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++){if(equalsFn(item,items[i]))return i}return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){if(!destNode)destNode=createNode(null);destNode.minX=Infinity;destNode.minY=Infinity;destNode.maxX=-Infinity;destNode.maxY=-Infinity;for(var i=k,child;i<p;i++){child=node.children[i];extend(destNode,node.leaf?toBBox(child):child)}return destNode}function extend(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function enlargedArea(a,b){return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))}function intersectionArea(a,b){var minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children:children,height:1,leaf:true,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function multiSelect(arr,left,right,n,compare){var stack=[left,right],mid;while(stack.length){right=stack.pop();left=stack.pop();if(right-left<=n)continue;mid=left+Math.ceil((right-left)/n/2)*n;quickselect(arr,mid,left,right,compare);stack.push(left,mid,mid,right)}}},{quickselect:194}],196:[function(require,module,exports){(function(define,location){"use strict";var undef;define(function(require){var mixin,origin,urlRE,absoluteUrlRE,fullyQualifiedUrlRE;mixin=require("./util/mixin");urlRE=/([a-z][a-z0-9\+\-\.]*:)\/\/([^@]+@)?(([^:\/]+)(:([0-9]+))?)?(\/[^?#]*)?(\?[^#]*)?(#\S*)?/i;absoluteUrlRE=/^([a-z][a-z0-9\-\+\.]*:\/\/|\/)/i;fullyQualifiedUrlRE=/([a-z][a-z0-9\+\-\.]*:)\/\/([^@]+@)?(([^:\/]+)(:([0-9]+))?)?\//i;function buildUrl(template,params){var url,name,queryStringParams,re;url=template;queryStringParams={};if(params){for(name in params){re=new RegExp("\\{"+name+"\\}");if(re.test(url)){url=url.replace(re,encodeURIComponent(params[name]),"g")}else{queryStringParams[name]=params[name]}}for(name in queryStringParams){url+=url.indexOf("?")===-1?"?":"&";url+=encodeURIComponent(name);if(queryStringParams[name]!==null&&queryStringParams[name]!==undefined){url+="=";url+=encodeURIComponent(queryStringParams[name])}}}return url}function startsWith(str,test){return str.indexOf(test)===0}function UrlBuilder(template,params){if(!(this instanceof UrlBuilder)){return new UrlBuilder(template,params)}if(template instanceof UrlBuilder){this._template=template.template;this._params=mixin({},this._params,params)}else{this._template=(template||"").toString();this._params=params||{}}}UrlBuilder.prototype={append:function(template,params){return new UrlBuilder(this._template+template,mixin({},this._params,params))},fullyQualify:function(){if(!location){return this}if(this.isFullyQualified()){return this}var template=this._template;if(startsWith(template,"//")){template=origin.protocol+template}else if(startsWith(template,"/")){template=origin.origin+template}else if(!this.isAbsolute()){template=origin.origin+origin.pathname.substring(0,origin.pathname.lastIndexOf("/")+1)}if(template.indexOf("/",8)===-1){template=template+"/"}return new UrlBuilder(template,this._params)},isAbsolute:function(){return absoluteUrlRE.test(this.build())},isFullyQualified:function(){return fullyQualifiedUrlRE.test(this.build())},isCrossOrigin:function(){if(!origin){return true}var url=this.parts();return url.protocol!==origin.protocol||url.hostname!==origin.hostname||url.port!==origin.port},parts:function(){var url,parts;url=this.fullyQualify().build().match(urlRE);parts={href:url[0],protocol:url[1],host:url[3]||"",hostname:url[4]||"",port:url[6],pathname:url[7]||"",search:url[8]||"",hash:url[9]||""};parts.origin=parts.protocol+"//"+parts.host;parts.port=parts.port||(parts.protocol==="https:"?"443":parts.protocol==="http:"?"80":"");return parts},build:function(params){return buildUrl(this._template,mixin({},this._params,params))},toString:function(){return this.build()}};origin=location?new UrlBuilder(location.href).parts():undef;return UrlBuilder})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)},typeof window!=="undefined"?window.location:void 0)},{"./util/mixin":215}],197:[function(require,module,exports){(function(define){"use strict";define(function(require){var rest=require("./client/default"),browser=require("./client/xhr");rest.setPlatformDefaultClient(browser);return rest})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./client/default":199,"./client/xhr":200}],198:[function(require,module,exports){(function(define){"use strict";define(function(){return function client(impl,target){if(target){impl.skip=function skip(){return target}}impl.wrap=function wrap(interceptor,config){return interceptor(impl,config)};impl.chain=function chain(){if(typeof console!=="undefined"){console.log("rest.js: client.chain() is deprecated, use client.wrap() instead")}return impl.wrap.apply(this,arguments)};return impl}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],199:[function(require,module,exports){(function(define){"use strict";var undef;define(function(require){var client,target,platformDefault;client=require("../client");function defaultClient(){return target.apply(undef,arguments)}defaultClient.setDefaultClient=function setDefaultClient(client){target=client};defaultClient.getDefaultClient=function getDefaultClient(){return target};defaultClient.resetDefaultClient=function resetDefaultClient(){target=platformDefault};defaultClient.setPlatformDefaultClient=function setPlatformDefaultClient(client){if(platformDefault){throw new Error("Unable to redefine platformDefaultClient")}target=platformDefault=client};return client(defaultClient)})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../client":198}],200:[function(require,module,exports){(function(define,global){"use strict";define(function(require){var when,UrlBuilder,normalizeHeaderName,responsePromise,client,headerSplitRE;when=require("when");UrlBuilder=require("../UrlBuilder");normalizeHeaderName=require("../util/normalizeHeaderName");responsePromise=require("../util/responsePromise");client=require("../client");headerSplitRE=/[\r|\n]+/;function parseHeaders(raw){var headers={};if(!raw){return headers}raw.trim().split(headerSplitRE).forEach(function(header){var boundary,name,value;boundary=header.indexOf(":");name=normalizeHeaderName(header.substring(0,boundary).trim());value=header.substring(boundary+1).trim();if(headers[name]){if(Array.isArray(headers[name])){headers[name].push(value)}else{headers[name]=[headers[name],value]}}else{headers[name]=value}});return headers}function safeMixin(target,source){Object.keys(source||{}).forEach(function(prop){if(source.hasOwnProperty(prop)&&prop in target){try{target[prop]=source[prop]}catch(e){}}});return target}return client(function xhr(request){return responsePromise.promise(function(resolve,reject){var client,method,url,headers,entity,headerName,response,XMLHttpRequest;request=typeof request==="string"?{path:request}:request||{};response={request:request};if(request.canceled){response.error="precanceled";reject(response);return}entity=request.entity;request.method=request.method||(entity?"POST":"GET");method=request.method;url=response.url=new UrlBuilder(request.path||"",request.params).build();XMLHttpRequest=request.engine||global.XMLHttpRequest;if(!XMLHttpRequest){reject({request:request,url:url,error:"xhr-not-available"});return}try{client=response.raw=new XMLHttpRequest;safeMixin(client,request.mixin);client.open(method,url,true);safeMixin(client,request.mixin);headers=request.headers;for(headerName in headers){if(headerName==="Content-Type"&&headers[headerName]==="multipart/form-data"){continue}client.setRequestHeader(headerName,headers[headerName])}request.canceled=false;request.cancel=function cancel(){request.canceled=true;client.abort();reject(response)};client.onreadystatechange=function(){if(request.canceled){return}if(client.readyState===(XMLHttpRequest.DONE||4)){response.status={code:client.status,text:client.statusText};response.headers=parseHeaders(client.getAllResponseHeaders());response.entity=client.responseText;if(response.status.code>0){resolve(response)}else{setTimeout(function(){resolve(response)},0)}}};try{client.onerror=function(){response.error="loaderror";reject(response)}}catch(e){}client.send(entity)}catch(e){response.error="loaderror";reject(response)}})})})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)},typeof window!=="undefined"?window:void 0)},{"../UrlBuilder":196,"../client":198,"../util/normalizeHeaderName":216,"../util/responsePromise":218,when:401}],201:[function(require,module,exports){(function(define){"use strict";define(function(require){var defaultClient,mixin,responsePromise,client,when;defaultClient=require("./client/default");mixin=require("./util/mixin");responsePromise=require("./util/responsePromise");client=require("./client");when=require("when");function defaultInitHandler(config){return config}function defaultRequestHandler(request){return request}function defaultResponseHandler(response){return response}function race(promisesOrValues){return when.promise(function(resolve,reject){promisesOrValues.forEach(function(promiseOrValue){when(promiseOrValue,resolve,reject)})})}function ComplexRequest(properties){if(!(this instanceof ComplexRequest)){return new ComplexRequest(properties)}mixin(this,properties)}function interceptor(handlers){var initHandler,requestHandler,successResponseHandler,errorResponseHandler;handlers=handlers||{};initHandler=handlers.init||defaultInitHandler;requestHandler=handlers.request||defaultRequestHandler;successResponseHandler=handlers.success||handlers.response||defaultResponseHandler;errorResponseHandler=handlers.error||function(){return when((handlers.response||defaultResponseHandler).apply(this,arguments),when.reject,when.reject)};return function(target,config){if(typeof target==="object"){config=target}if(typeof target!=="function"){target=handlers.client||defaultClient}config=initHandler(config||{});function interceptedClient(request){var context,meta;context={};meta={arguments:Array.prototype.slice.call(arguments),client:interceptedClient};request=typeof request==="string"?{path:request}:request||{};request.originator=request.originator||interceptedClient;return responsePromise(requestHandler.call(context,request,config,meta),function(request){var response,abort,next;next=target;if(request instanceof ComplexRequest){abort=request.abort;next=request.client||next;response=request.response;request=request.request}response=response||when(request,function(request){return when(next(request),function(response){return successResponseHandler.call(context,response,config,meta)},function(response){return errorResponseHandler.call(context,response,config,meta)})});return abort?race([response,abort]):response},function(error){return when.reject({request:request,error:error})})}return client(interceptedClient,target)}}interceptor.ComplexRequest=ComplexRequest;return interceptor})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./client":198,"./client/default":199,"./util/mixin":215,"./util/responsePromise":218,when:401}],202:[function(require,module,exports){(function(define){"use strict";define(function(require){var interceptor,mime,registry,noopConverter,when;interceptor=require("../interceptor");mime=require("../mime");registry=require("../mime/registry");when=require("when");noopConverter={read:function(obj){return obj},write:function(obj){return obj}};return interceptor({init:function(config){config.registry=config.registry||registry;return config},request:function(request,config){var type,headers;headers=request.headers||(request.headers={});type=mime.parse(headers["Content-Type"]=headers["Content-Type"]||config.mime||"text/plain");headers.Accept=headers.Accept||config.accept||type.raw+", application/json;q=0.8, text/plain;q=0.5, */*;q=0.2";if(!("entity"in request)){return request}return config.registry.lookup(type).otherwise(function(){if(config.permissive){return noopConverter}throw"mime-unknown"}).then(function(converter){var client=config.client||request.originator;return when.attempt(converter.write,request.entity,{client:client,request:request,mime:type,registry:config.registry}).otherwise(function(){throw"mime-serialization"}).then(function(entity){request.entity=entity;return request})})},response:function(response,config){if(!(response.headers&&response.headers["Content-Type"]&&response.entity)){return response}var type=mime.parse(response.headers["Content-Type"]);return config.registry.lookup(type).otherwise(function(){return noopConverter}).then(function(converter){var client=config.client||response.request&&response.request.originator;return when.attempt(converter.read,response.entity,{client:client,response:response,mime:type,registry:config.registry}).otherwise(function(e){response.error="mime-deserialization";response.cause=e;throw response}).then(function(entity){response.entity=entity;return response})})}})})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../interceptor":201,"../mime":206,"../mime/registry":207,when:401}],203:[function(require,module,exports){(function(global){(function(define,global){"use strict";define(function(require){var interceptor,UrlBuilder,pubsub,when;interceptor=require("../interceptor");UrlBuilder=require("../UrlBuilder");pubsub=require("../util/pubsub");when=require("when");function defaultOAuthCallback(hash){var params,queryString,regex,m;queryString=hash.indexOf("#")===0?hash.substring(1):hash;params={};regex=/([^&=]+)=([^&]*)/g;m=regex.exec(queryString);do{params[decodeURIComponent(m[1])]=decodeURIComponent(m[2]);m=regex.exec(queryString)}while(m);pubsub.publish(params.state,params.token_type+" "+params.access_token)}function defaultWindowStrategy(url){var w=window.open(url,"_blank","width=500,height=400");return function(){w.close()}}function authorize(config){var state,url,dismissWindow;return when.promise(function(resolve){state=Math.random()*(new Date).getTime();url=new UrlBuilder(config.authorizationUrlBase).build({response_type:"token",redirect_uri:config.redirectUrl,client_id:config.clientId,scope:config.scope,state:state});dismissWindow=config.windowStrategy(url);pubsub.subscribe(state,function(authorization){dismissWindow();resolve(authorization)})})}return interceptor({init:function(config){config.redirectUrl=new UrlBuilder(config.redirectUrl).fullyQualify().build();config.windowStrategy=config.windowStrategy||defaultWindowStrategy;config.oAuthCallback=config.oAuthCallback||defaultOAuthCallback;config.oAuthCallbackName=config.oAuthCallbackName||"oAuthCallback";global[config.oAuthCallbackName]=config.oAuthCallback;return config},request:function(request,config){request.headers=request.headers||{};if(config.token){request.headers.Authorization=config.token;return request}else{return authorize(config).then(function(authorization){request.headers.Authorization=config.token=authorization;return request})}},response:function(response,config,meta){if(response.status.code===401){return authorize(config).then(function(authorization){config.token=authorization;return meta.client(response.request)})}else if(response.status.code===403){return when.reject(response)}return response}})})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)},typeof window!=="undefined"?window:typeof global!=="undefined"?global:void 0)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../UrlBuilder":196,"../interceptor":201,"../util/pubsub":217,when:401}],204:[function(require,module,exports){(function(define){"use strict";define(function(require){var interceptor,UrlBuilder;interceptor=require("../interceptor");UrlBuilder=require("../UrlBuilder");function startsWith(str,prefix){return str.indexOf(prefix)===0}function endsWith(str,suffix){return str.lastIndexOf(suffix)+suffix.length===str.length}return interceptor({request:function(request,config){var path;if(config.prefix&&!new UrlBuilder(request.path).isFullyQualified()){path=config.prefix;if(request.path){if(!endsWith(path,"/")&&!startsWith(request.path,"/")){path+="/"}path+=request.path}request.path=path}return request}})})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../UrlBuilder":196,"../interceptor":201}],205:[function(require,module,exports){(function(define){"use strict";define(function(require){var interceptor,uriTemplate,mixin;interceptor=require("../interceptor");uriTemplate=require("../util/uriTemplate");mixin=require("../util/mixin");return interceptor({init:function(config){config.params=config.params||{};config.template=config.template||"";return config},request:function(request,config){var template,params;template=request.path||config.template;params=mixin({},request.params,config.params);request.path=uriTemplate.expand(template,params);delete request.params;return request}})})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../interceptor":201,"../util/mixin":215,"../util/uriTemplate":220}],206:[function(require,module,exports){(function(define){"use strict";var undef;define(function(){function parse(mime){var params,type;params=mime.split(";");type=params[0].trim().split("+");return{raw:mime,type:type[0],suffix:type[1]?"+"+type[1]:"",params:params.slice(1).reduce(function(params,pair){pair=pair.split("=");params[pair[0].trim()]=pair[1]?pair[1].trim():undef;return params},{})}}return{parse:parse}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],207:[function(require,module,exports){(function(define){"use strict";define(function(require){var mime,when,registry;mime=require("../mime");when=require("when");function Registry(mimes){this.lookup=function lookup(type){var parsed;parsed=typeof type==="string"?mime.parse(type):type;if(mimes[parsed.raw]){return mimes[parsed.raw]}if(mimes[parsed.type+parsed.suffix]){return mimes[parsed.type+parsed.suffix]}if(mimes[parsed.type]){return mimes[parsed.type]}if(mimes[parsed.suffix]){return mimes[parsed.suffix]}return when.reject(new Error('Unable to locate converter for mime "'+parsed.raw+'"'))};this.delegate=function delegate(type){return{read:function(){var args=arguments;return this.lookup(type).then(function(converter){return converter.read.apply(this,args)}.bind(this))}.bind(this),write:function(){var args=arguments;return this.lookup(type).then(function(converter){return converter.write.apply(this,args)}.bind(this))}.bind(this)}};this.register=function register(type,converter){mimes[type]=when(converter);return mimes[type]};this.child=function child(){return new Registry(Object.create(mimes))}}registry=new Registry({});registry.register("application/hal",require("./type/application/hal"));registry.register("application/json",require("./type/application/json"));registry.register("application/x-www-form-urlencoded",require("./type/application/x-www-form-urlencoded"));registry.register("multipart/form-data",require("./type/multipart/form-data"));registry.register("text/plain",require("./type/text/plain"));registry.register("+json",registry.delegate("application/json"));return registry})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../mime":206,"./type/application/hal":208,"./type/application/json":209,"./type/application/x-www-form-urlencoded":210,"./type/multipart/form-data":211,"./type/text/plain":212,when:401}],208:[function(require,module,exports){(function(define){"use strict";define(function(require){var pathPrefix,template,find,lazyPromise,responsePromise,when;pathPrefix=require("../../../interceptor/pathPrefix");template=require("../../../interceptor/template");find=require("../../../util/find");lazyPromise=require("../../../util/lazyPromise");responsePromise=require("../../../util/responsePromise");when=require("when");function defineProperty(obj,name,value){Object.defineProperty(obj,name,{value:value,configurable:true,enumerable:false,writeable:true})}return{read:function(str,opts){var client,console;opts=opts||{};client=opts.client;console=opts.console||console;function deprecationWarning(relationship,deprecation){if(deprecation&&console&&console.warn||console.log){(console.warn||console.log).call(console,"Relationship '"+relationship+"' is deprecated, see "+deprecation)}}return opts.registry.lookup(opts.mime.suffix).then(function(converter){return when(converter.read(str,opts)).then(function(root){find.findProperties(root,"_embedded",function(embedded,resource,name){Object.keys(embedded).forEach(function(relationship){
if(relationship in resource){return}var related=responsePromise({entity:embedded[relationship]});defineProperty(resource,relationship,related)});defineProperty(resource,name,embedded)});find.findProperties(root,"_links",function(links,resource,name){Object.keys(links).forEach(function(relationship){var link=links[relationship];if(relationship in resource){return}defineProperty(resource,relationship,responsePromise.make(lazyPromise(function(){if(link.deprecation){deprecationWarning(relationship,link.deprecation)}if(link.templated===true){return template(client)({path:link.href})}return client({path:link.href})})))});defineProperty(resource,name,links);defineProperty(resource,"clientFor",function(relationship,clientOverride){var link=links[relationship];if(!link){throw new Error("Unknown relationship: "+relationship)}if(link.deprecation){deprecationWarning(relationship,link.deprecation)}if(link.templated===true){return template(clientOverride||client,{template:link.href})}return pathPrefix(clientOverride||client,{prefix:link.href})});defineProperty(resource,"requestFor",function(relationship,request,clientOverride){var client=this.clientFor(relationship,clientOverride);return client(request)})});return root})})},write:function(obj,opts){return opts.registry.lookup(opts.mime.suffix).then(function(converter){return converter.write(obj,opts)})}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../../../interceptor/pathPrefix":204,"../../../interceptor/template":205,"../../../util/find":213,"../../../util/lazyPromise":214,"../../../util/responsePromise":218,when:401}],209:[function(require,module,exports){(function(define){"use strict";define(function(){function createConverter(reviver,replacer){return{read:function(str){return JSON.parse(str,reviver)},write:function(obj){return JSON.stringify(obj,replacer)},extend:createConverter}}return createConverter()})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],210:[function(require,module,exports){(function(define){"use strict";define(function(){var encodedSpaceRE,urlEncodedSpaceRE;encodedSpaceRE=/%20/g;urlEncodedSpaceRE=/\+/g;function urlEncode(str){str=encodeURIComponent(str);return str.replace(encodedSpaceRE,"+")}function urlDecode(str){str=str.replace(urlEncodedSpaceRE," ");return decodeURIComponent(str)}function append(str,name,value){if(Array.isArray(value)){value.forEach(function(value){str=append(str,name,value)})}else{if(str.length>0){str+="&"}str+=urlEncode(name);if(value!==undefined&&value!==null){str+="="+urlEncode(value)}}return str}return{read:function(str){var obj={};str.split("&").forEach(function(entry){var pair,name,value;pair=entry.split("=");name=urlDecode(pair[0]);if(pair.length===2){value=urlDecode(pair[1])}else{value=null}if(name in obj){if(!Array.isArray(obj[name])){obj[name]=[obj[name]]}obj[name].push(value)}else{obj[name]=value}});return obj},write:function(obj){var str="";Object.keys(obj).forEach(function(name){str=append(str,name,obj[name])});return str}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],211:[function(require,module,exports){(function(define){"use strict";define(function(){function isFormElement(object){return object&&object.nodeType===1&&object.tagName==="FORM"}function createFormDataFromObject(object){var formData=new FormData;var value;for(var property in object){if(object.hasOwnProperty(property)){value=object[property];if(value instanceof File){formData.append(property,value,value.name)}else if(value instanceof Blob){formData.append(property,value)}else{formData.append(property,String(value))}}}return formData}return{write:function(object){if(typeof FormData==="undefined"){throw new Error("The multipart/form-data mime serializer requires FormData support")}if(object instanceof FormData){return object}if(isFormElement(object)){return new FormData(object)}if(typeof object==="object"&&object!==null){return createFormDataFromObject(object)}throw new Error("Unable to create FormData from object "+object)}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],212:[function(require,module,exports){(function(define){"use strict";define(function(){return{read:function(str){return str},write:function(obj){return obj.toString()}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],213:[function(require,module,exports){(function(define){"use strict";define(function(){return{findProperties:function findProperties(obj,prop,callback){if(typeof obj!=="object"||obj===null){return}if(prop in obj){callback(obj[prop],obj,prop)}Object.keys(obj).forEach(function(key){findProperties(obj[key],prop,callback)})}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],214:[function(require,module,exports){(function(define){"use strict";define(function(require){var when;when=require("when");function lazyPromise(work){var defer,started,resolver,promise,then;defer=when.defer();started=false;resolver=defer.resolver;promise=defer.promise;then=promise.then;promise.then=function(){if(!started){started=true;when.attempt(work).then(resolver.resolve,resolver.reject)}return then.apply(promise,arguments)};return promise}return lazyPromise})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{when:401}],215:[function(require,module,exports){(function(define){"use strict";define(function(){var empty={};function mixin(dest){var i,l,source,name;if(!dest){dest={}}for(i=1,l=arguments.length;i<l;i+=1){source=arguments[i];for(name in source){if(!(name in dest)||dest[name]!==source[name]&&(!(name in empty)||empty[name]!==source[name])){dest[name]=source[name]}}}return dest}return mixin})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],216:[function(require,module,exports){(function(define){"use strict";define(function(){function normalizeHeaderName(name){return name.toLowerCase().split("-").map(function(chunk){return chunk.charAt(0).toUpperCase()+chunk.slice(1)}).join("-")}return normalizeHeaderName})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],217:[function(require,module,exports){(function(define){"use strict";define(function(){var topics={};function publish(topic){if(!topics[topic]){return}topics[topic].apply({},Array.prototype.slice.call(arguments,1));delete topics[topic]}function subscribe(topic,callback){topics[topic]=callback}return{publish:publish,subscribe:subscribe}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],218:[function(require,module,exports){(function(define){"use strict";define(function(require){var when=require("when"),normalizeHeaderName=require("./normalizeHeaderName");function property(promise,name){return promise.then(function(value){return value&&value[name]},function(value){return when.reject(value&&value[name])})}function entity(){return property(this,"entity")}function status(){return property(property(this,"status"),"code")}function headers(){return property(this,"headers")}function header(headerName){headerName=normalizeHeaderName(headerName);return property(this.headers(),headerName)}function follow(rels){rels=[].concat(rels);return make(when.reduce(rels,function(response,rel){if(typeof rel==="string"){rel={rel:rel}}if(typeof response.entity.clientFor!=="function"){throw new Error("Hypermedia response expected")}var client=response.entity.clientFor(rel.rel);return client({params:rel.params})},this))}function make(promise){promise.status=status;promise.headers=headers;promise.header=header;promise.entity=entity;promise.follow=follow;return promise}function responsePromise(){return make(when.apply(when,arguments))}responsePromise.make=make;responsePromise.reject=function(val){return make(when.reject(val))};responsePromise.promise=function(func){return make(when.promise(func))};return responsePromise})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./normalizeHeaderName":216,when:401}],219:[function(require,module,exports){(function(define){"use strict";define(function(){var charMap;charMap=function(){var strings={alpha:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",digit:"0123456789"};strings.genDelims=":/?#[]@";strings.subDelims="!$&'()*+,;=";strings.reserved=strings.genDelims+strings.subDelims;strings.unreserved=strings.alpha+strings.digit+"-._~";strings.url=strings.reserved+strings.unreserved;strings.scheme=strings.alpha+strings.digit+"+-.";strings.userinfo=strings.unreserved+strings.subDelims+":";strings.host=strings.unreserved+strings.subDelims;strings.port=strings.digit;strings.pchar=strings.unreserved+strings.subDelims+":@";strings.segment=strings.pchar;strings.path=strings.segment+"/";strings.query=strings.pchar+"/?";strings.fragment=strings.pchar+"/?";return Object.keys(strings).reduce(function(charMap,set){charMap[set]=strings[set].split("").reduce(function(chars,myChar){chars[myChar]=true;return chars},{});return charMap},{})}();function encode(str,allowed){if(typeof str!=="string"){throw new Error("String required for URL encoding")}return str.split("").map(function(myChar){if(allowed.hasOwnProperty(myChar)){return myChar}var code=myChar.charCodeAt(0);if(code<=127){var encoded=code.toString(16).toUpperCase();return"%"+(encoded.length%2===1?"0":"")+encoded}else{return encodeURIComponent(myChar).toUpperCase()}}).join("")}function makeEncoder(allowed){allowed=allowed||charMap.unreserved;return function(str){return encode(str,allowed)}}function decode(str){return decodeURIComponent(str)}return{decode:decode,encode:makeEncoder(),encodeURL:makeEncoder(charMap.url),encodeScheme:makeEncoder(charMap.scheme),encodeUserInfo:makeEncoder(charMap.userinfo),encodeHost:makeEncoder(charMap.host),encodePort:makeEncoder(charMap.port),encodePathSegment:makeEncoder(charMap.segment),encodePath:makeEncoder(charMap.path),encodeQuery:makeEncoder(charMap.query),encodeFragment:makeEncoder(charMap.fragment)}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{}],220:[function(require,module,exports){(function(define){"use strict";var undef;define(function(require){var uriEncoder,operations,prefixRE;uriEncoder=require("./uriEncoder");prefixRE=/^([^:]*):([0-9]+)$/;operations={"":{first:"",separator:",",named:false,empty:"",encoder:uriEncoder.encode},"+":{first:"",separator:",",named:false,empty:"",encoder:uriEncoder.encodeURL},"#":{first:"#",separator:",",named:false,empty:"",encoder:uriEncoder.encodeURL},".":{first:".",separator:".",named:false,empty:"",encoder:uriEncoder.encode},"/":{first:"/",separator:"/",named:false,empty:"",encoder:uriEncoder.encode},";":{first:";",separator:";",named:true,empty:"",encoder:uriEncoder.encode},"?":{first:"?",separator:"&",named:true,empty:"=",encoder:uriEncoder.encode},"&":{first:"&",separator:"&",named:true,empty:"=",encoder:uriEncoder.encode},"=":{reserved:true},",":{reserved:true},"!":{reserved:true},"@":{reserved:true},"|":{reserved:true}};function apply(operation,expression,params){return expression.split(",").reduce(function(result,variable){var opts,value;opts={};if(variable.slice(-1)==="*"){variable=variable.slice(0,-1);opts.explode=true}if(prefixRE.test(variable)){var prefix=prefixRE.exec(variable);variable=prefix[1];opts.maxLength=parseInt(prefix[2])}variable=uriEncoder.decode(variable);value=params[variable];if(value===undef||value===null){return result}if(Array.isArray(value)){result+=value.reduce(function(result,value){if(result.length){result+=opts.explode?operation.separator:",";if(operation.named&&opts.explode){result+=operation.encoder(variable);result+=value.length?"=":operation.empty}}else{result+=operation.first;if(operation.named){result+=operation.encoder(variable);result+=value.length?"=":operation.empty}}result+=operation.encoder(value);return result},"")}else if(typeof value==="object"){result+=Object.keys(value).reduce(function(result,name){if(result.length){result+=opts.explode?operation.separator:","}else{result+=operation.first;if(operation.named&&!opts.explode){result+=operation.encoder(variable);result+=value[name].length?"=":operation.empty}}result+=operation.encoder(name);result+=opts.explode?"=":",";result+=operation.encoder(value[name]);return result},"")}else{value=String(value);if(opts.maxLength){value=value.slice(0,opts.maxLength)}result+=result.length?operation.separator:operation.first;if(operation.named){result+=operation.encoder(variable);result+=value.length?"=":operation.empty}result+=operation.encoder(value)}return result},"")}function expandExpression(expression,params){var operation;operation=operations[expression.slice(0,1)];if(operation){expression=expression.slice(1)}else{operation=operations[""]}if(operation.reserved){throw new Error("Reserved expression operations are not supported")}return apply(operation,expression,params)}function expandTemplate(template,params){var start,end,uri;uri="";end=0;while(true){start=template.indexOf("{",end);if(start===-1){uri+=template.slice(end);break}uri+=template.slice(end,start);end=template.indexOf("}",start)+1;uri+=expandExpression(template.slice(start+1,end-1),params)}return uri}return{expand:expandTemplate}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./uriEncoder":219}],221:[function(require,module,exports){(function(global){(function(factory){var objectTypes={boolean:false,function:true,object:true,number:false,string:false,undefined:false};var root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal}if(typeof define==="function"&&define.amd){define(["rx"],function(Rx,exports){return factory(root,exports,Rx)})}else if(typeof module==="object"&&module&&module.exports===freeExports){module.exports=factory(root,module.exports,require("./rx"))}else{root.Rx=factory(root,{},root.Rx)}}).call(this,function(root,exp,Rx,undefined){var Observable=Rx.Observable,observableProto=Observable.prototype,CompositeDisposable=Rx.CompositeDisposable,AnonymousObservable=Rx.AnonymousObservable,disposableEmpty=Rx.Disposable.empty,isEqual=Rx.internals.isEqual,helpers=Rx.helpers,not=helpers.not,defaultComparer=helpers.defaultComparer,identity=helpers.identity,defaultSubComparer=helpers.defaultSubComparer,isFunction=helpers.isFunction,isPromise=helpers.isPromise,isArrayLike=helpers.isArrayLike,isIterable=helpers.isIterable,inherits=Rx.internals.inherits,observableFromPromise=Observable.fromPromise,observableFrom=Observable.from,bindCallback=Rx.internals.bindCallback,EmptyError=Rx.EmptyError,ObservableBase=Rx.ObservableBase,ArgumentOutOfRangeError=Rx.ArgumentOutOfRangeError;var errorObj={e:{}};var tryCatchTarget;function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}function tryCatch(fn){if(!isFunction(fn)){throw new TypeError("fn must be a function")}tryCatchTarget=fn;return tryCatcher}function thrower(e){throw e}function extremaBy(source,keySelector,comparer){return new AnonymousObservable(function(o){var hasValue=false,lastKey=null,list=[];return source.subscribe(function(x){var comparison,key;try{key=keySelector(x)}catch(ex){o.onError(ex);return}comparison=0;if(!hasValue){hasValue=true;lastKey=key}else{try{comparison=comparer(key,lastKey)}catch(ex1){o.onError(ex1);return}}if(comparison>0){lastKey=key;list=[]}if(comparison>=0){list.push(x)}},function(e){o.onError(e)},function(){o.onNext(list);o.onCompleted()})},source)}function firstOnly(x){if(x.length===0){throw new EmptyError}return x[0]}observableProto.aggregate=function(){var hasSeed=false,accumulator,seed,source=this;if(arguments.length===2){hasSeed=true;seed=arguments[0];accumulator=arguments[1]}else{accumulator=arguments[0]}return new AnonymousObservable(function(o){var hasAccumulation,accumulation,hasValue;return source.subscribe(function(x){!hasValue&&(hasValue=true);try{if(hasAccumulation){accumulation=accumulator(accumulation,x)}else{accumulation=hasSeed?accumulator(seed,x):x;hasAccumulation=true}}catch(e){return o.onError(e)}},function(e){o.onError(e)},function(){hasValue&&o.onNext(accumulation);!hasValue&&hasSeed&&o.onNext(seed);!hasValue&&!hasSeed&&o.onError(new EmptyError);o.onCompleted()})},source)};var ReduceObservable=function(__super__){inherits(ReduceObservable,__super__);function ReduceObservable(source,acc,hasSeed,seed){this.source=source;this.acc=acc;this.hasSeed=hasSeed;this.seed=seed;__super__.call(this)}ReduceObservable.prototype.subscribeCore=function(observer){return this.source.subscribe(new InnerObserver(observer,this))};function InnerObserver(o,parent){this.o=o;this.acc=parent.acc;this.hasSeed=parent.hasSeed;this.seed=parent.seed;this.hasAccumulation=false;this.result=null;this.hasValue=false;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}!this.hasValue&&(this.hasValue=true);if(this.hasAccumulation){this.result=tryCatch(this.acc)(this.result,x)}else{this.result=this.hasSeed?tryCatch(this.acc)(this.seed,x):x;this.hasAccumulation=true}if(this.result===errorObj){this.o.onError(this.result.e)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.hasValue&&this.o.onNext(this.result);!this.hasValue&&this.hasSeed&&this.o.onNext(this.seed);!this.hasValue&&!this.hasSeed&&this.o.onError(new EmptyError);this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return ReduceObservable}(ObservableBase);observableProto.reduce=function(accumulator){var hasSeed=false;if(arguments.length===2){hasSeed=true;var seed=arguments[1]}return new ReduceObservable(this,accumulator,hasSeed,seed)};observableProto.some=function(predicate,thisArg){var source=this;return predicate?source.filter(predicate,thisArg).some():new AnonymousObservable(function(observer){return source.subscribe(function(){observer.onNext(true);observer.onCompleted()},function(e){observer.onError(e)},function(){observer.onNext(false);observer.onCompleted()})},source)};observableProto.any=function(){return this.some.apply(this,arguments)};observableProto.isEmpty=function(){return this.any().map(not)};observableProto.every=function(predicate,thisArg){return this.filter(function(v){return!predicate(v)},thisArg).some().map(not)};observableProto.all=function(){return this.every.apply(this,arguments)};observableProto.includes=function(searchElement,fromIndex){var source=this;function comparer(a,b){return a===0&&b===0||(a===b||isNaN(a)&&isNaN(b))}return new AnonymousObservable(function(o){var i=0,n=+fromIndex||0;Math.abs(n)===Infinity&&(n=0);if(n<0){o.onNext(false);o.onCompleted();return disposableEmpty}return source.subscribe(function(x){if(i++>=n&&comparer(x,searchElement)){o.onNext(true);o.onCompleted()}},function(e){o.onError(e)},function(){o.onNext(false);o.onCompleted()})},this)};observableProto.contains=function(searchElement,fromIndex){observableProto.includes(searchElement,fromIndex)};observableProto.count=function(predicate,thisArg){return predicate?this.filter(predicate,thisArg).count():this.reduce(function(count){return count+1},0)};observableProto.indexOf=function(searchElement,fromIndex){var source=this;return new AnonymousObservable(function(o){var i=0,n=+fromIndex||0;Math.abs(n)===Infinity&&(n=0);if(n<0){o.onNext(-1);o.onCompleted();return disposableEmpty}return source.subscribe(function(x){if(i>=n&&x===searchElement){o.onNext(i);o.onCompleted()}i++},function(e){o.onError(e)},function(){o.onNext(-1);o.onCompleted()})},source)};observableProto.sum=function(keySelector,thisArg){return keySelector&&isFunction(keySelector)?this.map(keySelector,thisArg).sum():this.reduce(function(prev,curr){return prev+curr},0)};observableProto.minBy=function(keySelector,comparer){comparer||(comparer=defaultSubComparer);return extremaBy(this,keySelector,function(x,y){return comparer(x,y)*-1})};observableProto.min=function(comparer){return this.minBy(identity,comparer).map(function(x){return firstOnly(x)})};observableProto.maxBy=function(keySelector,comparer){comparer||(comparer=defaultSubComparer);return extremaBy(this,keySelector,comparer)};observableProto.max=function(comparer){return this.maxBy(identity,comparer).map(function(x){return firstOnly(x)})};observableProto.average=function(keySelector,thisArg){return keySelector&&isFunction(keySelector)?this.map(keySelector,thisArg).average():this.reduce(function(prev,cur){return{sum:prev.sum+cur,count:prev.count+1}},{sum:0,count:0}).map(function(s){if(s.count===0){throw new EmptyError}return s.sum/s.count})};observableProto.sequenceEqual=function(second,comparer){var first=this;comparer||(comparer=defaultComparer);return new AnonymousObservable(function(o){var donel=false,doner=false,ql=[],qr=[];var subscription1=first.subscribe(function(x){var equal,v;if(qr.length>0){v=qr.shift();try{equal=comparer(v,x)}catch(e){o.onError(e);return}if(!equal){o.onNext(false);o.onCompleted()}}else if(doner){o.onNext(false);o.onCompleted()}else{ql.push(x)}},function(e){o.onError(e)},function(){donel=true;if(ql.length===0){if(qr.length>0){o.onNext(false);o.onCompleted()}else if(doner){o.onNext(true);o.onCompleted()}}});(isArrayLike(second)||isIterable(second))&&(second=observableFrom(second));isPromise(second)&&(second=observableFromPromise(second));var subscription2=second.subscribe(function(x){var equal;if(ql.length>0){var v=ql.shift();try{equal=comparer(v,x)}catch(exception){o.onError(exception);return}if(!equal){o.onNext(false);o.onCompleted()}}else if(donel){o.onNext(false);o.onCompleted()}else{qr.push(x)}},function(e){o.onError(e)},function(){doner=true;if(qr.length===0){if(ql.length>0){o.onNext(false);o.onCompleted()}else if(donel){o.onNext(true);o.onCompleted()}}});return new CompositeDisposable(subscription1,subscription2)},first)};function elementAtOrDefault(source,index,hasDefault,defaultValue){if(index<0){throw new ArgumentOutOfRangeError}return new AnonymousObservable(function(o){var i=index;return source.subscribe(function(x){if(i--===0){o.onNext(x);o.onCompleted()}},function(e){o.onError(e)},function(){if(!hasDefault){o.onError(new ArgumentOutOfRangeError)}else{o.onNext(defaultValue);o.onCompleted()}})},source)}observableProto.elementAt=function(index){return elementAtOrDefault(this,index,false)};observableProto.elementAtOrDefault=function(index,defaultValue){return elementAtOrDefault(this,index,true,defaultValue)};function singleOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(o){var value=defaultValue,seenValue=false;return source.subscribe(function(x){if(seenValue){o.onError(new Error("Sequence contains more than one element"))}else{value=x;seenValue=true}},function(e){o.onError(e)},function(){if(!seenValue&&!hasDefault){o.onError(new EmptyError)}else{o.onNext(value);o.onCompleted()}})},source)}observableProto.single=function(predicate,thisArg){return predicate&&isFunction(predicate)?this.where(predicate,thisArg).single():singleOrDefaultAsync(this,false)};observableProto.singleOrDefault=function(predicate,defaultValue,thisArg){return predicate&&isFunction(predicate)?this.filter(predicate,thisArg).singleOrDefault(null,defaultValue):singleOrDefaultAsync(this,true,defaultValue)};function firstOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(o){return source.subscribe(function(x){o.onNext(x);o.onCompleted()},function(e){o.onError(e)},function(){if(!hasDefault){o.onError(new EmptyError)}else{o.onNext(defaultValue);o.onCompleted()}})},source)}observableProto.first=function(predicate,thisArg){return predicate?this.where(predicate,thisArg).first():firstOrDefaultAsync(this,false)};observableProto.firstOrDefault=function(predicate,defaultValue,thisArg){return predicate?this.where(predicate).firstOrDefault(null,defaultValue):firstOrDefaultAsync(this,true,defaultValue)};function lastOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(o){var value=defaultValue,seenValue=false;return source.subscribe(function(x){value=x;seenValue=true},function(e){o.onError(e)},function(){if(!seenValue&&!hasDefault){o.onError(new EmptyError)}else{o.onNext(value);o.onCompleted()}})},source)}observableProto.last=function(predicate,thisArg){return predicate?this.where(predicate,thisArg).last():lastOrDefaultAsync(this,false)};observableProto.lastOrDefault=function(predicate,defaultValue,thisArg){return predicate?this.where(predicate,thisArg).lastOrDefault(null,defaultValue):lastOrDefaultAsync(this,true,defaultValue)};function findValue(source,predicate,thisArg,yieldIndex){var callback=bindCallback(predicate,thisArg,3);return new AnonymousObservable(function(o){var i=0;return source.subscribe(function(x){var shouldRun;try{shouldRun=callback(x,i,source)}catch(e){o.onError(e);return}if(shouldRun){o.onNext(yieldIndex?i:x);o.onCompleted()}else{i++}},function(e){o.onError(e)},function(){o.onNext(yieldIndex?-1:undefined);o.onCompleted()})},source)}observableProto.find=function(predicate,thisArg){return findValue(this,predicate,thisArg,false)};observableProto.findIndex=function(predicate,thisArg){return findValue(this,predicate,thisArg,true)};observableProto.toSet=function(){if(typeof root.Set==="undefined"){throw new TypeError}var source=this;return new AnonymousObservable(function(o){var s=new root.Set;return source.subscribe(function(x){s.add(x)},function(e){o.onError(e)},function(){o.onNext(s);o.onCompleted()})},source)};observableProto.toMap=function(keySelector,elementSelector){if(typeof root.Map==="undefined"){throw new TypeError}var source=this;return new AnonymousObservable(function(o){var m=new root.Map;return source.subscribe(function(x){var key;try{key=keySelector(x)}catch(e){o.onError(e);return}var element=x;if(elementSelector){try{element=elementSelector(x)}catch(e){o.onError(e);return}}m.set(key,element)},function(e){o.onError(e)},function(){o.onNext(m);o.onCompleted()})},source)};return Rx})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./rx":222}],222:[function(require,module,exports){(function(process,global){(function(undefined){var objectTypes={boolean:false,function:true,object:true,number:false,string:false,undefined:false};var root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal}var Rx={internals:{},config:{Promise:root.Promise},helpers:{}};var noop=Rx.helpers.noop=function(){},notDefined=Rx.helpers.notDefined=function(x){return typeof x==="undefined"},identity=Rx.helpers.identity=function(x){return x},pluck=Rx.helpers.pluck=function(property){return function(x){return x[property]}},just=Rx.helpers.just=function(value){return function(){return value}},defaultNow=Rx.helpers.defaultNow=Date.now,defaultComparer=Rx.helpers.defaultComparer=function(x,y){return isEqual(x,y)},defaultSubComparer=Rx.helpers.defaultSubComparer=function(x,y){return x>y?1:x<y?-1:0},defaultKeySerializer=Rx.helpers.defaultKeySerializer=function(x){return x.toString()},defaultError=Rx.helpers.defaultError=function(err){throw err},isPromise=Rx.helpers.isPromise=function(p){return!!p&&typeof p.subscribe!=="function"&&typeof p.then==="function"},asArray=Rx.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},not=Rx.helpers.not=function(a){return!a},isFunction=Rx.helpers.isFunction=function(){var isFn=function(value){return typeof value=="function"||false};if(isFn(/x/)){isFn=function(value){return typeof value=="function"&&toString.call(value)=="[object Function]"}}return isFn}();function cloneArray(arr){for(var a=[],i=0,len=arr.length;i<len;i++){a.push(arr[i])}return a}Rx.config.longStackSupport=false;var hasStacks=false;try{throw new Error}catch(e){hasStacks=!!e.stack}var rStartingLine=captureLine(),rFileName;var STACK_JUMP_SEPARATOR="From previous event:";function makeStackTraceLong(error,observable){if(hasStacks&&observable.stack&&typeof error==="object"&&error!==null&&error.stack&&error.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){var stacks=[];for(var o=observable;!!o;o=o.source){if(o.stack){stacks.unshift(o.stack)}}stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){var lines=stackString.split("\n"),desiredLines=[];for(var i=0,len=lines.length;i<len;i++){var line=lines[i];if(!isInternalFrame(line)&&!isNodeFrame(line)&&line){desiredLines.push(line)}}return desiredLines.join("\n")}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber){return false}var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===rFileName&&lineNumber>=rStartingLine&&lineNumber<=rEndingLine}function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1}function captureLine(){if(!hasStacks){return}try{throw new Error}catch(e){var lines=e.stack.split("\n");var firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2];var fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber){return}rFileName=fileNameAndLineNumber[0];return fileNameAndLineNumber[1]}}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1){return[attempt1[1],Number(attempt1[2])]}var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2){return[attempt2[1],Number(attempt2[2])]}var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);if(attempt3){return[attempt3[1],Number(attempt3[2])]}}var EmptyError=Rx.EmptyError=function(){this.message="Sequence contains no elements.";Error.call(this)};EmptyError.prototype=Error.prototype;var ObjectDisposedError=Rx.ObjectDisposedError=function(){this.message="Object has been disposed";Error.call(this)};ObjectDisposedError.prototype=Error.prototype;var ArgumentOutOfRangeError=Rx.ArgumentOutOfRangeError=function(){this.message="Argument out of range";Error.call(this)};ArgumentOutOfRangeError.prototype=Error.prototype;var NotSupportedError=Rx.NotSupportedError=function(message){this.message=message||"This operation is not supported";Error.call(this)};NotSupportedError.prototype=Error.prototype;var NotImplementedError=Rx.NotImplementedError=function(message){this.message=message||"This operation is not implemented";Error.call(this)};NotImplementedError.prototype=Error.prototype;var notImplemented=Rx.helpers.notImplemented=function(){throw new NotImplementedError};var notSupported=Rx.helpers.notSupported=function(){throw new NotSupportedError};var $iterator$=typeof Symbol==="function"&&Symbol.iterator||"_es6shim_iterator_";if(root.Set&&typeof(new root.Set)["@@iterator"]==="function"){$iterator$="@@iterator"}var doneEnumerator=Rx.doneEnumerator={done:true,value:undefined};var isIterable=Rx.helpers.isIterable=function(o){
return o[$iterator$]!==undefined};var isArrayLike=Rx.helpers.isArrayLike=function(o){return o&&o.length!==undefined};Rx.helpers.iterator=$iterator$;var bindCallback=Rx.internals.bindCallback=function(func,thisArg,argCount){if(typeof thisArg==="undefined"){return func}switch(argCount){case 0:return function(){return func.call(thisArg)};case 1:return function(arg){return func.call(thisArg,arg)};case 2:return function(value,index){return func.call(thisArg,value,index)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)}}return function(){return func.apply(thisArg,arguments)}};var dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;var argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",errorClass="[object Error]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]";var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,supportsArgsClass=toString.call(arguments)==argsClass,supportNodeClass,errorProto=Error.prototype,objectProto=Object.prototype,stringProto=String.prototype,propertyIsEnumerable=objectProto.propertyIsEnumerable;try{supportNodeClass=!(toString.call(document)==objectClass&&!({toString:0}+""))}catch(e){supportNodeClass=true}var nonEnumProps={};nonEnumProps[arrayClass]=nonEnumProps[dateClass]=nonEnumProps[numberClass]={constructor:true,toLocaleString:true,toString:true,valueOf:true};nonEnumProps[boolClass]=nonEnumProps[stringClass]={constructor:true,toString:true,valueOf:true};nonEnumProps[errorClass]=nonEnumProps[funcClass]=nonEnumProps[regexpClass]={constructor:true,toString:true};nonEnumProps[objectClass]={constructor:true};var support={};(function(){var ctor=function(){this.x=1},props=[];ctor.prototype={valueOf:1,y:1};for(var key in new ctor){props.push(key)}for(key in arguments){}support.enumErrorProps=propertyIsEnumerable.call(errorProto,"message")||propertyIsEnumerable.call(errorProto,"name");support.enumPrototypes=propertyIsEnumerable.call(ctor,"prototype");support.nonEnumArgs=key!=0;support.nonEnumShadows=!/valueOf/.test(props)})(1);var isObject=Rx.internals.isObject=function(value){var type=typeof value;return value&&(type=="function"||type=="object")||false};function keysIn(object){var result=[];if(!isObject(object)){return result}if(support.nonEnumArgs&&object.length&&isArguments(object)){object=slice.call(object)}var skipProto=support.enumPrototypes&&typeof object=="function",skipErrorProps=support.enumErrorProps&&(object===errorProto||object instanceof Error);for(var key in object){if(!(skipProto&&key=="prototype")&&!(skipErrorProps&&(key=="message"||key=="name"))){result.push(key)}}if(support.nonEnumShadows&&object!==objectProto){var ctor=object.constructor,index=-1,length=dontEnumsLength;if(object===(ctor&&ctor.prototype)){var className=object===stringProto?stringClass:object===errorProto?errorClass:toString.call(object),nonEnum=nonEnumProps[className]}while(++index<length){key=dontEnums[index];if(!(nonEnum&&nonEnum[key])&&hasOwnProperty.call(object,key)){result.push(key)}}}return result}function internalFor(object,callback,keysFunc){var index=-1,props=keysFunc(object),length=props.length;while(++index<length){var key=props[index];if(callback(object[key],key,object)===false){break}}return object}function internalForIn(object,callback){return internalFor(object,callback,keysIn)}function isNode(value){return typeof value.toString!="function"&&typeof(value+"")=="string"}var isArguments=function(value){return value&&typeof value=="object"?toString.call(value)==argsClass:false};if(!supportsArgsClass){isArguments=function(value){return value&&typeof value=="object"?hasOwnProperty.call(value,"callee"):false}}var isEqual=Rx.internals.isEqual=function(x,y){return deepEquals(x,y,[],[])};function deepEquals(a,b,stackA,stackB){if(a===b){return a!==0||1/a==1/b}var type=typeof a,otherType=typeof b;if(a===a&&(a==null||b==null||type!="function"&&type!="object"&&otherType!="function"&&otherType!="object")){return false}var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass){className=objectClass}if(otherClass==argsClass){otherClass=objectClass}if(className!=otherClass){return false}switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}var isArr=className==arrayClass;if(!isArr){if(className!=objectClass||!support.nodeClass&&(isNode(a)||isNode(b))){return false}var ctorA=!support.argsObject&&isArguments(a)?Object:a.constructor,ctorB=!support.argsObject&&isArguments(b)?Object:b.constructor;if(ctorA!=ctorB&&!(hasOwnProperty.call(a,"constructor")&&hasOwnProperty.call(b,"constructor"))&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&("constructor"in a&&"constructor"in b)){return false}}var initedStack=!stackA;stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b}}var size=0;var result=true;stackA.push(a);stackB.push(b);if(isArr){length=a.length;size=b.length;result=size==length;if(result){while(size--){var index=length,value=b[size];if(!(result=deepEquals(a[size],value,stackA,stackB))){break}}}}else{internalForIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return result=hasOwnProperty.call(a,key)&&deepEquals(a[key],value,stackA,stackB)}});if(result){internalForIn(a,function(value,key,a){if(hasOwnProperty.call(a,key)){return result=--size>-1}})}}stackA.pop();stackB.pop();return result}var hasProp={}.hasOwnProperty,slice=Array.prototype.slice;var inherits=this.inherits=Rx.internals.inherits=function(child,parent){function __(){this.constructor=child}__.prototype=parent.prototype;child.prototype=new __};var addProperties=Rx.internals.addProperties=function(obj){for(var sources=[],i=1,len=arguments.length;i<len;i++){sources.push(arguments[i])}for(var idx=0,ln=sources.length;idx<ln;idx++){var source=sources[idx];for(var prop in source){obj[prop]=source[prop]}}};var addRef=Rx.internals.addRef=function(xs,r){return new AnonymousObservable(function(observer){return new CompositeDisposable(r.getDisposable(),xs.subscribe(observer))})};function arrayInitialize(count,factory){var a=new Array(count);for(var i=0;i<count;i++){a[i]=factory()}return a}var errorObj={e:{}};var tryCatchTarget;function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}function tryCatch(fn){if(!isFunction(fn)){throw new TypeError("fn must be a function")}tryCatchTarget=fn;return tryCatcher}function thrower(e){throw e}function IndexedItem(id,value){this.id=id;this.value=value}IndexedItem.prototype.compareTo=function(other){var c=this.value.compareTo(other.value);c===0&&(c=this.id-other.id);return c};var PriorityQueue=Rx.internals.PriorityQueue=function(capacity){this.items=new Array(capacity);this.length=0};var priorityProto=PriorityQueue.prototype;priorityProto.isHigherPriority=function(left,right){return this.items[left].compareTo(this.items[right])<0};priorityProto.percolate=function(index){if(index>=this.length||index<0){return}var parent=index-1>>1;if(parent<0||parent===index){return}if(this.isHigherPriority(index,parent)){var temp=this.items[index];this.items[index]=this.items[parent];this.items[parent]=temp;this.percolate(parent)}};priorityProto.heapify=function(index){+index||(index=0);if(index>=this.length||index<0){return}var left=2*index+1,right=2*index+2,first=index;if(left<this.length&&this.isHigherPriority(left,first)){first=left}if(right<this.length&&this.isHigherPriority(right,first)){first=right}if(first!==index){var temp=this.items[index];this.items[index]=this.items[first];this.items[first]=temp;this.heapify(first)}};priorityProto.peek=function(){return this.items[0].value};priorityProto.removeAt=function(index){this.items[index]=this.items[--this.length];this.items[this.length]=undefined;this.heapify()};priorityProto.dequeue=function(){var result=this.peek();this.removeAt(0);return result};priorityProto.enqueue=function(item){var index=this.length++;this.items[index]=new IndexedItem((PriorityQueue.count++),item);this.percolate(index)};priorityProto.remove=function(item){for(var i=0;i<this.length;i++){if(this.items[i].value===item){this.removeAt(i);return true}}return false};PriorityQueue.count=0;var CompositeDisposable=Rx.CompositeDisposable=function(){var args=[],i,len;if(Array.isArray(arguments[0])){args=arguments[0];len=args.length}else{len=arguments.length;args=new Array(len);for(i=0;i<len;i++){args[i]=arguments[i]}}for(i=0;i<len;i++){if(!isDisposable(args[i])){throw new TypeError("Not a disposable")}}this.disposables=args;this.isDisposed=false;this.length=args.length};var CompositeDisposablePrototype=CompositeDisposable.prototype;CompositeDisposablePrototype.add=function(item){if(this.isDisposed){item.dispose()}else{this.disposables.push(item);this.length++}};CompositeDisposablePrototype.remove=function(item){var shouldDispose=false;if(!this.isDisposed){var idx=this.disposables.indexOf(item);if(idx!==-1){shouldDispose=true;this.disposables.splice(idx,1);this.length--;item.dispose()}}return shouldDispose};CompositeDisposablePrototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var len=this.disposables.length,currentDisposables=new Array(len);for(var i=0;i<len;i++){currentDisposables[i]=this.disposables[i]}this.disposables=[];this.length=0;for(i=0;i<len;i++){currentDisposables[i].dispose()}}};var Disposable=Rx.Disposable=function(action){this.isDisposed=false;this.action=action||noop};Disposable.prototype.dispose=function(){if(!this.isDisposed){this.action();this.isDisposed=true}};var disposableCreate=Disposable.create=function(action){return new Disposable(action)};var disposableEmpty=Disposable.empty={dispose:noop};var isDisposable=Disposable.isDisposable=function(d){return d&&isFunction(d.dispose)};var checkDisposed=Disposable.checkDisposed=function(disposable){if(disposable.isDisposed){throw new ObjectDisposedError}};var SingleAssignmentDisposable=Rx.SingleAssignmentDisposable=function(){this.isDisposed=false;this.current=null};SingleAssignmentDisposable.prototype.getDisposable=function(){return this.current};SingleAssignmentDisposable.prototype.setDisposable=function(value){if(this.current){throw new Error("Disposable has already been assigned")}var shouldDispose=this.isDisposed;!shouldDispose&&(this.current=value);shouldDispose&&value&&value.dispose()};SingleAssignmentDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old=this.current;this.current=null}old&&old.dispose()};var SerialDisposable=Rx.SerialDisposable=function(){this.isDisposed=false;this.current=null};SerialDisposable.prototype.getDisposable=function(){return this.current};SerialDisposable.prototype.setDisposable=function(value){var shouldDispose=this.isDisposed;if(!shouldDispose){var old=this.current;this.current=value}old&&old.dispose();shouldDispose&&value&&value.dispose()};SerialDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old=this.current;this.current=null}old&&old.dispose()};var RefCountDisposable=Rx.RefCountDisposable=function(){function InnerDisposable(disposable){this.disposable=disposable;this.disposable.count++;this.isInnerDisposed=false}InnerDisposable.prototype.dispose=function(){if(!this.disposable.isDisposed&&!this.isInnerDisposed){this.isInnerDisposed=true;this.disposable.count--;if(this.disposable.count===0&&this.disposable.isPrimaryDisposed){this.disposable.isDisposed=true;this.disposable.underlyingDisposable.dispose()}}};function RefCountDisposable(disposable){this.underlyingDisposable=disposable;this.isDisposed=false;this.isPrimaryDisposed=false;this.count=0}RefCountDisposable.prototype.dispose=function(){if(!this.isDisposed&&!this.isPrimaryDisposed){this.isPrimaryDisposed=true;if(this.count===0){this.isDisposed=true;this.underlyingDisposable.dispose()}}};RefCountDisposable.prototype.getDisposable=function(){return this.isDisposed?disposableEmpty:new InnerDisposable(this)};return RefCountDisposable}();function ScheduledDisposable(scheduler,disposable){this.scheduler=scheduler;this.disposable=disposable;this.isDisposed=false}function scheduleItem(s,self){if(!self.isDisposed){self.isDisposed=true;self.disposable.dispose()}}ScheduledDisposable.prototype.dispose=function(){this.scheduler.scheduleWithState(this,scheduleItem)};var ScheduledItem=Rx.internals.ScheduledItem=function(scheduler,state,action,dueTime,comparer){this.scheduler=scheduler;this.state=state;this.action=action;this.dueTime=dueTime;this.comparer=comparer||defaultSubComparer;this.disposable=new SingleAssignmentDisposable};ScheduledItem.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())};ScheduledItem.prototype.compareTo=function(other){return this.comparer(this.dueTime,other.dueTime)};ScheduledItem.prototype.isCancelled=function(){return this.disposable.isDisposed};ScheduledItem.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var Scheduler=Rx.Scheduler=function(){function Scheduler(now,schedule,scheduleRelative,scheduleAbsolute){this.now=now;this._schedule=schedule;this._scheduleRelative=scheduleRelative;this._scheduleAbsolute=scheduleAbsolute}Scheduler.isScheduler=function(s){return s instanceof Scheduler};function invokeAction(scheduler,action){action();return disposableEmpty}var schedulerProto=Scheduler.prototype;schedulerProto.schedule=function(action){return this._schedule(action,invokeAction)};schedulerProto.scheduleWithState=function(state,action){return this._schedule(state,action)};schedulerProto.scheduleWithRelative=function(dueTime,action){return this._scheduleRelative(action,dueTime,invokeAction)};schedulerProto.scheduleWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative(state,dueTime,action)};schedulerProto.scheduleWithAbsolute=function(dueTime,action){return this._scheduleAbsolute(action,dueTime,invokeAction)};schedulerProto.scheduleWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute(state,dueTime,action)};Scheduler.now=defaultNow;Scheduler.normalize=function(timeSpan){timeSpan<0&&(timeSpan=0);return timeSpan};return Scheduler}();var normalizeTime=Scheduler.normalize,isScheduler=Scheduler.isScheduler;(function(schedulerProto){function invokeRecImmediate(scheduler,pair){var state=pair[0],action=pair[1],group=new CompositeDisposable;function recursiveAction(state1){action(state1,function(state2){var isAdded=false,isDone=false,d=scheduler.scheduleWithState(state2,function(scheduler1,state3){if(isAdded){group.remove(d)}else{isDone=true}recursiveAction(state3);return disposableEmpty});if(!isDone){group.add(d);isAdded=true}})}recursiveAction(state);return group}function invokeRecDate(scheduler,pair,method){var state=pair[0],action=pair[1],group=new CompositeDisposable;function recursiveAction(state1){action(state1,function(state2,dueTime1){var isAdded=false,isDone=false,d=scheduler[method](state2,dueTime1,function(scheduler1,state3){if(isAdded){group.remove(d)}else{isDone=true}recursiveAction(state3);return disposableEmpty});if(!isDone){group.add(d);isAdded=true}})}recursiveAction(state);return group}function scheduleInnerRecursive(action,self){action(function(dt){self(action,dt)})}schedulerProto.scheduleRecursive=function(action){return this.scheduleRecursiveWithState(action,scheduleInnerRecursive)};schedulerProto.scheduleRecursiveWithState=function(state,action){return this.scheduleWithState([state,action],invokeRecImmediate)};schedulerProto.scheduleRecursiveWithRelative=function(dueTime,action){return this.scheduleRecursiveWithRelativeAndState(action,dueTime,scheduleInnerRecursive)};schedulerProto.scheduleRecursiveWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative([state,action],dueTime,function(s,p){return invokeRecDate(s,p,"scheduleWithRelativeAndState")})};schedulerProto.scheduleRecursiveWithAbsolute=function(dueTime,action){return this.scheduleRecursiveWithAbsoluteAndState(action,dueTime,scheduleInnerRecursive)};schedulerProto.scheduleRecursiveWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute([state,action],dueTime,function(s,p){return invokeRecDate(s,p,"scheduleWithAbsoluteAndState")})}})(Scheduler.prototype);(function(schedulerProto){Scheduler.prototype.schedulePeriodic=function(period,action){return this.schedulePeriodicWithState(null,period,action)};Scheduler.prototype.schedulePeriodicWithState=function(state,period,action){if(typeof root.setInterval==="undefined"){throw new NotSupportedError}period=normalizeTime(period);var s=state,id=root.setInterval(function(){s=action(s)},period);return disposableCreate(function(){root.clearInterval(id)})}})(Scheduler.prototype);(function(schedulerProto){schedulerProto.catchError=schedulerProto["catch"]=function(handler){return new CatchScheduler(this,handler)}})(Scheduler.prototype);var SchedulePeriodicRecursive=Rx.internals.SchedulePeriodicRecursive=function(){function tick(command,recurse){recurse(0,this._period);try{this._state=this._action(this._state)}catch(e){this._cancel.dispose();throw e}}function SchedulePeriodicRecursive(scheduler,state,period,action){this._scheduler=scheduler;this._state=state;this._period=period;this._action=action}SchedulePeriodicRecursive.prototype.start=function(){var d=new SingleAssignmentDisposable;this._cancel=d;d.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,tick.bind(this)));return d};return SchedulePeriodicRecursive}();var immediateScheduler=Scheduler.immediate=function(){function scheduleNow(state,action){return action(this,state)}return new Scheduler(defaultNow,scheduleNow,notSupported,notSupported)}();var currentThreadScheduler=Scheduler.currentThread=function(){var queue;function runTrampoline(){while(queue.length>0){var item=queue.dequeue();!item.isCancelled()&&item.invoke()}}function scheduleNow(state,action){var si=new ScheduledItem(this,state,action,this.now());if(!queue){queue=new PriorityQueue(4);queue.enqueue(si);var result=tryCatch(runTrampoline)();queue=null;if(result===errorObj){return thrower(result.e)}}else{queue.enqueue(si)}return si.disposable}var currentScheduler=new Scheduler(defaultNow,scheduleNow,notSupported,notSupported);currentScheduler.scheduleRequired=function(){return!queue};return currentScheduler}();var scheduleMethod,clearMethod;var localTimer=function(){var localSetTimeout,localClearTimeout=noop;if(!!root.setTimeout){localSetTimeout=root.setTimeout;localClearTimeout=root.clearTimeout}else if(!!root.WScript){localSetTimeout=function(fn,time){root.WScript.Sleep(time);fn()}}else{throw new NotSupportedError}return{setTimeout:localSetTimeout,clearTimeout:localClearTimeout}}();var localSetTimeout=localTimer.setTimeout,localClearTimeout=localTimer.clearTimeout;(function(){var nextHandle=1,tasksByHandle={},currentlyRunning=false;clearMethod=function(handle){delete tasksByHandle[handle]};function runTask(handle){if(currentlyRunning){localSetTimeout(function(){runTask(handle)},0)}else{var task=tasksByHandle[handle];if(task){currentlyRunning=true;var result=tryCatch(task)();clearMethod(handle);currentlyRunning=false;if(result===errorObj){return thrower(result.e)}}}}var reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var setImmediate=typeof(setImmediate=freeGlobal&&moduleExports&&freeGlobal.setImmediate)=="function"&&!reNative.test(setImmediate)&&setImmediate;function postMessageSupported(){if(!root.postMessage||root.importScripts){return false}var isAsync=false,oldHandler=root.onmessage;root.onmessage=function(){isAsync=true};root.postMessage("","*");root.onmessage=oldHandler;return isAsync}if(isFunction(setImmediate)){scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;setImmediate(function(){runTask(id)});return id}}else if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;process.nextTick(function(){runTask(id)});return id}}else if(postMessageSupported()){var MSG_PREFIX="ms.rx.schedule"+Math.random();function onGlobalPostMessage(event){if(typeof event.data==="string"&&event.data.substring(0,MSG_PREFIX.length)===MSG_PREFIX){runTask(event.data.substring(MSG_PREFIX.length))}}if(root.addEventListener){root.addEventListener("message",onGlobalPostMessage,false)}else if(root.attachEvent){root.attachEvent("onmessage",onGlobalPostMessage)}else{root.onmessage=onGlobalPostMessage}scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;root.postMessage(MSG_PREFIX+currentId,"*");return id}}else if(!!root.MessageChannel){var channel=new root.MessageChannel;channel.port1.onmessage=function(e){runTask(e.data)};scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;channel.port2.postMessage(id);return id}}else if("document"in root&&"onreadystatechange"in root.document.createElement("script")){scheduleMethod=function(action){var scriptElement=root.document.createElement("script");var id=nextHandle++;tasksByHandle[id]=action;scriptElement.onreadystatechange=function(){runTask(id);scriptElement.onreadystatechange=null;scriptElement.parentNode.removeChild(scriptElement);scriptElement=null};root.document.documentElement.appendChild(scriptElement);return id}}else{scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;localSetTimeout(function(){runTask(id)},0);return id}}})();var timeoutScheduler=Scheduler.timeout=Scheduler["default"]=function(){function scheduleNow(state,action){var scheduler=this,disposable=new SingleAssignmentDisposable;var id=scheduleMethod(function(){!disposable.isDisposed&&disposable.setDisposable(action(scheduler,state))});return new CompositeDisposable(disposable,disposableCreate(function(){clearMethod(id)}))}function scheduleRelative(state,dueTime,action){var scheduler=this,dt=Scheduler.normalize(dueTime),disposable=new SingleAssignmentDisposable;if(dt===0){return scheduler.scheduleWithState(state,action)}var id=localSetTimeout(function(){!disposable.isDisposed&&disposable.setDisposable(action(scheduler,state))},dt);return new CompositeDisposable(disposable,disposableCreate(function(){localClearTimeout(id)}))}function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action)}return new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute)}();var CatchScheduler=function(__super__){function scheduleNow(state,action){return this._scheduler.scheduleWithState(state,this._wrap(action))}function scheduleRelative(state,dueTime,action){return this._scheduler.scheduleWithRelativeAndState(state,dueTime,this._wrap(action))}function scheduleAbsolute(state,dueTime,action){return this._scheduler.scheduleWithAbsoluteAndState(state,dueTime,this._wrap(action))}inherits(CatchScheduler,__super__);function CatchScheduler(scheduler,handler){this._scheduler=scheduler;this._handler=handler;this._recursiveOriginal=null;this._recursiveWrapper=null;__super__.call(this,this._scheduler.now.bind(this._scheduler),scheduleNow,scheduleRelative,scheduleAbsolute)}CatchScheduler.prototype._clone=function(scheduler){return new CatchScheduler(scheduler,this._handler)};CatchScheduler.prototype._wrap=function(action){var parent=this;return function(self,state){try{return action(parent._getRecursiveWrapper(self),state)}catch(e){if(!parent._handler(e)){throw e}return disposableEmpty}}};CatchScheduler.prototype._getRecursiveWrapper=function(scheduler){if(this._recursiveOriginal!==scheduler){this._recursiveOriginal=scheduler;var wrapper=this._clone(scheduler);wrapper._recursiveOriginal=scheduler;wrapper._recursiveWrapper=wrapper;this._recursiveWrapper=wrapper}return this._recursiveWrapper};CatchScheduler.prototype.schedulePeriodicWithState=function(state,period,action){var self=this,failed=false,d=new SingleAssignmentDisposable;d.setDisposable(this._scheduler.schedulePeriodicWithState(state,period,function(state1){if(failed){return null}try{return action(state1)}catch(e){failed=true;if(!self._handler(e)){throw e}d.dispose();return null}}));return d};return CatchScheduler}(Scheduler);var Notification=Rx.Notification=function(){function Notification(kind,value,exception,accept,acceptObservable,toString){this.kind=kind;this.value=value;this.exception=exception;this._accept=accept;this._acceptObservable=acceptObservable;this.toString=toString}Notification.prototype.accept=function(observerOrOnNext,onError,onCompleted){return observerOrOnNext&&typeof observerOrOnNext==="object"?this._acceptObservable(observerOrOnNext):this._accept(observerOrOnNext,onError,onCompleted)};Notification.prototype.toObservable=function(scheduler){var self=this;isScheduler(scheduler)||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.scheduleWithState(self,function(_,notification){notification._acceptObservable(observer);notification.kind==="N"&&observer.onCompleted()})})};return Notification}();var notificationCreateOnNext=Notification.createOnNext=function(){function _accept(onNext){return onNext(this.value)}function _acceptObservable(observer){return observer.onNext(this.value)}function toString(){return"OnNext("+this.value+")"}return function(value){return new Notification("N",value,null,_accept,_acceptObservable,toString)}}();var notificationCreateOnError=Notification.createOnError=function(){function _accept(onNext,onError){return onError(this.exception)}function _acceptObservable(observer){return observer.onError(this.exception)}function toString(){return"OnError("+this.exception+")"}return function(e){return new Notification("E",null,e,_accept,_acceptObservable,toString)}}();var notificationCreateOnCompleted=Notification.createOnCompleted=function(){function _accept(onNext,onError,onCompleted){return onCompleted()}function _acceptObservable(observer){return observer.onCompleted()}function toString(){return"OnCompleted()"}return function(){return new Notification("C",null,null,_accept,_acceptObservable,toString)}}();var Observer=Rx.Observer=function(){};Observer.prototype.toNotifier=function(){var observer=this;return function(n){return n.accept(observer)}};Observer.prototype.asObserver=function(){return new AnonymousObserver(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))};Observer.prototype.checked=function(){return new CheckedObserver(this)};var observerCreate=Observer.create=function(onNext,onError,onCompleted){onNext||(onNext=noop);onError||(onError=defaultError);onCompleted||(onCompleted=noop);return new AnonymousObserver(onNext,onError,onCompleted)};Observer.fromNotifier=function(handler,thisArg){return new AnonymousObserver(function(x){return handler.call(thisArg,notificationCreateOnNext(x))},function(e){return handler.call(thisArg,notificationCreateOnError(e))},function(){return handler.call(thisArg,notificationCreateOnCompleted())})};Observer.prototype.notifyOn=function(scheduler){return new ObserveOnObserver(scheduler,this)};Observer.prototype.makeSafe=function(disposable){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,disposable)};var AbstractObserver=Rx.internals.AbstractObserver=function(__super__){inherits(AbstractObserver,__super__);function AbstractObserver(){this.isStopped=false;__super__.call(this)}AbstractObserver.prototype.next=notImplemented;AbstractObserver.prototype.error=notImplemented;AbstractObserver.prototype.completed=notImplemented;AbstractObserver.prototype.onNext=function(value){if(!this.isStopped){this.next(value)}};AbstractObserver.prototype.onError=function(error){if(!this.isStopped){this.isStopped=true;this.error(error)}};AbstractObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.completed()}};AbstractObserver.prototype.dispose=function(){this.isStopped=true};AbstractObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.error(e);return true}return false};return AbstractObserver}(Observer);var AnonymousObserver=Rx.AnonymousObserver=function(__super__){inherits(AnonymousObserver,__super__);function AnonymousObserver(onNext,onError,onCompleted){__super__.call(this);this._onNext=onNext;this._onError=onError;this._onCompleted=onCompleted}AnonymousObserver.prototype.next=function(value){this._onNext(value)};AnonymousObserver.prototype.error=function(error){this._onError(error)};AnonymousObserver.prototype.completed=function(){this._onCompleted()};return AnonymousObserver}(AbstractObserver);var CheckedObserver=function(__super__){inherits(CheckedObserver,__super__);function CheckedObserver(observer){__super__.call(this);this._observer=observer;this._state=0}var CheckedObserverPrototype=CheckedObserver.prototype;CheckedObserverPrototype.onNext=function(value){this.checkAccess();var res=tryCatch(this._observer.onNext).call(this._observer,value);this._state=0;res===errorObj&&thrower(res.e)};CheckedObserverPrototype.onError=function(err){this.checkAccess();var res=tryCatch(this._observer.onError).call(this._observer,err);this._state=2;res===errorObj&&thrower(res.e)};CheckedObserverPrototype.onCompleted=function(){this.checkAccess();var res=tryCatch(this._observer.onCompleted).call(this._observer);this._state=2;res===errorObj&&thrower(res.e)};CheckedObserverPrototype.checkAccess=function(){if(this._state===1){throw new Error("Re-entrancy detected")}if(this._state===2){throw new Error("Observer completed")}if(this._state===0){this._state=1}};return CheckedObserver}(Observer);var ScheduledObserver=Rx.internals.ScheduledObserver=function(__super__){inherits(ScheduledObserver,__super__);function ScheduledObserver(scheduler,observer){__super__.call(this);this.scheduler=scheduler;this.observer=observer;this.isAcquired=false;this.hasFaulted=false;this.queue=[];this.disposable=new SerialDisposable}ScheduledObserver.prototype.next=function(value){var self=this;this.queue.push(function(){self.observer.onNext(value)})};ScheduledObserver.prototype.error=function(e){var self=this;this.queue.push(function(){self.observer.onError(e)})};ScheduledObserver.prototype.completed=function(){var self=this;this.queue.push(function(){self.observer.onCompleted()})};ScheduledObserver.prototype.ensureActive=function(){var isOwner=false,parent=this;if(!this.hasFaulted&&this.queue.length>0){isOwner=!this.isAcquired;this.isAcquired=true}if(isOwner){this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(self){var work;if(parent.queue.length>0){work=parent.queue.shift()}else{parent.isAcquired=false;return}try{work()}catch(ex){parent.queue=[];parent.hasFaulted=true;throw ex}self()}))}};ScheduledObserver.prototype.dispose=function(){__super__.prototype.dispose.call(this);this.disposable.dispose()};return ScheduledObserver}(AbstractObserver);var ObserveOnObserver=function(__super__){inherits(ObserveOnObserver,__super__);function ObserveOnObserver(scheduler,observer,cancel){__super__.call(this,scheduler,observer);this._cancel=cancel}ObserveOnObserver.prototype.next=function(value){__super__.prototype.next.call(this,value);this.ensureActive()};ObserveOnObserver.prototype.error=function(e){__super__.prototype.error.call(this,e);this.ensureActive()};ObserveOnObserver.prototype.completed=function(){__super__.prototype.completed.call(this);this.ensureActive()};ObserveOnObserver.prototype.dispose=function(){__super__.prototype.dispose.call(this);this._cancel&&this._cancel.dispose();this._cancel=null};return ObserveOnObserver}(ScheduledObserver);var observableProto;var Observable=Rx.Observable=function(){function Observable(subscribe){if(Rx.config.longStackSupport&&hasStacks){
try{throw new Error}catch(e){this.stack=e.stack.substring(e.stack.indexOf("\n")+1)}var self=this;this._subscribe=function(observer){var oldOnError=observer.onError.bind(observer);observer.onError=function(err){makeStackTraceLong(err,self);oldOnError(err)};return subscribe.call(self,observer)}}else{this._subscribe=subscribe}}observableProto=Observable.prototype;observableProto.subscribe=observableProto.forEach=function(observerOrOnNext,onError,onCompleted){return this._subscribe(typeof observerOrOnNext==="object"?observerOrOnNext:observerCreate(observerOrOnNext,onError,onCompleted))};observableProto.subscribeOnNext=function(onNext,thisArg){return this._subscribe(observerCreate(typeof thisArg!=="undefined"?function(x){onNext.call(thisArg,x)}:onNext))};observableProto.subscribeOnError=function(onError,thisArg){return this._subscribe(observerCreate(null,typeof thisArg!=="undefined"?function(e){onError.call(thisArg,e)}:onError))};observableProto.subscribeOnCompleted=function(onCompleted,thisArg){return this._subscribe(observerCreate(null,null,typeof thisArg!=="undefined"?function(){onCompleted.call(thisArg)}:onCompleted))};return Observable}();var ObservableBase=Rx.ObservableBase=function(__super__){inherits(ObservableBase,__super__);function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],self=state[1];var sub=tryCatch(self.subscribeCore).call(self,ado);if(sub===errorObj){if(!ado.fail(errorObj.e)){return thrower(errorObj.e)}}ado.setDisposable(fixSubscriber(sub))}function subscribe(observer){var ado=new AutoDetachObserver(observer),state=[ado,this];if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.scheduleWithState(state,setDisposable)}else{setDisposable(null,state)}return ado}function ObservableBase(){__super__.call(this,subscribe)}ObservableBase.prototype.subscribeCore=notImplemented;return ObservableBase}(Observable);var Enumerable=Rx.internals.Enumerable=function(){};var ConcatEnumerableObservable=function(__super__){inherits(ConcatEnumerableObservable,__super__);function ConcatEnumerableObservable(sources){this.sources=sources;__super__.call(this)}ConcatEnumerableObservable.prototype.subscribeCore=function(o){var isDisposed,subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursiveWithState(this.sources[$iterator$](),function(e,self){if(isDisposed){return}var currentItem=tryCatch(e.next).call(e);if(currentItem===errorObj){return o.onError(currentItem.e)}if(currentItem.done){return o.onCompleted()}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(new InnerObserver(o,self,e)))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true}))};function InnerObserver(o,s,e){this.o=o;this.s=s;this.e=e;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.o.onNext(x)}};InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.s(this.e)}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err);return true}return false};return ConcatEnumerableObservable}(ObservableBase);Enumerable.prototype.concat=function(){return new ConcatEnumerableObservable(this)};var CatchErrorObservable=function(__super__){inherits(CatchErrorObservable,__super__);function CatchErrorObservable(sources){this.sources=sources;__super__.call(this)}CatchErrorObservable.prototype.subscribeCore=function(o){var e=this.sources[$iterator$]();var isDisposed,subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursiveWithState(null,function(lastException,self){if(isDisposed){return}var currentItem=tryCatch(e.next).call(e);if(currentItem===errorObj){return o.onError(currentItem.e)}if(currentItem.done){return lastException!==null?o.onError(lastException):o.onCompleted()}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},self,function(){o.onCompleted()}))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true}))};return CatchErrorObservable}(ObservableBase);Enumerable.prototype.catchError=function(){return new CatchErrorObservable(this)};Enumerable.prototype.catchErrorWhen=function(notificationHandler){var sources=this;return new AnonymousObservable(function(o){var exceptions=new Subject,notifier=new Subject,handled=notificationHandler(exceptions),notificationDisposable=handled.subscribe(notifier);var e=sources[$iterator$]();var isDisposed,lastException,subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursive(function(self){if(isDisposed){return}var currentItem=tryCatch(e.next).call(e);if(currentItem===errorObj){return o.onError(currentItem.e)}if(currentItem.done){if(lastException){o.onError(lastException)}else{o.onCompleted()}return}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var outer=new SingleAssignmentDisposable;var inner=new SingleAssignmentDisposable;subscription.setDisposable(new CompositeDisposable(inner,outer));outer.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(exn){inner.setDisposable(notifier.subscribe(self,function(ex){o.onError(ex)},function(){o.onCompleted()}));exceptions.onNext(exn)},function(){o.onCompleted()}))});return new CompositeDisposable(notificationDisposable,subscription,cancelable,disposableCreate(function(){isDisposed=true}))})};var RepeatEnumerable=function(__super__){inherits(RepeatEnumerable,__super__);function RepeatEnumerable(v,c){this.v=v;this.c=c==null?-1:c}RepeatEnumerable.prototype[$iterator$]=function(){return new RepeatEnumerator(this)};function RepeatEnumerator(p){this.v=p.v;this.l=p.c}RepeatEnumerator.prototype.next=function(){if(this.l===0){return doneEnumerator}if(this.l>0){this.l--}return{done:false,value:this.v}};return RepeatEnumerable}(Enumerable);var enumerableRepeat=Enumerable.repeat=function(value,repeatCount){return new RepeatEnumerable(value,repeatCount)};var OfEnumerable=function(__super__){inherits(OfEnumerable,__super__);function OfEnumerable(s,fn,thisArg){this.s=s;this.fn=fn?bindCallback(fn,thisArg,3):null}OfEnumerable.prototype[$iterator$]=function(){return new OfEnumerator(this)};function OfEnumerator(p){this.i=-1;this.s=p.s;this.l=this.s.length;this.fn=p.fn}OfEnumerator.prototype.next=function(){return++this.i<this.l?{done:false,value:!this.fn?this.s[this.i]:this.fn(this.s[this.i],this.i,this.s)}:doneEnumerator};return OfEnumerable}(Enumerable);var enumerableOf=Enumerable.of=function(source,selector,thisArg){return new OfEnumerable(source,selector,thisArg)};observableProto.observeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(new ObserveOnObserver(scheduler,observer))},source)};observableProto.subscribeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable,d=new SerialDisposable;d.setDisposable(m);m.setDisposable(scheduler.schedule(function(){d.setDisposable(new ScheduledDisposable(scheduler,source.subscribe(observer)))}));return d},source)};var FromPromiseObservable=function(__super__){inherits(FromPromiseObservable,__super__);function FromPromiseObservable(p){this.p=p;__super__.call(this)}FromPromiseObservable.prototype.subscribeCore=function(o){this.p.then(function(data){o.onNext(data);o.onCompleted()},function(err){o.onError(err)});return disposableEmpty};return FromPromiseObservable}(ObservableBase);var observableFromPromise=Observable.fromPromise=function(promise){return new FromPromiseObservable(promise)};observableProto.toPromise=function(promiseCtor){promiseCtor||(promiseCtor=Rx.config.Promise);if(!promiseCtor){throw new NotSupportedError("Promise type not provided nor in Rx.config.Promise")}var source=this;return new promiseCtor(function(resolve,reject){var value,hasValue=false;source.subscribe(function(v){value=v;hasValue=true},reject,function(){hasValue&&resolve(value)})})};var ToArrayObservable=function(__super__){inherits(ToArrayObservable,__super__);function ToArrayObservable(source){this.source=source;__super__.call(this)}ToArrayObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o))};function InnerObserver(o){this.o=o;this.a=[];this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.a.push(x)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onNext(this.a);this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return ToArrayObservable}(ObservableBase);observableProto.toArray=function(){return new ToArrayObservable(this)};Observable.create=Observable.createWithDisposable=function(subscribe,parent){return new AnonymousObservable(subscribe,parent)};var observableDefer=Observable.defer=function(observableFactory){return new AnonymousObservable(function(observer){var result;try{result=observableFactory()}catch(e){return observableThrow(e).subscribe(observer)}isPromise(result)&&(result=observableFromPromise(result));return result.subscribe(observer)})};var EmptyObservable=function(__super__){inherits(EmptyObservable,__super__);function EmptyObservable(scheduler){this.scheduler=scheduler;__super__.call(this)}EmptyObservable.prototype.subscribeCore=function(observer){var sink=new EmptySink(observer,this);return sink.run()};function EmptySink(observer,parent){this.observer=observer;this.parent=parent}function scheduleItem(s,state){state.onCompleted()}EmptySink.prototype.run=function(){return this.parent.scheduler.scheduleWithState(this.observer,scheduleItem)};return EmptyObservable}(ObservableBase);var observableEmpty=Observable.empty=function(scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new EmptyObservable(scheduler)};var FromObservable=function(__super__){inherits(FromObservable,__super__);function FromObservable(iterable,mapper,scheduler){this.iterable=iterable;this.mapper=mapper;this.scheduler=scheduler;__super__.call(this)}FromObservable.prototype.subscribeCore=function(observer){var sink=new FromSink(observer,this);return sink.run()};return FromObservable}(ObservableBase);var FromSink=function(){function FromSink(observer,parent){this.observer=observer;this.parent=parent}FromSink.prototype.run=function(){var list=Object(this.parent.iterable),it=getIterable(list),observer=this.observer,mapper=this.parent.mapper;function loopRecursive(i,recurse){try{var next=it.next()}catch(e){return observer.onError(e)}if(next.done){return observer.onCompleted()}var result=next.value;if(mapper){try{result=mapper(result,i)}catch(e){return observer.onError(e)}}observer.onNext(result);recurse(i+1)}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};return FromSink}();var maxSafeInteger=Math.pow(2,53)-1;function StringIterable(str){this._s=s}StringIterable.prototype[$iterator$]=function(){return new StringIterator(this._s)};function StringIterator(str){this._s=s;this._l=s.length;this._i=0}StringIterator.prototype[$iterator$]=function(){return this};StringIterator.prototype.next=function(){return this._i<this._l?{done:false,value:this._s.charAt(this._i++)}:doneEnumerator};function ArrayIterable(a){this._a=a}ArrayIterable.prototype[$iterator$]=function(){return new ArrayIterator(this._a)};function ArrayIterator(a){this._a=a;this._l=toLength(a);this._i=0}ArrayIterator.prototype[$iterator$]=function(){return this};ArrayIterator.prototype.next=function(){return this._i<this._l?{done:false,value:this._a[this._i++]}:doneEnumerator};function numberIsFinite(value){return typeof value==="number"&&root.isFinite(value)}function isNan(n){return n!==n}function getIterable(o){var i=o[$iterator$],it;if(!i&&typeof o==="string"){it=new StringIterable(o);return it[$iterator$]()}if(!i&&o.length!==undefined){it=new ArrayIterable(o);return it[$iterator$]()}if(!i){throw new TypeError("Object is not iterable")}return o[$iterator$]()}function sign(value){var number=+value;if(number===0){return number}if(isNaN(number)){return number}return number<0?-1:1}function toLength(o){var len=+o.length;if(isNaN(len)){return 0}if(len===0||!numberIsFinite(len)){return len}len=sign(len)*Math.floor(Math.abs(len));if(len<=0){return 0}if(len>maxSafeInteger){return maxSafeInteger}return len}var observableFrom=Observable.from=function(iterable,mapFn,thisArg,scheduler){if(iterable==null){throw new Error("iterable cannot be null.")}if(mapFn&&!isFunction(mapFn)){throw new Error("mapFn when provided must be a function")}if(mapFn){var mapper=bindCallback(mapFn,thisArg,2)}isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromObservable(iterable,mapper,scheduler)};var FromArrayObservable=function(__super__){inherits(FromArrayObservable,__super__);function FromArrayObservable(args,scheduler){this.args=args;this.scheduler=scheduler;__super__.call(this)}FromArrayObservable.prototype.subscribeCore=function(observer){var sink=new FromArraySink(observer,this);return sink.run()};return FromArrayObservable}(ObservableBase);function FromArraySink(observer,parent){this.observer=observer;this.parent=parent}FromArraySink.prototype.run=function(){var observer=this.observer,args=this.parent.args,len=args.length;function loopRecursive(i,recurse){if(i<len){observer.onNext(args[i]);recurse(i+1)}else{observer.onCompleted()}}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};var observableFromArray=Observable.fromArray=function(array,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromArrayObservable(array,scheduler)};Observable.generate=function(initialState,condition,iterate,resultSelector,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(o){var first=true;return scheduler.scheduleRecursiveWithState(initialState,function(state,self){var hasResult,result;try{if(first){first=false}else{state=iterate(state)}hasResult=condition(state);hasResult&&(result=resultSelector(state))}catch(e){return o.onError(e)}if(hasResult){o.onNext(result);self(state)}else{o.onCompleted()}})})};var NeverObservable=function(__super__){inherits(NeverObservable,__super__);function NeverObservable(){__super__.call(this)}NeverObservable.prototype.subscribeCore=function(observer){return disposableEmpty};return NeverObservable}(ObservableBase);var observableNever=Observable.never=function(){return new NeverObservable};function observableOf(scheduler,array){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromArrayObservable(array,scheduler)}Observable.of=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return new FromArrayObservable(args,currentThreadScheduler)};Observable.ofWithScheduler=function(scheduler){var len=arguments.length,args=new Array(len-1);for(var i=1;i<len;i++){args[i-1]=arguments[i]}return new FromArrayObservable(args,scheduler)};var PairsObservable=function(__super__){inherits(PairsObservable,__super__);function PairsObservable(obj,scheduler){this.obj=obj;this.keys=Object.keys(obj);this.scheduler=scheduler;__super__.call(this)}PairsObservable.prototype.subscribeCore=function(observer){var sink=new PairsSink(observer,this);return sink.run()};return PairsObservable}(ObservableBase);function PairsSink(observer,parent){this.observer=observer;this.parent=parent}PairsSink.prototype.run=function(){var observer=this.observer,obj=this.parent.obj,keys=this.parent.keys,len=keys.length;function loopRecursive(i,recurse){if(i<len){var key=keys[i];observer.onNext([key,obj[key]]);recurse(i+1)}else{observer.onCompleted()}}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};Observable.pairs=function(obj,scheduler){scheduler||(scheduler=currentThreadScheduler);return new PairsObservable(obj,scheduler)};var RangeObservable=function(__super__){inherits(RangeObservable,__super__);function RangeObservable(start,count,scheduler){this.start=start;this.rangeCount=count;this.scheduler=scheduler;__super__.call(this)}RangeObservable.prototype.subscribeCore=function(observer){var sink=new RangeSink(observer,this);return sink.run()};return RangeObservable}(ObservableBase);var RangeSink=function(){function RangeSink(observer,parent){this.observer=observer;this.parent=parent}RangeSink.prototype.run=function(){var start=this.parent.start,count=this.parent.rangeCount,observer=this.observer;function loopRecursive(i,recurse){if(i<count){observer.onNext(start+i);recurse(i+1)}else{observer.onCompleted()}}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};return RangeSink}();Observable.range=function(start,count,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new RangeObservable(start,count,scheduler)};var RepeatObservable=function(__super__){inherits(RepeatObservable,__super__);function RepeatObservable(value,repeatCount,scheduler){this.value=value;this.repeatCount=repeatCount==null?-1:repeatCount;this.scheduler=scheduler;__super__.call(this)}RepeatObservable.prototype.subscribeCore=function(observer){var sink=new RepeatSink(observer,this);return sink.run()};return RepeatObservable}(ObservableBase);function RepeatSink(observer,parent){this.observer=observer;this.parent=parent}RepeatSink.prototype.run=function(){var observer=this.observer,value=this.parent.value;function loopRecursive(i,recurse){if(i===-1||i>0){observer.onNext(value);i>0&&i--}if(i===0){return observer.onCompleted()}recurse(i)}return this.parent.scheduler.scheduleRecursiveWithState(this.parent.repeatCount,loopRecursive)};Observable.repeat=function(value,repeatCount,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new RepeatObservable(value,repeatCount,scheduler)};var JustObservable=function(__super__){inherits(JustObservable,__super__);function JustObservable(value,scheduler){this.value=value;this.scheduler=scheduler;__super__.call(this)}JustObservable.prototype.subscribeCore=function(observer){var sink=new JustSink(observer,this);return sink.run()};function JustSink(observer,parent){this.observer=observer;this.parent=parent}function scheduleItem(s,state){var value=state[0],observer=state[1];observer.onNext(value);observer.onCompleted()}JustSink.prototype.run=function(){return this.parent.scheduler.scheduleWithState([this.parent.value,this.observer],scheduleItem)};return JustObservable}(ObservableBase);var observableReturn=Observable["return"]=Observable.just=Observable.returnValue=function(value,scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new JustObservable(value,scheduler)};var ThrowObservable=function(__super__){inherits(ThrowObservable,__super__);function ThrowObservable(error,scheduler){this.error=error;this.scheduler=scheduler;__super__.call(this)}ThrowObservable.prototype.subscribeCore=function(o){var sink=new ThrowSink(o,this);return sink.run()};function ThrowSink(o,p){this.o=o;this.p=p}function scheduleItem(s,state){var e=state[0],o=state[1];o.onError(e)}ThrowSink.prototype.run=function(){return this.p.scheduler.scheduleWithState([this.p.error,this.o],scheduleItem)};return ThrowObservable}(ObservableBase);var observableThrow=Observable["throw"]=Observable.throwError=Observable.throwException=function(error,scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new ThrowObservable(error,scheduler)};Observable.using=function(resourceFactory,observableFactory){return new AnonymousObservable(function(observer){var disposable=disposableEmpty,resource,source;try{resource=resourceFactory();resource&&(disposable=resource);source=observableFactory(resource)}catch(exception){return new CompositeDisposable(observableThrow(exception).subscribe(observer),disposable)}return new CompositeDisposable(source.subscribe(observer),disposable)})};observableProto.amb=function(rightSource){var leftSource=this;return new AnonymousObservable(function(observer){var choice,leftChoice="L",rightChoice="R",leftSubscription=new SingleAssignmentDisposable,rightSubscription=new SingleAssignmentDisposable;isPromise(rightSource)&&(rightSource=observableFromPromise(rightSource));function choiceL(){if(!choice){choice=leftChoice;rightSubscription.dispose()}}function choiceR(){if(!choice){choice=rightChoice;leftSubscription.dispose()}}leftSubscription.setDisposable(leftSource.subscribe(function(left){choiceL();choice===leftChoice&&observer.onNext(left)},function(err){choiceL();choice===leftChoice&&observer.onError(err)},function(){choiceL();choice===leftChoice&&observer.onCompleted()}));rightSubscription.setDisposable(rightSource.subscribe(function(right){choiceR();choice===rightChoice&&observer.onNext(right)},function(err){choiceR();choice===rightChoice&&observer.onError(err)},function(){choiceR();choice===rightChoice&&observer.onCompleted()}));return new CompositeDisposable(leftSubscription,rightSubscription)})};Observable.amb=function(){var acc=observableNever(),items=[];if(Array.isArray(arguments[0])){items=arguments[0]}else{for(var i=0,len=arguments.length;i<len;i++){items.push(arguments[i])}}function func(previous,current){return previous.amb(current)}for(var i=0,len=items.length;i<len;i++){acc=func(acc,items[i])}return acc};function observableCatchHandler(source,handler){return new AnonymousObservable(function(o){var d1=new SingleAssignmentDisposable,subscription=new SerialDisposable;subscription.setDisposable(d1);d1.setDisposable(source.subscribe(function(x){o.onNext(x)},function(e){try{var result=handler(e)}catch(ex){return o.onError(ex)}isPromise(result)&&(result=observableFromPromise(result));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(result.subscribe(o))},function(x){o.onCompleted(x)}));return subscription},source)}observableProto["catch"]=observableProto.catchError=observableProto.catchException=function(handlerOrSecond){return typeof handlerOrSecond==="function"?observableCatchHandler(this,handlerOrSecond):observableCatch([this,handlerOrSecond])};var observableCatch=Observable.catchError=Observable["catch"]=Observable.catchException=function(){var items=[];if(Array.isArray(arguments[0])){items=arguments[0]}else{for(var i=0,len=arguments.length;i<len;i++){items.push(arguments[i])}}return enumerableOf(items).catchError()};observableProto.combineLatest=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}if(Array.isArray(args[0])){args[0].unshift(this)}else{args.unshift(this)}return combineLatest.apply(this,args)};var combineLatest=Observable.combineLatest=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=args.pop();Array.isArray(args[0])&&(args=args[0]);return new AnonymousObservable(function(o){var n=args.length,falseFactory=function(){return false},hasValue=arrayInitialize(n,falseFactory),hasValueAll=false,isDone=arrayInitialize(n,falseFactory),values=new Array(n);function next(i){hasValue[i]=true;if(hasValueAll||(hasValueAll=hasValue.every(identity))){try{var res=resultSelector.apply(null,values)}catch(e){return o.onError(e)}o.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(identity)){o.onCompleted()}}function done(i){isDone[i]=true;isDone.every(identity)&&o.onCompleted()}var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){var source=args[i],sad=new SingleAssignmentDisposable;isPromise(source)&&(source=observableFromPromise(source));sad.setDisposable(source.subscribe(function(x){values[i]=x;next(i)},function(e){o.onError(e)},function(){done(i)}));subscriptions[i]=sad})(idx)}return new CompositeDisposable(subscriptions)},this)};observableProto.concat=function(){for(var args=[],i=0,len=arguments.length;i<len;i++){args.push(arguments[i])}args.unshift(this);return observableConcat.apply(null,args)};var ConcatObservable=function(__super__){inherits(ConcatObservable,__super__);function ConcatObservable(sources){this.sources=sources;__super__.call(this)}ConcatObservable.prototype.subscribeCore=function(o){var sink=new ConcatSink(this.sources,o);return sink.run()};function ConcatSink(sources,o){this.sources=sources;this.o=o}ConcatSink.prototype.run=function(){var isDisposed,subscription=new SerialDisposable,sources=this.sources,length=sources.length,o=this.o;var cancelable=immediateScheduler.scheduleRecursiveWithState(0,function(i,self){if(isDisposed){return}if(i===length){return o.onCompleted()}var currentValue=sources[i];isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(e){o.onError(e)},function(){self(i+1)}))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true}))};return ConcatObservable}(ObservableBase);var observableConcat=Observable.concat=function(){var args;if(Array.isArray(arguments[0])){args=arguments[0]}else{args=new Array(arguments.length);for(var i=0,len=arguments.length;i<len;i++){args[i]=arguments[i]}}return new ConcatObservable(args)};observableProto.concatAll=observableProto.concatObservable=function(){return this.merge(1)};var MergeObservable=function(__super__){inherits(MergeObservable,__super__);function MergeObservable(source,maxConcurrent){this.source=source;this.maxConcurrent=maxConcurrent;__super__.call(this)}MergeObservable.prototype.subscribeCore=function(observer){var g=new CompositeDisposable;g.add(this.source.subscribe(new MergeObserver(observer,this.maxConcurrent,g)));return g};return MergeObservable}(ObservableBase);var MergeObserver=function(){function MergeObserver(o,max,g){this.o=o;this.max=max;this.g=g;this.done=false;this.q=[];this.activeCount=0;this.isStopped=false}MergeObserver.prototype.handleSubscribe=function(xs){var sad=new SingleAssignmentDisposable;this.g.add(sad);isPromise(xs)&&(xs=observableFromPromise(xs));sad.setDisposable(xs.subscribe(new InnerObserver(this,sad)))};MergeObserver.prototype.onNext=function(innerSource){if(this.isStopped){return}if(this.activeCount<this.max){this.activeCount++;this.handleSubscribe(innerSource)}else{this.q.push(innerSource)}};MergeObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};MergeObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.done=true;this.activeCount===0&&this.o.onCompleted()}};MergeObserver.prototype.dispose=function(){this.isStopped=true};MergeObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};function InnerObserver(parent,sad){this.parent=parent;this.sad=sad;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.parent.o.onNext(x)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;var parent=this.parent;parent.g.remove(this.sad);if(parent.q.length>0){parent.handleSubscribe(parent.q.shift())}else{parent.activeCount--;parent.done&&parent.activeCount===0&&parent.o.onCompleted()}}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e);return true}return false};return MergeObserver}();observableProto.merge=function(maxConcurrentOrOther){return typeof maxConcurrentOrOther!=="number"?observableMerge(this,maxConcurrentOrOther):new MergeObservable(this,maxConcurrentOrOther)};var observableMerge=Observable.merge=function(){var scheduler,sources=[],i,len=arguments.length;if(!arguments[0]){scheduler=immediateScheduler;for(i=1;i<len;i++){sources.push(arguments[i])}}else if(isScheduler(arguments[0])){scheduler=arguments[0];for(i=1;i<len;i++){sources.push(arguments[i])}}else{scheduler=immediateScheduler;for(i=0;i<len;i++){sources.push(arguments[i])}}if(Array.isArray(sources[0])){sources=sources[0]}return observableOf(scheduler,sources).mergeAll()};var CompositeError=Rx.CompositeError=function(errors){this.name="NotImplementedError";this.innerErrors=errors;this.message="This contains multiple errors. Check the innerErrors";Error.call(this)};CompositeError.prototype=Error.prototype;Observable.mergeDelayError=function(){var args;if(Array.isArray(arguments[0])){args=arguments[0]}else{var len=arguments.length;args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}}var source=observableOf(null,args);return new AnonymousObservable(function(o){var group=new CompositeDisposable,m=new SingleAssignmentDisposable,isStopped=false,errors=[];function setCompletion(){if(errors.length===0){o.onCompleted()}else if(errors.length===1){o.onError(errors[0])}else{o.onError(new CompositeError(errors))}}group.add(m);m.setDisposable(source.subscribe(function(innerSource){var innerSubscription=new SingleAssignmentDisposable;group.add(innerSubscription);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));innerSubscription.setDisposable(innerSource.subscribe(function(x){o.onNext(x)},function(e){errors.push(e);group.remove(innerSubscription);isStopped&&group.length===1&&setCompletion()},function(){group.remove(innerSubscription);isStopped&&group.length===1&&setCompletion()}))},function(e){errors.push(e);isStopped=true;group.length===1&&setCompletion()},function(){isStopped=true;group.length===1&&setCompletion()}));return group})};var MergeAllObservable=function(__super__){inherits(MergeAllObservable,__super__);function MergeAllObservable(source){this.source=source;__super__.call(this)}MergeAllObservable.prototype.subscribeCore=function(observer){var g=new CompositeDisposable,m=new SingleAssignmentDisposable;g.add(m);m.setDisposable(this.source.subscribe(new MergeAllObserver(observer,g)));return g};function MergeAllObserver(o,g){this.o=o;this.g=g;this.isStopped=false;this.done=false}MergeAllObserver.prototype.onNext=function(innerSource){if(this.isStopped){return}var sad=new SingleAssignmentDisposable;this.g.add(sad);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));sad.setDisposable(innerSource.subscribe(new InnerObserver(this,this.g,sad)))};MergeAllObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};MergeAllObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.done=true;this.g.length===1&&this.o.onCompleted()}};MergeAllObserver.prototype.dispose=function(){this.isStopped=true};MergeAllObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};function InnerObserver(parent,g,sad){this.parent=parent;this.g=g;this.sad=sad;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.parent.o.onNext(x)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){var parent=this.parent;
this.isStopped=true;parent.g.remove(this.sad);parent.done&&parent.g.length===1&&parent.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e);return true}return false};return MergeAllObservable}(ObservableBase);observableProto.mergeAll=observableProto.mergeObservable=function(){return new MergeAllObservable(this)};observableProto.onErrorResumeNext=function(second){if(!second){throw new Error("Second observable is required")}return onErrorResumeNext([this,second])};var onErrorResumeNext=Observable.onErrorResumeNext=function(){var sources=[];if(Array.isArray(arguments[0])){sources=arguments[0]}else{for(var i=0,len=arguments.length;i<len;i++){sources.push(arguments[i])}}return new AnonymousObservable(function(observer){var pos=0,subscription=new SerialDisposable,cancelable=immediateScheduler.scheduleRecursive(function(self){var current,d;if(pos<sources.length){current=sources[pos++];isPromise(current)&&(current=observableFromPromise(current));d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),self,self))}else{observer.onCompleted()}});return new CompositeDisposable(subscription,cancelable)})};observableProto.skipUntil=function(other){var source=this;return new AnonymousObservable(function(o){var isOpen=false;var disposables=new CompositeDisposable(source.subscribe(function(left){isOpen&&o.onNext(left)},function(e){o.onError(e)},function(){isOpen&&o.onCompleted()}));isPromise(other)&&(other=observableFromPromise(other));var rightSubscription=new SingleAssignmentDisposable;disposables.add(rightSubscription);rightSubscription.setDisposable(other.subscribe(function(){isOpen=true;rightSubscription.dispose()},function(e){o.onError(e)},function(){rightSubscription.dispose()}));return disposables},source)};var SwitchObservable=function(__super__){inherits(SwitchObservable,__super__);function SwitchObservable(source){this.source=source;__super__.call(this)}SwitchObservable.prototype.subscribeCore=function(o){var inner=new SerialDisposable,s=this.source.subscribe(new SwitchObserver(o,inner));return new CompositeDisposable(s,inner)};function SwitchObserver(o,inner){this.o=o;this.inner=inner;this.stopped=false;this.latest=0;this.hasLatest=false;this.isStopped=false}SwitchObserver.prototype.onNext=function(innerSource){if(this.isStopped){return}var d=new SingleAssignmentDisposable,id=++this.latest;this.hasLatest=true;this.inner.setDisposable(d);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));d.setDisposable(innerSource.subscribe(new InnerObserver(this,id)))};SwitchObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};SwitchObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.stopped=true;!this.hasLatest&&this.o.onCompleted()}};SwitchObserver.prototype.dispose=function(){this.isStopped=true};SwitchObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};function InnerObserver(parent,id){this.parent=parent;this.id=id;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}this.parent.latest===this.id&&this.parent.o.onNext(x)};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.parent.latest===this.id&&this.parent.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;if(this.parent.latest===this.id){this.parent.hasLatest=false;this.parent.isStopped&&this.parent.o.onCompleted()}}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e);return true}return false};return SwitchObservable}(ObservableBase);observableProto["switch"]=observableProto.switchLatest=function(){return new SwitchObservable(this)};var TakeUntilObservable=function(__super__){inherits(TakeUntilObservable,__super__);function TakeUntilObservable(source,other){this.source=source;this.other=isPromise(other)?observableFromPromise(other):other;__super__.call(this)}TakeUntilObservable.prototype.subscribeCore=function(o){return new CompositeDisposable(this.source.subscribe(o),this.other.subscribe(new InnerObserver(o)))};function InnerObserver(o){this.o=o;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}this.o.onCompleted()};InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){!this.isStopped&&(this.isStopped=true)};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return TakeUntilObservable}(ObservableBase);observableProto.takeUntil=function(other){return new TakeUntilObservable(this,other)};function falseFactory(){return false}observableProto.withLatestFrom=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=args.pop(),source=this;Array.isArray(args[0])&&(args=args[0]);return new AnonymousObservable(function(observer){var n=args.length,hasValue=arrayInitialize(n,falseFactory),hasValueAll=false,values=new Array(n);var subscriptions=new Array(n+1);for(var idx=0;idx<n;idx++){(function(i){var other=args[i],sad=new SingleAssignmentDisposable;isPromise(other)&&(other=observableFromPromise(other));sad.setDisposable(other.subscribe(function(x){values[i]=x;hasValue[i]=true;hasValueAll=hasValue.every(identity)},function(e){observer.onError(e)},noop));subscriptions[i]=sad})(idx)}var sad=new SingleAssignmentDisposable;sad.setDisposable(source.subscribe(function(x){var allValues=[x].concat(values);if(!hasValueAll){return}var res=tryCatch(resultSelector).apply(null,allValues);if(res===errorObj){return observer.onError(res.e)}observer.onNext(res)},function(e){observer.onError(e)},function(){observer.onCompleted()}));subscriptions[n]=sad;return new CompositeDisposable(subscriptions)},this)};function zipArray(second,resultSelector){var first=this;return new AnonymousObservable(function(o){var index=0,len=second.length;return first.subscribe(function(left){if(index<len){var right=second[index++],res=tryCatch(resultSelector)(left,right);if(res===errorObj){return o.onError(res.e)}o.onNext(res)}else{o.onCompleted()}},function(e){o.onError(e)},function(){o.onCompleted()})},first)}function falseFactory(){return false}function emptyArrayFactory(){return[]}observableProto.zip=function(){if(Array.isArray(arguments[0])){return zipArray.apply(this,arguments)}var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var parent=this,resultSelector=args.pop();args.unshift(parent);return new AnonymousObservable(function(o){var n=args.length,queues=arrayInitialize(n,emptyArrayFactory),isDone=arrayInitialize(n,falseFactory);var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){var source=args[i],sad=new SingleAssignmentDisposable;isPromise(source)&&(source=observableFromPromise(source));sad.setDisposable(source.subscribe(function(x){queues[i].push(x);if(queues.every(function(x){return x.length>0})){var queuedValues=queues.map(function(x){return x.shift()}),res=tryCatch(resultSelector).apply(parent,queuedValues);if(res===errorObj){return o.onError(res.e)}o.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(identity)){o.onCompleted()}},function(e){o.onError(e)},function(){isDone[i]=true;isDone.every(identity)&&o.onCompleted()}));subscriptions[i]=sad})(idx)}return new CompositeDisposable(subscriptions)},parent)};Observable.zip=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var first=args.shift();return first.zip.apply(first,args)};function falseFactory(){return false}function arrayFactory(){return[]}Observable.zipArray=function(){var sources;if(Array.isArray(arguments[0])){sources=arguments[0]}else{var len=arguments.length;sources=new Array(len);for(var i=0;i<len;i++){sources[i]=arguments[i]}}return new AnonymousObservable(function(o){var n=sources.length,queues=arrayInitialize(n,arrayFactory),isDone=arrayInitialize(n,falseFactory);var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){subscriptions[i]=new SingleAssignmentDisposable;subscriptions[i].setDisposable(sources[i].subscribe(function(x){queues[i].push(x);if(queues.every(function(x){return x.length>0})){var res=queues.map(function(x){return x.shift()});o.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(identity)){return o.onCompleted()}},function(e){o.onError(e)},function(){isDone[i]=true;isDone.every(identity)&&o.onCompleted()}))})(idx)}return new CompositeDisposable(subscriptions)})};observableProto.asObservable=function(){var source=this;return new AnonymousObservable(function(o){return source.subscribe(o)},source)};observableProto.bufferWithCount=function(count,skip){if(typeof skip!=="number"){skip=count}return this.windowWithCount(count,skip).selectMany(function(x){return x.toArray()}).where(function(x){return x.length>0})};observableProto.dematerialize=function(){var source=this;return new AnonymousObservable(function(o){return source.subscribe(function(x){return x.accept(o)},function(e){o.onError(e)},function(){o.onCompleted()})},this)};observableProto.distinctUntilChanged=function(keySelector,comparer){var source=this;comparer||(comparer=defaultComparer);return new AnonymousObservable(function(o){var hasCurrentKey=false,currentKey;return source.subscribe(function(value){var key=value;if(keySelector){key=tryCatch(keySelector)(value);if(key===errorObj){return o.onError(key.e)}}if(hasCurrentKey){var comparerEquals=tryCatch(comparer)(currentKey,key);if(comparerEquals===errorObj){return o.onError(comparerEquals.e)}}if(!hasCurrentKey||!comparerEquals){hasCurrentKey=true;currentKey=key;o.onNext(value)}},function(e){o.onError(e)},function(){o.onCompleted()})},this)};var TapObservable=function(__super__){inherits(TapObservable,__super__);function TapObservable(source,observerOrOnNext,onError,onCompleted){this.source=source;this.t=!observerOrOnNext||isFunction(observerOrOnNext)?observerCreate(observerOrOnNext||noop,onError||noop,onCompleted||noop):observerOrOnNext;__super__.call(this)}TapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.t))};function InnerObserver(o,t){this.o=o;this.t=t;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}var res=tryCatch(this.t.onNext).call(this.t,x);if(res===errorObj){this.o.onError(res.e)}this.o.onNext(x)};InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;var res=tryCatch(this.t.onError).call(this.t,err);if(res===errorObj){return this.o.onError(res.e)}this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;var res=tryCatch(this.t.onCompleted).call(this.t);if(res===errorObj){return this.o.onError(res.e)}this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return TapObservable}(ObservableBase);observableProto["do"]=observableProto.tap=observableProto.doAction=function(observerOrOnNext,onError,onCompleted){return new TapObservable(this,observerOrOnNext,onError,onCompleted)};observableProto.doOnNext=observableProto.tapOnNext=function(onNext,thisArg){return this.tap(typeof thisArg!=="undefined"?function(x){onNext.call(thisArg,x)}:onNext)};observableProto.doOnError=observableProto.tapOnError=function(onError,thisArg){return this.tap(noop,typeof thisArg!=="undefined"?function(e){onError.call(thisArg,e)}:onError)};observableProto.doOnCompleted=observableProto.tapOnCompleted=function(onCompleted,thisArg){return this.tap(noop,null,typeof thisArg!=="undefined"?function(){onCompleted.call(thisArg)}:onCompleted)};observableProto["finally"]=observableProto.ensure=function(action){var source=this;return new AnonymousObservable(function(observer){var subscription;try{subscription=source.subscribe(observer)}catch(e){action();throw e}return disposableCreate(function(){try{subscription.dispose()}catch(e){throw e}finally{action()}})},this)};observableProto.finallyAction=function(action){return this.ensure(action)};var IgnoreElementsObservable=function(__super__){inherits(IgnoreElementsObservable,__super__);function IgnoreElementsObservable(source){this.source=source;__super__.call(this)}IgnoreElementsObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o))};function InnerObserver(o){this.o=o;this.isStopped=false}InnerObserver.prototype.onNext=noop;InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.observer.onError(e);return true}return false};return IgnoreElementsObservable}(ObservableBase);observableProto.ignoreElements=function(){return new IgnoreElementsObservable(this)};observableProto.materialize=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(function(value){observer.onNext(notificationCreateOnNext(value))},function(e){observer.onNext(notificationCreateOnError(e));observer.onCompleted()},function(){observer.onNext(notificationCreateOnCompleted());observer.onCompleted()})},source)};observableProto.repeat=function(repeatCount){return enumerableRepeat(this,repeatCount).concat()};observableProto.retry=function(retryCount){return enumerableRepeat(this,retryCount).catchError()};observableProto.retryWhen=function(notifier){return enumerableRepeat(this).catchErrorWhen(notifier)};var ScanObservable=function(__super__){inherits(ScanObservable,__super__);function ScanObservable(source,accumulator,hasSeed,seed){this.source=source;this.accumulator=accumulator;this.hasSeed=hasSeed;this.seed=seed;__super__.call(this)}ScanObservable.prototype.subscribeCore=function(observer){return this.source.subscribe(new ScanObserver(observer,this))};return ScanObservable}(ObservableBase);function ScanObserver(observer,parent){this.observer=observer;this.accumulator=parent.accumulator;this.hasSeed=parent.hasSeed;this.seed=parent.seed;this.hasAccumulation=false;this.accumulation=null;this.hasValue=false;this.isStopped=false}ScanObserver.prototype.onNext=function(x){if(this.isStopped){return}!this.hasValue&&(this.hasValue=true);try{if(this.hasAccumulation){this.accumulation=this.accumulator(this.accumulation,x)}else{this.accumulation=this.hasSeed?this.accumulator(this.seed,x):x;this.hasAccumulation=true}}catch(e){return this.observer.onError(e)}this.observer.onNext(this.accumulation)};ScanObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.observer.onError(e)}};ScanObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;!this.hasValue&&this.hasSeed&&this.observer.onNext(this.seed);this.observer.onCompleted()}};ScanObserver.prototype.dispose=function(){this.isStopped=true};ScanObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.observer.onError(e);return true}return false};observableProto.scan=function(){var hasSeed=false,seed,accumulator,source=this;if(arguments.length===2){hasSeed=true;seed=arguments[0];accumulator=arguments[1]}else{accumulator=arguments[0]}return new ScanObservable(this,accumulator,hasSeed,seed)};observableProto.skipLast=function(count){if(count<0){throw new ArgumentOutOfRangeError}var source=this;return new AnonymousObservable(function(o){var q=[];return source.subscribe(function(x){q.push(x);q.length>count&&o.onNext(q.shift())},function(e){o.onError(e)},function(){o.onCompleted()})},source)};observableProto.startWith=function(){var values,scheduler,start=0;if(!!arguments.length&&isScheduler(arguments[0])){scheduler=arguments[0];start=1}else{scheduler=immediateScheduler}for(var args=[],i=start,len=arguments.length;i<len;i++){args.push(arguments[i])}return enumerableOf([observableFromArray(args,scheduler),this]).concat()};observableProto.takeLast=function(count){if(count<0){throw new ArgumentOutOfRangeError}var source=this;return new AnonymousObservable(function(o){var q=[];return source.subscribe(function(x){q.push(x);q.length>count&&q.shift()},function(e){o.onError(e)},function(){while(q.length>0){o.onNext(q.shift())}o.onCompleted()})},source)};observableProto.takeLastBuffer=function(count){var source=this;return new AnonymousObservable(function(o){var q=[];return source.subscribe(function(x){q.push(x);q.length>count&&q.shift()},function(e){o.onError(e)},function(){o.onNext(q);o.onCompleted()})},source)};observableProto.windowWithCount=function(count,skip){var source=this;+count||(count=0);Math.abs(count)===Infinity&&(count=0);if(count<=0){throw new ArgumentOutOfRangeError}skip==null&&(skip=count);+skip||(skip=0);Math.abs(skip)===Infinity&&(skip=0);if(skip<=0){throw new ArgumentOutOfRangeError}return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable,refCountDisposable=new RefCountDisposable(m),n=0,q=[];function createWindow(){var s=new Subject;q.push(s);observer.onNext(addRef(s,refCountDisposable))}createWindow();m.setDisposable(source.subscribe(function(x){for(var i=0,len=q.length;i<len;i++){q[i].onNext(x)}var c=n-count+1;c>=0&&c%skip===0&&q.shift().onCompleted();++n%skip===0&&createWindow()},function(e){while(q.length>0){q.shift().onError(e)}observer.onError(e)},function(){while(q.length>0){q.shift().onCompleted()}observer.onCompleted()}));return refCountDisposable},source)};function concatMap(source,selector,thisArg){var selectorFunc=bindCallback(selector,thisArg,3);return source.map(function(x,i){var result=selectorFunc(x,i,source);isPromise(result)&&(result=observableFromPromise(result));(isArrayLike(result)||isIterable(result))&&(result=observableFrom(result));return result}).concatAll()}observableProto.selectConcat=observableProto.concatMap=function(selector,resultSelector,thisArg){if(isFunction(selector)&&isFunction(resultSelector)){return this.concatMap(function(x,i){var selectorResult=selector(x,i);isPromise(selectorResult)&&(selectorResult=observableFromPromise(selectorResult));(isArrayLike(selectorResult)||isIterable(selectorResult))&&(selectorResult=observableFrom(selectorResult));return selectorResult.map(function(y,i2){return resultSelector(x,y,i,i2)})})}return isFunction(selector)?concatMap(this,selector,thisArg):concatMap(this,function(){return selector})};observableProto.concatMapObserver=observableProto.selectConcatObserver=function(onNext,onError,onCompleted,thisArg){var source=this,onNextFunc=bindCallback(onNext,thisArg,2),onErrorFunc=bindCallback(onError,thisArg,1),onCompletedFunc=bindCallback(onCompleted,thisArg,0);return new AnonymousObservable(function(observer){var index=0;return source.subscribe(function(x){var result;try{result=onNextFunc(x,index++)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result)},function(err){var result;try{result=onErrorFunc(err)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()},function(){var result;try{result=onCompletedFunc()}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()})},this).concatAll()};observableProto.defaultIfEmpty=function(defaultValue){var source=this;defaultValue===undefined&&(defaultValue=null);return new AnonymousObservable(function(observer){var found=false;return source.subscribe(function(x){found=true;observer.onNext(x)},function(e){observer.onError(e)},function(){!found&&observer.onNext(defaultValue);observer.onCompleted()})},source)};function arrayIndexOfComparer(array,item,comparer){for(var i=0,len=array.length;i<len;i++){if(comparer(array[i],item)){return i}}return-1}function HashSet(comparer){this.comparer=comparer;this.set=[]}HashSet.prototype.push=function(value){var retValue=arrayIndexOfComparer(this.set,value,this.comparer)===-1;retValue&&this.set.push(value);return retValue};observableProto.distinct=function(keySelector,comparer){var source=this;comparer||(comparer=defaultComparer);return new AnonymousObservable(function(o){var hashSet=new HashSet(comparer);return source.subscribe(function(x){var key=x;if(keySelector){try{key=keySelector(x)}catch(e){o.onError(e);return}}hashSet.push(key)&&o.onNext(x)},function(e){o.onError(e)},function(){o.onCompleted()})},this)};var MapObservable=function(__super__){inherits(MapObservable,__super__);function MapObservable(source,selector,thisArg){this.source=source;this.selector=bindCallback(selector,thisArg,3);__super__.call(this)}function innerMap(selector,self){return function(x,i,o){return selector.call(this,self.selector(x,i,o),i,o)}}MapObservable.prototype.internalMap=function(selector,thisArg){return new MapObservable(this.source,innerMap(selector,this),thisArg)};MapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.selector,this))};function InnerObserver(o,selector,source){this.o=o;this.selector=selector;this.source=source;this.i=0;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}var result=tryCatch(this.selector)(x,this.i++,this.source);if(result===errorObj){return this.o.onError(result.e)}this.o.onNext(result)};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return MapObservable}(ObservableBase);observableProto.map=observableProto.select=function(selector,thisArg){var selectorFn=typeof selector==="function"?selector:function(){return selector};return this instanceof MapObservable?this.internalMap(selectorFn,thisArg):new MapObservable(this,selectorFn,thisArg)};observableProto.pluck=function(){var args=arguments,len=arguments.length;if(len===0){throw new Error("List of properties cannot be empty.")}return this.map(function(x){var currentProp=x;for(var i=0;i<len;i++){var p=currentProp[args[i]];if(typeof p!=="undefined"){currentProp=p}else{return undefined}}return currentProp})};observableProto.flatMapObserver=observableProto.selectManyObserver=function(onNext,onError,onCompleted,thisArg){var source=this;return new AnonymousObservable(function(observer){var index=0;return source.subscribe(function(x){var result;try{result=onNext.call(thisArg,x,index++)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result)},function(err){var result;try{result=onError.call(thisArg,err)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()},function(){var result;try{result=onCompleted.call(thisArg)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()})},source).mergeAll()};function flatMap(source,selector,thisArg){var selectorFunc=bindCallback(selector,thisArg,3);return source.map(function(x,i){var result=selectorFunc(x,i,source);isPromise(result)&&(result=observableFromPromise(result));(isArrayLike(result)||isIterable(result))&&(result=observableFrom(result));return result}).mergeAll()}observableProto.selectMany=observableProto.flatMap=function(selector,resultSelector,thisArg){if(isFunction(selector)&&isFunction(resultSelector)){return this.flatMap(function(x,i){var selectorResult=selector(x,i);isPromise(selectorResult)&&(selectorResult=observableFromPromise(selectorResult));(isArrayLike(selectorResult)||isIterable(selectorResult))&&(selectorResult=observableFrom(selectorResult));return selectorResult.map(function(y,i2){return resultSelector(x,y,i,i2)})},thisArg)}return isFunction(selector)?flatMap(this,selector,thisArg):flatMap(this,function(){return selector})};observableProto.selectSwitch=observableProto.flatMapLatest=observableProto.switchMap=function(selector,thisArg){return this.select(selector,thisArg).switchLatest()};var SkipObservable=function(__super__){inherits(SkipObservable,__super__);function SkipObservable(source,count){this.source=source;this.skipCount=count;__super__.call(this)}SkipObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.skipCount))};function InnerObserver(o,c){this.c=c;this.r=c;this.o=o;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}if(this.r<=0){this.o.onNext(x)}else{this.r--}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return SkipObservable}(ObservableBase);observableProto.skip=function(count){if(count<0){throw new ArgumentOutOfRangeError}return new SkipObservable(this,count)};observableProto.skipWhile=function(predicate,thisArg){var source=this,callback=bindCallback(predicate,thisArg,3);return new AnonymousObservable(function(o){var i=0,running=false;return source.subscribe(function(x){if(!running){try{running=!callback(x,i++,source)}catch(e){o.onError(e);return}}running&&o.onNext(x)},function(e){o.onError(e)},function(){o.onCompleted()})},source)};observableProto.take=function(count,scheduler){if(count<0){throw new ArgumentOutOfRangeError}if(count===0){return observableEmpty(scheduler)}var source=this;return new AnonymousObservable(function(o){var remaining=count;return source.subscribe(function(x){if(remaining-- >0){o.onNext(x);remaining<=0&&o.onCompleted()}},function(e){o.onError(e)},function(){o.onCompleted()})},source)};observableProto.takeWhile=function(predicate,thisArg){var source=this,callback=bindCallback(predicate,thisArg,3);return new AnonymousObservable(function(o){var i=0,running=true;return source.subscribe(function(x){if(running){try{running=callback(x,i++,source)}catch(e){o.onError(e);return}if(running){o.onNext(x)}else{o.onCompleted()}}},function(e){o.onError(e)},function(){o.onCompleted()})},source)};var FilterObservable=function(__super__){inherits(FilterObservable,__super__);function FilterObservable(source,predicate,thisArg){this.source=source;this.predicate=bindCallback(predicate,thisArg,3);__super__.call(this)}FilterObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.predicate,this))};function innerPredicate(predicate,self){return function(x,i,o){return self.predicate(x,i,o)&&predicate.call(this,x,i,o)}}FilterObservable.prototype.internalFilter=function(predicate,thisArg){return new FilterObservable(this.source,innerPredicate(predicate,this),thisArg)};function InnerObserver(o,predicate,source){this.o=o;this.predicate=predicate;this.source=source;this.i=0;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}var shouldYield=tryCatch(this.predicate)(x,this.i++,this.source);if(shouldYield===errorObj){return this.o.onError(shouldYield.e)}shouldYield&&this.o.onNext(x)};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return FilterObservable}(ObservableBase);observableProto.filter=observableProto.where=function(predicate,thisArg){return this instanceof FilterObservable?this.internalFilter(predicate,thisArg):new FilterObservable(this,predicate,thisArg)};observableProto.transduce=function(transducer){var source=this;function transformForObserver(o){return{"@@transducer/init":function(){return o},"@@transducer/step":function(obs,input){return obs.onNext(input)},"@@transducer/result":function(obs){return obs.onCompleted()}}}return new AnonymousObservable(function(o){var xform=transducer(transformForObserver(o));return source.subscribe(function(v){try{xform["@@transducer/step"](o,v)}catch(e){o.onError(e)}},function(e){o.onError(e)},function(){xform["@@transducer/result"](o)})},source)};var AnonymousObservable=Rx.AnonymousObservable=function(__super__){inherits(AnonymousObservable,__super__);function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],subscribe=state[1];var sub=tryCatch(subscribe)(ado);if(sub===errorObj){if(!ado.fail(errorObj.e)){return thrower(errorObj.e)}}ado.setDisposable(fixSubscriber(sub))}function AnonymousObservable(subscribe,parent){this.source=parent;function s(observer){var ado=new AutoDetachObserver(observer),state=[ado,subscribe];if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.scheduleWithState(state,setDisposable)}else{setDisposable(null,state)}return ado}__super__.call(this,s)}return AnonymousObservable}(Observable);var AutoDetachObserver=function(__super__){inherits(AutoDetachObserver,__super__);function AutoDetachObserver(observer){__super__.call(this);this.observer=observer;this.m=new SingleAssignmentDisposable}var AutoDetachObserverPrototype=AutoDetachObserver.prototype;AutoDetachObserverPrototype.next=function(value){var result=tryCatch(this.observer.onNext).call(this.observer,value);if(result===errorObj){this.dispose();thrower(result.e)}};AutoDetachObserverPrototype.error=function(err){var result=tryCatch(this.observer.onError).call(this.observer,err);this.dispose();result===errorObj&&thrower(result.e)};AutoDetachObserverPrototype.completed=function(){var result=tryCatch(this.observer.onCompleted).call(this.observer);this.dispose();result===errorObj&&thrower(result.e)};AutoDetachObserverPrototype.setDisposable=function(value){this.m.setDisposable(value)};AutoDetachObserverPrototype.getDisposable=function(){return this.m.getDisposable()};AutoDetachObserverPrototype.dispose=function(){__super__.prototype.dispose.call(this);this.m.dispose()};return AutoDetachObserver}(AbstractObserver);var InnerSubscription=function(subject,observer){this.subject=subject;this.observer=observer};InnerSubscription.prototype.dispose=function(){if(!this.subject.isDisposed&&this.observer!==null){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1);this.observer=null}};var Subject=Rx.Subject=function(__super__){function subscribe(observer){checkDisposed(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer)}if(this.hasError){observer.onError(this.error);return disposableEmpty}observer.onCompleted();return disposableEmpty}inherits(Subject,__super__);function Subject(){__super__.call(this,subscribe);this.isDisposed=false,this.isStopped=false,this.observers=[];this.hasError=false;
}addProperties(Subject.prototype,Observer.prototype,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){checkDisposed(this);if(!this.isStopped){this.isStopped=true;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onCompleted()}this.observers.length=0}},onError:function(error){checkDisposed(this);if(!this.isStopped){this.isStopped=true;this.error=error;this.hasError=true;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onError(error)}this.observers.length=0}},onNext:function(value){checkDisposed(this);if(!this.isStopped){for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onNext(value)}}},dispose:function(){this.isDisposed=true;this.observers=null}});Subject.create=function(observer,observable){return new AnonymousSubject(observer,observable)};return Subject}(Observable);var AsyncSubject=Rx.AsyncSubject=function(__super__){function subscribe(observer){checkDisposed(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer)}if(this.hasError){observer.onError(this.error)}else if(this.hasValue){observer.onNext(this.value);observer.onCompleted()}else{observer.onCompleted()}return disposableEmpty}inherits(AsyncSubject,__super__);function AsyncSubject(){__super__.call(this,subscribe);this.isDisposed=false;this.isStopped=false;this.hasValue=false;this.observers=[];this.hasError=false}addProperties(AsyncSubject.prototype,Observer,{hasObservers:function(){checkDisposed(this);return this.observers.length>0},onCompleted:function(){var i,len;checkDisposed(this);if(!this.isStopped){this.isStopped=true;var os=cloneArray(this.observers),len=os.length;if(this.hasValue){for(i=0;i<len;i++){var o=os[i];o.onNext(this.value);o.onCompleted()}}else{for(i=0;i<len;i++){os[i].onCompleted()}}this.observers.length=0}},onError:function(error){checkDisposed(this);if(!this.isStopped){this.isStopped=true;this.hasError=true;this.error=error;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onError(error)}this.observers.length=0}},onNext:function(value){checkDisposed(this);if(this.isStopped){return}this.value=value;this.hasValue=true},dispose:function(){this.isDisposed=true;this.observers=null;this.exception=null;this.value=null}});return AsyncSubject}(Observable);var AnonymousSubject=Rx.AnonymousSubject=function(__super__){inherits(AnonymousSubject,__super__);function subscribe(observer){return this.observable.subscribe(observer)}function AnonymousSubject(observer,observable){this.observer=observer;this.observable=observable;__super__.call(this,subscribe)}addProperties(AnonymousSubject.prototype,Observer.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(error){this.observer.onError(error)},onNext:function(value){this.observer.onNext(value)}});return AnonymousSubject}(Observable);if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root.Rx=Rx;define(function(){return Rx})}else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=Rx).Rx=Rx}else{freeExports.Rx=Rx}}else{root.Rx=Rx}var rEndingLine=captureLine()}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:6}],223:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subject_1=require("./Subject");var throwError_1=require("./util/throwError");var ObjectUnsubscribedError_1=require("./util/ObjectUnsubscribedError");var BehaviorSubject=function(_super){__extends(BehaviorSubject,_super);function BehaviorSubject(_value){_super.call(this);this._value=_value}BehaviorSubject.prototype.getValue=function(){if(this.hasError){throwError_1.throwError(this.thrownError)}else if(this.isUnsubscribed){throwError_1.throwError(new ObjectUnsubscribedError_1.ObjectUnsubscribedError)}else{return this._value}};Object.defineProperty(BehaviorSubject.prototype,"value",{get:function(){return this.getValue()},enumerable:true,configurable:true});BehaviorSubject.prototype._subscribe=function(subscriber){var subscription=_super.prototype._subscribe.call(this,subscriber);if(subscription&&!subscription.isUnsubscribed){subscriber.next(this._value)}return subscription};BehaviorSubject.prototype.next=function(value){_super.prototype.next.call(this,this._value=value)};return BehaviorSubject}(Subject_1.Subject);exports.BehaviorSubject=BehaviorSubject},{"./Subject":230,"./util/ObjectUnsubscribedError":337,"./util/throwError":348}],224:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("./Subscriber");var InnerSubscriber=function(_super){__extends(InnerSubscriber,_super);function InnerSubscriber(parent,outerValue,outerIndex){_super.call(this);this.parent=parent;this.outerValue=outerValue;this.outerIndex=outerIndex;this.index=0}InnerSubscriber.prototype._next=function(value){this.parent.notifyNext(this.outerValue,value,this.outerIndex,this.index++,this)};InnerSubscriber.prototype._error=function(error){this.parent.notifyError(error,this);this.unsubscribe()};InnerSubscriber.prototype._complete=function(){this.parent.notifyComplete(this);this.unsubscribe()};return InnerSubscriber}(Subscriber_1.Subscriber);exports.InnerSubscriber=InnerSubscriber},{"./Subscriber":232}],225:[function(require,module,exports){"use strict";var Observable_1=require("./Observable");var Notification=function(){function Notification(kind,value,exception){this.kind=kind;this.value=value;this.exception=exception;this.hasValue=kind==="N"}Notification.prototype.observe=function(observer){switch(this.kind){case"N":return observer.next&&observer.next(this.value);case"E":return observer.error&&observer.error(this.exception);case"C":return observer.complete&&observer.complete()}};Notification.prototype.do=function(next,error,complete){var kind=this.kind;switch(kind){case"N":return next&&next(this.value);case"E":return error&&error(this.exception);case"C":return complete&&complete()}};Notification.prototype.accept=function(nextOrObserver,error,complete){if(nextOrObserver&&typeof nextOrObserver.next==="function"){return this.observe(nextOrObserver)}else{return this.do(nextOrObserver,error,complete)}};Notification.prototype.toObservable=function(){var kind=this.kind;switch(kind){case"N":return Observable_1.Observable.of(this.value);case"E":return Observable_1.Observable.throw(this.exception);case"C":return Observable_1.Observable.empty()}};Notification.createNext=function(value){if(typeof value!=="undefined"){return new Notification("N",value)}return this.undefinedValueNotification};Notification.createError=function(err){return new Notification("E",undefined,err)};Notification.createComplete=function(){return this.completeNotification};Notification.completeNotification=new Notification("C");Notification.undefinedValueNotification=new Notification("N",undefined);return Notification}();exports.Notification=Notification},{"./Observable":226}],226:[function(require,module,exports){"use strict";var root_1=require("./util/root");var toSubscriber_1=require("./util/toSubscriber");var symbol_observable_1=require("symbol-observable");var Observable=function(){function Observable(subscribe){this._isScalar=false;if(subscribe){this._subscribe=subscribe}}Observable.prototype.lift=function(operator){var observable=new Observable;observable.source=this;observable.operator=operator;return observable};Observable.prototype.subscribe=function(observerOrNext,error,complete){var operator=this.operator;var sink=toSubscriber_1.toSubscriber(observerOrNext,error,complete);if(operator){operator.call(sink,this)}else{sink.add(this._subscribe(sink))}if(sink.syncErrorThrowable){sink.syncErrorThrowable=false;if(sink.syncErrorThrown){throw sink.syncErrorValue}}return sink};Observable.prototype.forEach=function(next,PromiseCtor){var _this=this;if(!PromiseCtor){if(root_1.root.Rx&&root_1.root.Rx.config&&root_1.root.Rx.config.Promise){PromiseCtor=root_1.root.Rx.config.Promise}else if(root_1.root.Promise){PromiseCtor=root_1.root.Promise}}if(!PromiseCtor){throw new Error("no Promise impl found")}return new PromiseCtor(function(resolve,reject){var subscription=_this.subscribe(function(value){if(subscription){try{next(value)}catch(err){reject(err);subscription.unsubscribe()}}else{next(value)}},reject,resolve)})};Observable.prototype._subscribe=function(subscriber){return this.source.subscribe(subscriber)};Observable.prototype[symbol_observable_1.default]=function(){return this};Observable.create=function(subscribe){return new Observable(subscribe)};return Observable}();exports.Observable=Observable},{"./util/root":346,"./util/toSubscriber":349,"symbol-observable":351}],227:[function(require,module,exports){"use strict";exports.empty={isUnsubscribed:true,next:function(value){},error:function(err){throw err},complete:function(){}}},{}],228:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("./Subscriber");var OuterSubscriber=function(_super){__extends(OuterSubscriber,_super);function OuterSubscriber(){_super.apply(this,arguments)}OuterSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this.destination.next(innerValue)};OuterSubscriber.prototype.notifyError=function(error,innerSub){this.destination.error(error)};OuterSubscriber.prototype.notifyComplete=function(innerSub){this.destination.complete()};return OuterSubscriber}(Subscriber_1.Subscriber);exports.OuterSubscriber=OuterSubscriber},{"./Subscriber":232}],229:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subject_1=require("./Subject");var queue_1=require("./scheduler/queue");var observeOn_1=require("./operator/observeOn");var ReplaySubject=function(_super){__extends(ReplaySubject,_super);function ReplaySubject(bufferSize,windowTime,scheduler){if(bufferSize===void 0){bufferSize=Number.POSITIVE_INFINITY}if(windowTime===void 0){windowTime=Number.POSITIVE_INFINITY}_super.call(this);this.scheduler=scheduler;this._events=[];this._bufferSize=bufferSize<1?1:bufferSize;this._windowTime=windowTime<1?1:windowTime}ReplaySubject.prototype.next=function(value){var now=this._getNow();this._events.push(new ReplayEvent(now,value));this._trimBufferThenGetEvents();_super.prototype.next.call(this,value)};ReplaySubject.prototype._subscribe=function(subscriber){var _events=this._trimBufferThenGetEvents();var scheduler=this.scheduler;if(scheduler){subscriber.add(subscriber=new observeOn_1.ObserveOnSubscriber(subscriber,scheduler))}var len=_events.length;for(var i=0;i<len&&!subscriber.isUnsubscribed;i++){subscriber.next(_events[i].value)}return _super.prototype._subscribe.call(this,subscriber)};ReplaySubject.prototype._getNow=function(){return(this.scheduler||queue_1.queue).now()};ReplaySubject.prototype._trimBufferThenGetEvents=function(){var now=this._getNow();var _bufferSize=this._bufferSize;var _windowTime=this._windowTime;var _events=this._events;var eventsCount=_events.length;var spliceCount=0;while(spliceCount<eventsCount){if(now-_events[spliceCount].time<_windowTime){break}spliceCount++}if(eventsCount>_bufferSize){spliceCount=Math.max(spliceCount,eventsCount-_bufferSize)}if(spliceCount>0){_events.splice(0,spliceCount)}return _events};return ReplaySubject}(Subject_1.Subject);exports.ReplaySubject=ReplaySubject;var ReplayEvent=function(){function ReplayEvent(time,value){this.time=time;this.value=value}return ReplayEvent}()},{"./Subject":230,"./operator/observeOn":311,"./scheduler/queue":332}],230:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("./Observable");var Subscriber_1=require("./Subscriber");var Subscription_1=require("./Subscription");var ObjectUnsubscribedError_1=require("./util/ObjectUnsubscribedError");var SubjectSubscription_1=require("./SubjectSubscription");var rxSubscriber_1=require("./symbol/rxSubscriber");var SubjectSubscriber=function(_super){__extends(SubjectSubscriber,_super);function SubjectSubscriber(destination){_super.call(this,destination);this.destination=destination}return SubjectSubscriber}(Subscriber_1.Subscriber);exports.SubjectSubscriber=SubjectSubscriber;var Subject=function(_super){__extends(Subject,_super);function Subject(){_super.call(this);this.observers=[];this.isUnsubscribed=false;this.isStopped=false;this.hasError=false;this.thrownError=null}Subject.prototype[rxSubscriber_1.$$rxSubscriber]=function(){return new SubjectSubscriber(this)};Subject.prototype.lift=function(operator){var subject=new AnonymousSubject(this,this);subject.operator=operator;return subject};Subject.prototype.next=function(value){if(this.isUnsubscribed){throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError}if(!this.isStopped){var observers=this.observers;var len=observers.length;var copy=observers.slice();for(var i=0;i<len;i++){copy[i].next(value)}}};Subject.prototype.error=function(err){if(this.isUnsubscribed){throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError}this.hasError=true;this.thrownError=err;this.isStopped=true;var observers=this.observers;var len=observers.length;var copy=observers.slice();for(var i=0;i<len;i++){copy[i].error(err)}this.observers.length=0};Subject.prototype.complete=function(){if(this.isUnsubscribed){throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError}this.isStopped=true;var observers=this.observers;var len=observers.length;var copy=observers.slice();for(var i=0;i<len;i++){copy[i].complete()}this.observers.length=0};Subject.prototype.unsubscribe=function(){this.isStopped=true;this.isUnsubscribed=true;this.observers=null};Subject.prototype._subscribe=function(subscriber){if(this.isUnsubscribed){throw new ObjectUnsubscribedError_1.ObjectUnsubscribedError}else if(this.hasError){subscriber.error(this.thrownError);return Subscription_1.Subscription.EMPTY}else if(this.isStopped){subscriber.complete();return Subscription_1.Subscription.EMPTY}else{this.observers.push(subscriber);return new SubjectSubscription_1.SubjectSubscription(this,subscriber)}};Subject.prototype.asObservable=function(){var observable=new Observable_1.Observable;observable.source=this;return observable};Subject.create=function(destination,source){return new AnonymousSubject(destination,source)};return Subject}(Observable_1.Observable);exports.Subject=Subject;var AnonymousSubject=function(_super){__extends(AnonymousSubject,_super);function AnonymousSubject(destination,source){_super.call(this);this.destination=destination;this.source=source}AnonymousSubject.prototype.next=function(value){var destination=this.destination;if(destination&&destination.next){destination.next(value)}};AnonymousSubject.prototype.error=function(err){var destination=this.destination;if(destination&&destination.error){this.destination.error(err)}};AnonymousSubject.prototype.complete=function(){var destination=this.destination;if(destination&&destination.complete){this.destination.complete()}};AnonymousSubject.prototype._subscribe=function(subscriber){var source=this.source;if(source){return this.source.subscribe(subscriber)}else{return Subscription_1.Subscription.EMPTY}};return AnonymousSubject}(Subject);exports.AnonymousSubject=AnonymousSubject},{"./Observable":226,"./SubjectSubscription":231,"./Subscriber":232,"./Subscription":233,"./symbol/rxSubscriber":334,"./util/ObjectUnsubscribedError":337}],231:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscription_1=require("./Subscription");var SubjectSubscription=function(_super){__extends(SubjectSubscription,_super);function SubjectSubscription(subject,subscriber){_super.call(this);this.subject=subject;this.subscriber=subscriber;this.isUnsubscribed=false}SubjectSubscription.prototype.unsubscribe=function(){if(this.isUnsubscribed){return}this.isUnsubscribed=true;var subject=this.subject;var observers=subject.observers;this.subject=null;if(!observers||observers.length===0||subject.isStopped||subject.isUnsubscribed){return}var subscriberIndex=observers.indexOf(this.subscriber);if(subscriberIndex!==-1){observers.splice(subscriberIndex,1)}};return SubjectSubscription}(Subscription_1.Subscription);exports.SubjectSubscription=SubjectSubscription},{"./Subscription":233}],232:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var isFunction_1=require("./util/isFunction");var Subscription_1=require("./Subscription");var Observer_1=require("./Observer");var rxSubscriber_1=require("./symbol/rxSubscriber");var Subscriber=function(_super){__extends(Subscriber,_super);function Subscriber(destinationOrNext,error,complete){_super.call(this);this.syncErrorValue=null;this.syncErrorThrown=false;this.syncErrorThrowable=false;this.isStopped=false;switch(arguments.length){case 0:this.destination=Observer_1.empty;break;case 1:if(!destinationOrNext){this.destination=Observer_1.empty;break}if(typeof destinationOrNext==="object"){if(destinationOrNext instanceof Subscriber){this.destination=destinationOrNext;this.destination.add(this)}else{this.syncErrorThrowable=true;this.destination=new SafeSubscriber(this,destinationOrNext)}break}default:this.syncErrorThrowable=true;this.destination=new SafeSubscriber(this,destinationOrNext,error,complete);break}}Subscriber.prototype[rxSubscriber_1.$$rxSubscriber]=function(){return this};Subscriber.create=function(next,error,complete){var subscriber=new Subscriber(next,error,complete);subscriber.syncErrorThrowable=false;return subscriber};Subscriber.prototype.next=function(value){if(!this.isStopped){this._next(value)}};Subscriber.prototype.error=function(err){if(!this.isStopped){this.isStopped=true;this._error(err)}};Subscriber.prototype.complete=function(){if(!this.isStopped){this.isStopped=true;this._complete()}};Subscriber.prototype.unsubscribe=function(){if(this.isUnsubscribed){return}this.isStopped=true;_super.prototype.unsubscribe.call(this)};Subscriber.prototype._next=function(value){this.destination.next(value)};Subscriber.prototype._error=function(err){this.destination.error(err);this.unsubscribe()};Subscriber.prototype._complete=function(){this.destination.complete();this.unsubscribe()};return Subscriber}(Subscription_1.Subscription);exports.Subscriber=Subscriber;var SafeSubscriber=function(_super){__extends(SafeSubscriber,_super);function SafeSubscriber(_parent,observerOrNext,error,complete){_super.call(this);this._parent=_parent;var next;var context=this;if(isFunction_1.isFunction(observerOrNext)){next=observerOrNext}else if(observerOrNext){context=observerOrNext;next=observerOrNext.next;error=observerOrNext.error;complete=observerOrNext.complete;if(isFunction_1.isFunction(context.unsubscribe)){this.add(context.unsubscribe.bind(context))}context.unsubscribe=this.unsubscribe.bind(this)}this._context=context;this._next=next;this._error=error;this._complete=complete}SafeSubscriber.prototype.next=function(value){if(!this.isStopped&&this._next){var _parent=this._parent;if(!_parent.syncErrorThrowable){this.__tryOrUnsub(this._next,value)}else if(this.__tryOrSetError(_parent,this._next,value)){this.unsubscribe()}}};SafeSubscriber.prototype.error=function(err){if(!this.isStopped){var _parent=this._parent;if(this._error){if(!_parent.syncErrorThrowable){this.__tryOrUnsub(this._error,err);this.unsubscribe()}else{this.__tryOrSetError(_parent,this._error,err);this.unsubscribe()}}else if(!_parent.syncErrorThrowable){this.unsubscribe();throw err}else{_parent.syncErrorValue=err;_parent.syncErrorThrown=true;this.unsubscribe()}}};SafeSubscriber.prototype.complete=function(){if(!this.isStopped){var _parent=this._parent;if(this._complete){if(!_parent.syncErrorThrowable){this.__tryOrUnsub(this._complete);this.unsubscribe()}else{this.__tryOrSetError(_parent,this._complete);this.unsubscribe()}}else{this.unsubscribe()}}};SafeSubscriber.prototype.__tryOrUnsub=function(fn,value){try{fn.call(this._context,value)}catch(err){this.unsubscribe();throw err}};SafeSubscriber.prototype.__tryOrSetError=function(parent,fn,value){try{fn.call(this._context,value)}catch(err){parent.syncErrorValue=err;parent.syncErrorThrown=true;return true}return false};SafeSubscriber.prototype._unsubscribe=function(){var _parent=this._parent;this._context=null;this._parent=null;_parent.unsubscribe()};return SafeSubscriber}(Subscriber)},{"./Observer":227,"./Subscription":233,"./symbol/rxSubscriber":334,"./util/isFunction":342}],233:[function(require,module,exports){"use strict";var isArray_1=require("./util/isArray");var isObject_1=require("./util/isObject");var isFunction_1=require("./util/isFunction");var tryCatch_1=require("./util/tryCatch");var errorObject_1=require("./util/errorObject");var UnsubscriptionError_1=require("./util/UnsubscriptionError");var Subscription=function(){function Subscription(unsubscribe){this.isUnsubscribed=false;if(unsubscribe){this._unsubscribe=unsubscribe}}Subscription.prototype.unsubscribe=function(){var hasErrors=false;var errors;if(this.isUnsubscribed){return}this.isUnsubscribed=true;var _a=this,_unsubscribe=_a._unsubscribe,_subscriptions=_a._subscriptions;this._subscriptions=null;if(isFunction_1.isFunction(_unsubscribe)){var trial=tryCatch_1.tryCatch(_unsubscribe).call(this);if(trial===errorObject_1.errorObject){hasErrors=true;(errors=errors||[]).push(errorObject_1.errorObject.e)}}if(isArray_1.isArray(_subscriptions)){var index=-1;var len=_subscriptions.length;while(++index<len){var sub=_subscriptions[index];if(isObject_1.isObject(sub)){var trial=tryCatch_1.tryCatch(sub.unsubscribe).call(sub);if(trial===errorObject_1.errorObject){hasErrors=true;errors=errors||[];var err=errorObject_1.errorObject.e;if(err instanceof UnsubscriptionError_1.UnsubscriptionError){errors=errors.concat(err.errors)}else{errors.push(err)}}}}}if(hasErrors){throw new UnsubscriptionError_1.UnsubscriptionError(errors)}};Subscription.prototype.add=function(teardown){if(!teardown||teardown===this||teardown===Subscription.EMPTY){return}var sub=teardown;switch(typeof teardown){case"function":sub=new Subscription(teardown);case"object":if(sub.isUnsubscribed||typeof sub.unsubscribe!=="function"){break}else if(this.isUnsubscribed){sub.unsubscribe()}else{(this._subscriptions||(this._subscriptions=[])).push(sub)}break;default:throw new Error("Unrecognized teardown "+teardown+" added to Subscription.")}return sub};Subscription.prototype.remove=function(subscription){if(subscription==null||subscription===this||subscription===Subscription.EMPTY){return}var subscriptions=this._subscriptions;if(subscriptions){var subscriptionIndex=subscriptions.indexOf(subscription);if(subscriptionIndex!==-1){subscriptions.splice(subscriptionIndex,1)}}};Subscription.EMPTY=function(empty){empty.isUnsubscribed=true;return empty}(new Subscription);return Subscription}();exports.Subscription=Subscription},{"./util/UnsubscriptionError":338,"./util/errorObject":339,"./util/isArray":340,"./util/isFunction":342,"./util/isObject":343,"./util/tryCatch":350}],234:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var combineLatest_1=require("../../observable/combineLatest");Observable_1.Observable.combineLatest=combineLatest_1.combineLatest},{"../../Observable":226,"../../observable/combineLatest":285}],235:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var empty_1=require("../../observable/empty");Observable_1.Observable.empty=empty_1.empty},{"../../Observable":226,"../../observable/empty":286}],236:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var from_1=require("../../observable/from");Observable_1.Observable.from=from_1.from},{"../../Observable":226,"../../observable/from":287}],237:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var fromEvent_1=require("../../observable/fromEvent");Observable_1.Observable.fromEvent=fromEvent_1.fromEvent},{"../../Observable":226,"../../observable/fromEvent":288}],238:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var fromPromise_1=require("../../observable/fromPromise");Observable_1.Observable.fromPromise=fromPromise_1.fromPromise},{"../../Observable":226,"../../observable/fromPromise":289}],239:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var merge_1=require("../../observable/merge");Observable_1.Observable.merge=merge_1.merge},{"../../Observable":226,"../../observable/merge":290}],240:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var of_1=require("../../observable/of");Observable_1.Observable.of=of_1.of},{"../../Observable":226,"../../observable/of":291}],241:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var throw_1=require("../../observable/throw");Observable_1.Observable.throw=throw_1._throw},{"../../Observable":226,"../../observable/throw":292}],242:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var zip_1=require("../../observable/zip");Observable_1.Observable.zip=zip_1.zip},{"../../Observable":226,"../../observable/zip":293}],243:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var buffer_1=require("../../operator/buffer");Observable_1.Observable.prototype.buffer=buffer_1.buffer},{"../../Observable":226,"../../operator/buffer":294}],244:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var combineLatest_1=require("../../operator/combineLatest");Observable_1.Observable.prototype.combineLatest=combineLatest_1.combineLatest},{"../../Observable":226,"../../operator/combineLatest":295}],245:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var concat_1=require("../../operator/concat");Observable_1.Observable.prototype.concat=concat_1.concat},{"../../Observable":226,"../../operator/concat":296}],246:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var debounceTime_1=require("../../operator/debounceTime");Observable_1.Observable.prototype.debounceTime=debounceTime_1.debounceTime},{"../../Observable":226,"../../operator/debounceTime":297}],247:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var delay_1=require("../../operator/delay");Observable_1.Observable.prototype.delay=delay_1.delay},{"../../Observable":226,"../../operator/delay":298}],248:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var distinct_1=require("../../operator/distinct");Observable_1.Observable.prototype.distinct=distinct_1.distinct},{"../../Observable":226,"../../operator/distinct":299}],249:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var distinctUntilChanged_1=require("../../operator/distinctUntilChanged");Observable_1.Observable.prototype.distinctUntilChanged=distinctUntilChanged_1.distinctUntilChanged},{"../../Observable":226,"../../operator/distinctUntilChanged":300}],250:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var do_1=require("../../operator/do");Observable_1.Observable.prototype.do=do_1._do},{"../../Observable":226,"../../operator/do":301}],251:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var expand_1=require("../../operator/expand");Observable_1.Observable.prototype.expand=expand_1.expand},{"../../Observable":226,"../../operator/expand":302}],252:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var filter_1=require("../../operator/filter");Observable_1.Observable.prototype.filter=filter_1.filter},{"../../Observable":226,"../../operator/filter":303}],253:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var finally_1=require("../../operator/finally");Observable_1.Observable.prototype.finally=finally_1._finally},{"../../Observable":226,"../../operator/finally":304}],254:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var first_1=require("../../operator/first");Observable_1.Observable.prototype.first=first_1.first},{"../../Observable":226,"../../operator/first":305}],255:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var map_1=require("../../operator/map");Observable_1.Observable.prototype.map=map_1.map},{"../../Observable":226,"../../operator/map":306}],256:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var merge_1=require("../../operator/merge");Observable_1.Observable.prototype.merge=merge_1.merge},{"../../Observable":226,"../../operator/merge":307}],257:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var mergeAll_1=require("../../operator/mergeAll");Observable_1.Observable.prototype.mergeAll=mergeAll_1.mergeAll},{"../../Observable":226,"../../operator/mergeAll":308}],258:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var mergeMap_1=require("../../operator/mergeMap");Observable_1.Observable.prototype.mergeMap=mergeMap_1.mergeMap;Observable_1.Observable.prototype.flatMap=mergeMap_1.mergeMap},{"../../Observable":226,"../../operator/mergeMap":309}],259:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var pairwise_1=require("../../operator/pairwise");Observable_1.Observable.prototype.pairwise=pairwise_1.pairwise},{"../../Observable":226,"../../operator/pairwise":312}],260:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var pluck_1=require("../../operator/pluck");Observable_1.Observable.prototype.pluck=pluck_1.pluck},{"../../Observable":226,"../../operator/pluck":313}],261:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var publish_1=require("../../operator/publish");Observable_1.Observable.prototype.publish=publish_1.publish},{"../../Observable":226,"../../operator/publish":314}],262:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var publishReplay_1=require("../../operator/publishReplay");Observable_1.Observable.prototype.publishReplay=publishReplay_1.publishReplay},{"../../Observable":226,"../../operator/publishReplay":315}],263:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var scan_1=require("../../operator/scan");Observable_1.Observable.prototype.scan=scan_1.scan},{"../../Observable":226,"../../operator/scan":316}],264:[function(require,module,exports){
"use strict";var Observable_1=require("../../Observable");var share_1=require("../../operator/share");Observable_1.Observable.prototype.share=share_1.share},{"../../Observable":226,"../../operator/share":317}],265:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var skip_1=require("../../operator/skip");Observable_1.Observable.prototype.skip=skip_1.skip},{"../../Observable":226,"../../operator/skip":318}],266:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var skipUntil_1=require("../../operator/skipUntil");Observable_1.Observable.prototype.skipUntil=skipUntil_1.skipUntil},{"../../Observable":226,"../../operator/skipUntil":319}],267:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var skipWhile_1=require("../../operator/skipWhile");Observable_1.Observable.prototype.skipWhile=skipWhile_1.skipWhile},{"../../Observable":226,"../../operator/skipWhile":320}],268:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var startWith_1=require("../../operator/startWith");Observable_1.Observable.prototype.startWith=startWith_1.startWith},{"../../Observable":226,"../../operator/startWith":321}],269:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var switchMap_1=require("../../operator/switchMap");Observable_1.Observable.prototype.switchMap=switchMap_1.switchMap},{"../../Observable":226,"../../operator/switchMap":322}],270:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var take_1=require("../../operator/take");Observable_1.Observable.prototype.take=take_1.take},{"../../Observable":226,"../../operator/take":323}],271:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var takeUntil_1=require("../../operator/takeUntil");Observable_1.Observable.prototype.takeUntil=takeUntil_1.takeUntil},{"../../Observable":226,"../../operator/takeUntil":324}],272:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var withLatestFrom_1=require("../../operator/withLatestFrom");Observable_1.Observable.prototype.withLatestFrom=withLatestFrom_1.withLatestFrom},{"../../Observable":226,"../../operator/withLatestFrom":325}],273:[function(require,module,exports){"use strict";var Observable_1=require("../../Observable");var zip_1=require("../../operator/zip");Observable_1.Observable.prototype.zip=zip_1.zipProto},{"../../Observable":226,"../../operator/zip":326}],274:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("../Observable");var ScalarObservable_1=require("./ScalarObservable");var EmptyObservable_1=require("./EmptyObservable");var ArrayLikeObservable=function(_super){__extends(ArrayLikeObservable,_super);function ArrayLikeObservable(arrayLike,mapFn,thisArg,scheduler){_super.call(this);this.arrayLike=arrayLike;this.scheduler=scheduler;if(!mapFn&&!scheduler&&arrayLike.length===1){this._isScalar=true;this.value=arrayLike[0]}if(mapFn){this.mapFn=mapFn.bind(thisArg)}}ArrayLikeObservable.create=function(arrayLike,mapFn,thisArg,scheduler){var length=arrayLike.length;if(length===0){return new EmptyObservable_1.EmptyObservable}else if(length===1&&!mapFn){return new ScalarObservable_1.ScalarObservable(arrayLike[0],scheduler)}else{return new ArrayLikeObservable(arrayLike,mapFn,thisArg,scheduler)}};ArrayLikeObservable.dispatch=function(state){var arrayLike=state.arrayLike,index=state.index,length=state.length,mapFn=state.mapFn,subscriber=state.subscriber;if(subscriber.isUnsubscribed){return}if(index>=length){subscriber.complete();return}var result=mapFn?mapFn(arrayLike[index],index):arrayLike[index];subscriber.next(result);state.index=index+1;this.schedule(state)};ArrayLikeObservable.prototype._subscribe=function(subscriber){var index=0;var _a=this,arrayLike=_a.arrayLike,mapFn=_a.mapFn,scheduler=_a.scheduler;var length=arrayLike.length;if(scheduler){return scheduler.schedule(ArrayLikeObservable.dispatch,0,{arrayLike:arrayLike,index:index,length:length,mapFn:mapFn,subscriber:subscriber})}else{for(var i=0;i<length&&!subscriber.isUnsubscribed;i++){var result=mapFn?mapFn(arrayLike[i],i):arrayLike[i];subscriber.next(result)}subscriber.complete()}};return ArrayLikeObservable}(Observable_1.Observable);exports.ArrayLikeObservable=ArrayLikeObservable},{"../Observable":226,"./EmptyObservable":277,"./ScalarObservable":284}],275:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("../Observable");var ScalarObservable_1=require("./ScalarObservable");var EmptyObservable_1=require("./EmptyObservable");var isScheduler_1=require("../util/isScheduler");var ArrayObservable=function(_super){__extends(ArrayObservable,_super);function ArrayObservable(array,scheduler){_super.call(this);this.array=array;this.scheduler=scheduler;if(!scheduler&&array.length===1){this._isScalar=true;this.value=array[0]}}ArrayObservable.create=function(array,scheduler){return new ArrayObservable(array,scheduler)};ArrayObservable.of=function(){var array=[];for(var _i=0;_i<arguments.length;_i++){array[_i-0]=arguments[_i]}var scheduler=array[array.length-1];if(isScheduler_1.isScheduler(scheduler)){array.pop()}else{scheduler=null}var len=array.length;if(len>1){return new ArrayObservable(array,scheduler)}else if(len===1){return new ScalarObservable_1.ScalarObservable(array[0],scheduler)}else{return new EmptyObservable_1.EmptyObservable(scheduler)}};ArrayObservable.dispatch=function(state){var array=state.array,index=state.index,count=state.count,subscriber=state.subscriber;if(index>=count){subscriber.complete();return}subscriber.next(array[index]);if(subscriber.isUnsubscribed){return}state.index=index+1;this.schedule(state)};ArrayObservable.prototype._subscribe=function(subscriber){var index=0;var array=this.array;var count=array.length;var scheduler=this.scheduler;if(scheduler){return scheduler.schedule(ArrayObservable.dispatch,0,{array:array,index:index,count:count,subscriber:subscriber})}else{for(var i=0;i<count&&!subscriber.isUnsubscribed;i++){subscriber.next(array[i])}subscriber.complete()}};return ArrayObservable}(Observable_1.Observable);exports.ArrayObservable=ArrayObservable},{"../Observable":226,"../util/isScheduler":345,"./EmptyObservable":277,"./ScalarObservable":284}],276:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subject_1=require("../Subject");var Observable_1=require("../Observable");var Subscriber_1=require("../Subscriber");var Subscription_1=require("../Subscription");var ConnectableObservable=function(_super){__extends(ConnectableObservable,_super);function ConnectableObservable(source,subjectFactory){_super.call(this);this.source=source;this.subjectFactory=subjectFactory;this._refCount=0}ConnectableObservable.prototype._subscribe=function(subscriber){return this.getSubject().subscribe(subscriber)};ConnectableObservable.prototype.getSubject=function(){var subject=this._subject;if(!subject||subject.isStopped){this._subject=this.subjectFactory()}return this._subject};ConnectableObservable.prototype.connect=function(){var connection=this._connection;if(!connection){connection=this._connection=new Subscription_1.Subscription;connection.add(this.source.subscribe(new ConnectableSubscriber(this.getSubject(),this)));if(connection.isUnsubscribed){this._connection=null;connection=Subscription_1.Subscription.EMPTY}else{this._connection=connection}}return connection};ConnectableObservable.prototype.refCount=function(){return this.lift(new RefCountOperator(this))};return ConnectableObservable}(Observable_1.Observable);exports.ConnectableObservable=ConnectableObservable;var ConnectableSubscriber=function(_super){__extends(ConnectableSubscriber,_super);function ConnectableSubscriber(destination,connectable){_super.call(this,destination);this.connectable=connectable}ConnectableSubscriber.prototype._error=function(err){this._unsubscribe();_super.prototype._error.call(this,err)};ConnectableSubscriber.prototype._complete=function(){this._unsubscribe();_super.prototype._complete.call(this)};ConnectableSubscriber.prototype._unsubscribe=function(){var connectable=this.connectable;if(connectable){this.connectable=null;var connection=connectable._connection;connectable._refCount=0;connectable._subject=null;connectable._connection=null;if(connection){connection.unsubscribe()}}};return ConnectableSubscriber}(Subject_1.SubjectSubscriber);var RefCountOperator=function(){function RefCountOperator(connectable){this.connectable=connectable}RefCountOperator.prototype.call=function(subscriber,source){var connectable=this.connectable;connectable._refCount++;var refCounter=new RefCountSubscriber(subscriber,connectable);var subscription=source._subscribe(refCounter);if(!refCounter.isUnsubscribed){refCounter.connection=connectable.connect()}return subscription};return RefCountOperator}();var RefCountSubscriber=function(_super){__extends(RefCountSubscriber,_super);function RefCountSubscriber(destination,connectable){_super.call(this,destination);this.connectable=connectable}RefCountSubscriber.prototype._unsubscribe=function(){var connectable=this.connectable;if(!connectable){this.connection=null;return}this.connectable=null;var refCount=connectable._refCount;if(refCount<=0){this.connection=null;return}connectable._refCount=refCount-1;if(refCount>1){this.connection=null;return}var connection=this.connection;var sharedConnection=connectable._connection;this.connection=null;if(sharedConnection&&(!connection||sharedConnection===connection)){sharedConnection.unsubscribe()}};return RefCountSubscriber}(Subscriber_1.Subscriber)},{"../Observable":226,"../Subject":230,"../Subscriber":232,"../Subscription":233}],277:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("../Observable");var EmptyObservable=function(_super){__extends(EmptyObservable,_super);function EmptyObservable(scheduler){_super.call(this);this.scheduler=scheduler}EmptyObservable.create=function(scheduler){return new EmptyObservable(scheduler)};EmptyObservable.dispatch=function(arg){var subscriber=arg.subscriber;subscriber.complete()};EmptyObservable.prototype._subscribe=function(subscriber){var scheduler=this.scheduler;if(scheduler){return scheduler.schedule(EmptyObservable.dispatch,0,{subscriber:subscriber})}else{subscriber.complete()}};return EmptyObservable}(Observable_1.Observable);exports.EmptyObservable=EmptyObservable},{"../Observable":226}],278:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("../Observable");var ErrorObservable=function(_super){__extends(ErrorObservable,_super);function ErrorObservable(error,scheduler){_super.call(this);this.error=error;this.scheduler=scheduler}ErrorObservable.create=function(error,scheduler){return new ErrorObservable(error,scheduler)};ErrorObservable.dispatch=function(arg){var error=arg.error,subscriber=arg.subscriber;subscriber.error(error)};ErrorObservable.prototype._subscribe=function(subscriber){var error=this.error;var scheduler=this.scheduler;if(scheduler){return scheduler.schedule(ErrorObservable.dispatch,0,{error:error,subscriber:subscriber})}else{subscriber.error(error)}};return ErrorObservable}(Observable_1.Observable);exports.ErrorObservable=ErrorObservable},{"../Observable":226}],279:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("../Observable");var tryCatch_1=require("../util/tryCatch");var errorObject_1=require("../util/errorObject");var Subscription_1=require("../Subscription");function isNodeStyleEventEmmitter(sourceObj){return!!sourceObj&&typeof sourceObj.addListener==="function"&&typeof sourceObj.removeListener==="function"}function isJQueryStyleEventEmitter(sourceObj){return!!sourceObj&&typeof sourceObj.on==="function"&&typeof sourceObj.off==="function"}function isNodeList(sourceObj){return!!sourceObj&&sourceObj.toString()==="[object NodeList]"}function isHTMLCollection(sourceObj){return!!sourceObj&&sourceObj.toString()==="[object HTMLCollection]"}function isEventTarget(sourceObj){return!!sourceObj&&typeof sourceObj.addEventListener==="function"&&typeof sourceObj.removeEventListener==="function"}var FromEventObservable=function(_super){__extends(FromEventObservable,_super);function FromEventObservable(sourceObj,eventName,selector){_super.call(this);this.sourceObj=sourceObj;this.eventName=eventName;this.selector=selector}FromEventObservable.create=function(target,eventName,selector){return new FromEventObservable(target,eventName,selector)};FromEventObservable.setupSubscription=function(sourceObj,eventName,handler,subscriber){var unsubscribe;if(isNodeList(sourceObj)||isHTMLCollection(sourceObj)){for(var i=0,len=sourceObj.length;i<len;i++){FromEventObservable.setupSubscription(sourceObj[i],eventName,handler,subscriber)}}else if(isEventTarget(sourceObj)){var source_1=sourceObj;sourceObj.addEventListener(eventName,handler);unsubscribe=function(){return source_1.removeEventListener(eventName,handler)}}else if(isJQueryStyleEventEmitter(sourceObj)){var source_2=sourceObj;sourceObj.on(eventName,handler);unsubscribe=function(){return source_2.off(eventName,handler)}}else if(isNodeStyleEventEmmitter(sourceObj)){var source_3=sourceObj;sourceObj.addListener(eventName,handler);unsubscribe=function(){return source_3.removeListener(eventName,handler)}}subscriber.add(new Subscription_1.Subscription(unsubscribe))};FromEventObservable.prototype._subscribe=function(subscriber){var sourceObj=this.sourceObj;var eventName=this.eventName;var selector=this.selector;var handler=selector?function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i-0]=arguments[_i]}var result=tryCatch_1.tryCatch(selector).apply(void 0,args);if(result===errorObject_1.errorObject){subscriber.error(errorObject_1.errorObject.e)}else{subscriber.next(result)}}:function(e){return subscriber.next(e)};FromEventObservable.setupSubscription(sourceObj,eventName,handler,subscriber)};return FromEventObservable}(Observable_1.Observable);exports.FromEventObservable=FromEventObservable},{"../Observable":226,"../Subscription":233,"../util/errorObject":339,"../util/tryCatch":350}],280:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var isArray_1=require("../util/isArray");var isFunction_1=require("../util/isFunction");var isPromise_1=require("../util/isPromise");var isScheduler_1=require("../util/isScheduler");var PromiseObservable_1=require("./PromiseObservable");var IteratorObservable_1=require("./IteratorObservable");var ArrayObservable_1=require("./ArrayObservable");var ArrayLikeObservable_1=require("./ArrayLikeObservable");var iterator_1=require("../symbol/iterator");var Observable_1=require("../Observable");var observeOn_1=require("../operator/observeOn");var symbol_observable_1=require("symbol-observable");var isArrayLike=function(x){return x&&typeof x.length==="number"};var FromObservable=function(_super){__extends(FromObservable,_super);function FromObservable(ish,scheduler){_super.call(this,null);this.ish=ish;this.scheduler=scheduler}FromObservable.create=function(ish,mapFnOrScheduler,thisArg,lastScheduler){var scheduler=null;var mapFn=null;if(isFunction_1.isFunction(mapFnOrScheduler)){scheduler=lastScheduler||null;mapFn=mapFnOrScheduler}else if(isScheduler_1.isScheduler(scheduler)){scheduler=mapFnOrScheduler}if(ish!=null){if(typeof ish[symbol_observable_1.default]==="function"){if(ish instanceof Observable_1.Observable&&!scheduler){return ish}return new FromObservable(ish,scheduler)}else if(isArray_1.isArray(ish)){return new ArrayObservable_1.ArrayObservable(ish,scheduler)}else if(isPromise_1.isPromise(ish)){return new PromiseObservable_1.PromiseObservable(ish,scheduler)}else if(typeof ish[iterator_1.$$iterator]==="function"||typeof ish==="string"){return new IteratorObservable_1.IteratorObservable(ish,null,null,scheduler)}else if(isArrayLike(ish)){return new ArrayLikeObservable_1.ArrayLikeObservable(ish,mapFn,thisArg,scheduler)}}throw new TypeError((ish!==null&&typeof ish||ish)+" is not observable")};FromObservable.prototype._subscribe=function(subscriber){var ish=this.ish;var scheduler=this.scheduler;if(scheduler==null){return ish[symbol_observable_1.default]().subscribe(subscriber)}else{return ish[symbol_observable_1.default]().subscribe(new observeOn_1.ObserveOnSubscriber(subscriber,scheduler,0))}};return FromObservable}(Observable_1.Observable);exports.FromObservable=FromObservable},{"../Observable":226,"../operator/observeOn":311,"../symbol/iterator":333,"../util/isArray":340,"../util/isFunction":342,"../util/isPromise":344,"../util/isScheduler":345,"./ArrayLikeObservable":274,"./ArrayObservable":275,"./IteratorObservable":281,"./PromiseObservable":283,"symbol-observable":351}],281:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var root_1=require("../util/root");var isObject_1=require("../util/isObject");var tryCatch_1=require("../util/tryCatch");var Observable_1=require("../Observable");var isFunction_1=require("../util/isFunction");var iterator_1=require("../symbol/iterator");var errorObject_1=require("../util/errorObject");var IteratorObservable=function(_super){__extends(IteratorObservable,_super);function IteratorObservable(iterator,project,thisArg,scheduler){_super.call(this);if(iterator==null){throw new Error("iterator cannot be null.")}if(isObject_1.isObject(project)){this.thisArg=project;this.scheduler=thisArg}else if(isFunction_1.isFunction(project)){this.project=project;this.thisArg=thisArg;this.scheduler=scheduler}else if(project!=null){throw new Error("When provided, `project` must be a function.")}this.iterator=getIterator(iterator)}IteratorObservable.create=function(iterator,project,thisArg,scheduler){return new IteratorObservable(iterator,project,thisArg,scheduler)};IteratorObservable.dispatch=function(state){var index=state.index,hasError=state.hasError,thisArg=state.thisArg,project=state.project,iterator=state.iterator,subscriber=state.subscriber;if(hasError){subscriber.error(state.error);return}var result=iterator.next();if(result.done){subscriber.complete();return}if(project){result=tryCatch_1.tryCatch(project).call(thisArg,result.value,index);if(result===errorObject_1.errorObject){state.error=errorObject_1.errorObject.e;state.hasError=true}else{subscriber.next(result);state.index=index+1}}else{subscriber.next(result.value);state.index=index+1}if(subscriber.isUnsubscribed){return}this.schedule(state)};IteratorObservable.prototype._subscribe=function(subscriber){var index=0;var _a=this,iterator=_a.iterator,project=_a.project,thisArg=_a.thisArg,scheduler=_a.scheduler;if(scheduler){return scheduler.schedule(IteratorObservable.dispatch,0,{index:index,thisArg:thisArg,project:project,iterator:iterator,subscriber:subscriber})}else{do{var result=iterator.next();if(result.done){subscriber.complete();break}else if(project){result=tryCatch_1.tryCatch(project).call(thisArg,result.value,index++);if(result===errorObject_1.errorObject){subscriber.error(errorObject_1.errorObject.e);break}subscriber.next(result)}else{subscriber.next(result.value)}if(subscriber.isUnsubscribed){break}}while(true)}};return IteratorObservable}(Observable_1.Observable);exports.IteratorObservable=IteratorObservable;var StringIterator=function(){function StringIterator(str,idx,len){if(idx===void 0){idx=0}if(len===void 0){len=str.length}this.str=str;this.idx=idx;this.len=len}StringIterator.prototype[iterator_1.$$iterator]=function(){return this};StringIterator.prototype.next=function(){return this.idx<this.len?{done:false,value:this.str.charAt(this.idx++)}:{done:true,value:undefined}};return StringIterator}();var ArrayIterator=function(){function ArrayIterator(arr,idx,len){if(idx===void 0){idx=0}if(len===void 0){len=toLength(arr)}this.arr=arr;this.idx=idx;this.len=len}ArrayIterator.prototype[iterator_1.$$iterator]=function(){return this};ArrayIterator.prototype.next=function(){return this.idx<this.len?{done:false,value:this.arr[this.idx++]}:{done:true,value:undefined}};return ArrayIterator}();function getIterator(obj){var i=obj[iterator_1.$$iterator];if(!i&&typeof obj==="string"){return new StringIterator(obj)}if(!i&&obj.length!==undefined){return new ArrayIterator(obj)}if(!i){throw new TypeError("Object is not iterable")}return obj[iterator_1.$$iterator]()}var maxSafeInteger=Math.pow(2,53)-1;function toLength(o){var len=+o.length;if(isNaN(len)){return 0}if(len===0||!numberIsFinite(len)){return len}len=sign(len)*Math.floor(Math.abs(len));if(len<=0){return 0}if(len>maxSafeInteger){return maxSafeInteger}return len}function numberIsFinite(value){return typeof value==="number"&&root_1.root.isFinite(value)}function sign(value){var valueAsNumber=+value;if(valueAsNumber===0){return valueAsNumber}if(isNaN(valueAsNumber)){return valueAsNumber}return valueAsNumber<0?-1:1}},{"../Observable":226,"../symbol/iterator":333,"../util/errorObject":339,"../util/isFunction":342,"../util/isObject":343,"../util/root":346,"../util/tryCatch":350}],282:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("../Observable");var ConnectableObservable_1=require("../observable/ConnectableObservable");var MulticastObservable=function(_super){__extends(MulticastObservable,_super);function MulticastObservable(source,subjectFactory,selector){_super.call(this);this.source=source;this.subjectFactory=subjectFactory;this.selector=selector}MulticastObservable.prototype._subscribe=function(subscriber){var _a=this,selector=_a.selector,source=_a.source;var connectable=new ConnectableObservable_1.ConnectableObservable(source,this.subjectFactory);var subscription=selector(connectable).subscribe(subscriber);subscription.add(connectable.connect());return subscription};return MulticastObservable}(Observable_1.Observable);exports.MulticastObservable=MulticastObservable},{"../Observable":226,"../observable/ConnectableObservable":276}],283:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var root_1=require("../util/root");var Observable_1=require("../Observable");var PromiseObservable=function(_super){__extends(PromiseObservable,_super);function PromiseObservable(promise,scheduler){if(scheduler===void 0){scheduler=null}_super.call(this);this.promise=promise;this.scheduler=scheduler}PromiseObservable.create=function(promise,scheduler){if(scheduler===void 0){scheduler=null}return new PromiseObservable(promise,scheduler)};PromiseObservable.prototype._subscribe=function(subscriber){var _this=this;var promise=this.promise;var scheduler=this.scheduler;if(scheduler==null){if(this._isScalar){if(!subscriber.isUnsubscribed){subscriber.next(this.value);subscriber.complete()}}else{promise.then(function(value){_this.value=value;_this._isScalar=true;if(!subscriber.isUnsubscribed){subscriber.next(value);subscriber.complete()}},function(err){if(!subscriber.isUnsubscribed){subscriber.error(err)}}).then(null,function(err){root_1.root.setTimeout(function(){throw err})})}}else{if(this._isScalar){if(!subscriber.isUnsubscribed){return scheduler.schedule(dispatchNext,0,{value:this.value,subscriber:subscriber})}}else{promise.then(function(value){_this.value=value;_this._isScalar=true;if(!subscriber.isUnsubscribed){subscriber.add(scheduler.schedule(dispatchNext,0,{value:value,subscriber:subscriber}))}},function(err){if(!subscriber.isUnsubscribed){subscriber.add(scheduler.schedule(dispatchError,0,{err:err,subscriber:subscriber}))}}).then(null,function(err){root_1.root.setTimeout(function(){throw err})})}}};return PromiseObservable}(Observable_1.Observable);exports.PromiseObservable=PromiseObservable;function dispatchNext(arg){var value=arg.value,subscriber=arg.subscriber;if(!subscriber.isUnsubscribed){subscriber.next(value);subscriber.complete()}}function dispatchError(arg){var err=arg.err,subscriber=arg.subscriber;if(!subscriber.isUnsubscribed){subscriber.error(err)}}},{"../Observable":226,"../util/root":346}],284:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("../Observable");var ScalarObservable=function(_super){__extends(ScalarObservable,_super);function ScalarObservable(value,scheduler){_super.call(this);this.value=value;this.scheduler=scheduler;this._isScalar=true;if(scheduler){this._isScalar=false}}ScalarObservable.create=function(value,scheduler){return new ScalarObservable(value,scheduler)};ScalarObservable.dispatch=function(state){var done=state.done,value=state.value,subscriber=state.subscriber;if(done){subscriber.complete();return}subscriber.next(value);if(subscriber.isUnsubscribed){return}state.done=true;this.schedule(state)};ScalarObservable.prototype._subscribe=function(subscriber){var value=this.value;var scheduler=this.scheduler;if(scheduler){return scheduler.schedule(ScalarObservable.dispatch,0,{done:false,value:value,subscriber:subscriber})}else{subscriber.next(value);if(!subscriber.isUnsubscribed){subscriber.complete()}}};return ScalarObservable}(Observable_1.Observable);exports.ScalarObservable=ScalarObservable},{"../Observable":226}],285:[function(require,module,exports){"use strict";var isScheduler_1=require("../util/isScheduler");var isArray_1=require("../util/isArray");var ArrayObservable_1=require("./ArrayObservable");var combineLatest_1=require("../operator/combineLatest");function combineLatest(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}var project=null;var scheduler=null;if(isScheduler_1.isScheduler(observables[observables.length-1])){scheduler=observables.pop()}if(typeof observables[observables.length-1]==="function"){project=observables.pop()}if(observables.length===1&&isArray_1.isArray(observables[0])){observables=observables[0]}return new ArrayObservable_1.ArrayObservable(observables,scheduler).lift(new combineLatest_1.CombineLatestOperator(project))}exports.combineLatest=combineLatest},{"../operator/combineLatest":295,"../util/isArray":340,"../util/isScheduler":345,"./ArrayObservable":275}],286:[function(require,module,exports){"use strict";var EmptyObservable_1=require("./EmptyObservable");exports.empty=EmptyObservable_1.EmptyObservable.create},{"./EmptyObservable":277}],287:[function(require,module,exports){"use strict";var FromObservable_1=require("./FromObservable");exports.from=FromObservable_1.FromObservable.create},{"./FromObservable":280}],288:[function(require,module,exports){"use strict";var FromEventObservable_1=require("./FromEventObservable");exports.fromEvent=FromEventObservable_1.FromEventObservable.create},{"./FromEventObservable":279}],289:[function(require,module,exports){"use strict";var PromiseObservable_1=require("./PromiseObservable");exports.fromPromise=PromiseObservable_1.PromiseObservable.create},{"./PromiseObservable":283}],290:[function(require,module,exports){"use strict";var merge_1=require("../operator/merge");exports.merge=merge_1.mergeStatic},{"../operator/merge":307}],291:[function(require,module,exports){"use strict";var ArrayObservable_1=require("./ArrayObservable");exports.of=ArrayObservable_1.ArrayObservable.of},{"./ArrayObservable":275}],292:[function(require,module,exports){"use strict";var ErrorObservable_1=require("./ErrorObservable");exports._throw=ErrorObservable_1.ErrorObservable.create},{"./ErrorObservable":278}],293:[function(require,module,exports){"use strict";var zip_1=require("../operator/zip");exports.zip=zip_1.zipStatic},{"../operator/zip":326}],294:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function buffer(closingNotifier){return this.lift(new BufferOperator(closingNotifier))}exports.buffer=buffer;var BufferOperator=function(){function BufferOperator(closingNotifier){this.closingNotifier=closingNotifier}BufferOperator.prototype.call=function(subscriber,source){return source._subscribe(new BufferSubscriber(subscriber,this.closingNotifier))};return BufferOperator}();var BufferSubscriber=function(_super){__extends(BufferSubscriber,_super);function BufferSubscriber(destination,closingNotifier){_super.call(this,destination);this.buffer=[];this.add(subscribeToResult_1.subscribeToResult(this,closingNotifier))}BufferSubscriber.prototype._next=function(value){this.buffer.push(value)};BufferSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){var buffer=this.buffer;this.buffer=[];this.destination.next(buffer)};return BufferSubscriber}(OuterSubscriber_1.OuterSubscriber)},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],295:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var ArrayObservable_1=require("../observable/ArrayObservable");var isArray_1=require("../util/isArray");var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");var none={};function combineLatest(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}var project=null;if(typeof observables[observables.length-1]==="function"){project=observables.pop()}if(observables.length===1&&isArray_1.isArray(observables[0])){observables=observables[0]}observables.unshift(this);return new ArrayObservable_1.ArrayObservable(observables).lift(new CombineLatestOperator(project))}exports.combineLatest=combineLatest;var CombineLatestOperator=function(){function CombineLatestOperator(project){this.project=project}CombineLatestOperator.prototype.call=function(subscriber,source){return source._subscribe(new CombineLatestSubscriber(subscriber,this.project));
};return CombineLatestOperator}();exports.CombineLatestOperator=CombineLatestOperator;var CombineLatestSubscriber=function(_super){__extends(CombineLatestSubscriber,_super);function CombineLatestSubscriber(destination,project){_super.call(this,destination);this.project=project;this.active=0;this.values=[];this.observables=[]}CombineLatestSubscriber.prototype._next=function(observable){this.values.push(none);this.observables.push(observable)};CombineLatestSubscriber.prototype._complete=function(){var observables=this.observables;var len=observables.length;if(len===0){this.destination.complete()}else{this.active=len;this.toRespond=len;for(var i=0;i<len;i++){var observable=observables[i];this.add(subscribeToResult_1.subscribeToResult(this,observable,observable,i))}}};CombineLatestSubscriber.prototype.notifyComplete=function(unused){if((this.active-=1)===0){this.destination.complete()}};CombineLatestSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){var values=this.values;var oldVal=values[outerIndex];var toRespond=!this.toRespond?0:oldVal===none?--this.toRespond:this.toRespond;values[outerIndex]=innerValue;if(toRespond===0){if(this.project){this._tryProject(values)}else{this.destination.next(values)}}};CombineLatestSubscriber.prototype._tryProject=function(values){var result;try{result=this.project.apply(this,values)}catch(err){this.destination.error(err);return}this.destination.next(result)};return CombineLatestSubscriber}(OuterSubscriber_1.OuterSubscriber);exports.CombineLatestSubscriber=CombineLatestSubscriber},{"../OuterSubscriber":228,"../observable/ArrayObservable":275,"../util/isArray":340,"../util/subscribeToResult":347}],296:[function(require,module,exports){"use strict";var isScheduler_1=require("../util/isScheduler");var ArrayObservable_1=require("../observable/ArrayObservable");var mergeAll_1=require("./mergeAll");function concat(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}return concatStatic.apply(void 0,[this].concat(observables))}exports.concat=concat;function concatStatic(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}var scheduler=null;var args=observables;if(isScheduler_1.isScheduler(args[observables.length-1])){scheduler=args.pop()}return new ArrayObservable_1.ArrayObservable(observables,scheduler).lift(new mergeAll_1.MergeAllOperator(1))}exports.concatStatic=concatStatic},{"../observable/ArrayObservable":275,"../util/isScheduler":345,"./mergeAll":308}],297:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");var async_1=require("../scheduler/async");function debounceTime(dueTime,scheduler){if(scheduler===void 0){scheduler=async_1.async}return this.lift(new DebounceTimeOperator(dueTime,scheduler))}exports.debounceTime=debounceTime;var DebounceTimeOperator=function(){function DebounceTimeOperator(dueTime,scheduler){this.dueTime=dueTime;this.scheduler=scheduler}DebounceTimeOperator.prototype.call=function(subscriber,source){return source._subscribe(new DebounceTimeSubscriber(subscriber,this.dueTime,this.scheduler))};return DebounceTimeOperator}();var DebounceTimeSubscriber=function(_super){__extends(DebounceTimeSubscriber,_super);function DebounceTimeSubscriber(destination,dueTime,scheduler){_super.call(this,destination);this.dueTime=dueTime;this.scheduler=scheduler;this.debouncedSubscription=null;this.lastValue=null;this.hasValue=false}DebounceTimeSubscriber.prototype._next=function(value){this.clearDebounce();this.lastValue=value;this.hasValue=true;this.add(this.debouncedSubscription=this.scheduler.schedule(dispatchNext,this.dueTime,this))};DebounceTimeSubscriber.prototype._complete=function(){this.debouncedNext();this.destination.complete()};DebounceTimeSubscriber.prototype.debouncedNext=function(){this.clearDebounce();if(this.hasValue){this.destination.next(this.lastValue);this.lastValue=null;this.hasValue=false}};DebounceTimeSubscriber.prototype.clearDebounce=function(){var debouncedSubscription=this.debouncedSubscription;if(debouncedSubscription!==null){this.remove(debouncedSubscription);debouncedSubscription.unsubscribe();this.debouncedSubscription=null}};return DebounceTimeSubscriber}(Subscriber_1.Subscriber);function dispatchNext(subscriber){subscriber.debouncedNext()}},{"../Subscriber":232,"../scheduler/async":331}],298:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var async_1=require("../scheduler/async");var isDate_1=require("../util/isDate");var Subscriber_1=require("../Subscriber");var Notification_1=require("../Notification");function delay(delay,scheduler){if(scheduler===void 0){scheduler=async_1.async}var absoluteDelay=isDate_1.isDate(delay);var delayFor=absoluteDelay?+delay-scheduler.now():Math.abs(delay);return this.lift(new DelayOperator(delayFor,scheduler))}exports.delay=delay;var DelayOperator=function(){function DelayOperator(delay,scheduler){this.delay=delay;this.scheduler=scheduler}DelayOperator.prototype.call=function(subscriber,source){return source._subscribe(new DelaySubscriber(subscriber,this.delay,this.scheduler))};return DelayOperator}();var DelaySubscriber=function(_super){__extends(DelaySubscriber,_super);function DelaySubscriber(destination,delay,scheduler){_super.call(this,destination);this.delay=delay;this.scheduler=scheduler;this.queue=[];this.active=false;this.errored=false}DelaySubscriber.dispatch=function(state){var source=state.source;var queue=source.queue;var scheduler=state.scheduler;var destination=state.destination;while(queue.length>0&&queue[0].time-scheduler.now()<=0){queue.shift().notification.observe(destination)}if(queue.length>0){var delay_1=Math.max(0,queue[0].time-scheduler.now());this.schedule(state,delay_1)}else{source.active=false}};DelaySubscriber.prototype._schedule=function(scheduler){this.active=true;this.add(scheduler.schedule(DelaySubscriber.dispatch,this.delay,{source:this,destination:this.destination,scheduler:scheduler}))};DelaySubscriber.prototype.scheduleNotification=function(notification){if(this.errored===true){return}var scheduler=this.scheduler;var message=new DelayMessage(scheduler.now()+this.delay,notification);this.queue.push(message);if(this.active===false){this._schedule(scheduler)}};DelaySubscriber.prototype._next=function(value){this.scheduleNotification(Notification_1.Notification.createNext(value))};DelaySubscriber.prototype._error=function(err){this.errored=true;this.queue=[];this.destination.error(err)};DelaySubscriber.prototype._complete=function(){this.scheduleNotification(Notification_1.Notification.createComplete())};return DelaySubscriber}(Subscriber_1.Subscriber);var DelayMessage=function(){function DelayMessage(time,notification){this.time=time;this.notification=notification}return DelayMessage}()},{"../Notification":225,"../Subscriber":232,"../scheduler/async":331,"../util/isDate":341}],299:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function distinct(compare,flushes){return this.lift(new DistinctOperator(compare,flushes))}exports.distinct=distinct;var DistinctOperator=function(){function DistinctOperator(compare,flushes){this.compare=compare;this.flushes=flushes}DistinctOperator.prototype.call=function(subscriber,source){return source._subscribe(new DistinctSubscriber(subscriber,this.compare,this.flushes))};return DistinctOperator}();var DistinctSubscriber=function(_super){__extends(DistinctSubscriber,_super);function DistinctSubscriber(destination,compare,flushes){_super.call(this,destination);this.values=[];if(typeof compare==="function"){this.compare=compare}if(flushes){this.add(subscribeToResult_1.subscribeToResult(this,flushes))}}DistinctSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this.values.length=0};DistinctSubscriber.prototype.notifyError=function(error,innerSub){this._error(error)};DistinctSubscriber.prototype._next=function(value){var found=false;var values=this.values;var len=values.length;try{for(var i=0;i<len;i++){if(this.compare(values[i],value)){found=true;return}}}catch(err){this.destination.error(err);return}this.values.push(value);this.destination.next(value)};DistinctSubscriber.prototype.compare=function(x,y){return x===y};return DistinctSubscriber}(OuterSubscriber_1.OuterSubscriber);exports.DistinctSubscriber=DistinctSubscriber},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],300:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");var tryCatch_1=require("../util/tryCatch");var errorObject_1=require("../util/errorObject");function distinctUntilChanged(compare,keySelector){return this.lift(new DistinctUntilChangedOperator(compare,keySelector))}exports.distinctUntilChanged=distinctUntilChanged;var DistinctUntilChangedOperator=function(){function DistinctUntilChangedOperator(compare,keySelector){this.compare=compare;this.keySelector=keySelector}DistinctUntilChangedOperator.prototype.call=function(subscriber,source){return source._subscribe(new DistinctUntilChangedSubscriber(subscriber,this.compare,this.keySelector))};return DistinctUntilChangedOperator}();var DistinctUntilChangedSubscriber=function(_super){__extends(DistinctUntilChangedSubscriber,_super);function DistinctUntilChangedSubscriber(destination,compare,keySelector){_super.call(this,destination);this.keySelector=keySelector;this.hasKey=false;if(typeof compare==="function"){this.compare=compare}}DistinctUntilChangedSubscriber.prototype.compare=function(x,y){return x===y};DistinctUntilChangedSubscriber.prototype._next=function(value){var keySelector=this.keySelector;var key=value;if(keySelector){key=tryCatch_1.tryCatch(this.keySelector)(value);if(key===errorObject_1.errorObject){return this.destination.error(errorObject_1.errorObject.e)}}var result=false;if(this.hasKey){result=tryCatch_1.tryCatch(this.compare)(this.key,key);if(result===errorObject_1.errorObject){return this.destination.error(errorObject_1.errorObject.e)}}else{this.hasKey=true}if(Boolean(result)===false){this.key=key;this.destination.next(value)}};return DistinctUntilChangedSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232,"../util/errorObject":339,"../util/tryCatch":350}],301:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");function _do(nextOrObserver,error,complete){return this.lift(new DoOperator(nextOrObserver,error,complete))}exports._do=_do;var DoOperator=function(){function DoOperator(nextOrObserver,error,complete){this.nextOrObserver=nextOrObserver;this.error=error;this.complete=complete}DoOperator.prototype.call=function(subscriber,source){return source._subscribe(new DoSubscriber(subscriber,this.nextOrObserver,this.error,this.complete))};return DoOperator}();var DoSubscriber=function(_super){__extends(DoSubscriber,_super);function DoSubscriber(destination,nextOrObserver,error,complete){_super.call(this,destination);var safeSubscriber=new Subscriber_1.Subscriber(nextOrObserver,error,complete);safeSubscriber.syncErrorThrowable=true;this.add(safeSubscriber);this.safeSubscriber=safeSubscriber}DoSubscriber.prototype._next=function(value){var safeSubscriber=this.safeSubscriber;safeSubscriber.next(value);if(safeSubscriber.syncErrorThrown){this.destination.error(safeSubscriber.syncErrorValue)}else{this.destination.next(value)}};DoSubscriber.prototype._error=function(err){var safeSubscriber=this.safeSubscriber;safeSubscriber.error(err);if(safeSubscriber.syncErrorThrown){this.destination.error(safeSubscriber.syncErrorValue)}else{this.destination.error(err)}};DoSubscriber.prototype._complete=function(){var safeSubscriber=this.safeSubscriber;safeSubscriber.complete();if(safeSubscriber.syncErrorThrown){this.destination.error(safeSubscriber.syncErrorValue)}else{this.destination.complete()}};return DoSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232}],302:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var tryCatch_1=require("../util/tryCatch");var errorObject_1=require("../util/errorObject");var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function expand(project,concurrent,scheduler){if(concurrent===void 0){concurrent=Number.POSITIVE_INFINITY}if(scheduler===void 0){scheduler=undefined}concurrent=(concurrent||0)<1?Number.POSITIVE_INFINITY:concurrent;return this.lift(new ExpandOperator(project,concurrent,scheduler))}exports.expand=expand;var ExpandOperator=function(){function ExpandOperator(project,concurrent,scheduler){this.project=project;this.concurrent=concurrent;this.scheduler=scheduler}ExpandOperator.prototype.call=function(subscriber,source){return source._subscribe(new ExpandSubscriber(subscriber,this.project,this.concurrent,this.scheduler))};return ExpandOperator}();exports.ExpandOperator=ExpandOperator;var ExpandSubscriber=function(_super){__extends(ExpandSubscriber,_super);function ExpandSubscriber(destination,project,concurrent,scheduler){_super.call(this,destination);this.project=project;this.concurrent=concurrent;this.scheduler=scheduler;this.index=0;this.active=0;this.hasCompleted=false;if(concurrent<Number.POSITIVE_INFINITY){this.buffer=[]}}ExpandSubscriber.dispatch=function(arg){var subscriber=arg.subscriber,result=arg.result,value=arg.value,index=arg.index;subscriber.subscribeToProjection(result,value,index)};ExpandSubscriber.prototype._next=function(value){var destination=this.destination;if(destination.isUnsubscribed){this._complete();return}var index=this.index++;if(this.active<this.concurrent){destination.next(value);var result=tryCatch_1.tryCatch(this.project)(value,index);if(result===errorObject_1.errorObject){destination.error(errorObject_1.errorObject.e)}else if(!this.scheduler){this.subscribeToProjection(result,value,index)}else{var state={subscriber:this,result:result,value:value,index:index};this.add(this.scheduler.schedule(ExpandSubscriber.dispatch,0,state))}}else{this.buffer.push(value)}};ExpandSubscriber.prototype.subscribeToProjection=function(result,value,index){this.active++;this.add(subscribeToResult_1.subscribeToResult(this,result,value,index))};ExpandSubscriber.prototype._complete=function(){this.hasCompleted=true;if(this.hasCompleted&&this.active===0){this.destination.complete()}};ExpandSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this._next(innerValue)};ExpandSubscriber.prototype.notifyComplete=function(innerSub){var buffer=this.buffer;this.remove(innerSub);this.active--;if(buffer&&buffer.length>0){this._next(buffer.shift())}if(this.hasCompleted&&this.active===0){this.destination.complete()}};return ExpandSubscriber}(OuterSubscriber_1.OuterSubscriber);exports.ExpandSubscriber=ExpandSubscriber},{"../OuterSubscriber":228,"../util/errorObject":339,"../util/subscribeToResult":347,"../util/tryCatch":350}],303:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");function filter(predicate,thisArg){return this.lift(new FilterOperator(predicate,thisArg))}exports.filter=filter;var FilterOperator=function(){function FilterOperator(predicate,thisArg){this.predicate=predicate;this.thisArg=thisArg}FilterOperator.prototype.call=function(subscriber,source){return source._subscribe(new FilterSubscriber(subscriber,this.predicate,this.thisArg))};return FilterOperator}();var FilterSubscriber=function(_super){__extends(FilterSubscriber,_super);function FilterSubscriber(destination,predicate,thisArg){_super.call(this,destination);this.predicate=predicate;this.thisArg=thisArg;this.count=0;this.predicate=predicate}FilterSubscriber.prototype._next=function(value){var result;try{result=this.predicate.call(this.thisArg,value,this.count++)}catch(err){this.destination.error(err);return}if(result){this.destination.next(value)}};return FilterSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232}],304:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");var Subscription_1=require("../Subscription");function _finally(callback){return this.lift(new FinallyOperator(callback))}exports._finally=_finally;var FinallyOperator=function(){function FinallyOperator(callback){this.callback=callback}FinallyOperator.prototype.call=function(subscriber,source){return source._subscribe(new FinallySubscriber(subscriber,this.callback))};return FinallyOperator}();var FinallySubscriber=function(_super){__extends(FinallySubscriber,_super);function FinallySubscriber(destination,callback){_super.call(this,destination);this.add(new Subscription_1.Subscription(callback))}return FinallySubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232,"../Subscription":233}],305:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");var EmptyError_1=require("../util/EmptyError");function first(predicate,resultSelector,defaultValue){return this.lift(new FirstOperator(predicate,resultSelector,defaultValue,this))}exports.first=first;var FirstOperator=function(){function FirstOperator(predicate,resultSelector,defaultValue,source){this.predicate=predicate;this.resultSelector=resultSelector;this.defaultValue=defaultValue;this.source=source}FirstOperator.prototype.call=function(observer,source){return source._subscribe(new FirstSubscriber(observer,this.predicate,this.resultSelector,this.defaultValue,this.source))};return FirstOperator}();var FirstSubscriber=function(_super){__extends(FirstSubscriber,_super);function FirstSubscriber(destination,predicate,resultSelector,defaultValue,source){_super.call(this,destination);this.predicate=predicate;this.resultSelector=resultSelector;this.defaultValue=defaultValue;this.source=source;this.index=0;this.hasCompleted=false}FirstSubscriber.prototype._next=function(value){var index=this.index++;if(this.predicate){this._tryPredicate(value,index)}else{this._emit(value,index)}};FirstSubscriber.prototype._tryPredicate=function(value,index){var result;try{result=this.predicate(value,index,this.source)}catch(err){this.destination.error(err);return}if(result){this._emit(value,index)}};FirstSubscriber.prototype._emit=function(value,index){if(this.resultSelector){this._tryResultSelector(value,index);return}this._emitFinal(value)};FirstSubscriber.prototype._tryResultSelector=function(value,index){var result;try{result=this.resultSelector(value,index)}catch(err){this.destination.error(err);return}this._emitFinal(result)};FirstSubscriber.prototype._emitFinal=function(value){var destination=this.destination;destination.next(value);destination.complete();this.hasCompleted=true};FirstSubscriber.prototype._complete=function(){var destination=this.destination;if(!this.hasCompleted&&typeof this.defaultValue!=="undefined"){destination.next(this.defaultValue);destination.complete()}else if(!this.hasCompleted){destination.error(new EmptyError_1.EmptyError)}};return FirstSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232,"../util/EmptyError":336}],306:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");function map(project,thisArg){if(typeof project!=="function"){throw new TypeError("argument is not a function. Are you looking for `mapTo()`?")}return this.lift(new MapOperator(project,thisArg))}exports.map=map;var MapOperator=function(){function MapOperator(project,thisArg){this.project=project;this.thisArg=thisArg}MapOperator.prototype.call=function(subscriber,source){return source._subscribe(new MapSubscriber(subscriber,this.project,this.thisArg))};return MapOperator}();var MapSubscriber=function(_super){__extends(MapSubscriber,_super);function MapSubscriber(destination,project,thisArg){_super.call(this,destination);this.project=project;this.count=0;this.thisArg=thisArg||this}MapSubscriber.prototype._next=function(value){var result;try{result=this.project.call(this.thisArg,value,this.count++)}catch(err){this.destination.error(err);return}this.destination.next(result)};return MapSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232}],307:[function(require,module,exports){"use strict";var ArrayObservable_1=require("../observable/ArrayObservable");var mergeAll_1=require("./mergeAll");var isScheduler_1=require("../util/isScheduler");function merge(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}observables.unshift(this);return mergeStatic.apply(this,observables)}exports.merge=merge;function mergeStatic(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}var concurrent=Number.POSITIVE_INFINITY;var scheduler=null;var last=observables[observables.length-1];if(isScheduler_1.isScheduler(last)){scheduler=observables.pop();if(observables.length>1&&typeof observables[observables.length-1]==="number"){concurrent=observables.pop()}}else if(typeof last==="number"){concurrent=observables.pop()}if(observables.length===1){return observables[0]}return new ArrayObservable_1.ArrayObservable(observables,scheduler).lift(new mergeAll_1.MergeAllOperator(concurrent))}exports.mergeStatic=mergeStatic},{"../observable/ArrayObservable":275,"../util/isScheduler":345,"./mergeAll":308}],308:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function mergeAll(concurrent){if(concurrent===void 0){concurrent=Number.POSITIVE_INFINITY}return this.lift(new MergeAllOperator(concurrent))}exports.mergeAll=mergeAll;var MergeAllOperator=function(){function MergeAllOperator(concurrent){this.concurrent=concurrent}MergeAllOperator.prototype.call=function(observer,source){return source._subscribe(new MergeAllSubscriber(observer,this.concurrent))};return MergeAllOperator}();exports.MergeAllOperator=MergeAllOperator;var MergeAllSubscriber=function(_super){__extends(MergeAllSubscriber,_super);function MergeAllSubscriber(destination,concurrent){_super.call(this,destination);this.concurrent=concurrent;this.hasCompleted=false;this.buffer=[];this.active=0}MergeAllSubscriber.prototype._next=function(observable){if(this.active<this.concurrent){this.active++;this.add(subscribeToResult_1.subscribeToResult(this,observable))}else{this.buffer.push(observable)}};MergeAllSubscriber.prototype._complete=function(){this.hasCompleted=true;if(this.active===0&&this.buffer.length===0){this.destination.complete()}};MergeAllSubscriber.prototype.notifyComplete=function(innerSub){var buffer=this.buffer;this.remove(innerSub);this.active--;if(buffer.length>0){this._next(buffer.shift())}else if(this.active===0&&this.hasCompleted){this.destination.complete()}};return MergeAllSubscriber}(OuterSubscriber_1.OuterSubscriber);exports.MergeAllSubscriber=MergeAllSubscriber},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],309:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var subscribeToResult_1=require("../util/subscribeToResult");var OuterSubscriber_1=require("../OuterSubscriber");function mergeMap(project,resultSelector,concurrent){if(concurrent===void 0){concurrent=Number.POSITIVE_INFINITY}if(typeof resultSelector==="number"){concurrent=resultSelector;resultSelector=null}return this.lift(new MergeMapOperator(project,resultSelector,concurrent))}exports.mergeMap=mergeMap;var MergeMapOperator=function(){function MergeMapOperator(project,resultSelector,concurrent){if(concurrent===void 0){concurrent=Number.POSITIVE_INFINITY}this.project=project;this.resultSelector=resultSelector;this.concurrent=concurrent}MergeMapOperator.prototype.call=function(observer,source){return source._subscribe(new MergeMapSubscriber(observer,this.project,this.resultSelector,this.concurrent))};return MergeMapOperator}();exports.MergeMapOperator=MergeMapOperator;var MergeMapSubscriber=function(_super){__extends(MergeMapSubscriber,_super);function MergeMapSubscriber(destination,project,resultSelector,concurrent){if(concurrent===void 0){concurrent=Number.POSITIVE_INFINITY}_super.call(this,destination);this.project=project;this.resultSelector=resultSelector;this.concurrent=concurrent;this.hasCompleted=false;this.buffer=[];this.active=0;this.index=0}MergeMapSubscriber.prototype._next=function(value){if(this.active<this.concurrent){this._tryNext(value)}else{this.buffer.push(value)}};MergeMapSubscriber.prototype._tryNext=function(value){var result;var index=this.index++;try{result=this.project(value,index)}catch(err){this.destination.error(err);return}this.active++;this._innerSub(result,value,index)};MergeMapSubscriber.prototype._innerSub=function(ish,value,index){this.add(subscribeToResult_1.subscribeToResult(this,ish,value,index))};MergeMapSubscriber.prototype._complete=function(){this.hasCompleted=true;if(this.active===0&&this.buffer.length===0){this.destination.complete()}};MergeMapSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){if(this.resultSelector){this._notifyResultSelector(outerValue,innerValue,outerIndex,innerIndex)}else{this.destination.next(innerValue)}};MergeMapSubscriber.prototype._notifyResultSelector=function(outerValue,innerValue,outerIndex,innerIndex){var result;try{result=this.resultSelector(outerValue,innerValue,outerIndex,innerIndex)}catch(err){this.destination.error(err);return}this.destination.next(result)};MergeMapSubscriber.prototype.notifyComplete=function(innerSub){var buffer=this.buffer;this.remove(innerSub);this.active--;if(buffer.length>0){this._next(buffer.shift())}else if(this.active===0&&this.hasCompleted){this.destination.complete()}};return MergeMapSubscriber}(OuterSubscriber_1.OuterSubscriber);exports.MergeMapSubscriber=MergeMapSubscriber},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],310:[function(require,module,exports){"use strict";var MulticastObservable_1=require("../observable/MulticastObservable");var ConnectableObservable_1=require("../observable/ConnectableObservable");function multicast(subjectOrSubjectFactory,selector){var subjectFactory;if(typeof subjectOrSubjectFactory==="function"){subjectFactory=subjectOrSubjectFactory}else{subjectFactory=function subjectFactory(){return subjectOrSubjectFactory}}return!selector?new ConnectableObservable_1.ConnectableObservable(this,subjectFactory):new MulticastObservable_1.MulticastObservable(this,subjectFactory,selector)}exports.multicast=multicast},{"../observable/ConnectableObservable":276,"../observable/MulticastObservable":282}],311:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");var Notification_1=require("../Notification");function observeOn(scheduler,delay){if(delay===void 0){delay=0}return this.lift(new ObserveOnOperator(scheduler,delay))}exports.observeOn=observeOn;var ObserveOnOperator=function(){function ObserveOnOperator(scheduler,delay){if(delay===void 0){delay=0}this.scheduler=scheduler;this.delay=delay}ObserveOnOperator.prototype.call=function(subscriber,source){return source._subscribe(new ObserveOnSubscriber(subscriber,this.scheduler,this.delay))};return ObserveOnOperator}();exports.ObserveOnOperator=ObserveOnOperator;var ObserveOnSubscriber=function(_super){__extends(ObserveOnSubscriber,_super);function ObserveOnSubscriber(destination,scheduler,delay){if(delay===void 0){delay=0}_super.call(this,destination);this.scheduler=scheduler;this.delay=delay}ObserveOnSubscriber.dispatch=function(arg){var notification=arg.notification,destination=arg.destination;notification.observe(destination)};ObserveOnSubscriber.prototype.scheduleMessage=function(notification){this.add(this.scheduler.schedule(ObserveOnSubscriber.dispatch,this.delay,new ObserveOnMessage(notification,this.destination)))};ObserveOnSubscriber.prototype._next=function(value){this.scheduleMessage(Notification_1.Notification.createNext(value))};ObserveOnSubscriber.prototype._error=function(err){this.scheduleMessage(Notification_1.Notification.createError(err))};ObserveOnSubscriber.prototype._complete=function(){this.scheduleMessage(Notification_1.Notification.createComplete())};return ObserveOnSubscriber}(Subscriber_1.Subscriber);exports.ObserveOnSubscriber=ObserveOnSubscriber;var ObserveOnMessage=function(){function ObserveOnMessage(notification,destination){this.notification=notification;this.destination=destination}return ObserveOnMessage}();exports.ObserveOnMessage=ObserveOnMessage},{"../Notification":225,"../Subscriber":232}],312:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");function pairwise(){return this.lift(new PairwiseOperator)}exports.pairwise=pairwise;var PairwiseOperator=function(){function PairwiseOperator(){}PairwiseOperator.prototype.call=function(subscriber,source){return source._subscribe(new PairwiseSubscriber(subscriber))};return PairwiseOperator}();var PairwiseSubscriber=function(_super){__extends(PairwiseSubscriber,_super);function PairwiseSubscriber(destination){_super.call(this,destination);this.hasPrev=false}PairwiseSubscriber.prototype._next=function(value){if(this.hasPrev){this.destination.next([this.prev,value])}else{this.hasPrev=true}this.prev=value};return PairwiseSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232}],313:[function(require,module,exports){
"use strict";var map_1=require("./map");function pluck(){var properties=[];for(var _i=0;_i<arguments.length;_i++){properties[_i-0]=arguments[_i]}var length=properties.length;if(length===0){throw new Error("List of properties cannot be empty.")}return map_1.map.call(this,plucker(properties,length))}exports.pluck=pluck;function plucker(props,length){var mapper=function(x){var currentProp=x;for(var i=0;i<length;i++){var p=currentProp[props[i]];if(typeof p!=="undefined"){currentProp=p}else{return undefined}}return currentProp};return mapper}},{"./map":306}],314:[function(require,module,exports){"use strict";var Subject_1=require("../Subject");var multicast_1=require("./multicast");function publish(selector){return selector?multicast_1.multicast.call(this,function(){return new Subject_1.Subject},selector):multicast_1.multicast.call(this,new Subject_1.Subject)}exports.publish=publish},{"../Subject":230,"./multicast":310}],315:[function(require,module,exports){"use strict";var ReplaySubject_1=require("../ReplaySubject");var multicast_1=require("./multicast");function publishReplay(bufferSize,windowTime,scheduler){if(bufferSize===void 0){bufferSize=Number.POSITIVE_INFINITY}if(windowTime===void 0){windowTime=Number.POSITIVE_INFINITY}return multicast_1.multicast.call(this,new ReplaySubject_1.ReplaySubject(bufferSize,windowTime,scheduler))}exports.publishReplay=publishReplay},{"../ReplaySubject":229,"./multicast":310}],316:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");function scan(accumulator,seed){return this.lift(new ScanOperator(accumulator,seed))}exports.scan=scan;var ScanOperator=function(){function ScanOperator(accumulator,seed){this.accumulator=accumulator;this.seed=seed}ScanOperator.prototype.call=function(subscriber,source){return source._subscribe(new ScanSubscriber(subscriber,this.accumulator,this.seed))};return ScanOperator}();var ScanSubscriber=function(_super){__extends(ScanSubscriber,_super);function ScanSubscriber(destination,accumulator,seed){_super.call(this,destination);this.accumulator=accumulator;this.index=0;this.accumulatorSet=false;this.seed=seed;this.accumulatorSet=typeof seed!=="undefined"}Object.defineProperty(ScanSubscriber.prototype,"seed",{get:function(){return this._seed},set:function(value){this.accumulatorSet=true;this._seed=value},enumerable:true,configurable:true});ScanSubscriber.prototype._next=function(value){if(!this.accumulatorSet){this.seed=value;this.destination.next(value)}else{return this._tryNext(value)}};ScanSubscriber.prototype._tryNext=function(value){var index=this.index++;var result;try{result=this.accumulator(this.seed,value,index)}catch(err){this.destination.error(err)}this.seed=result;this.destination.next(result)};return ScanSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232}],317:[function(require,module,exports){"use strict";var multicast_1=require("./multicast");var Subject_1=require("../Subject");function shareSubjectFactory(){return new Subject_1.Subject}function share(){return multicast_1.multicast.call(this,shareSubjectFactory).refCount()}exports.share=share},{"../Subject":230,"./multicast":310}],318:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");function skip(total){return this.lift(new SkipOperator(total))}exports.skip=skip;var SkipOperator=function(){function SkipOperator(total){this.total=total}SkipOperator.prototype.call=function(subscriber,source){return source._subscribe(new SkipSubscriber(subscriber,this.total))};return SkipOperator}();var SkipSubscriber=function(_super){__extends(SkipSubscriber,_super);function SkipSubscriber(destination,total){_super.call(this,destination);this.total=total;this.count=0}SkipSubscriber.prototype._next=function(x){if(++this.count>this.total){this.destination.next(x)}};return SkipSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232}],319:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function skipUntil(notifier){return this.lift(new SkipUntilOperator(notifier))}exports.skipUntil=skipUntil;var SkipUntilOperator=function(){function SkipUntilOperator(notifier){this.notifier=notifier}SkipUntilOperator.prototype.call=function(subscriber,source){return source._subscribe(new SkipUntilSubscriber(subscriber,this.notifier))};return SkipUntilOperator}();var SkipUntilSubscriber=function(_super){__extends(SkipUntilSubscriber,_super);function SkipUntilSubscriber(destination,notifier){_super.call(this,destination);this.hasValue=false;this.isInnerStopped=false;this.add(subscribeToResult_1.subscribeToResult(this,notifier))}SkipUntilSubscriber.prototype._next=function(value){if(this.hasValue){_super.prototype._next.call(this,value)}};SkipUntilSubscriber.prototype._complete=function(){if(this.isInnerStopped){_super.prototype._complete.call(this)}else{this.unsubscribe()}};SkipUntilSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this.hasValue=true};SkipUntilSubscriber.prototype.notifyComplete=function(){this.isInnerStopped=true;if(this.isStopped){_super.prototype._complete.call(this)}};return SkipUntilSubscriber}(OuterSubscriber_1.OuterSubscriber)},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],320:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");function skipWhile(predicate){return this.lift(new SkipWhileOperator(predicate))}exports.skipWhile=skipWhile;var SkipWhileOperator=function(){function SkipWhileOperator(predicate){this.predicate=predicate}SkipWhileOperator.prototype.call=function(subscriber,source){return source._subscribe(new SkipWhileSubscriber(subscriber,this.predicate))};return SkipWhileOperator}();var SkipWhileSubscriber=function(_super){__extends(SkipWhileSubscriber,_super);function SkipWhileSubscriber(destination,predicate){_super.call(this,destination);this.predicate=predicate;this.skipping=true;this.index=0}SkipWhileSubscriber.prototype._next=function(value){var destination=this.destination;if(this.skipping){this.tryCallPredicate(value)}if(!this.skipping){destination.next(value)}};SkipWhileSubscriber.prototype.tryCallPredicate=function(value){try{var result=this.predicate(value,this.index++);this.skipping=Boolean(result)}catch(err){this.destination.error(err)}};return SkipWhileSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232}],321:[function(require,module,exports){"use strict";var ArrayObservable_1=require("../observable/ArrayObservable");var ScalarObservable_1=require("../observable/ScalarObservable");var EmptyObservable_1=require("../observable/EmptyObservable");var concat_1=require("./concat");var isScheduler_1=require("../util/isScheduler");function startWith(){var array=[];for(var _i=0;_i<arguments.length;_i++){array[_i-0]=arguments[_i]}var scheduler=array[array.length-1];if(isScheduler_1.isScheduler(scheduler)){array.pop()}else{scheduler=null}var len=array.length;if(len===1){return concat_1.concatStatic(new ScalarObservable_1.ScalarObservable(array[0],scheduler),this)}else if(len>1){return concat_1.concatStatic(new ArrayObservable_1.ArrayObservable(array,scheduler),this)}else{return concat_1.concatStatic(new EmptyObservable_1.EmptyObservable(scheduler),this)}}exports.startWith=startWith},{"../observable/ArrayObservable":275,"../observable/EmptyObservable":277,"../observable/ScalarObservable":284,"../util/isScheduler":345,"./concat":296}],322:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function switchMap(project,resultSelector){return this.lift(new SwitchMapOperator(project,resultSelector))}exports.switchMap=switchMap;var SwitchMapOperator=function(){function SwitchMapOperator(project,resultSelector){this.project=project;this.resultSelector=resultSelector}SwitchMapOperator.prototype.call=function(subscriber,source){return source._subscribe(new SwitchMapSubscriber(subscriber,this.project,this.resultSelector))};return SwitchMapOperator}();var SwitchMapSubscriber=function(_super){__extends(SwitchMapSubscriber,_super);function SwitchMapSubscriber(destination,project,resultSelector){_super.call(this,destination);this.project=project;this.resultSelector=resultSelector;this.index=0}SwitchMapSubscriber.prototype._next=function(value){var result;var index=this.index++;try{result=this.project(value,index)}catch(error){this.destination.error(error);return}this._innerSub(result,value,index)};SwitchMapSubscriber.prototype._innerSub=function(result,value,index){var innerSubscription=this.innerSubscription;if(innerSubscription){innerSubscription.unsubscribe()}this.add(this.innerSubscription=subscribeToResult_1.subscribeToResult(this,result,value,index))};SwitchMapSubscriber.prototype._complete=function(){var innerSubscription=this.innerSubscription;if(!innerSubscription||innerSubscription.isUnsubscribed){_super.prototype._complete.call(this)}};SwitchMapSubscriber.prototype._unsubscribe=function(){this.innerSubscription=null};SwitchMapSubscriber.prototype.notifyComplete=function(innerSub){this.remove(innerSub);this.innerSubscription=null;if(this.isStopped){_super.prototype._complete.call(this)}};SwitchMapSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){if(this.resultSelector){this._tryNotifyNext(outerValue,innerValue,outerIndex,innerIndex)}else{this.destination.next(innerValue)}};SwitchMapSubscriber.prototype._tryNotifyNext=function(outerValue,innerValue,outerIndex,innerIndex){var result;try{result=this.resultSelector(outerValue,innerValue,outerIndex,innerIndex)}catch(err){this.destination.error(err);return}this.destination.next(result)};return SwitchMapSubscriber}(OuterSubscriber_1.OuterSubscriber)},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],323:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Subscriber_1=require("../Subscriber");var ArgumentOutOfRangeError_1=require("../util/ArgumentOutOfRangeError");var EmptyObservable_1=require("../observable/EmptyObservable");function take(count){if(count===0){return new EmptyObservable_1.EmptyObservable}else{return this.lift(new TakeOperator(count))}}exports.take=take;var TakeOperator=function(){function TakeOperator(total){this.total=total;if(this.total<0){throw new ArgumentOutOfRangeError_1.ArgumentOutOfRangeError}}TakeOperator.prototype.call=function(subscriber,source){return source._subscribe(new TakeSubscriber(subscriber,this.total))};return TakeOperator}();var TakeSubscriber=function(_super){__extends(TakeSubscriber,_super);function TakeSubscriber(destination,total){_super.call(this,destination);this.total=total;this.count=0}TakeSubscriber.prototype._next=function(value){var total=this.total;if(++this.count<=total){this.destination.next(value);if(this.count===total){this.destination.complete();this.unsubscribe()}}};return TakeSubscriber}(Subscriber_1.Subscriber)},{"../Subscriber":232,"../observable/EmptyObservable":277,"../util/ArgumentOutOfRangeError":335}],324:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function takeUntil(notifier){return this.lift(new TakeUntilOperator(notifier))}exports.takeUntil=takeUntil;var TakeUntilOperator=function(){function TakeUntilOperator(notifier){this.notifier=notifier}TakeUntilOperator.prototype.call=function(subscriber,source){return source._subscribe(new TakeUntilSubscriber(subscriber,this.notifier))};return TakeUntilOperator}();var TakeUntilSubscriber=function(_super){__extends(TakeUntilSubscriber,_super);function TakeUntilSubscriber(destination,notifier){_super.call(this,destination);this.notifier=notifier;this.add(subscribeToResult_1.subscribeToResult(this,notifier))}TakeUntilSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this.complete()};TakeUntilSubscriber.prototype.notifyComplete=function(){};return TakeUntilSubscriber}(OuterSubscriber_1.OuterSubscriber)},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],325:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");function withLatestFrom(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i-0]=arguments[_i]}var project;if(typeof args[args.length-1]==="function"){project=args.pop()}var observables=args;return this.lift(new WithLatestFromOperator(observables,project))}exports.withLatestFrom=withLatestFrom;var WithLatestFromOperator=function(){function WithLatestFromOperator(observables,project){this.observables=observables;this.project=project}WithLatestFromOperator.prototype.call=function(subscriber,source){return source._subscribe(new WithLatestFromSubscriber(subscriber,this.observables,this.project))};return WithLatestFromOperator}();var WithLatestFromSubscriber=function(_super){__extends(WithLatestFromSubscriber,_super);function WithLatestFromSubscriber(destination,observables,project){_super.call(this,destination);this.observables=observables;this.project=project;this.toRespond=[];var len=observables.length;this.values=new Array(len);for(var i=0;i<len;i++){this.toRespond.push(i)}for(var i=0;i<len;i++){var observable=observables[i];this.add(subscribeToResult_1.subscribeToResult(this,observable,observable,i))}}WithLatestFromSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this.values[outerIndex]=innerValue;var toRespond=this.toRespond;if(toRespond.length>0){var found=toRespond.indexOf(outerIndex);if(found!==-1){toRespond.splice(found,1)}}};WithLatestFromSubscriber.prototype.notifyComplete=function(){};WithLatestFromSubscriber.prototype._next=function(value){if(this.toRespond.length===0){var args=[value].concat(this.values);if(this.project){this._tryProject(args)}else{this.destination.next(args)}}};WithLatestFromSubscriber.prototype._tryProject=function(args){var result;try{result=this.project.apply(this,args)}catch(err){this.destination.error(err);return}this.destination.next(result)};return WithLatestFromSubscriber}(OuterSubscriber_1.OuterSubscriber)},{"../OuterSubscriber":228,"../util/subscribeToResult":347}],326:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var ArrayObservable_1=require("../observable/ArrayObservable");var isArray_1=require("../util/isArray");var Subscriber_1=require("../Subscriber");var OuterSubscriber_1=require("../OuterSubscriber");var subscribeToResult_1=require("../util/subscribeToResult");var iterator_1=require("../symbol/iterator");function zipProto(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}observables.unshift(this);return zipStatic.apply(this,observables)}exports.zipProto=zipProto;function zipStatic(){var observables=[];for(var _i=0;_i<arguments.length;_i++){observables[_i-0]=arguments[_i]}var project=observables[observables.length-1];if(typeof project==="function"){observables.pop()}return new ArrayObservable_1.ArrayObservable(observables).lift(new ZipOperator(project))}exports.zipStatic=zipStatic;var ZipOperator=function(){function ZipOperator(project){this.project=project}ZipOperator.prototype.call=function(subscriber,source){return source._subscribe(new ZipSubscriber(subscriber,this.project))};return ZipOperator}();exports.ZipOperator=ZipOperator;var ZipSubscriber=function(_super){__extends(ZipSubscriber,_super);function ZipSubscriber(destination,project,values){if(values===void 0){values=Object.create(null)}_super.call(this,destination);this.index=0;this.iterators=[];this.active=0;this.project=typeof project==="function"?project:null;this.values=values}ZipSubscriber.prototype._next=function(value){var iterators=this.iterators;var index=this.index++;if(isArray_1.isArray(value)){iterators.push(new StaticArrayIterator(value))}else if(typeof value[iterator_1.$$iterator]==="function"){iterators.push(new StaticIterator(value[iterator_1.$$iterator]()))}else{iterators.push(new ZipBufferIterator(this.destination,this,value,index))}};ZipSubscriber.prototype._complete=function(){var iterators=this.iterators;var len=iterators.length;this.active=len;for(var i=0;i<len;i++){var iterator=iterators[i];if(iterator.stillUnsubscribed){this.add(iterator.subscribe(iterator,i))}else{this.active--}}};ZipSubscriber.prototype.notifyInactive=function(){this.active--;if(this.active===0){this.destination.complete()}};ZipSubscriber.prototype.checkIterators=function(){var iterators=this.iterators;var len=iterators.length;var destination=this.destination;for(var i=0;i<len;i++){var iterator=iterators[i];if(typeof iterator.hasValue==="function"&&!iterator.hasValue()){return}}var shouldComplete=false;var args=[];for(var i=0;i<len;i++){var iterator=iterators[i];var result=iterator.next();if(iterator.hasCompleted()){shouldComplete=true}if(result.done){destination.complete();return}args.push(result.value)}if(this.project){this._tryProject(args)}else{destination.next(args)}if(shouldComplete){destination.complete()}};ZipSubscriber.prototype._tryProject=function(args){var result;try{result=this.project.apply(this,args)}catch(err){this.destination.error(err);return}this.destination.next(result)};return ZipSubscriber}(Subscriber_1.Subscriber);exports.ZipSubscriber=ZipSubscriber;var StaticIterator=function(){function StaticIterator(iterator){this.iterator=iterator;this.nextResult=iterator.next()}StaticIterator.prototype.hasValue=function(){return true};StaticIterator.prototype.next=function(){var result=this.nextResult;this.nextResult=this.iterator.next();return result};StaticIterator.prototype.hasCompleted=function(){var nextResult=this.nextResult;return nextResult&&nextResult.done};return StaticIterator}();var StaticArrayIterator=function(){function StaticArrayIterator(array){this.array=array;this.index=0;this.length=0;this.length=array.length}StaticArrayIterator.prototype[iterator_1.$$iterator]=function(){return this};StaticArrayIterator.prototype.next=function(value){var i=this.index++;var array=this.array;return i<this.length?{value:array[i],done:false}:{value:null,done:true}};StaticArrayIterator.prototype.hasValue=function(){return this.array.length>this.index};StaticArrayIterator.prototype.hasCompleted=function(){return this.array.length===this.index};return StaticArrayIterator}();var ZipBufferIterator=function(_super){__extends(ZipBufferIterator,_super);function ZipBufferIterator(destination,parent,observable,index){_super.call(this,destination);this.parent=parent;this.observable=observable;this.index=index;this.stillUnsubscribed=true;this.buffer=[];this.isComplete=false}ZipBufferIterator.prototype[iterator_1.$$iterator]=function(){return this};ZipBufferIterator.prototype.next=function(){var buffer=this.buffer;if(buffer.length===0&&this.isComplete){return{value:null,done:true}}else{return{value:buffer.shift(),done:false}}};ZipBufferIterator.prototype.hasValue=function(){return this.buffer.length>0};ZipBufferIterator.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete};ZipBufferIterator.prototype.notifyComplete=function(){if(this.buffer.length>0){this.isComplete=true;this.parent.notifyInactive()}else{this.destination.complete()}};ZipBufferIterator.prototype.notifyNext=function(outerValue,innerValue,outerIndex,innerIndex,innerSub){this.buffer.push(innerValue);this.parent.checkIterators()};ZipBufferIterator.prototype.subscribe=function(value,index){return subscribeToResult_1.subscribeToResult(this,this.observable,this,index)};return ZipBufferIterator}(OuterSubscriber_1.OuterSubscriber)},{"../OuterSubscriber":228,"../Subscriber":232,"../observable/ArrayObservable":275,"../symbol/iterator":333,"../util/isArray":340,"../util/subscribeToResult":347}],327:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var FutureAction_1=require("./FutureAction");var QueueScheduler_1=require("./QueueScheduler");var AsyncScheduler=function(_super){__extends(AsyncScheduler,_super);function AsyncScheduler(){_super.apply(this,arguments)}AsyncScheduler.prototype.scheduleNow=function(work,state){return new FutureAction_1.FutureAction(this,work).schedule(state,0)};return AsyncScheduler}(QueueScheduler_1.QueueScheduler);exports.AsyncScheduler=AsyncScheduler},{"./FutureAction":328,"./QueueScheduler":330}],328:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var root_1=require("../util/root");var Subscription_1=require("../Subscription");var FutureAction=function(_super){__extends(FutureAction,_super);function FutureAction(scheduler,work){_super.call(this);this.scheduler=scheduler;this.work=work;this.pending=false}FutureAction.prototype.execute=function(){if(this.isUnsubscribed){this.error=new Error("executing a cancelled action")}else{try{this.work(this.state)}catch(e){this.unsubscribe();this.error=e}}};FutureAction.prototype.schedule=function(state,delay){if(delay===void 0){delay=0}if(this.isUnsubscribed){return this}return this._schedule(state,delay)};FutureAction.prototype._schedule=function(state,delay){var _this=this;if(delay===void 0){delay=0}this.state=state;this.pending=true;var id=this.id;if(id!=null&&this.delay===delay){return this}this.delay=delay;if(id!=null){this.id=null;root_1.root.clearInterval(id)}this.id=root_1.root.setInterval(function(){_this.pending=false;var _a=_this,id=_a.id,scheduler=_a.scheduler;scheduler.actions.push(_this);scheduler.flush();if(_this.pending===false&&id!=null){_this.id=null;root_1.root.clearInterval(id)}},delay);return this};FutureAction.prototype._unsubscribe=function(){this.pending=false;var _a=this,id=_a.id,scheduler=_a.scheduler;var actions=scheduler.actions;var index=actions.indexOf(this);if(id!=null){this.id=null;root_1.root.clearInterval(id)}if(index!==-1){actions.splice(index,1)}this.work=null;this.state=null;this.scheduler=null};return FutureAction}(Subscription_1.Subscription);exports.FutureAction=FutureAction},{"../Subscription":233,"../util/root":346}],329:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var FutureAction_1=require("./FutureAction");var QueueAction=function(_super){__extends(QueueAction,_super);function QueueAction(){_super.apply(this,arguments)}QueueAction.prototype._schedule=function(state,delay){if(delay===void 0){delay=0}if(delay>0){return _super.prototype._schedule.call(this,state,delay)}this.delay=delay;this.state=state;var scheduler=this.scheduler;scheduler.actions.push(this);scheduler.flush();return this};return QueueAction}(FutureAction_1.FutureAction);exports.QueueAction=QueueAction},{"./FutureAction":328}],330:[function(require,module,exports){"use strict";var QueueAction_1=require("./QueueAction");var FutureAction_1=require("./FutureAction");var QueueScheduler=function(){function QueueScheduler(){this.active=false;this.actions=[];this.scheduledId=null}QueueScheduler.prototype.now=function(){return Date.now()};QueueScheduler.prototype.flush=function(){if(this.active||this.scheduledId){return}this.active=true;var actions=this.actions;for(var action=null;action=actions.shift();){action.execute();if(action.error){this.active=false;throw action.error}}this.active=false};QueueScheduler.prototype.schedule=function(work,delay,state){if(delay===void 0){delay=0}return delay<=0?this.scheduleNow(work,state):this.scheduleLater(work,delay,state)};QueueScheduler.prototype.scheduleNow=function(work,state){return new QueueAction_1.QueueAction(this,work).schedule(state)};QueueScheduler.prototype.scheduleLater=function(work,delay,state){return new FutureAction_1.FutureAction(this,work).schedule(state,delay)};return QueueScheduler}();exports.QueueScheduler=QueueScheduler},{"./FutureAction":328,"./QueueAction":329}],331:[function(require,module,exports){"use strict";var AsyncScheduler_1=require("./AsyncScheduler");exports.async=new AsyncScheduler_1.AsyncScheduler},{"./AsyncScheduler":327}],332:[function(require,module,exports){"use strict";var QueueScheduler_1=require("./QueueScheduler");exports.queue=new QueueScheduler_1.QueueScheduler},{"./QueueScheduler":330}],333:[function(require,module,exports){"use strict";var root_1=require("../util/root");var Symbol=root_1.root.Symbol;if(typeof Symbol==="function"){if(Symbol.iterator){exports.$$iterator=Symbol.iterator}else if(typeof Symbol.for==="function"){exports.$$iterator=Symbol.for("iterator")}}else{if(root_1.root.Set&&typeof(new root_1.root.Set)["@@iterator"]==="function"){exports.$$iterator="@@iterator"}else if(root_1.root.Map){var keys=Object.getOwnPropertyNames(root_1.root.Map.prototype);for(var i=0;i<keys.length;++i){var key=keys[i];if(key!=="entries"&&key!=="size"&&root_1.root.Map.prototype[key]===root_1.root.Map.prototype["entries"]){exports.$$iterator=key;break}}}else{exports.$$iterator="@@iterator"}}},{"../util/root":346}],334:[function(require,module,exports){"use strict";var root_1=require("../util/root");var Symbol=root_1.root.Symbol;exports.$$rxSubscriber=typeof Symbol==="function"&&typeof Symbol.for==="function"?Symbol.for("rxSubscriber"):"@@rxSubscriber"},{"../util/root":346}],335:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var ArgumentOutOfRangeError=function(_super){__extends(ArgumentOutOfRangeError,_super);function ArgumentOutOfRangeError(){var err=_super.call(this,"argument out of range");this.name=err.name="ArgumentOutOfRangeError";this.stack=err.stack;this.message=err.message}return ArgumentOutOfRangeError}(Error);exports.ArgumentOutOfRangeError=ArgumentOutOfRangeError},{}],336:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var EmptyError=function(_super){__extends(EmptyError,_super);function EmptyError(){var err=_super.call(this,"no elements in sequence");this.name=err.name="EmptyError";this.stack=err.stack;this.message=err.message}return EmptyError}(Error);exports.EmptyError=EmptyError},{}],337:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var ObjectUnsubscribedError=function(_super){__extends(ObjectUnsubscribedError,_super);function ObjectUnsubscribedError(){var err=_super.call(this,"object unsubscribed");this.name=err.name="ObjectUnsubscribedError";this.stack=err.stack;this.message=err.message}return ObjectUnsubscribedError}(Error);exports.ObjectUnsubscribedError=ObjectUnsubscribedError},{}],338:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var UnsubscriptionError=function(_super){__extends(UnsubscriptionError,_super);function UnsubscriptionError(errors){_super.call(this);this.errors=errors;var err=Error.call(this,errors?errors.length+" errors occurred during unsubscription:\n  "+errors.map(function(err,i){return i+1+") "+err.toString()}).join("\n  "):"");this.name=err.name="UnsubscriptionError";this.stack=err.stack;this.message=err.message}return UnsubscriptionError}(Error);exports.UnsubscriptionError=UnsubscriptionError},{}],339:[function(require,module,exports){"use strict";exports.errorObject={e:{}}},{}],340:[function(require,module,exports){"use strict";exports.isArray=Array.isArray||function(x){return x&&typeof x.length==="number"}},{}],341:[function(require,module,exports){"use strict";function isDate(value){return value instanceof Date&&!isNaN(+value)}exports.isDate=isDate},{}],342:[function(require,module,exports){"use strict";function isFunction(x){return typeof x==="function"}exports.isFunction=isFunction},{}],343:[function(require,module,exports){"use strict";function isObject(x){return x!=null&&typeof x==="object"}exports.isObject=isObject},{}],344:[function(require,module,exports){"use strict";function isPromise(value){return value&&typeof value.subscribe!=="function"&&typeof value.then==="function"}exports.isPromise=isPromise},{}],345:[function(require,module,exports){"use strict";function isScheduler(value){return value&&typeof value.schedule==="function"}exports.isScheduler=isScheduler},{}],346:[function(require,module,exports){(function(global){"use strict";var objectTypes={boolean:false,function:true,object:true,number:false,string:false,undefined:false};exports.root=objectTypes[typeof self]&&self||objectTypes[typeof window]&&window;var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){exports.root=freeGlobal}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],347:[function(require,module,exports){"use strict";var root_1=require("./root");var isArray_1=require("./isArray");var isPromise_1=require("./isPromise");var Observable_1=require("../Observable");var iterator_1=require("../symbol/iterator");var InnerSubscriber_1=require("../InnerSubscriber");var symbol_observable_1=require("symbol-observable");
function subscribeToResult(outerSubscriber,result,outerValue,outerIndex){var destination=new InnerSubscriber_1.InnerSubscriber(outerSubscriber,outerValue,outerIndex);if(destination.isUnsubscribed){return}if(result instanceof Observable_1.Observable){if(result._isScalar){destination.next(result.value);destination.complete();return}else{return result.subscribe(destination)}}if(isArray_1.isArray(result)){for(var i=0,len=result.length;i<len&&!destination.isUnsubscribed;i++){destination.next(result[i])}if(!destination.isUnsubscribed){destination.complete()}}else if(isPromise_1.isPromise(result)){result.then(function(value){if(!destination.isUnsubscribed){destination.next(value);destination.complete()}},function(err){return destination.error(err)}).then(null,function(err){root_1.root.setTimeout(function(){throw err})});return destination}else if(typeof result[iterator_1.$$iterator]==="function"){for(var _i=0,_a=result;_i<_a.length;_i++){var item=_a[_i];destination.next(item);if(destination.isUnsubscribed){break}}if(!destination.isUnsubscribed){destination.complete()}}else if(typeof result[symbol_observable_1.default]==="function"){var obs=result[symbol_observable_1.default]();if(typeof obs.subscribe!=="function"){destination.error("invalid observable")}else{return obs.subscribe(new InnerSubscriber_1.InnerSubscriber(outerSubscriber,outerValue,outerIndex))}}else{destination.error(new TypeError("unknown type returned"))}}exports.subscribeToResult=subscribeToResult},{"../InnerSubscriber":224,"../Observable":226,"../symbol/iterator":333,"./isArray":340,"./isPromise":344,"./root":346,"symbol-observable":351}],348:[function(require,module,exports){"use strict";function throwError(e){throw e}exports.throwError=throwError},{}],349:[function(require,module,exports){"use strict";var Subscriber_1=require("../Subscriber");var rxSubscriber_1=require("../symbol/rxSubscriber");function toSubscriber(nextOrObserver,error,complete){if(nextOrObserver){if(nextOrObserver instanceof Subscriber_1.Subscriber){return nextOrObserver}if(nextOrObserver[rxSubscriber_1.$$rxSubscriber]){return nextOrObserver[rxSubscriber_1.$$rxSubscriber]()}}if(!nextOrObserver&&!error&&!complete){return new Subscriber_1.Subscriber}return new Subscriber_1.Subscriber(nextOrObserver,error,complete)}exports.toSubscriber=toSubscriber},{"../Subscriber":232,"../symbol/rxSubscriber":334}],350:[function(require,module,exports){"use strict";var errorObject_1=require("./errorObject");var tryCatchTarget;function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObject_1.errorObject.e=e;return errorObject_1.errorObject}}function tryCatch(fn){tryCatchTarget=fn;return tryCatcher}exports.tryCatch=tryCatch},{"./errorObject":339}],351:[function(require,module,exports){module.exports=require("./lib/index")},{"./lib/index":352}],352:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ponyfill=require("./ponyfill");var _ponyfill2=_interopRequireDefault(_ponyfill);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var root=undefined;if(typeof global!=="undefined"){root=global}else if(typeof window!=="undefined"){root=window}var result=(0,_ponyfill2.default)(root);exports.default=result}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ponyfill":353}],353:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=symbolObservablePonyfill;function symbolObservablePonyfill(root){var result;var _Symbol=root.Symbol;if(typeof _Symbol==="function"){if(_Symbol.observable){result=_Symbol.observable}else{result=_Symbol("observable");_Symbol.observable=result}}else{result="@@observable"}return result}},{}],354:[function(require,module,exports){"use strict";var THREE={REVISION:"79"};"function"===typeof define&&define.amd?define("three",THREE):"undefined"!==typeof exports&&"undefined"!==typeof module&&(module.exports=THREE);void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b}}();Object.assign(THREE,{MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,MaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:0,AlwaysDepth:1,LessDepth:2,LessEqualDepth:3,EqualDepth:4,GreaterEqualDepth:5,GreaterDepth:6,NotEqualDepth:7,MultiplyOperation:0,MixOperation:1,AddOperation:2,NoToneMapping:0,LinearToneMapping:1,ReinhardToneMapping:2,Uncharted2ToneMapping:3,CineonToneMapping:4,UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307,RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1025,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023,RGBEFormat:THREE.RGBAFormat,DepthFormat:1026,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,RGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,ZeroCurvatureEnding:2400,ZeroSlopeEnding:2401,WrapAroundEnding:2402,TrianglesDrawMode:0,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:3e3,sRGBEncoding:3001,GammaEncoding:3007,RGBEEncoding:3002,LogLuvEncoding:3003,RGBM7Encoding:3004,RGBM16Encoding:3005,RGBDEncoding:3006,BasicDepthPacking:3200,RGBADepthPacking:3201});THREE.Color=function(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&(d-=1);return d<1/6?a+6*(c-a)*d:.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}return function(b,c,d){b=THREE.Math.euclideanModulo(b,1);c=THREE.Math.clamp(c,0,1);d=THREE.Math.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var d=c[2];switch(c[1]){case"rgb":case"rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case"hsl":case"hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){var d=parseFloat(c[1])/360,e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&(c=THREE.ColorKeywords[a],void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var k=e-f,f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;"XYZ"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===k&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6],b=b[10],l=c+f+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1e-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,l=b._w;this._x=c*l+f*g+d*k-e*h;this._y=d*l+f*h+e*g-c*k;this._z=e*l+f*k+c*h-d*g;this._w=f*l-c*g-d*h-e*k;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.sqrt(1-g*g);if(.001>Math.abs(h))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var k=Math.atan2(h,g),g=Math.sin((1-b)*k)/h,h=Math.sin(b*k)/h;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Object.assign(THREE.Quaternion,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],k=c[d+1],l=c[d+2];c=c[d+3];d=e[f+0];var m=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||h!==d||k!==m||l!==p){f=1-g;var n=h*d+k*m+l*p+c*e,q=0<=n?1:-1,r=1-n*n;r>Number.EPSILON&&(r=Math.sqrt(r),n=Math.atan2(r,n*q),f=Math.sin(f*n)/r,g=Math.sin(g*n)/r);q*=g;h=h*f+d*q;k=k*f+m*q;l=l*f+p*q;c=c*f+e*q;f===1-g&&(g=1/Math.sqrt(h*h+k*k+l*l+c*c),h*=g,k*=g,l*=g,c*=g)}a[b]=h;a[b+1]=k;a[b+2]=l;a[b+3]=c}});THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};THREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;this.x=e*c-f*d+a.x;this.y=e*d+f*c+a.y;return this}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,l=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-l*-f;this.y=k*a+b*-f+l*-e-h*-g;this.z=l*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;this.z=c*g-d*f;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if("number"===typeof a){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var c=a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this;
},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1e-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var l=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>Math.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+l-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;l=(l+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>l?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>l?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=k/c):.01>l?(c=b=.707106781,d=0):(d=Math.sqrt(l),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/a;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+l-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],l=e[9],m=e[2],p=e[6],e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(g,e),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-m,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-m,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-d(m,-1,1)),.99999>Math.abs(m)?(this._x=Math.atan2(p,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):"YZX"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-m,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,k),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-l,e),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2((-Infinity),(-Infinity))};THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3((-Infinity),(-Infinity),(-Infinity))};THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.length;h<k;h+=3){var l=a[h],m=a[h+1],p=a[h+2];l<b&&(b=l);m<c&&(c=m);p<d&&(d=p);l>e&&(e=l);m>f&&(f=m);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new THREE.Vector3;return function(b){var c=this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){var e=b.geometry;if(void 0!==e)if(e instanceof THREE.Geometry)for(var e=e.vertices,f=0,g=e.length;f<g;f++)a.copy(e[f]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else if(e instanceof THREE.BufferGeometry&&(g=e.attributes.position,void 0!==g)){var h;g instanceof THREE.InterleavedBufferAttribute?(e=g.data.array,f=g.offset,h=g.data.stride):(e=g.array,f=0,h=3);for(g=e.length;f<g;f+=h)a.fromArray(e,f),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var l=this.elements;l[0]=a;l[1]=d;l[2]=g;l[3]=b;l[4]=e;l[5]=h;l[6]=c;l[7]=f;l[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){a instanceof THREE.Matrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],h=c[3],k=c[4],l=c[5],m=c[6],p=c[7],c=c[8],n=c*k-l*p,q=l*m-c*h,r=p*h-k*m,s=e*n+f*q+g*r;if(0===s){if(b)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}s=1/s;d[0]=n*s;d[1]=(g*p-c*f)*s;d[2]=(l*f-g*k)*s;d[3]=q*s;d[4]=(c*e-g*m)*s;d[5]=(g*h-l*e)*s;d[6]=r*s;d[7]=(f*m-p*e)*s;d[8]=(k*e-f*h)*s;return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,l,m,p,n,q,r,s){var v=this.elements;v[0]=a;v[4]=b;v[8]=c;v[12]=d;v[1]=e;v[5]=f;v[9]=g;v[13]=h;v[2]=k;v[6]=l;v[10]=m;v[14]=p;v[3]=n;v[7]=q;v[11]=r;v[15]=s;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);var c=this.elements,d=b.elements,e=1/a.setFromMatrixColumn(b,0).length(),f=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,2).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if("XYZ"===a.order){a=f*h;var k=f*e,l=c*h,m=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=k+l*d;b[5]=a-m*d;b[9]=-c*g;b[2]=m-a*d;b[6]=l+k*d;b[10]=f*g}else"YXZ"===a.order?(a=g*h,k=g*e,l=d*h,m=d*e,b[0]=a+m*c,b[4]=l*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-l,b[6]=m+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,k=g*e,l=d*h,m=d*e,b[0]=a-m*c,b[4]=-f*e,b[8]=l+k*c,b[1]=k+l*c,b[5]=f*h,b[9]=m-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,k=f*e,l=c*h,m=c*e,b[0]=g*h,b[4]=l*d-k,b[8]=a*d+m,b[1]=g*e,b[5]=m*d+a,b[9]=k*d-l,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,k=f*d,l=c*g,m=c*d,b[0]=g*h,b[4]=m-a*e,b[8]=l*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+l,b[10]=a-m*e):"XZY"===a.order&&(a=f*g,k=f*d,l=c*g,m=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+m,b[5]=f*h,b[9]=k*e-l,b[2]=l*e-k,b[6]=c*h,b[10]=m*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var l=c*h,c=c*k,m=d*h,d=d*k,e=e*k,g=f*g,h=f*h,f=f*k;b[0]=1-(m+e);b[4]=l-f;b[8]=c+h;b[1]=l+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(d,e,f){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3);var g=this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.lengthSq()&&(c.z+=1e-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],k=c[12],l=c[1],m=c[5],p=c[9],n=c[13],q=c[2],r=c[6],s=c[10],v=c[14],t=c[3],u=c[7],D=c[11],c=c[15],w=d[0],I=d[4],z=d[8],y=d[12],A=d[1],G=d[5],B=d[9],F=d[13],J=d[2],P=d[6],K=d[10],H=d[14],M=d[3],O=d[7],N=d[11],d=d[15];e[0]=f*w+g*A+h*J+k*M;e[4]=f*I+g*G+h*P+k*O;e[8]=f*z+g*B+h*K+k*N;e[12]=f*y+g*F+h*H+k*d;e[1]=l*w+m*A+p*J+n*M;e[5]=l*I+m*G+p*P+n*O;e[9]=l*z+m*B+p*K+n*N;e[13]=l*y+m*F+p*H+n*d;e[2]=q*w+r*A+s*J+v*M;e[6]=q*I+r*G+s*P+v*O;e[10]=q*z+r*B+s*K+v*N;e[14]=q*y+r*F+s*H+v*d;e[3]=t*w+u*A+D*J+c*M;e[7]=t*I+u*G+D*P+c*O;e[11]=t*z+u*B+D*K+c*N;e[15]=t*y+u*F+D*H+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],k=a[13],l=a[2],m=a[6],p=a[10],n=a[14];return a[3]*(+e*h*m-d*k*m-e*g*p+c*k*p+d*g*n-c*h*n)+a[7]*(+b*h*n-b*k*p+e*f*p-d*f*n+d*k*l-e*h*l)+a[11]*(+b*k*m-b*g*n-e*f*m+c*f*n+e*g*l-c*k*l)+a[15]*(-d*g*l-b*h*m+b*g*p+d*f*m-c*f*p+c*h*l)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new THREE.Vector3);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],k=d[4],l=d[5],m=d[6],p=d[7],n=d[8],q=d[9],r=d[10],s=d[11],v=d[12],t=d[13],u=d[14],d=d[15],D=q*u*p-t*r*p+t*m*s-l*u*s-q*m*d+l*r*d,w=v*r*p-n*u*p-v*m*s+k*u*s+n*m*d-k*r*d,I=n*t*p-v*q*p+v*l*s-k*t*s-n*l*d+k*q*d,z=v*q*m-n*t*m-v*l*r+k*t*r+n*l*u-k*q*u,y=e*D+f*w+g*I+h*z;if(0===y){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}y=1/y;c[0]=D*y;c[1]=(t*r*h-q*u*h-t*g*s+f*u*s+q*g*d-f*r*d)*y;c[2]=(l*u*h-t*m*h+t*g*p-f*u*p-l*g*d+f*m*d)*y;c[3]=(q*m*h-l*r*h-q*g*p+f*r*p+l*g*s-f*m*s)*y;c[4]=w*y;c[5]=(n*u*h-v*r*h+v*g*s-e*u*s-n*g*d+e*r*d)*y;c[6]=(v*m*h-k*u*h-v*g*p+e*u*p+k*g*d-e*m*d)*y;c[7]=(k*r*h-n*m*h+n*g*p-e*r*p-k*g*s+e*m*s)*y;c[8]=I*y;c[9]=(v*q*h-n*t*h-v*f*s+e*t*s+n*f*d-e*q*d)*y;c[10]=(k*t*h-v*l*h+v*f*p-e*t*p-k*f*d+e*l*d)*y;c[11]=(n*l*h-k*q*h-n*f*p+e*q*p+k*f*s-e*l*s)*y;c[12]=z*y;c[13]=(n*t*g-v*q*g+v*f*r-e*t*r-n*f*u+e*q*u)*y;c[14]=(v*l*g-k*t*g-v*f*m+e*t*m+k*f*u-e*l*u)*y;c[15]=(k*q*g-n*l*g+n*f*m-e*q*m-k*f*r+e*l*r)*y;return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,k=e*f,l=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*g+d*h,l*g+c,l*h-d*f,0,k*h-d*g,l*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,d,e){void 0===a&&(a=new THREE.Vector3,b=new THREE.Matrix4);var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/h,l=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.DEG2RAD*a*.5);var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),k=1/(c-d),l=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*k;g[9]=0;g[13]=-((c+d)*k);g[2]=0;g[6]=0;g[10]=-2*l;g[14]=-((f+e)*l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a){this.elements.set(a);return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),l=c.dot(this.direction),m=-c.dot(b),p=c.lengthSq(),n=Math.abs(1-k*k),q;0<n?(d=k*m-l,e=k*l-m,q=h*n,0<=d?e>=-q?e<=q?(h=1/n,d*=h,e*=h,k=d*(d+k*e+2*l)+e*(k*d+e+2*m)+p):(e=h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*m)+p):(e=-h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*m)+p):e<=-q?(d=Math.max(0,-(-k*h+l)),e=0<d?-h:Math.min(Math.max(-h,-m),h),k=-d*d+e*(e+2*m)+p):e<=q?(d=0,e=Math.min(Math.max(-h,-m),h),k=e*(e+2*m)+p):(d=Math.max(0,-(k*h+l)),e=0<d?h:Math.min(Math.max(-h,-m),h),k=-d*d+e*(e+2*m)+p)):(e=0<k?-h:h,d=Math.max(0,-(k*e+l)),k=-d*d+e*(e+2*m)+p);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return k}}(),intersectSphere:function(){var a=new THREE.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;
if(e>f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!==d)d=f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c>g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0>d?null:this.at(0<=c?c:d,b)},intersectsBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new THREE.Vector3;d.copy(a);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}};THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],l=c[7],m=c[8],p=c[9],n=c[10],q=c[11],r=c[12],s=c[13],v=c[14],c=c[15];b[0].setComponents(f-a,l-g,q-m,c-r).normalize();b[1].setComponents(f+a,l+g,q+m,c+r).normalize();b[2].setComponents(f+d,l+h,q+p,c+s).normalize();b[3].setComponents(f-d,l-h,q-p,c-s).normalize();b[4].setComponents(f-e,l-k,q-n,c-v).normalize();b[5].setComponents(f+e,l+k,q+n,c+v).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new THREE.Sphere;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0===f){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(b.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Matrix3;return function(c,d){var e=this.coplanarPoint(a).applyMatrix4(c),f=d||b.getNormalMatrix(c),f=this.normal.applyMatrix3(f).normalize();this.constant=-e.dot(f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};THREE.Spherical=function(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this};THREE.Spherical.prototype={constructor:THREE.Spherical,set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(THREE.Math.clamp(a.y/this.radius,-1,1)));return this}};THREE.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8===e||13===e||18===e||23===e?b[e]="-":14===e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19===e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*THREE.Math.DEG2RAD},radToDeg:function(a){return a*THREE.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};THREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,l,m,p,n;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+2;l=this.points[c[0]];m=this.points[c[1]];p=this.points[c[2]];n=this.points[c[3]];h=g*g;k=g*h;d.x=b(l.x,m.x,p.x,n.x,g,h,k);d.y=b(l.y,m.y,p.y,n.y,g,h,k);d.z=b(l.z,m.z,p.z,n.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=b=b=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=a/c,d=this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],k=new THREE.Vector3,l=this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=l.chunks[b]-l.chunks[b-1];g=Math.ceil(a*c/l.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(k.copy(d).clone());h.push(k.copy(this.points[b]).clone())}this.points=h}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var l=d*k-e*e;h=h||new THREE.Vector3;if(0===l)return h.set(-2,-1,-1);l=1/l;k=(k*f-e*g)*l;d=(d*g-e*f)*l;return h.set(1-k-d,d,k)}}();THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},closestPointToPoint:function(){var a,b,c,d;return function(e,f){void 0===a&&(a=new THREE.Plane,b=[new THREE.Line3,new THREE.Line3,new THREE.Line3],c=new THREE.Vector3,d=new THREE.Vector3);var g=f||new THREE.Vector3,h=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))g.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var k=0;k<b.length;k++){b[k].closestPointToPoint(c,!0,d);var l=c.distanceToSquared(d);l<h&&(h=l,g.copy(d))}}return g}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};THREE.Interpolant=function(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c};THREE.Interpolant.prototype={constructor:THREE.Interpolant,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=c;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=c[a+e];return b},interpolate_:function(a,b,c,d){throw Error("call to abstract method")},intervalChanged_:function(a,b,c){}};Object.assign(THREE.Interpolant.prototype,{beforeStart_:THREE.Interpolant.prototype.copySampleValue_,afterEnd_:THREE.Interpolant.prototype.copySampleValue_});THREE.CubicInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0};THREE.CubicInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case THREE.ZeroSlopeEnding:e=a;g=2*b-c;break;case THREE.WrapAroundEnding:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case THREE.ZeroSlopeEnding:f=a;h=2*c-b;break;case THREE.WrapAroundEnding:f=1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g,k=this._offsetPrev,l=this._offsetNext,m=this._weightPrev,p=this._weightNext,n=(c-b)/(d-b);c=n*n;d=c*n;b=-m*d+2*m*c-m*n;m=(1+m)*d+(-1.5-2*m)*c+(-.5+m)*n+1;n=(-1-p)*d+(1.5+p)*c+.5*n;p=p*d-p*c;for(c=0;c!==g;++c)e[c]=b*f[k+c]+m*f[h+c]+n*f[a+c]+p*f[l+c];return e}});THREE.DiscreteInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(a,b,c,d){return this.copySampleValue_(a-1)}});THREE.LinearInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};THREE.LinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[h+d]*c+f[a+d]*b;return e}});THREE.QuaternionLinearInterpolant=function(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)};THREE.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;b=(c-b)/(d-b);for(c=a+g;a!==c;a+=4)THREE.Quaternion.slerpFlat(e,0,f,a-g,f,a,b);return e}});THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=(performance||Date).now(),a=(b-this.oldTime)/1e3;this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};Object.assign(THREE.EventDispatcher.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=0,e=b.length,d=0;d<e;d++)c[d]=b[d];for(d=0;d<e;d++)c[d].call(this,a)}}}});THREE.Layers=function(){this.mask=1};THREE.Layers.prototype={constructor:THREE.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};(function(a){function b(a,b){return a.distance-b.distance}function c(a,b,f,g){if(!1!==a.visible&&(a.raycast(b,f),!0===g)){a=a.children;g=0;for(var h=a.length;g<h;g++)c(a[g],b,f,!0)}}a.Raycaster=function(b,c,f,g){this.ray=new a.Ray(b,c);this.near=f||0;this.far=g||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};a.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,e){var f=[];c(a,this,f,e);f.sort(b);return f},intersectObjects:function(a,e){var f=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),f;for(var g=0,h=a.length;g<h;g++)c(a[g],this,f,e);f.sort(b);return f}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}});this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new THREE.Layers;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.DefaultMatrixAutoUpdate=!0;Object.assign(THREE.Object3D.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a instanceof THREE.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||""===a,d={};c&&(a={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var e={};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&(e.visible=!1);e.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),e.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),e.material=this.material.uuid);if(0<this.children.length){e.children=[];for(var f=0;f<this.children.length;f++)e.children.push(this.children[f].toJSON(a).object)}if(c){var c=b(a.geometries),f=b(a.materials),g=b(a.textures);a=b(a.images);0<c.length&&(d.geometries=c);0<f.length&&(d.materials=f);0<g.length&&(d.textures=g);0<a.length&&(d.images=a)}d.object=e;return d},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}});THREE.Object3DIdCount=0;THREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=Array.isArray(d)?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=void 0!==f?f:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};THREE.BufferAttribute=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.array=a;this.itemSize=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0;this.normalized=!0===c};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),f=new THREE.Color);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];b[c++]=f.a;b[c++]=f.b;b[c++]=f.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new THREE.Vector2);b[c++]=f.x;b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new THREE.Vector3);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),f=new THREE.Vector4);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return(new this.constructor).copy(this)}};THREE.Int8Attribute=function(a,b){return new THREE.BufferAttribute(new Int8Array(a),b)};THREE.Uint8Attribute=function(a,b){
return new THREE.BufferAttribute(new Uint8Array(a),b)};THREE.Uint8ClampedAttribute=function(a,b){return new THREE.BufferAttribute(new Uint8ClampedArray(a),b)};THREE.Int16Attribute=function(a,b){return new THREE.BufferAttribute(new Int16Array(a),b)};THREE.Uint16Attribute=function(a,b){return new THREE.BufferAttribute(new Uint16Array(a),b)};THREE.Int32Attribute=function(a,b){return new THREE.BufferAttribute(new Int32Array(a),b)};THREE.Uint32Attribute=function(a,b){return new THREE.BufferAttribute(new Uint32Array(a),b)};THREE.Float32Attribute=function(a,b){return new THREE.BufferAttribute(new Float32Array(a),b)};THREE.Float64Attribute=function(a,b){return new THREE.BufferAttribute(new Float64Array(a),b)};THREE.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new THREE.BufferAttribute(a,b).setDynamic(!0)};THREE.InstancedBufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;THREE.InstancedBufferAttribute.prototype.copy=function(a){THREE.BufferAttribute.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBuffer=function(a,b){this.uuid=THREE.Math.generateUUID();this.array=a;this.stride=b;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0};THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};THREE.InstancedInterleavedBuffer=function(a,b,c){THREE.InterleavedBuffer.call(this,a,b);this.meshPerAttribute=c||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;THREE.InstancedInterleavedBuffer.prototype.copy=function(a){THREE.InterleavedBuffer.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};THREE.InterleavedBufferAttribute=function(a,b,c,d){this.uuid=THREE.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c;this.normalized=!0===d};THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.data.count},get array(){return this.data.array},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return this}};THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1};Object.assign(THREE.Geometry.prototype,THREE.EventDispatcher.prototype,{applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0!==g?[m[a].clone(),m[b].clone(),m[d].clone()]:[],q=void 0!==h?[c.colors[a].clone(),c.colors[b].clone(),c.colors[d].clone()]:[];e=new THREE.Face3(a,b,d,f,q,e);c.faces.push(e);void 0!==k&&c.faceVertexUvs[0].push([p[a].clone(),p[b].clone(),p[d].clone()]);void 0!==l&&c.faceVertexUvs[1].push([n[a].clone(),n[b].clone(),n[d].clone()])}var c=this,d=null!==a.index?a.index.array:void 0,e=a.attributes,f=e.position.array,g=void 0!==e.normal?e.normal.array:void 0,h=void 0!==e.color?e.color.array:void 0,k=void 0!==e.uv?e.uv.array:void 0,l=void 0!==e.uv2?e.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var m=[],p=[],n=[],q=e=0;e<f.length;e+=3,q+=2)c.vertices.push(new THREE.Vector3(f[e],f[e+1],f[e+2])),void 0!==g&&m.push(new THREE.Vector3(g[e],g[e+1],g[e+2])),void 0!==h&&c.colors.push(new THREE.Color(h[e],h[e+1],h[e+2])),void 0!==k&&p.push(new THREE.Vector2(k[q],k[q+1])),void 0!==l&&n.push(new THREE.Vector2(l[q],l[q+1]));if(void 0!==d)if(f=a.groups,0<f.length)for(e=0;e<f.length;e++)for(var r=f[e],s=r.start,v=r.count,q=s,s=s+v;q<s;q+=3)b(d[q],d[q+1],d[q+2],r.materialIndex);else for(e=0;e<d.length;e+=3)b(d[e],d[e+1],d[e+2]);else for(e=0;e<f.length/3;e+=3)b(e,e+1,e+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,b=0===b?1:1/b,c=new THREE.Matrix4;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b,c,d;d=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<c;b++)d[b]=new THREE.Vector3;if(a){var e,f,g,h=new THREE.Vector3,k=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else for(a=0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<b;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new THREE.Geometry;f.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var g=this.morphNormals[a].vertexNormals,h,k;c=0;for(d=this.faces.length;c<d;c++)h=new THREE.Vector3,k={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},e.push(h),g.push(k)}g=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===a instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,l=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==b&&(d=(new THREE.Matrix3).getNormalMatrix(b));for(var m=0,p=g.length;m<p;m++){var n=g[m].clone();void 0!==b&&n.applyMatrix4(b);f.push(n)}m=0;for(p=k.length;m<p;m++){var g=k[m],q,r=g.vertexNormals,s=g.vertexColors,n=new THREE.Face3(g.a+e,g.b+e,g.c+e);n.normal.copy(g.normal);void 0!==d&&n.normal.applyMatrix3(d).normalize();b=0;for(f=r.length;b<f;b++)q=r[b].clone(),void 0!==d&&q.applyMatrix3(d).normalize(),n.vertexNormals.push(q);n.color.copy(g.color);b=0;for(f=s.length;b<f;b++)q=s[b],n.vertexColors.push(q.clone());n.materialIndex=g.materialIndex+c;h.push(n)}m=0;for(p=a.length;m<p;m++)if(c=a[m],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(c[b].clone());l.push(d)}}},mergeMesh:function(a){!1===a instanceof THREE.Mesh?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<g;f++)d=this.vertices[f],d=Math.round(d.x*e)+"_"+Math.round(d.y*e)+"_"+Math.round(d.z*e),void 0===a[d]?(a[d]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[d]];a=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]===e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e,1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=b;return f},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var h=a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=g)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==l[b])return l[b];l[b]=k.length/3;k.push(a.x,a.y,a.z);return l[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==p[b])return p[b];p[b]=m.length;m.push(a.getHex());return p[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==q[b])return q[b];q[b]=n.length/2;n.push(a.x,a.y);return q[b]}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}var h=[],k=[],l={},m=[],p={},n=[],q={};for(g=0;g<this.faces.length;g++){var r=this.faces[g],s=void 0!==this.faceVertexUvs[0][g],v=0<r.normal.length(),t=0<r.vertexNormals.length,u=1!==r.color.r||1!==r.color.g||1!==r.color.b,D=0<r.vertexColors.length,w=0,w=a(w,0,0),w=a(w,1,!0),w=a(w,2,!1),w=a(w,3,s),w=a(w,4,v),w=a(w,5,t),w=a(w,6,u),w=a(w,7,D);h.push(w);h.push(r.a,r.b,r.c);h.push(r.materialIndex);s&&(s=this.faceVertexUvs[0][g],h.push(d(s[0]),d(s[1]),d(s[2])));v&&h.push(b(r.normal));t&&(v=r.vertexNormals,h.push(b(v[0]),b(v[1]),b(v[2])));u&&h.push(c(r.color));D&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<m.length&&(e.data.colors=m);0<n.length&&(e.data.uvs=[n]);e.data.faces=h;return e},clone:function(){return(new THREE.Geometry).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());b=a.faces;c=0;for(d=b.length;c<d;c++)this.faces.push(b[c].clone());c=0;for(d=a.faceVertexUvs.length;c<d;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var e=0,f=b.length;e<f;e++){for(var g=b[e],h=[],k=0,l=g.length;k<l;k++)h.push(g[k].clone());this.faceVertexUvs[c].push(h)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});THREE.GeometryIdCount=0;THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1};Object.assign(THREE.DirectGeometry.prototype,THREE.EventDispatcher.prototype,{computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(a){var b,c=[],d;a=a.faces;for(var e=0;e<a.length;e++){var f=a[e];f.materialIndex!==d&&(d=f.materialIndex,void 0!==b&&(b.count=3*e-b.start,c.push(b)),b={start:3*e,materialIndex:d})}void 0!==b&&(b.count=3*e-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,h=g.length,k;if(0<h){k=[];for(var l=0;l<h;l++)k[l]=[];this.morphTargets.position=k}var m=a.morphNormals,p=m.length,n;if(0<p){n=[];for(l=0;l<p;l++)n[l]=[];this.morphTargets.normal=n}for(var q=a.skinIndices,r=a.skinWeights,s=q.length===c.length,v=r.length===c.length,l=0;l<b.length;l++){var t=b[l];this.vertices.push(c[t.a],c[t.b],c[t.c]);var u=t.vertexNormals;3===u.length?this.normals.push(u[0],u[1],u[2]):(u=t.normal,this.normals.push(u,u,u));u=t.vertexColors;3===u.length?this.colors.push(u[0],u[1],u[2]):(u=t.color,this.colors.push(u,u,u));!0===e&&(u=d[0][l],void 0!==u?this.uvs.push(u[0],u[1],u[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));!0===f&&(u=d[1][l],void 0!==u?this.uvs2.push(u[0],u[1],u[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)));for(u=0;u<h;u++){var D=g[u].vertices;k[u].push(D[t.a],D[t.b],D[t.c])}for(u=0;u<p;u++)D=m[u].vertexNormals[l],n[u].push(D.a,D.b,D.c);s&&this.skinIndices.push(q[t.a],q[t.b],q[t.c]);v&&this.skinWeights.push(r[t.a],r[t.b],r[t.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}};Object.assign(THREE.BufferGeometry.prototype,THREE.EventDispatcher.prototype,{getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b,c){if(!1===b instanceof THREE.BufferAttribute&&!1===b instanceof THREE.InterleavedBufferAttribute)console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new THREE.BufferAttribute(b,c));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new THREE.Object3D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Points||a instanceof THREE.Line){a=new THREE.Float32Attribute(3*b.vertices.length,3);var c=new THREE.Float32Attribute(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));this.addAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&(a=new THREE.Float32Attribute(b.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a instanceof THREE.Mesh&&b instanceof THREE.Geometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a instanceof THREE.Mesh){var c=b.__directGeometry;if(void 0===c||!0===b.elementsNeedUpdate)return this.fromGeometry(b);c.verticesNeedUpdate=b.verticesNeedUpdate||b.elementsNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate||b.elementsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate||b.elementsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate||b.elementsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate||b.elementsNeedUpdate;b.elementsNeedUpdate=!1;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new THREE.DirectGeometry).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute("position",new THREE.BufferAttribute(b,3).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",new THREE.BufferAttribute(b,3).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute("color",new THREE.BufferAttribute(b,3).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",new THREE.BufferAttribute(b,2).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",new THREE.BufferAttribute(b,2).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new(65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex(new THREE.BufferAttribute(b,1).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var b=[],d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],h=new THREE.Float32Attribute(3*g.length,3);b.push(h.copyVector3sArray(g))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new THREE.Float32Attribute(4*a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new THREE.Float32Attribute(4*a.skinWeights.length,4),this.addAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var a=this.attributes.position.array;void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position;if(c){var c=c.array,d=this.boundingSphere.center;a.setFromArray(c);a.center(d);for(var e=0,f=0,g=c.length;f<g;f+=3)b.fromArray(c,f),e=Math.max(e,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var d=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(d.length),3));else for(var e=b.normal.array,f=0,g=e.length;f<g;f++)e[f]=0;var e=b.normal.array,h,k,l,m=new THREE.Vector3,p=new THREE.Vector3,n=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var s=0,v=c.length;s<v;++s)for(f=c[s],g=f.start,h=f.count,f=g,g+=h;f<g;f+=3)h=3*a[f+0],k=3*a[f+1],l=3*a[f+2],m.fromArray(d,h),p.fromArray(d,k),n.fromArray(d,l),q.subVectors(n,p),r.subVectors(m,p),q.cross(r),e[h]+=q.x,e[h+1]+=q.y,e[h+2]+=q.z,e[k]+=q.x,e[k+1]+=q.y,e[k+2]+=q.z,e[l]+=q.x,e[l+1]+=q.y,e[l+2]+=q.z}else for(f=0,g=d.length;f<g;f+=9)m.fromArray(d,f),p.fromArray(d,f+3),n.fromArray(d,f+6),q.subVectors(n,p),r.subVectors(m,p),q.cross(r),e[f]=q.x,e[f+1]=q.y,e[f+2]=q.z,e[f+3]=q.x,e[f+4]=q.y,e[f+5]=q.z,e[f+6]=q.x,e[f+7]=q.y,e[f+8]=q.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===a instanceof THREE.BufferGeometry)console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===b&&(b=0);var c=this.attributes,d;for(d in c)if(void 0!==a.attributes[d])for(var e=c[d].array,f=a.attributes[d],g=f.array,h=0,f=f.itemSize*b;h<g.length;h++,f++)e[f]=g[h];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new THREE.BufferGeometry,b=this.index.array,c=this.attributes,d;for(d in c){for(var e=c[d],f=e.array,e=e.itemSize,g=new f.constructor(b.length*e),h=0,k=0,l=0,m=b.length;l<m;l++)for(var h=b[l]*e,p=0;p<e;p++)g[k++]=f[h++];a.addAttribute(d,new THREE.BufferAttribute(g,e))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,c;for(c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(b=Array.prototype.slice.call(d.array),a.data.index={type:d.array.constructor.name,array:b});d=this.attributes;for(c in d){var e=d[c],b=Array.prototype.slice.call(e.array);a.data.attributes[c]={itemSize:e.itemSize,type:e.array.constructor.name,array:b,normalized:e.normalized}}c=this.groups;0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),radius:c.radius});return a},clone:function(){return(new THREE.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});THREE.BufferGeometry.MaxIndex=65535;THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0};THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};THREE.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.instances)}return this};THREE.Uniform=function(a,b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a;this.dynamic=!1};THREE.Uniform.prototype={constructor:THREE.Uniform,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};THREE.AnimationAction=function(){throw Error("THREE.AnimationAction: Use mixer.clipAction for construction.")};THREE.AnimationAction._new=function(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var d={endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=THREE.LoopRepeat;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0};THREE.AnimationAction._new.prototype={constructor:THREE.AnimationAction._new,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,e=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping();
},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;d[1]=e+c;f[0]=a/g;f[1]=b/g;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,d){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var e=this._propertyBindings,f=0,g=b.length;f!==g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(d===THREE.LoopOnce)a:{if(-1===e&&(this.loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{d=d===THREE.LoopPingPong;-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,d)):this._setEndings(0===this.repetitions,!0,d));if(b>=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,b,c){var d=this._interpolantSettings;c?(d.endingStart=THREE.ZeroSlopeEnding,d.endingEnd=THREE.ZeroSlopeEnding):(d.endingStart=a?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,d.endingEnd=b?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}};THREE.AnimationClip=function(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=THREE.Math.generateUUID();0>this.duration&&this.resetDuration();this.trim();this.optimize()};THREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var d=this.tracks[b],a=Math.max(a,d.times[d.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};Object.assign(THREE.AnimationClip,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(THREE.KeyframeTrack.parse(c[e]).scale(d));return new THREE.AnimationClip(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var d=0,e=c.length;d!==e;++d)b.push(THREE.KeyframeTrack.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],k=[];h.push((g+e-1)%e,g,(g+1)%e);k.push(0,1,0);var l=THREE.AnimationUtils.getKeyframeOrder(h),h=THREE.AnimationUtils.sortedArray(h,1,l),k=THREE.AnimationUtils.sortedArray(k,1,l);d||0!==h[0]||(h.push(e),k.push(k[0]));f.push(new THREE.NumberKeyframeTrack(".morphTargetInfluences["+b[g].name+"]",h,k).scale(1/c))}return new THREE.AnimationClip(a,(-1),f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var d=0;d<c.length;d++)if(c[d].name===b)return c[d];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],k=h.name.match(e);if(k&&1<k.length){var l=k[1];(k=d[l])||(d[l]=k=[]);k.push(h)}}a=[];for(l in d)a.push(THREE.AnimationClip.CreateFromMorphTargetSequence(l,d[l],b,c));return a},parseAnimation:function(a,b,c){if(!a)return console.error("  no animation in JSONLoader data"),null;c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];THREE.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&e.push(new a(b,f,g))}};var d=[],e=a.name||"default",f=a.length||-1,g=a.fps||30;a=a.hierarchy||[];for(var h=0;h<a.length;h++){var k=a[h].keys;if(k&&0!==k.length)if(k[0].morphTargets){for(var f={},l=0;l<k.length;l++)if(k[l].morphTargets)for(var m=0;m<k[l].morphTargets.length;m++)f[k[l].morphTargets[m]]=-1;for(var p in f){for(var n=[],q=[],m=0;m!==k[l].morphTargets.length;++m){var r=k[l];n.push(r.time);q.push(r.morphTarget===p?1:0)}d.push(new THREE.NumberKeyframeTrack(".morphTargetInfluence["+p+"]",n,q))}f=f.length*(g||1)}else l=".bones["+b[h].name+"]",c(THREE.VectorKeyframeTrack,l+".position",k,"pos",d),c(THREE.QuaternionKeyframeTrack,l+".quaternion",k,"rot",d),c(THREE.VectorKeyframeTrack,l+".scale",k,"scl",d)}return 0===d.length?null:new THREE.AnimationClip(e,f,d)}});THREE.AnimationMixer=function(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1};Object.assign(THREE.AnimationMixer.prototype,THREE.EventDispatcher.prototype,{clipAction:function(a,b){var c=b||this._root,d=c.uuid,e="string"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=null!==e?e.uuid:a,f=this._actionsByClip[c],g=null;if(void 0!==f){g=f.actionByRoot[d];if(void 0!==g)return g;g=f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return null;e=new THREE.AnimationMixer._Action(this,e,b);this._bindAction(e,g);this._addInactiveAction(e,c,d);return e},existingAction:function(a,b){var c=b||this._root,d=c.uuid,c="string"===typeof a?THREE.AnimationClip.findByName(c,a):a,c=this._actionsByClip[c?c.uuid:a];return void 0!==c?c.actionByRoot[d]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,d=this._nActiveBindings,e=this._nActiveBindings=this._nActiveActions=0;e!==b;++e)a[e].reset();for(e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var h=b[g];h.enabled&&h._update(d,a,e,f)}a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){for(var d=d.knownActions,e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var h=g._cacheIndex,k=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;k._cacheIndex=h;b[h]=k;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var d=b[c].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(var e in c)a=c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}});THREE.AnimationMixer._Action=THREE.AnimationAction._new;Object.assign(THREE.AnimationMixer.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings,g=a._interpolants,h=c.uuid,k=this._bindingsByRootAndName,l=k[h];void 0===l&&(l={},k[h]=l);for(k=0;k!==e;++k){var m=d[k],p=m.name,n=l[p];if(void 0===n){n=f[k];if(void 0!==n){null===n._cacheIndex&&(++n.referenceCount,this._addInactiveBinding(n,h,p));continue}n=new THREE.PropertyMixer(THREE.PropertyBinding.create(c,p,b&&b._propertyBindings[k].binding.parsedPath),m.ValueTypeName,m.getValueSize());++n.referenceCount;this._addInactiveBinding(n,h,p)}f[k]=n;g[k].resultBuffer=n.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=f.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;var c=a._clip.uuid,d=this._actionsByClip,e=d[c],f=e.knownActions,g=f[f.length-1],h=a._byClipCacheIndex;g._byClipCacheIndex=h;f[h]=g;f.pop();a._byClipCacheIndex=null;delete e.actionByRoot[(b._localRoot||this._root).uuid];0===f.length&&delete d[c];this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,e=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e);e[c]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,c=c.path,e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var h in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new THREE.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1)});THREE.AnimationObjectGroup=function(a){this.uuid=THREE.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,d=arguments.length;c!==d;++c)b[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}};THREE.AnimationObjectGroup.prototype={constructor:THREE.AnimationObjectGroup,add:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._paths,g=this._parsedPaths,h=this._bindings,k=h.length,l=0,m=arguments.length;l!==m;++l){var p=arguments[l],n=p.uuid,q=e[n];if(void 0===q){q=c++;e[n]=q;b.push(p);for(var n=0,r=k;n!==r;++n)h[n].push(new THREE.PropertyBinding(p,f[n],g[n]))}else if(q<d){var s=b[q],v=--d,r=b[v];e[r.uuid]=q;b[q]=r;e[n]=v;b[v]=p;n=0;for(r=k;n!==r;++n){var t=h[n],u=t[q];t[q]=t[v];void 0===u&&(u=new THREE.PropertyBinding(p,f[n],g[n]));t[v]=u}}else b[q]!==s&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=d},remove:function(a){for(var b=this._objects,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var k=arguments[g],l=k.uuid,m=d[l];if(void 0!==m&&m>=c){var p=c++,n=b[p];d[n.uuid]=m;b[m]=n;d[l]=p;b[p]=k;k=0;for(l=f;k!==l;++k){var n=e[k],q=n[m];n[m]=n[p];n[p]=q}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,m=e[l];if(void 0!==m)if(delete e[l],m<d){var l=--d,p=b[l],n=--c,q=b[n];e[p.uuid]=m;b[m]=p;e[q.uuid]=l;b[l]=q;b.pop();p=0;for(q=g;p!==q;++p){var r=f[p],s=r[n];r[m]=r[l];r[l]=s;r.pop()}}else for(n=--c,q=b[n],e[q.uuid]=m,b[m]=q,b.pop(),p=0,q=g;p!==q;++p)r=f[p],r[m]=r[n],r.pop()}this.nCachedObjects_=d},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),d=e.length;c[a]=d;f.push(a);g.push(b);e.push(l);c=k;for(d=h.length;c!==d;++c)l[c]=new THREE.PropertyBinding(h[c],a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};THREE.AnimationUtils={arraySlice:function(a,b,c){return THREE.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,b,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,k=0;k!==b;++k)e[g++]=a[h+k];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++];while(void 0!==f)}}}};THREE.KeyframeTrack=function(a,b,c,d){if(void 0===a)throw Error("track name is undefined");if(void 0===b||0===b.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=THREE.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=THREE.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()};THREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return new THREE.DiscreteInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new THREE.LinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new THREE.CubicInterpolant(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){var b;switch(a){case THREE.InterpolateDiscrete:b=this.InterpolantFactoryMethodDiscrete;break;case THREE.InterpolateLinear:b=this.InterpolantFactoryMethodLinear;break;case THREE.InterpolateSmooth:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return THREE.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return THREE.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return THREE.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),d=this.getValueSize(),this.times=THREE.AnimationUtils.arraySlice(c,e,f),this.values=THREE.AnimationUtils.arraySlice(this.values,e*d,f*d);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("invalid value size in track",this),a=!1);var c=this.times,b=this.values,d=c.length;0===d&&(console.error("track is empty",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if("number"===typeof g&&isNaN(g)){console.error("time is not a valid number",this,f,g);a=!1;break}if(null!==e&&e>g){console.error("out of order keys",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&THREE.AnimationUtils.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error("value is not a valid number",this,f,d);a=!1;break}return a},optimize:function(){for(var a=this.times,b=this.values,c=this.getValueSize(),d=1,e=1,f=a.length-1;e<=f;++e){var g=!1,h=a[e];if(h!==a[e+1]&&(1!==e||h!==h[0]))for(var k=e*c,l=k-c,m=k+c,h=0;h!==c;++h){var p=b[k+h];if(p!==b[l+h]||p!==b[m+h]){g=!0;break}}if(g){if(e!==d)for(a[d]=a[e],g=e*c,k=d*c,h=0;h!==c;++h)b[k+h]=b[g+h];++d}}d!==a.length&&(this.times=THREE.AnimationUtils.arraySlice(a,0,d),this.values=THREE.AnimationUtils.arraySlice(b,0,d*c));return this}};Object.assign(THREE.KeyframeTrack,{parse:function(a){if(void 0===a.type)throw Error("track type undefined, can not parse");var b=THREE.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var c=[],d=[];THREE.AnimationUtils.flattenJSON(a.keys,c,d,"value");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{var b={name:a.name,times:THREE.AnimationUtils.convertArray(a.times,Array),values:THREE.AnimationUtils.convertArray(a.values,Array)},c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return THREE.NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return THREE.VectorKeyframeTrack;case"color":return THREE.ColorKeyframeTrack;case"quaternion":return THREE.QuaternionKeyframeTrack;case"bool":case"boolean":return THREE.BooleanKeyframeTrack;case"string":return THREE.StringKeyframeTrack}throw Error("Unsupported typeName: "+a)}});THREE.PropertyBinding=function(a,b,c){this.path=b;this.parsedPath=c||THREE.PropertyBinding.parseTrackName(b);this.node=THREE.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a};THREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=THREE.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case"materials":if(!a.material){console.error("  can not bind to material as node does not have a material",this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}a=a.material.materials;break;case"bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[c]}if(void 0!==f){if(void 0===a[f]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error("  trying to update property for track: "+b.nodeName+"."+d+" but it wasn't found.",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):void 0!==f.length?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(THREE.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:THREE.PropertyBinding.prototype.getValue,_setValue_unbound:THREE.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});THREE.PropertyBinding.Composite=function(a,b,c){c=c||THREE.PropertyBinding.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};THREE.PropertyBinding.Composite.prototype={constructor:THREE.PropertyBinding.Composite,getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}};THREE.PropertyBinding.create=function(a,b,c){return a instanceof THREE.AnimationObjectGroup?new THREE.PropertyBinding.Composite(a,b,c):new THREE.PropertyBinding(a,b,c)};THREE.PropertyBinding.parseTrackName=function(a){var b=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_.:\- ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,c=b.exec(a);if(!c)throw Error("cannot parse trackName at all: "+a);c.index===b.lastIndex&&b.lastIndex++;b={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===b.propertyName||0===b.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return b};THREE.PropertyBinding.findNode=function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var g=a[c];if(g.name===b||g.uuid===b||(g=d(g.children)))return g}return null};if(c=d(a.children))return c}return null};THREE.PropertyMixer=function(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case"quaternion":b=this._slerp;break;case"string":case"bool":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0};THREE.PropertyMixer.prototype={constructor:THREE.PropertyMixer,accumulate:function(a,b){var c=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(f=0;f!==d;++f)c[e+f]=c[f];f=b}else f+=b,this._mixBufferRegion(c,e,0,b/f,d);this.cumulativeWeight=f},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);break}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){THREE.Quaternion.slerpFlat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}}};THREE.BooleanKeyframeTrack=function(a,b,c){THREE.KeyframeTrack.call(this,a,b,c)};THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.ColorKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.ColorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.ColorKeyframeTrack,ValueTypeName:"color"});THREE.NumberKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:"number"});THREE.QuaternionKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(a){return new THREE.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});THREE.StringKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.StringKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:THREE.InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});THREE.VectorKeyframeTrack=function(a,b,c,d){THREE.KeyframeTrack.call(this,a,b,c,d)};THREE.VectorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:"vector"});THREE.Audio=function(a){THREE.Object3D.call(this);this.type="Audio";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]};THREE.Audio.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Audio,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.source.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);
this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(a){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):this.source.loop=a},getVolume:function(){return this.gain.gain.value},setVolume:function(a){this.gain.gain.value=a;return this}});THREE.AudioAnalyser=function(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)};Object.assign(THREE.AudioAnalyser.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}});Object.defineProperty(THREE,"AudioContext",{get:function(){var a;return function(){void 0===a&&(a=new(window.AudioContext||window.webkitAudioContext));return a}}()});THREE.PositionalAudio=function(a){THREE.Audio.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)};THREE.PositionalAudio.prototype=Object.assign(Object.create(THREE.Audio.prototype),{constructor:THREE.PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new THREE.Vector3;return function(b){THREE.Object3D.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=THREE.AudioContext;this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null};THREE.AudioListener.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.AudioListener,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3;return function(e){THREE.Object3D.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,b,c);d.set(0,0,-1).applyQuaternion(b);e.setPosition(a.x,a.y,a.z);e.setOrientation(d.x,d.y,d.z,f.x,f.y,f.z)}}()});THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};THREE.Camera.prototype.copy=function(a){THREE.Object3D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);this.type="CubeCamera";var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3((-1),0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,(-1),0));this.add(g);var h=new THREE.PerspectiveCamera(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,(-1)));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,n=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=n;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.OrthographicCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,f){this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,c=c+a,a=d+b,b=d-b;if(null!==this.view)var c=this.zoom/(this.view.width/this.view.fullWidth),b=this.zoom/(this.view.height/this.view.fullHeight),f=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height,e=e+this.view.offsetX/c*f,c=e+this.view.width/c*f,a=a-this.view.offsetY/b*d,b=a-this.view.height/b*d;this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far)},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2e3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.assign(Object.create(THREE.Camera.prototype),{constructor:THREE.PerspectiveCamera,copy:function(a){THREE.Camera.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*THREE.Math.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*THREE.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*THREE.Math.RAD2DEG*Math.atan(Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==f)var g=f.fullWidth,h=f.fullHeight,e=e+f.offsetX*d/g,b=b-f.offsetY*c/h,d=f.width/g*d,c=f.height/h*c;f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+d,b-c,b,a,this.far)},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});THREE.StereoCamera=function(){this.type="StereoCamera";this.aspect=1;this.cameraL=new THREE.PerspectiveCamera;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new THREE.PerspectiveCamera;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1};Object.assign(THREE.StereoCamera.prototype,{update:function(){var a,b,c,d,e,f=new THREE.Matrix4,g=new THREE.Matrix4;return function(h){if(a!==h.focus||b!==h.fov||c!==h.aspect*this.aspect||d!==h.near||e!==h.far){a=h.focus;b=h.fov;c=h.aspect*this.aspect;d=h.near;e=h.far;var k=h.projectionMatrix.clone(),l=.032*d/a,m=d*Math.tan(THREE.Math.DEG2RAD*b*.5),p,n;g.elements[12]=-.032;f.elements[12]=.032;p=-m*c+l;n=m*c+l;k.elements[0]=2*d/(n-p);k.elements[8]=(n+p)/(n-p);this.cameraL.projectionMatrix.copy(k);p=-m*c-l;n=m*c-l;k.elements[0]=2*d/(n-p);k.elements[8]=(n+p)/(n-p);this.cameraR.projectionMatrix.copy(k)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(g);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(f)}}()});THREE.Light=function(a,b){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0};THREE.Light.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Light,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);return a}});THREE.LightShadow=function(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new THREE.Vector2(512,512);this.map=null;this.matrix=new THREE.Matrix4};Object.assign(THREE.LightShadow.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)}});THREE.AmbientLight=function(a,b){THREE.Light.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0};THREE.AmbientLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.AmbientLight});THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a,b);this.type="DirectionalLight";this.position.copy(THREE.Object3D.DefaultUp);this.updateMatrix();this.target=new THREE.Object3D;this.shadow=new THREE.DirectionalLightShadow};THREE.DirectionalLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.DirectionalLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.DirectionalLightShadow=function(a){THREE.LightShadow.call(this,new THREE.OrthographicCamera((-5),5,5,(-5),.5,500))};THREE.DirectionalLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.DirectionalLightShadow});THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a,c);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(THREE.Object3D.DefaultUp);this.updateMatrix();this.groundColor=new THREE.Color(b)};THREE.HemisphereLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.HemisphereLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});THREE.PointLight=function(a,b,c,d){THREE.Light.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==d?d:1;this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,.5,500))};THREE.PointLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.PointLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});THREE.SpotLight=function(a,b,c,d,e,f){THREE.Light.call(this,a,b);this.type="SpotLight";this.position.copy(THREE.Object3D.DefaultUp);this.updateMatrix();this.target=new THREE.Object3D;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new THREE.SpotLightShadow};THREE.SpotLight.prototype=Object.assign(Object.create(THREE.Light.prototype),{constructor:THREE.SpotLight,copy:function(a){THREE.Light.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});THREE.SpotLightShadow=function(){THREE.LightShadow.call(this,new THREE.PerspectiveCamera(50,1,.5,500))};THREE.SpotLightShadow.prototype=Object.assign(Object.create(THREE.LightShadow.prototype),{constructor:THREE.SpotLightShadow,update:function(a){var b=2*THREE.Math.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var d=this.camera;if(b!==d.fov||c!==d.aspect||a!==d.far)d.fov=b,d.aspect=c,d.far=a,d.updateProjectionMatrix()}});THREE.AudioLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.AudioLoader.prototype,{load:function(a,b,c,d){var e=new THREE.XHRLoader(this.manager);e.setResponseType("arraybuffer");e.load(a,function(a){THREE.AudioContext.decodeAudioData(a,function(a){b(a)})},c,d)}});THREE.Cache={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};THREE.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a,b,c;return function(d,e,f){function g(a,c,d,g,k){a=e+a;var l=THREE.Loader.Handlers.get(a);null!==l?a=l.load(a):(b.setCrossOrigin(f),a=b.load(a));void 0!==c&&(a.repeat.fromArray(c),1!==c[0]&&(a.wrapS=THREE.RepeatWrapping),1!==c[1]&&(a.wrapT=THREE.RepeatWrapping));void 0!==d&&a.offset.fromArray(d);void 0!==g&&("repeat"===g[0]&&(a.wrapS=THREE.RepeatWrapping),"mirror"===g[0]&&(a.wrapS=THREE.MirroredRepeatWrapping),"repeat"===g[1]&&(a.wrapT=THREE.RepeatWrapping),"mirror"===g[1]&&(a.wrapT=THREE.MirroredRepeatWrapping));void 0!==k&&(a.anisotropy=k);c=THREE.Math.generateUUID();h[c]=a;return c}void 0===a&&(a=new THREE.Color);void 0===b&&(b=new THREE.TextureLoader);void 0===c&&(c=new THREE.MaterialLoader);var h={},k={uuid:THREE.Math.generateUUID(),type:"MeshLambertMaterial"},l;for(l in d){var m=d[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":k.name=m;break;case"blending":k.blending=THREE[m];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":k.color=a.fromArray(m).getHex();break;case"colorSpecular":k.specular=a.fromArray(m).getHex();break;case"colorEmissive":k.emissive=a.fromArray(m).getHex();break;case"specularCoef":k.shininess=m;break;case"shading":"basic"===m.toLowerCase()&&(k.type="MeshBasicMaterial");"phong"===m.toLowerCase()&&(k.type="MeshPhongMaterial");"standard"===m.toLowerCase()&&(k.type="MeshStandardMaterial");break;case"mapDiffuse":k.map=g(m,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":k.emissiveMap=g(m,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":k.lightMap=g(m,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":k.aoMap=g(m,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":k.bumpMap=g(m,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case"mapBumpScale":k.bumpScale=m;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":k.normalMap=g(m,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case"mapNormalFactor":k.normalScale=[m,m];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":k.specularMap=g(m,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":k.metalnessMap=g(m,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":k.roughnessMap=g(m,d.mapRoughnessRepeat,d.mapRoughnessOffset,d.mapRoughnessWrap,d.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":k.alphaMap=g(m,d.mapAlphaRepeat,d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":k.side=THREE.BackSide;break;case"doubleSided":k.side=THREE.DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");k.opacity=m;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":k[l]=m;break;case"vertexColors":!0===m&&(k.vertexColors=THREE.VertexColors);"face"===m&&(k.vertexColors=THREE.FaceColors);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,m)}}"MeshBasicMaterial"===k.type&&delete k.emissive;"MeshPhongMaterial"!==k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);c.setTextures(h);return c.parse(k)}}()};THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c+1];if(b[c].test(a))return e}return null}};THREE.XHRLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.XHRLoader.prototype,{load:function(a,b,c,d){void 0!==this.path&&(a=this.path+a);var e=this,f=THREE.Cache.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;var g=new XMLHttpRequest;g.overrideMimeType("text/plain");g.open("GET",a,!0);g.addEventListener("load",function(c){var f=c.target.response;THREE.Cache.add(a,f);200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),b&&b(f),e.manager.itemEnd(a)):(d&&d(c),e.manager.itemError(a))},!1);void 0!==c&&g.addEventListener("progress",function(a){c(a)},!1);g.addEventListener("error",function(b){d&&d(b);e.manager.itemError(a)},!1);void 0!==this.responseType&&(g.responseType=this.responseType);void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials);g.send(null);e.manager.itemStart(a);return g},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this}});THREE.FontLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.FontLoader.prototype,{load:function(a,b,c,d){var e=this;new THREE.XHRLoader(this.manager).load(a,function(a){var c;try{c=JSON.parse(a)}catch(d){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return new THREE.Font(a)}});THREE.ImageLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.ImageLoader.prototype,{load:function(a,b,c,d){var e=this,f=document.createElementNS("http://www.w3.org/1999/xhtml","img");f.onload=function(){URL.revokeObjectURL(f.src);b&&b(f);e.manager.itemEnd(a)};if(0===a.indexOf("data:"))f.src=a;else{var g=new THREE.XHRLoader;g.setPath(this.path);g.setResponseType("blob");g.load(a,function(a){f.src=URL.createObjectURL(a)},c,d)}e.manager.itemStart(a);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});THREE.JSONLoader=function(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};Object.assign(THREE.JSONLoader.prototype,{load:function(a,b,c,d){var e=this,f=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),g=new THREE.XHRLoader(this.manager);g.setWithCredentials(this.withCredentials);g.load(a,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d)){if("object"===d.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===d.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");return}}c=e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,g,h,k,l,m,p,n,q,r,s,v,t,u=a.faces;m=a.vertices;var D=a.normals,w=a.colors,I=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&I++;for(d=0;d<I;d++)c.faceVertexUvs[d]=[]}k=0;for(l=m.length;k<l;)d=new THREE.Vector3,d.x=m[k++]*b,d.y=m[k++]*b,d.z=m[k++]*b,c.vertices.push(d);k=0;for(l=u.length;k<l;)if(b=u[k++],q=b&1,h=b&2,d=b&8,p=b&16,r=b&32,m=b&64,b&=128,q){q=new THREE.Face3;q.a=u[k];q.b=u[k+1];q.c=u[k+3];s=new THREE.Face3;s.a=u[k+1];s.b=u[k+2];s.c=u[k+3];k+=4;h&&(h=u[k++],q.materialIndex=h,s.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<I;d++)for(v=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4>g;g++)n=u[k++],t=v[2*n],n=v[2*n+1],t=new THREE.Vector2(t,n),2!==g&&c.faceVertexUvs[d][h].push(t),0!==g&&c.faceVertexUvs[d][h+1].push(t);p&&(p=3*u[k++],q.normal.set(D[p++],D[p++],D[p]),s.normal.copy(q.normal));if(r)for(d=0;4>d;d++)p=3*u[k++],r=new THREE.Vector3(D[p++],D[p++],D[p]),2!==d&&q.vertexNormals.push(r),0!==d&&s.vertexNormals.push(r);m&&(m=u[k++],m=w[m],q.color.setHex(m),s.color.setHex(m));if(b)for(d=0;4>d;d++)m=u[k++],m=w[m],2!==d&&q.vertexColors.push(new THREE.Color(m)),0!==d&&s.vertexColors.push(new THREE.Color(m));c.faces.push(q);c.faces.push(s)}else{q=new THREE.Face3;q.a=u[k++];q.b=u[k++];q.c=u[k++];h&&(h=u[k++],q.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<I;d++)for(v=a.uvs[d],c.faceVertexUvs[d][h]=[],g=0;3>g;g++)n=u[k++],t=v[2*n],n=v[2*n+1],t=new THREE.Vector2(t,n),c.faceVertexUvs[d][h].push(t);p&&(p=3*u[k++],q.normal.set(D[p++],D[p++],D[p]));if(r)for(d=0;3>d;d++)p=3*u[k++],r=new THREE.Vector3(D[p++],D[p++],D[p]),q.vertexNormals.push(r);m&&(m=u[k++],q.color.setHex(w[m]));if(b)for(d=0;3>d;d++)m=u[k++],q.vertexColors.push(new THREE.Color(w[m]));c.faces.push(q)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,g=a.morphTargets.length;d<g;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var h=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,l=0,m=k.length;l<m;l+=3){var p=new THREE.Vector3;p.x=k[l]*b;p.y=k[l+1]*b;p.z=k[l+2]*b;h.push(p)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,h=a.morphColors[0].colors,d=0,g=b.length;d<g;d++)b[d].color.fromArray(h,3*d)})(d);(function(){var b=[],d=[];void 0!==a.animation&&d.push(a.animation);void 0!==a.animations&&(a.animations.length?d=d.concat(a.animations):d.push(a.animations));for(var g=0;g<d.length;g++){var h=THREE.AnimationClip.parseAnimation(d[g],c.bones);h&&b.push(h)}c.morphTargets&&(d=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(d));0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}});THREE.LoadingManager=function(a,b,c){var d=this,e=!1,f=0,g=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.BufferGeometryLoader.prototype,{load:function(a,b,c,d){var e=this;new THREE.XHRLoader(e.manager).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},parse:function(a){var b=new THREE.BufferGeometry,c=a.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0!==c&&(c=new d[c.type](c.array),b.setIndex(new THREE.BufferAttribute(c,1)));var e=a.data.attributes,f;for(f in e){var g=e[f],c=new d[g.type](g.array);b.addAttribute(f,new THREE.BufferAttribute(c,g.itemSize,g.normalized))}d=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==d)for(f=0,c=d.length;f!==c;++f)e=d[f],b.addGroup(e.start,e.count,e.materialIndex);a=a.data.boundingSphere;void 0!==a&&(d=new THREE.Vector3,void 0!==a.center&&d.fromArray(a.center),b.boundingSphere=new THREE.Sphere(d,a.radius));return b}});THREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.textures={}};Object.assign(THREE.MaterialLoader.prototype,{load:function(a,b,c,d){var e=this;new THREE.XHRLoader(e.manager).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setTextures:function(a){this.textures=a},getTexture:function(a){var b=this.textures;void 0===b[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return b[a]},parse:function(a){var b=new THREE[a.type];void 0!==a.uuid&&(b.uuid=a.uuid);void 0!==a.name&&(b.name=a.name);void 0!==a.color&&b.color.setHex(a.color);void 0!==a.roughness&&(b.roughness=a.roughness);void 0!==a.metalness&&(b.metalness=a.metalness);void 0!==a.emissive&&b.emissive.setHex(a.emissive);void 0!==a.specular&&b.specular.setHex(a.specular);void 0!==a.shininess&&(b.shininess=a.shininess);void 0!==a.uniforms&&(b.uniforms=a.uniforms);void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors);void 0!==a.shading&&(b.shading=a.shading);void 0!==a.blending&&(b.blending=a.blending);void 0!==a.side&&(b.side=a.side);void 0!==a.opacity&&(b.opacity=a.opacity);void 0!==a.transparent&&(b.transparent=a.transparent);void 0!==a.alphaTest&&(b.alphaTest=a.alphaTest);void 0!==a.depthTest&&(b.depthTest=a.depthTest);void 0!==a.depthWrite&&(b.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(b.colorWrite=a.colorWrite);void 0!==a.wireframe&&(b.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(b.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.size&&(b.size=a.size);void 0!==a.sizeAttenuation&&(b.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(b.map=this.getTexture(a.map));void 0!==a.alphaMap&&(b.alphaMap=this.getTexture(a.alphaMap),b.transparent=!0);void 0!==a.bumpMap&&(b.bumpMap=this.getTexture(a.bumpMap));void 0!==a.bumpScale&&(b.bumpScale=a.bumpScale);
void 0!==a.normalMap&&(b.normalMap=this.getTexture(a.normalMap));if(void 0!==a.normalScale){var c=a.normalScale;!1===Array.isArray(c)&&(c=[c,c]);b.normalScale=(new THREE.Vector2).fromArray(c)}void 0!==a.displacementMap&&(b.displacementMap=this.getTexture(a.displacementMap));void 0!==a.displacementScale&&(b.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(b.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(b.roughnessMap=this.getTexture(a.roughnessMap));void 0!==a.metalnessMap&&(b.metalnessMap=this.getTexture(a.metalnessMap));void 0!==a.emissiveMap&&(b.emissiveMap=this.getTexture(a.emissiveMap));void 0!==a.emissiveIntensity&&(b.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(b.specularMap=this.getTexture(a.specularMap));void 0!==a.envMap&&(b.envMap=this.getTexture(a.envMap),b.combine=THREE.MultiplyOperation);void 0!==a.reflectivity&&(b.reflectivity=a.reflectivity);void 0!==a.lightMap&&(b.lightMap=this.getTexture(a.lightMap));void 0!==a.lightMapIntensity&&(b.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(b.aoMap=this.getTexture(a.aoMap));void 0!==a.aoMapIntensity&&(b.aoMapIntensity=a.aoMapIntensity);if(void 0!==a.materials)for(var c=0,d=a.materials.length;c<d;c++)b.materials.push(this.parse(a.materials[c]));return b}});THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.texturePath=""};Object.assign(THREE.ObjectLoader.prototype,{load:function(a,b,c,d){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var e=this;new THREE.XHRLoader(e.manager).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),d=this.parseImages(a.images,function(){void 0!==b&&b(e)}),d=this.parseTextures(a.textures,d),d=this.parseMaterials(a.materials,d),e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,e=0,f=a.length;e<f;e++){var g,h=a[e];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":g=new THREE[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":g=new THREE[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":g=new THREE[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":g=new THREE[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":g=new THREE[h.type](h.radius,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":g=new THREE[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":g=new THREE[h.type](h.radius,h.detail);break;case"RingGeometry":case"RingBufferGeometry":g=new THREE[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":g=new THREE[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":g=new THREE[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case"LatheGeometry":case"LatheBufferGeometry":g=new THREE[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case"BufferGeometry":g=d.parse(h);break;case"Geometry":g=c.parse(h.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}g.uuid=h.uuid;void 0!==h.name&&(g.name=h.name);b[h.uuid]=g}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var d=new THREE.MaterialLoader;d.setTextures(b);for(var e=0,f=a.length;e<f;e++){var g=d.parse(a[e]);c[g.uuid]=g}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=THREE.AnimationClip.parse(a[c]);b.push(d)}return b},parseImages:function(a,b){function c(a){d.manager.itemStart(a);return g.load(a,function(){d.manager.itemEnd(a)})}var d=this,e={};if(void 0!==a&&0<a.length){var f=new THREE.LoadingManager(b),g=new THREE.ImageLoader(f);g.setCrossOrigin(this.crossOrigin);for(var f=0,h=a.length;f<h;f++){var k=a[f],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;e[k.uuid]=c(l)}}return e},parseTextures:function(a,b){function c(a){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a);return THREE[a]}var d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid);void 0===b[g.image]&&console.warn("THREE.ObjectLoader: Undefined image",g.image);var h=new THREE.Texture(b[g.image]);h.needsUpdate=!0;h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);void 0!==g.mapping&&(h.mapping=c(g.mapping));void 0!==g.offset&&h.offset.fromArray(g.offset);void 0!==g.repeat&&h.repeat.fromArray(g.repeat);void 0!==g.wrap&&(h.wrapS=c(g.wrap[0]),h.wrapT=c(g.wrap[1]));void 0!==g.minFilter&&(h.minFilter=c(g.minFilter));void 0!==g.magFilter&&(h.magFilter=c(g.magFilter));void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy);void 0!==g.flipY&&(h.flipY=g.flipY);d[g.uuid]=h}return d},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,d){function e(a){void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a);return c[a]}function f(a){if(void 0!==a)return void 0===d[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),d[a]}var g;switch(b.type){case"Scene":g=new THREE.Scene;break;case"PerspectiveCamera":g=new THREE.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(g.focus=b.focus);void 0!==b.zoom&&(g.zoom=b.zoom);void 0!==b.filmGauge&&(g.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(g.filmOffset=b.filmOffset);void 0!==b.view&&(g.view=Object.assign({},b.view));break;case"OrthographicCamera":g=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case"AmbientLight":g=new THREE.AmbientLight(b.color,b.intensity);break;case"DirectionalLight":g=new THREE.DirectionalLight(b.color,b.intensity);break;case"PointLight":g=new THREE.PointLight(b.color,b.intensity,b.distance,b.decay);break;case"SpotLight":g=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case"HemisphereLight":g=new THREE.HemisphereLight(b.color,b.groundColor,b.intensity);break;case"Mesh":g=e(b.geometry);var h=f(b.material);g=g.bones&&0<g.bones.length?new THREE.SkinnedMesh(g,h):new THREE.Mesh(g,h);break;case"LOD":g=new THREE.LOD;break;case"Line":g=new THREE.Line(e(b.geometry),f(b.material),b.mode);break;case"PointCloud":case"Points":g=new THREE.Points(e(b.geometry),f(b.material));break;case"Sprite":g=new THREE.Sprite(f(b.material));break;case"Group":g=new THREE.Group;break;default:g=new THREE.Object3D}g.uuid=b.uuid;void 0!==b.name&&(g.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(g.position,g.quaternion,g.scale)):(void 0!==b.position&&g.position.fromArray(b.position),void 0!==b.rotation&&g.rotation.fromArray(b.rotation),void 0!==b.scale&&g.scale.fromArray(b.scale));void 0!==b.castShadow&&(g.castShadow=b.castShadow);void 0!==b.receiveShadow&&(g.receiveShadow=b.receiveShadow);void 0!==b.visible&&(g.visible=b.visible);void 0!==b.userData&&(g.userData=b.userData);if(void 0!==b.children)for(var k in b.children)g.add(this.parseObject(b.children[k],c,d));if("LOD"===b.type)for(b=b.levels,h=0;h<b.length;h++){var l=b[h];k=g.getObjectByProperty("uuid",l.object);void 0!==k&&g.addLevel(k,l.distance)}return g}}()});THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.TextureLoader.prototype,{load:function(a,b,c,d){var e=new THREE.Texture,f=new THREE.ImageLoader(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);f.load(a,function(c){var d=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data\:image\/jpeg/);e.format=d?THREE.RGBFormat:THREE.RGBAFormat;e.image=c;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});THREE.CubeTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};Object.assign(THREE.CubeTextureLoader.prototype,{load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new THREE.CubeTexture,g=new THREE.ImageLoader(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);var h=0;for(c=0;c<a.length;++c)e(c);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};Object.assign(THREE.BinaryTextureLoader.prototype,{load:function(a,b,c,d){var e=this,f=new THREE.DataTexture,g=new THREE.XHRLoader(this.manager);g.setResponseType("arraybuffer");g.load(a,function(a){if(a=e._parser(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:THREE.ClampToEdgeWrapping,f.wrapT=void 0!==a.wrapT?a.wrapT:THREE.ClampToEdgeWrapping,f.magFilter=void 0!==a.magFilter?a.magFilter:THREE.LinearFilter,f.minFilter=void 0!==a.minFilter?a.minFilter:THREE.LinearMipMapLinearFilter,f.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps),1===a.mipmapCount&&(f.minFilter=THREE.LinearFilter),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});THREE.CompressedTextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this._parser=null};Object.assign(THREE.CompressedTextureLoader.prototype,{load:function(a,b,c,d){function e(e){k.load(a[e],function(a){a=f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};l+=1;6===l&&(1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new THREE.CompressedTexture;h.image=g;var k=new THREE.XHRLoader(this.manager);k.setPath(this.path);k.setResponseType("arraybuffer");if(Array.isArray(a))for(var l=0,m=0,p=a.length;m<p;++m)e(m);else k.load(a,function(a){a=f._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=THREE.LinearFilter);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return h},setPath:function(a){this.path=a;return this}});THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=THREE.NormalBlending;this.side=THREE.FrontSide;this.shading=THREE.SmoothShading;this.vertexColors=THREE.NoColors;this.opacity=1;this.transparent=!1;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=THREE.LessEqualDepth;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0};THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else{var d=this[b];void 0===d?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):d instanceof THREE.Color?d.set(c):d instanceof THREE.Vector3&&c instanceof THREE.Vector3?d.copy(c):this[b]="overdraw"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color instanceof THREE.Color&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);this.emissive instanceof THREE.Color&&(d.emissive=this.emissive.getHex());this.specular instanceof THREE.Color&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);this.map instanceof THREE.Texture&&(d.map=this.map.toJSON(a).uuid);this.alphaMap instanceof THREE.Texture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap instanceof THREE.Texture&&(d.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap instanceof THREE.Texture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale);this.normalMap instanceof THREE.Texture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap instanceof THREE.Texture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap instanceof THREE.Texture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap instanceof THREE.Texture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap instanceof THREE.Texture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap instanceof THREE.Texture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap instanceof THREE.Texture&&(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);this.blending!==THREE.NormalBlending&&(d.blending=this.blending);this.shading!==THREE.SmoothShading&&(d.shading=this.shading);this.side!==THREE.FrontSide&&(d.side=this.side);this.vertexColors!==THREE.NoColors&&(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);c&&(c=b(a.textures),a=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==a)for(var c=a.length,b=Array(c),d=0;d!==c;++d)b[d]=a[d].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(THREE.Material.prototype,THREE.EventDispatcher.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.LineBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshBasicMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.type="MeshDepthMaterial";this.depthPacking=THREE.BasicDepthPacking;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshLambertMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(a)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.specular=new THREE.Color(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshPhongMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshStandardMaterial=function(a){THREE.Material.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new THREE.Color(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new THREE.Color(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial;THREE.MeshStandardMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};THREE.MeshPhysicalMaterial=function(a){THREE.MeshStandardMaterial.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)};THREE.MeshPhysicalMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);THREE.MeshPhysicalMaterial.prototype.constructor=THREE.MeshPhysicalMaterial;THREE.MeshPhysicalMaterial.prototype.copy=function(a){THREE.MeshStandardMaterial.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};THREE.MultiMaterial=function(a){this.uuid=THREE.Math.generateUUID();this.type="MultiMaterial";this.materials=a instanceof Array?a:[];this.visible=!0};THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,e=c.length;d<e;d++){var f=c[d].toJSON(a);delete f.metadata;b.materials.push(f)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};THREE.PointsMaterial=function(a){THREE.Material.call(this);this.type="PointsMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;THREE.PointsMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.ShaderMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};THREE.ShaderMaterial.prototype.toJSON=function(a){a=THREE.Material.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.copy=function(a){THREE.Material.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};THREE.ShadowMaterial=function(){THREE.ShaderMaterial.call(this,{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{opacity:{value:1}}]),vertexShader:THREE.ShaderChunk.shadow_vert,fragmentShader:THREE.ShaderChunk.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}}})};THREE.ShadowMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.ShadowMaterial.prototype.constructor=THREE.ShadowMaterial;THREE.Texture=function(a,b,c,d,e,f,g,h,k,l){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==a?a:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==d?d:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==e?e:THREE.LinearFilter;this.minFilter=void 0!==f?f:THREE.LinearMipMapLinearFilter;this.anisotropy=void 0!==k?k:1;this.format=void 0!==g?g:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==l?l:THREE.LinearEncoding;this.version=0;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;
this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=THREE.Math.generateUUID());if(void 0===a.images[c.uuid]){var d=a.images,e=c.uuid,f=c.uuid,g;void 0!==c.toDataURL?g=c:(g=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),g.width=c.width,g.height=c.height,g.getContext("2d").drawImage(c,0,0,c.width,c.height));g=2048<g.width||2048<g.height?g.toDataURL("image/jpeg",.6):g.toDataURL("image/png");d[e]={uuid:f,url:g}}b.image=c.uuid}return a.textures[this.uuid]=b},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(this.mapping===THREE.UVMapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case THREE.RepeatWrapping:a.x-=Math.floor(a.x);break;case THREE.ClampToEdgeWrapping:a.x=0>a.x?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case THREE.RepeatWrapping:a.y-=Math.floor(a.y);break;case THREE.ClampToEdgeWrapping:a.y=0>a.y?0:1;break;case THREE.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(THREE.Texture.prototype,THREE.EventDispatcher.prototype);THREE.TextureIdCount=0;THREE.DepthTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,null,d,e,f,g,h,THREE.DepthFormat,c,k);this.image={width:a,height:b};this.type=void 0!==c?c:THREE.UnsignedShortType;this.magFilter=void 0!==g?g:THREE.NearestFilter;this.minFilter=void 0!==h?h:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DepthTexture.prototype.constructor=THREE.DepthTexture;THREE.CanvasTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.needsUpdate=!0};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;THREE.CubeTexture=function(a,b,c,d,e,f,g,h,k,l){a=void 0!==a?a:[];b=void 0!==b?b:THREE.CubeReflectionMapping;THREE.Texture.call(this,a,b,c,d,e,f,g,h,k,l);this.flipY=!1};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;Object.defineProperty(THREE.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,k,l,m,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,m,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;THREE.DataTexture=function(a,b,c,d,e,f,g,h,k,l,m,p){THREE.Texture.call(this,null,f,g,h,k,l,d,e,m,p);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:THREE.NearestFilter;this.minFilter=void 0!==l?l:THREE.NearestFilter;this.generateMipmaps=this.flipY=!1};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.VideoTexture=function(a,b,c,d,e,f,g,h,k){function l(){requestAnimationFrame(l);a.readyState>=a.HAVE_CURRENT_DATA&&(m.needsUpdate=!0)}THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;var m=this;l()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Group});THREE.Points=function(a,b){THREE.Object3D.call(this);this.type="Points";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.PointsMaterial({color:16777215*Math.random()})};THREE.Points.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Points,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);if(f<m){var h=b.closestPointToPoint(a);h.applyMatrix4(k);var l=d.ray.origin.distanceTo(h);l<d.near||l>d.far||e.push({distance:l,distanceToRay:Math.sqrt(f),point:h.clone(),index:c,face:null,object:g})}}var g=this,h=this.geometry,k=this.matrixWorld,l=d.params.Points.threshold;null===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);var l=l/((this.scale.x+this.scale.y+this.scale.z)/3),m=l*l,l=new THREE.Vector3;if(h instanceof THREE.BufferGeometry){var p=h.index,h=h.attributes.position.array;if(null!==p)for(var n=p.array,p=0,q=n.length;p<q;p++){var r=n[p];l.fromArray(h,3*r);f(l,r)}else for(p=0,n=h.length/3;p<n;p++)l.fromArray(h,3*p),f(l,p)}else for(l=h.vertices,p=0,n=l.length;p<n;p++)f(l[p],p)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});THREE.Line=function(a,b,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new THREE.LineSegments(a,b);THREE.Object3D.call(this);this.type="Line";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()})};THREE.Line.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Line,raycast:function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){var f=d.linePrecision,f=f*f,g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);var k=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,m=new THREE.Vector3,p=this instanceof THREE.LineSegments?2:1;if(g instanceof THREE.BufferGeometry){var n=g.index,q=g.attributes.position.array;if(null!==n)for(var n=n.array,g=0,r=n.length-1;g<r;g+=p){var s=n[g+1];k.fromArray(q,3*n[g]);l.fromArray(q,3*s);s=b.distanceSqToSegment(k,l,m,h);s>f||(m.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(m),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,r=q.length/3-1;g<r;g+=p)k.fromArray(q,3*g),l.fromArray(q,3*g+3),s=b.distanceSqToSegment(k,l,m,h),s>f||(m.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(m),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g instanceof THREE.Geometry)for(k=g.vertices,l=k.length,g=0;g<l-1;g+=p)s=b.distanceSqToSegment(k[g],k[g+1],m,h),s>f||(m.applyMatrix4(this.matrixWorld),s=d.ray.origin.distanceTo(m),s<d.near||s>d.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});THREE.LineSegments=function(a,b){THREE.Line.call(this,a,b);this.type="LineSegments"};THREE.LineSegments.prototype=Object.assign(Object.create(THREE.Line.prototype),{constructor:THREE.LineSegments});THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new THREE.BufferGeometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=THREE.TrianglesDrawMode;this.updateMorphTargets()};THREE.Mesh.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Mesh,setDrawMode:function(a){this.drawMode=a},copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},getMorphTargetIndexByName:function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0},raycast:function(){function a(a,b,c,d,e,g,f){THREE.Triangle.barycoordFromPoint(a,b,c,d,s);e.multiplyScalar(s.x);g.multiplyScalar(s.y);f.multiplyScalar(s.z);e.add(g).add(f);return e.clone()}function b(a,b,c,d,e,g,f){var h=a.material;if(null===(h.side===THREE.BackSide?c.intersectTriangle(g,e,d,!0,f):c.intersectTriangle(d,e,g,h.side!==THREE.DoubleSide,f)))return null;t.copy(f);t.applyMatrix4(a.matrixWorld);c=b.ray.origin.distanceTo(t);return c<b.near||c>b.far?null:{distance:c,point:t.clone(),object:a}}function c(c,d,e,f,l,p,m,s){g.fromArray(f,3*p);h.fromArray(f,3*m);k.fromArray(f,3*s);if(c=b(c,d,e,g,h,k,v))l&&(n.fromArray(l,2*p),q.fromArray(l,2*m),r.fromArray(l,2*s),c.uv=a(v,g,h,k,n,q,r)),c.face=new THREE.Face3(p,m,s,THREE.Triangle.normal(g,h,k)),c.faceIndex=p;return c}var d=new THREE.Matrix4,e=new THREE.Ray,f=new THREE.Sphere,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Vector3,p=new THREE.Vector3,n=new THREE.Vector2,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector3,v=new THREE.Vector3,t=new THREE.Vector3;return function(u,s){var w=this.geometry,t=this.material,z=this.matrixWorld;if(void 0!==t&&(null===w.boundingSphere&&w.computeBoundingSphere(),f.copy(w.boundingSphere),f.applyMatrix4(z),!1!==u.ray.intersectsSphere(f)&&(d.getInverse(z),e.copy(u.ray).applyMatrix4(d),null===w.boundingBox||!1!==e.intersectsBox(w.boundingBox)))){var y,A;if(w instanceof THREE.BufferGeometry){var G,B,t=w.index,z=w.attributes,w=z.position.array;void 0!==z.uv&&(y=z.uv.array);if(null!==t)for(var z=t.array,F=0,J=z.length;F<J;F+=3){if(t=z[F],G=z[F+1],B=z[F+2],A=c(this,u,e,w,y,t,G,B))A.faceIndex=Math.floor(F/3),s.push(A)}else for(F=0,J=w.length;F<J;F+=9)if(t=F/3,G=t+1,B=t+2,A=c(this,u,e,w,y,t,G,B))A.index=t,s.push(A)}else if(w instanceof THREE.Geometry){var P,K,z=t instanceof THREE.MultiMaterial,F=!0===z?t.materials:null,J=w.vertices;G=w.faces;B=w.faceVertexUvs[0];0<B.length&&(y=B);for(var H=0,M=G.length;H<M;H++){var O=G[H];A=!0===z?F[O.materialIndex]:t;if(void 0!==A){B=J[O.a];P=J[O.b];K=J[O.c];if(!0===A.morphTargets){A=w.morphTargets;var N=this.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var Q=0,C=A.length;Q<C;Q++){var L=N[Q];if(0!==L){var E=A[Q].vertices;g.addScaledVector(l.subVectors(E[O.a],B),L);h.addScaledVector(m.subVectors(E[O.b],P),L);k.addScaledVector(p.subVectors(E[O.c],K),L)}}g.add(B);h.add(P);k.add(K);B=g;P=h;K=k}if(A=b(this,u,e,B,P,K,v))y&&(N=y[H],n.copy(N[0]),q.copy(N[1]),r.copy(N[2]),A.uv=a(v,B,P,K,n,q,r)),A.face=O,A.faceIndex=H,s.push(A)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});THREE.Bone=function(a){THREE.Object3D.call(this);this.type="Bone";this.skin=a};THREE.Bone.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Bone,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.skin=a.skin;return this}});THREE.Skeleton=function(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new THREE.Matrix4;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=THREE.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new THREE.Matrix4)};Object.assign(THREE.Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new THREE.Matrix4;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent instanceof THREE.Bone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new THREE.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}});THREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var d,e=0,f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],b=new THREE.Bone(this),a.push(b),b.name=d.name,b.position.fromArray(d.pos),b.quaternion.fromArray(d.rotq),void 0!==d.scl&&b.scale.fromArray(d.scl);e=0;for(f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],-1!==d.parent&&null!==d.parent&&void 0!==a[d.parent]?a[d.parent].add(a[e]):this.add(a[e])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(a,(void 0),c),this.matrixWorld)};THREE.SkinnedMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.SkinnedMesh,bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry instanceof THREE.BufferGeometry)for(var b=new THREE.Vector4,d=this.geometry.attributes.skinWeight,a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}});THREE.LOD=function(){THREE.Object3D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})};THREE.LOD.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LOD,copy:function(a){THREE.Object3D.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,d=b.length;c<d&&!(a<b[c].distance);c++);return b[c-1].object},raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),update:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){var d=this.levels;if(1<d.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);d[0].object.visible=!0;for(var e=1,f=d.length;e<f;e++)if(c>=d[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),toJSON:function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});THREE.Sprite=function(a){THREE.Object3D.call(this);this.type="Sprite";this.material=void 0!==a?a:new THREE.SpriteMaterial};THREE.Sprite.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.Sprite,raycast:function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceSqToPoint(a);d>this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}});THREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)};THREE.LensFlare.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.LensFlare,copy:function(a){THREE.Object3D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this},add:function(a,b,c,d,e,f){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var a,b=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.copy=function(a,b){THREE.Object3D.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};THREE.Fog=function(a,b,c){this.name="";this.color=new THREE.Color(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(a,b){this.name="";this.color=new THREE.Color(a);this.density=void 0!==b?b:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n";THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n";THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n";THREE.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n";THREE.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif";THREE.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n";THREE.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n";THREE.ShaderChunk.bsdfs="bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n";THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n";THREE.ShaderChunk.clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n";THREE.ShaderChunk.clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n";THREE.ShaderChunk.clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n";THREE.ShaderChunk.clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n";THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif";THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n";THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif";THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif";THREE.ShaderChunk.common="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n";THREE.ShaderChunk.cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n";
THREE.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n";THREE.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n";THREE.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n";THREE.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n";THREE.ShaderChunk.encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n";THREE.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n";THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n";THREE.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n";THREE.ShaderChunk.envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n";THREE.ShaderChunk.envmap_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n";THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n";THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif";THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n";THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif";THREE.ShaderChunk.lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n";THREE.ShaderChunk.lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n";THREE.ShaderChunk.lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n";THREE.ShaderChunk.lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n";THREE.ShaderChunk.lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n";THREE.ShaderChunk.lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n";THREE.ShaderChunk.lights_template="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n";THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif";THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n";THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif";THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n";THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n";THREE.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n";THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n";THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n";THREE.ShaderChunk.metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n";THREE.ShaderChunk.metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif";THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n";THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif";THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n";THREE.ShaderChunk.normal_flip="#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n";THREE.ShaderChunk.normal_fragment="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n";THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n";THREE.ShaderChunk.packing="vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n";
THREE.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n";THREE.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk.roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n";THREE.ShaderChunk.roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif";THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n";THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n";THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n";THREE.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n";THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif";THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n";THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n";THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n";THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif";THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif";THREE.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n";THREE.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n";THREE.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif";THREE.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif";THREE.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif";THREE.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif";THREE.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n";THREE.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif";THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n";THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix3||e instanceof THREE.Matrix4||e instanceof THREE.Texture?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}};THREE.UniformsLib={common:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new THREE.Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}}},points:{diffuse:{value:new THREE.Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new THREE.Vector4(0,0,1,1)}}};THREE.ShaderChunk.cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n";THREE.ShaderChunk.cube_vert="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n";THREE.ShaderChunk.depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n";THREE.ShaderChunk.depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";THREE.ShaderChunk.distanceRGBA_frag="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n";THREE.ShaderChunk.distanceRGBA_vert="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n";THREE.ShaderChunk.equirect_frag="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n";THREE.ShaderChunk.equirect_vert="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n";THREE.ShaderChunk.linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";THREE.ShaderChunk.linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";THREE.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";THREE.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n";THREE.ShaderChunk.meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";THREE.ShaderChunk.meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n";THREE.ShaderChunk.meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";THREE.ShaderChunk.meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n";THREE.ShaderChunk.meshphysical_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";
THREE.ShaderChunk.meshphysical_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";THREE.ShaderChunk.normal_frag="uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n";THREE.ShaderChunk.normal_vert="varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n";THREE.ShaderChunk.points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n";THREE.ShaderChunk.points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";THREE.ShaderChunk.shadow_frag="uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n";THREE.ShaderChunk.shadow_vert="#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n";THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.meshbasic_vert,fragmentShader:THREE.ShaderChunk.meshbasic_frag},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)}}]),vertexShader:THREE.ShaderChunk.meshlambert_vert,fragmentShader:THREE.ShaderChunk.meshlambert_frag},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},specular:{value:new THREE.Color(1118481)},shininess:{value:30}}]),vertexShader:THREE.ShaderChunk.meshphong_vert,fragmentShader:THREE.ShaderChunk.meshphong_frag},standard:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.roughnessmap,THREE.UniformsLib.metalnessmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,{emissive:{value:new THREE.Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.fog]),vertexShader:THREE.ShaderChunk.points_vert,fragmentShader:THREE.ShaderChunk.points_frag},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:THREE.ShaderChunk.linedashed_vert,fragmentShader:THREE.ShaderChunk.linedashed_frag},depth:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.displacementmap]),vertexShader:THREE.ShaderChunk.depth_vert,fragmentShader:THREE.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:THREE.ShaderChunk.normal_vert,fragmentShader:THREE.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:THREE.ShaderChunk.cube_vert,fragmentShader:THREE.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:THREE.ShaderChunk.equirect_vert,fragmentShader:THREE.ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new THREE.Vector3}},vertexShader:THREE.ShaderChunk.distanceRGBA_vert,fragmentShader:THREE.ShaderChunk.distanceRGBA_frag}};THREE.ShaderLib.physical={uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:THREE.ShaderChunk.meshphysical_vert,fragmentShader:THREE.ShaderChunk.meshphysical_frag};THREE.WebGLRenderer=function(a){function b(a,b,c,d){!0===A&&(a*=d,b*=d,c*=d);R.clearColor(a,b,c,d)}function c(){R.init();R.scissor(X.copy(ua).multiplyScalar(Z));R.viewport(fa.copy(na).multiplyScalar(Z));b(V.r,V.g,V.b,ba)}function d(){T=Q=null;$="";E=-1;R.reset()}function e(a){a.preventDefault();d();c();Y.clear()}function f(a){a=a.target;a.removeEventListener("dispose",f);g(a);Y.delete(a)}function g(a){var b=Y.get(a).program;a.program=void 0;void 0!==b&&oa.releaseProgram(b)}function h(a,b){return Math.abs(b[0])-Math.abs(a[0])}function k(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.program&&b.material.program&&a.material.program!==b.material.program?a.material.program.id-b.material.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function l(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function m(a,b,c,d,e){var g;c.transparent?(d=P,g=++K):(d=F,g=++J);g=d[g];void 0!==g?(g.id=a.id,g.object=a,g.geometry=b,g.material=c,g.z=W.z,g.group=e):(g={id:a.id,object:a,geometry:b,material:c,z:W.z,group:e},d.push(g))}function p(a){if(!wa.intersectsSphere(a))return!1;var b=da.numPlanes;if(0===b)return!0;var c=N.clippingPlanes,d=a.center;a=-a.radius;var e=0;do if(c[e].distanceToPoint(d)<a)return!1;while(++e!==b);return!0}function n(a,b){if(!1!==a.visible){if(a.layers.test(b.layers))if(a instanceof THREE.Light)B.push(a);else if(a instanceof THREE.Sprite){var c;(c=!1===a.frustumCulled)||(ka.center.set(0,0,0),ka.radius=.7071067811865476,ka.applyMatrix4(a.matrixWorld),c=!0===p(ka));c&&M.push(a)}else if(a instanceof THREE.LensFlare)O.push(a);else if(a instanceof THREE.ImmediateRenderObject)!0===N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(qa)),m(a,null,a.material,W.z,null);else if(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)if(a instanceof THREE.SkinnedMesh&&a.skeleton.update(),(c=!1===a.frustumCulled)||(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),ka.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),c=!0===p(ka)),c){var d=a.material;if(!0===d.visible)if(!0===N.sortObjects&&(W.setFromMatrixPosition(a.matrixWorld),W.applyProjection(qa)),c=ha.update(a),d instanceof THREE.MultiMaterial)for(var e=c.groups,g=d.materials,d=0,f=e.length;d<f;d++){var h=e[d],k=g[h.materialIndex];!0===k.visible&&m(a,c,k,W.z,h)}else m(a,c,d,W.z,null)}c=a.children;d=0;for(f=c.length;d<f;d++)n(c[d],b)}}function q(a,b,c,d){for(var e=0,g=a.length;e<g;e++){var f=a[e],h=f.object,k=f.geometry,l=void 0===d?f.material:d,f=f.group;h.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);if(h instanceof THREE.ImmediateRenderObject){r(l);var n=s(b,c,l,h);$="";h.render(function(a){N.renderBufferImmediate(a,n,l)})}else N.renderBufferDirect(b,c,k,l,h,f)}}function r(a){a.side!==THREE.DoubleSide?R.enable(x.CULL_FACE):R.disable(x.CULL_FACE);R.setFlipSided(a.side===THREE.BackSide);!0===a.transparent?R.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):R.setBlending(THREE.NoBlending);R.setDepthFunc(a.depthFunc);R.setDepthTest(a.depthTest);R.setDepthWrite(a.depthWrite);R.setColorWrite(a.colorWrite);R.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function s(a,b,c,d){ga=0;var e=Y.get(c);ra&&((va||a!==T)&&da.setState(c.clippingPlanes,c.clipShadows,a,e,a===T&&c.id===E),void 0!==e.numClippingPlanes&&e.numClippingPlanes!==da.numPlanes&&(c.needsUpdate=!0));void 0===e.program&&(c.needsUpdate=!0);void 0!==e.lightsHash&&e.lightsHash!==S.hash&&(c.needsUpdate=!0);if(c.needsUpdate){a:{var h=Y.get(c),k=oa.getParameters(c,S,b,da.numPlanes,d),l=oa.getProgramCode(c,k),n=h.program,p=!0;if(void 0===n)c.addEventListener("dispose",f);else if(n.code!==l)g(c);else if(void 0!==k.shaderID)break a;else p=!1;p&&(k.shaderID?(n=THREE.ShaderLib[k.shaderID],h.__webglShader={name:c.type,uniforms:THREE.UniformsUtils.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}):h.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=h.__webglShader,n=oa.acquireProgram(c,k,l),h.program=n,c.program=n);k=n.getAttributes();if(c.morphTargets)for(l=c.numSupportedMorphTargets=0;l<N.maxMorphTargets;l++)0<=k["morphTarget"+l]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(l=c.numSupportedMorphNormals=0;l<N.maxMorphNormals;l++)0<=k["morphNormal"+l]&&c.numSupportedMorphNormals++;k=h.__webglShader.uniforms;(c instanceof THREE.ShaderMaterial||c instanceof THREE.RawShaderMaterial)&&!0!==c.clipping||(h.numClippingPlanes=da.numPlanes,k.clippingPlanes=da.uniform);c.lights&&(h.lightsHash=S.hash,k.ambientLightColor.value=S.ambient,k.directionalLights.value=S.directional,k.spotLights.value=S.spot,k.pointLights.value=S.point,k.hemisphereLights.value=S.hemi,k.directionalShadowMap.value=S.directionalShadowMap,k.directionalShadowMatrix.value=S.directionalShadowMatrix,k.spotShadowMap.value=S.spotShadowMap,k.spotShadowMatrix.value=S.spotShadowMatrix,k.pointShadowMap.value=S.pointShadowMap,k.pointShadowMatrix.value=S.pointShadowMatrix);l=h.program.getUniforms();l=THREE.WebGLUniforms.seqWithValue(l.seq,k);h.uniformsList=l;h.dynamicUniforms=THREE.WebGLUniforms.splitDynamic(l,k)}c.needsUpdate=!1}var m=!1,p=n=!1,h=e.program,l=h.getUniforms(),k=e.__webglShader.uniforms;h.id!==Q&&(x.useProgram(h.program),Q=h.id,p=n=m=!0);c.id!==E&&(E=c.id,n=!0);if(m||a!==T){l.set(x,a,"projectionMatrix");ca.logarithmicDepthBuffer&&l.setValue(x,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));a!==T&&(T=a,p=n=!0);if(c instanceof THREE.ShaderMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c.envMap)m=l.map.cameraPosition,void 0!==m&&m.setValue(x,W.setFromMatrixPosition(a.matrixWorld));(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.ShaderMaterial||c.skinning)&&l.setValue(x,"viewMatrix",a.matrixWorldInverse);l.set(x,N,"toneMappingExposure");l.set(x,N,"toneMappingWhitePoint")}c.skinning&&(l.setOptional(x,d,"bindMatrix"),l.setOptional(x,d,"bindMatrixInverse"),m=d.skeleton)&&(ca.floatVertexTextures&&m.useVertexTexture?(l.set(x,m,"boneTexture"),l.set(x,m,"boneTextureWidth"),l.set(x,m,"boneTextureHeight")):l.setOptional(x,m,"boneMatrices"));if(n){c.lights&&(n=p,k.ambientLightColor.needsUpdate=n,k.directionalLights.needsUpdate=n,k.pointLights.needsUpdate=n,k.spotLights.needsUpdate=n,k.hemisphereLights.needsUpdate=n);b&&c.fog&&(k.fogColor.value=b.color,b instanceof THREE.Fog?(k.fogNear.value=b.near,k.fogFar.value=b.far):b instanceof THREE.FogExp2&&(k.fogDensity.value=b.density));if(c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshStandardMaterial||c instanceof THREE.MeshDepthMaterial){k.opacity.value=c.opacity;k.diffuse.value=c.color;c.emissive&&k.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);k.map.value=c.map;k.specularMap.value=c.specularMap;k.alphaMap.value=c.alphaMap;c.aoMap&&(k.aoMap.value=c.aoMap,k.aoMapIntensity.value=c.aoMapIntensity);var q;c.map?q=c.map:c.specularMap?q=c.specularMap:c.displacementMap?q=c.displacementMap:c.normalMap?q=c.normalMap:c.bumpMap?q=c.bumpMap:c.roughnessMap?q=c.roughnessMap:c.metalnessMap?q=c.metalnessMap:c.alphaMap?q=c.alphaMap:c.emissiveMap&&(q=c.emissiveMap);void 0!==q&&(q instanceof THREE.WebGLRenderTarget&&(q=q.texture),b=q.offset,q=q.repeat,k.offsetRepeat.value.set(b.x,b.y,q.x,q.y));k.envMap.value=c.envMap;k.flipEnvMap.value=c.envMap instanceof THREE.CubeTexture?-1:1;k.reflectivity.value=c.reflectivity;k.refractionRatio.value=c.refractionRatio}c instanceof THREE.LineBasicMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity):c instanceof THREE.LineDashedMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity,k.dashSize.value=c.dashSize,k.totalSize.value=c.dashSize+c.gapSize,k.scale.value=c.scale):c instanceof THREE.PointsMaterial?(k.diffuse.value=c.color,k.opacity.value=c.opacity,k.size.value=c.size*Z,k.scale.value=.5*u.clientHeight,k.map.value=c.map,null!==c.map&&(q=c.map.offset,c=c.map.repeat,k.offsetRepeat.value.set(q.x,q.y,c.x,c.y))):c instanceof THREE.MeshLambertMaterial?(c.lightMap&&(k.lightMap.value=c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap)):c instanceof THREE.MeshPhongMaterial?(k.specular.value=c.specular,k.shininess.value=Math.max(c.shininess,1e-4),c.lightMap&&(k.lightMap.value=c.lightMap,k.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(k.emissiveMap.value=c.emissiveMap),c.bumpMap&&(k.bumpMap.value=c.bumpMap,k.bumpScale.value=c.bumpScale),c.normalMap&&(k.normalMap.value=c.normalMap,k.normalScale.value.copy(c.normalScale)),c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias)):c instanceof THREE.MeshPhysicalMaterial?(k.clearCoat.value=c.clearCoat,k.clearCoatRoughness.value=c.clearCoatRoughness,v(k,c)):c instanceof THREE.MeshStandardMaterial?v(k,c):c instanceof THREE.MeshDepthMaterial?c.displacementMap&&(k.displacementMap.value=c.displacementMap,k.displacementScale.value=c.displacementScale,k.displacementBias.value=c.displacementBias):c instanceof THREE.MeshNormalMaterial&&(k.opacity.value=c.opacity);THREE.WebGLUniforms.upload(x,e.uniformsList,k,N)}l.set(x,d,"modelViewMatrix");l.set(x,d,"normalMatrix");l.setValue(x,"modelMatrix",d.matrixWorld);e=e.dynamicUniforms;null!==e&&(THREE.WebGLUniforms.evalDynamic(e,k,d,a),THREE.WebGLUniforms.upload(x,e,k,N));return h}function v(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function t(a){var b;if(a===THREE.RepeatWrapping)return x.REPEAT;if(a===THREE.ClampToEdgeWrapping)return x.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return x.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return x.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return x.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return x.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return x.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return x.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return x.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return x.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return x.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return x.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return x.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return x.BYTE;if(a===THREE.ShortType)return x.SHORT;if(a===THREE.UnsignedShortType)return x.UNSIGNED_SHORT;if(a===THREE.IntType)return x.INT;if(a===THREE.UnsignedIntType)return x.UNSIGNED_INT;if(a===THREE.FloatType)return x.FLOAT;b=U.get("OES_texture_half_float");if(null!==b&&a===THREE.HalfFloatType)return b.HALF_FLOAT_OES;if(a===THREE.AlphaFormat)return x.ALPHA;if(a===THREE.RGBFormat)return x.RGB;if(a===THREE.RGBAFormat)return x.RGBA;if(a===THREE.LuminanceFormat)return x.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return x.LUMINANCE_ALPHA;if(a===THREE.DepthFormat)return x.DEPTH_COMPONENT;if(a===THREE.AddEquation)return x.FUNC_ADD;if(a===THREE.SubtractEquation)return x.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return x.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return x.ZERO;if(a===THREE.OneFactor)return x.ONE;if(a===THREE.SrcColorFactor)return x.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return x.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return x.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return x.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return x.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return x.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return x.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return x.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return x.SRC_ALPHA_SATURATE;b=U.get("WEBGL_compressed_texture_s3tc");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=U.get("WEBGL_compressed_texture_pvrtc");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=U.get("WEBGL_compressed_texture_etc1");if(null!==b&&a===THREE.RGB_ETC1_Format)return b.COMPRESSED_RGB_ETC1_WEBGL;b=U.get("EXT_blend_minmax");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var u=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),D=void 0!==a.context?a.context:null,w=void 0!==a.alpha?a.alpha:!1,I=void 0!==a.depth?a.depth:!0,z=void 0!==a.stencil?a.stencil:!0,y=void 0!==a.antialias?a.antialias:!1,A=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,G=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,B=[],F=[],J=-1,P=[],K=-1,H=new Float32Array(8),M=[],O=[];this.domElement=u;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMapping=THREE.LinearToneMapping;this.toneMappingWhitePoint=this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var N=this,Q=null,C=null,L=null,E=-1,$="",T=null,X=new THREE.Vector4,ea=null,fa=new THREE.Vector4,ga=0,V=new THREE.Color(0),ba=0,aa=u.width,sa=u.height,Z=1,ua=new THREE.Vector4(0,0,aa,sa),xa=!1,na=new THREE.Vector4(0,0,aa,sa),wa=new THREE.Frustum,da=new THREE.WebGLClipping,ra=!1,va=!1,ka=new THREE.Sphere,qa=new THREE.Matrix4,W=new THREE.Vector3,S={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},ia={calls:0,vertices:0,faces:0,points:0};this.info={render:ia,memory:{geometries:0,textures:0},programs:null};var x;try{w={alpha:w,depth:I,stencil:z,antialias:y,premultipliedAlpha:A,preserveDrawingBuffer:G};x=D||u.getContext("webgl",w)||u.getContext("experimental-webgl",w);if(null===x){if(null!==u.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context."}void 0===x.getShaderPrecisionFormat&&(x.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});u.addEventListener("webglcontextlost",e,!1)}catch(za){console.error("THREE.WebGLRenderer: "+za)}var U=new THREE.WebGLExtensions(x);U.get("WEBGL_depth_texture");U.get("OES_texture_float");U.get("OES_texture_float_linear");U.get("OES_texture_half_float");U.get("OES_texture_half_float_linear");U.get("OES_standard_derivatives");U.get("ANGLE_instanced_arrays");U.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var ca=new THREE.WebGLCapabilities(x,U,a),R=new THREE.WebGLState(x,U,t),Y=new THREE.WebGLProperties,la=new THREE.WebGLTextures(x,U,R,Y,ca,t,this.info),ha=new THREE.WebGLObjects(x,Y,this.info),oa=new THREE.WebGLPrograms(this,ca),ta=new THREE.WebGLLights;this.info.programs=oa.programs;var Aa=new THREE.WebGLBufferRenderer(x,U,ia),Ba=new THREE.WebGLIndexedBufferRenderer(x,U,ia),Ca=new THREE.OrthographicCamera((-1),1,1,(-1),0,1),ma=new THREE.PerspectiveCamera,pa=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1}));a=THREE.ShaderLib.cube;var ja=new THREE.Mesh(new THREE.BoxBufferGeometry(5,5,5),new THREE.ShaderMaterial({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1}));c();this.context=x;this.capabilities=ca;this.extensions=U;this.properties=Y;this.state=R;var ya=new THREE.WebGLShadowMap(this,S,ha,ca);this.shadowMap=ya;var Da=new THREE.SpritePlugin(this,M),Ea=new THREE.LensFlarePlugin(this,O);this.getContext=function(){return x};this.getContextAttributes=function(){return x.getContextAttributes()};this.forceContextLoss=function(){U.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return ca.getMaxAnisotropy()};this.getPrecision=function(){return ca.precision};this.getPixelRatio=function(){return Z};this.setPixelRatio=function(a){void 0!==a&&(Z=a,this.setSize(na.z,na.w,!1))};this.getSize=function(){return{width:aa,height:sa}};this.setSize=function(a,b,c){aa=a;sa=b;u.width=a*Z;u.height=b*Z;!1!==c&&(u.style.width=a+"px",u.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){R.viewport(na.set(a,b,c,d))};this.setScissor=function(a,b,c,d){R.scissor(ua.set(a,b,c,d))};this.setScissorTest=function(a){R.setScissorTest(xa=a)};this.getClearColor=function(){return V};this.setClearColor=function(a,c){V.set(a);ba=void 0!==c?c:1;b(V.r,V.g,V.b,ba)};this.getClearAlpha=function(){return ba};this.setClearAlpha=function(a){ba=a;b(V.r,V.g,V.b,ba)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=x.COLOR_BUFFER_BIT;if(void 0===b||b)d|=x.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=x.STENCIL_BUFFER_BIT;x.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=d;this.dispose=function(){P=[];K=-1;F=[];J=-1;u.removeEventListener("webglcontextlost",e,!1)};this.renderBufferImmediate=function(a,b,c){R.initAttributes();var d=Y.get(a);a.hasPositions&&!d.position&&(d.position=x.createBuffer());a.hasNormals&&!d.normal&&(d.normal=x.createBuffer());a.hasUvs&&!d.uv&&(d.uv=x.createBuffer());a.hasColors&&!d.color&&(d.color=x.createBuffer());b=b.getAttributes();a.hasPositions&&(x.bindBuffer(x.ARRAY_BUFFER,d.position),x.bufferData(x.ARRAY_BUFFER,a.positionArray,x.DYNAMIC_DRAW),R.enableAttribute(b.position),x.vertexAttribPointer(b.position,3,x.FLOAT,!1,0,0));if(a.hasNormals){x.bindBuffer(x.ARRAY_BUFFER,d.normal);if("MeshPhongMaterial"!==c.type&&"MeshStandardMaterial"!==c.type&&"MeshPhysicalMaterial"!==c.type&&c.shading===THREE.FlatShading)for(var e=0,g=3*a.count;e<g;e+=9){var f=a.normalArray,h=(f[e+0]+f[e+3]+f[e+6])/3,k=(f[e+1]+f[e+4]+f[e+7])/3,l=(f[e+2]+f[e+5]+f[e+8])/3;f[e+0]=h;f[e+1]=k;f[e+2]=l;f[e+3]=h;f[e+4]=k;f[e+5]=l;f[e+6]=h;f[e+7]=k;f[e+8]=l}x.bufferData(x.ARRAY_BUFFER,a.normalArray,x.DYNAMIC_DRAW);R.enableAttribute(b.normal);x.vertexAttribPointer(b.normal,3,x.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(x.bindBuffer(x.ARRAY_BUFFER,d.uv),x.bufferData(x.ARRAY_BUFFER,a.uvArray,x.DYNAMIC_DRAW),R.enableAttribute(b.uv),x.vertexAttribPointer(b.uv,2,x.FLOAT,!1,0,0));a.hasColors&&c.vertexColors!==THREE.NoColors&&(x.bindBuffer(x.ARRAY_BUFFER,d.color),x.bufferData(x.ARRAY_BUFFER,a.colorArray,x.DYNAMIC_DRAW),R.enableAttribute(b.color),x.vertexAttribPointer(b.color,3,x.FLOAT,!1,0,0));R.disableUnusedAttributes();x.drawArrays(x.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){r(d);var g=s(a,b,d,e),k=!1;a=c.id+"_"+g.id+"_"+d.wireframe;a!==$&&($=a,k=!0);b=e.morphTargetInfluences;if(void 0!==b){a=[];for(var l=0,k=b.length;l<k;l++){var n=b[l];a.push([n,l])}a.sort(h);8<a.length&&(a.length=8);for(var m=c.morphAttributes,l=0,k=a.length;l<k;l++)n=a[l],H[l]=n[0],0!==n[0]?(b=n[1],!0===d.morphTargets&&m.position&&c.addAttribute("morphTarget"+l,m.position[b]),!0===d.morphNormals&&m.normal&&c.addAttribute("morphNormal"+l,m.normal[b])):(!0===d.morphTargets&&c.removeAttribute("morphTarget"+l),!0===d.morphNormals&&c.removeAttribute("morphNormal"+l));g.getUniforms().setValue(x,"morphTargetInfluences",H);k=!0}b=c.index;l=c.attributes.position;!0===d.wireframe&&(b=ha.getWireframeAttribute(c));null!==b?(a=Ba,a.setIndex(b)):a=Aa;if(k){a:{var k=void 0,p;if(c instanceof THREE.InstancedBufferGeometry&&(p=U.get("ANGLE_instanced_arrays"),null===p)){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");break a}void 0===k&&(k=0);R.initAttributes();var n=c.attributes,g=g.getAttributes(),m=d.defaultAttributeValues,q;for(q in g){var u=g[q];if(0<=u){var w=n[q];if(void 0!==w){var t=x.FLOAT,D=w.array,v=w.normalized;D instanceof Float32Array?t=x.FLOAT:D instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):D instanceof Uint16Array?t=x.UNSIGNED_SHORT:D instanceof Int16Array?t=x.SHORT:D instanceof Uint32Array?t=x.UNSIGNED_INT:D instanceof Int32Array?t=x.INT:D instanceof Int8Array?t=x.BYTE:D instanceof Uint8Array&&(t=x.UNSIGNED_BYTE);var D=w.itemSize,y=ha.getAttributeBuffer(w);if(w instanceof THREE.InterleavedBufferAttribute){var z=w.data,A=z.stride,w=w.offset;z instanceof THREE.InstancedInterleavedBuffer?(R.enableAttributeAndDivisor(u,z.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=z.meshPerAttribute*z.count)):R.enableAttribute(u);x.bindBuffer(x.ARRAY_BUFFER,y);x.vertexAttribPointer(u,D,t,v,A*z.array.BYTES_PER_ELEMENT,(k*A+w)*z.array.BYTES_PER_ELEMENT)}else w instanceof THREE.InstancedBufferAttribute?(R.enableAttributeAndDivisor(u,w.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=w.meshPerAttribute*w.count)):R.enableAttribute(u),x.bindBuffer(x.ARRAY_BUFFER,y),x.vertexAttribPointer(u,D,t,v,0,k*D*w.array.BYTES_PER_ELEMENT)}else if(void 0!==m&&(t=m[q],void 0!==t))switch(t.length){case 2:x.vertexAttrib2fv(u,t);break;case 3:x.vertexAttrib3fv(u,t);break;case 4:x.vertexAttrib4fv(u,t);break;default:x.vertexAttrib1fv(u,t)}}}R.disableUnusedAttributes()}null!==b&&x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,ha.getAttributeBuffer(b))}p=Infinity;null!==b?p=b.count:void 0!==l&&(p=l.count);q=c.drawRange.start;b=c.drawRange.count;l=null!==f?f.start:0;k=null!==f?f.count:Infinity;f=Math.max(0,q,l);p=Math.min(0+p,q+b,l+k)-1;p=Math.max(0,p-f+1);if(e instanceof THREE.Mesh)if(!0===d.wireframe)R.setLineWidth(d.wireframeLinewidth*(null===C?Z:1)),a.setMode(x.LINES);else switch(e.drawMode){case THREE.TrianglesDrawMode:a.setMode(x.TRIANGLES);break;case THREE.TriangleStripDrawMode:a.setMode(x.TRIANGLE_STRIP);break;case THREE.TriangleFanDrawMode:a.setMode(x.TRIANGLE_FAN)}else e instanceof THREE.Line?(d=d.linewidth,void 0===d&&(d=1),R.setLineWidth(d*(null===C?Z:1)),e instanceof THREE.LineSegments?a.setMode(x.LINES):a.setMode(x.LINE_STRIP)):e instanceof THREE.Points&&a.setMode(x.POINTS);c instanceof THREE.InstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,f,p):a.render(f,p)};this.render=function(a,c,d,e){if(!1===c instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var f=a.fog;$="";E=-1;T=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);qa.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);wa.setFromMatrix(qa);B.length=0;K=J=-1;M.length=0;O.length=0;va=this.localClippingEnabled;ra=da.init(this.clippingPlanes,va,c);n(a,c);F.length=J+1;P.length=K+1;!0===N.sortObjects&&(F.sort(k),P.sort(l));ra&&da.beginShadows();for(var g=B,h=0,p=0,m=g.length;p<m;p++){var u=g[p];u.castShadow&&(S.shadows[h++]=u)}S.shadows.length=h;ya.render(a,c);for(var g=B,r=u=0,s=0,w,t,D,H,v=c.matrixWorldInverse,y=0,z=0,A=0,L=0,h=0,p=g.length;h<p;h++)if(m=g[h],w=m.color,t=m.intensity,D=m.distance,H=m.shadow&&m.shadow.map?m.shadow.map.texture:null,m instanceof THREE.AmbientLight)u+=w.r*t,r+=w.g*t,s+=w.b*t;else if(m instanceof THREE.DirectionalLight){var C=ta.get(m);C.color.copy(m.color).multiplyScalar(m.intensity);C.direction.setFromMatrixPosition(m.matrixWorld);W.setFromMatrixPosition(m.target.matrixWorld);C.direction.sub(W);C.direction.transformDirection(v);if(C.shadow=m.castShadow)C.shadowBias=m.shadow.bias,C.shadowRadius=m.shadow.radius,
C.shadowMapSize=m.shadow.mapSize;S.directionalShadowMap[y]=H;S.directionalShadowMatrix[y]=m.shadow.matrix;S.directional[y++]=C}else if(m instanceof THREE.SpotLight){C=ta.get(m);C.position.setFromMatrixPosition(m.matrixWorld);C.position.applyMatrix4(v);C.color.copy(w).multiplyScalar(t);C.distance=D;C.direction.setFromMatrixPosition(m.matrixWorld);W.setFromMatrixPosition(m.target.matrixWorld);C.direction.sub(W);C.direction.transformDirection(v);C.coneCos=Math.cos(m.angle);C.penumbraCos=Math.cos(m.angle*(1-m.penumbra));C.decay=0===m.distance?0:m.decay;if(C.shadow=m.castShadow)C.shadowBias=m.shadow.bias,C.shadowRadius=m.shadow.radius,C.shadowMapSize=m.shadow.mapSize;S.spotShadowMap[A]=H;S.spotShadowMatrix[A]=m.shadow.matrix;S.spot[A++]=C}else if(m instanceof THREE.PointLight){C=ta.get(m);C.position.setFromMatrixPosition(m.matrixWorld);C.position.applyMatrix4(v);C.color.copy(m.color).multiplyScalar(m.intensity);C.distance=m.distance;C.decay=0===m.distance?0:m.decay;if(C.shadow=m.castShadow)C.shadowBias=m.shadow.bias,C.shadowRadius=m.shadow.radius,C.shadowMapSize=m.shadow.mapSize;S.pointShadowMap[z]=H;void 0===S.pointShadowMatrix[z]&&(S.pointShadowMatrix[z]=new THREE.Matrix4);W.setFromMatrixPosition(m.matrixWorld).negate();S.pointShadowMatrix[z].identity().setPosition(W);S.point[z++]=C}else m instanceof THREE.HemisphereLight&&(C=ta.get(m),C.direction.setFromMatrixPosition(m.matrixWorld),C.direction.transformDirection(v),C.direction.normalize(),C.skyColor.copy(m.color).multiplyScalar(t),C.groundColor.copy(m.groundColor).multiplyScalar(t),S.hemi[L++]=C);S.ambient[0]=u;S.ambient[1]=r;S.ambient[2]=s;S.directional.length=y;S.spot.length=A;S.point.length=z;S.hemi.length=L;S.hash=y+","+z+","+A+","+L+","+S.shadows.length;ra&&da.endShadows();ia.calls=0;ia.vertices=0;ia.faces=0;ia.points=0;void 0===d&&(d=null);this.setRenderTarget(d);g=a.background;null===g?b(V.r,V.g,V.b,ba):g instanceof THREE.Color&&b(g.r,g.g,g.b,1);(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);g instanceof THREE.CubeTexture?(ma.projectionMatrix.copy(c.projectionMatrix),ma.matrixWorld.extractRotation(c.matrixWorld),ma.matrixWorldInverse.getInverse(ma.matrixWorld),ja.material.uniforms.tCube.value=g,ja.modelViewMatrix.multiplyMatrices(ma.matrixWorldInverse,ja.matrixWorld),ha.update(ja),N.renderBufferDirect(ma,null,ja.geometry,ja.material,ja,null)):g instanceof THREE.Texture&&(pa.material.map=g,ha.update(pa),N.renderBufferDirect(Ca,null,pa.geometry,pa.material,pa,null));a.overrideMaterial?(e=a.overrideMaterial,q(F,c,f,e),q(P,c,f,e)):(R.setBlending(THREE.NoBlending),q(F,c,f),q(P,c,f));Da.render(a,c);Ea.render(a,c,fa);d&&la.updateRenderTargetMipmap(d);R.setDepthTest(!0);R.setDepthWrite(!0);R.setColorWrite(!0)}};this.setFaceCulling=function(a,b){R.setCullFace(a);R.setFlipSided(b===THREE.FrontFaceDirectionCW)};this.allocTextureUnit=function(){var a=ga;a>=ca.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+ca.maxTextures);ga+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTarget&&(a||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);la.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),a=!0);la.setTexture2D(b,c)}}();this.setTextureCube=function(){var a=!1;return function(b,c){b instanceof THREE.WebGLRenderTargetCube&&(a||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);b instanceof THREE.CubeTexture||Array.isArray(b.image)&&6===b.image.length?la.setTextureCube(b,c):la.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return C};this.setRenderTarget=function(a){(C=a)&&void 0===Y.get(a).__webglFramebuffer&&la.setupRenderTarget(a);var b=a instanceof THREE.WebGLRenderTargetCube,c;a?(c=Y.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,X.copy(a.scissor),ea=a.scissorTest,fa.copy(a.viewport)):(c=null,X.copy(ua).multiplyScalar(Z),ea=xa,fa.copy(na).multiplyScalar(Z));L!==c&&(x.bindFramebuffer(x.FRAMEBUFFER,c),L=c);R.scissor(X);R.setScissorTest(ea);R.viewport(fa);b&&(b=Y.get(a.texture),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=function(a,b,c,d,e,g){if(!1===a instanceof THREE.WebGLRenderTarget)console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var f=Y.get(a).__webglFramebuffer;if(f){var h=!1;f!==L&&(x.bindFramebuffer(x.FRAMEBUFFER,f),h=!0);try{var k=a.texture;k.format!==THREE.RGBAFormat&&t(k.format)!==x.getParameter(x.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):k.type===THREE.UnsignedByteType||t(k.type)===x.getParameter(x.IMPLEMENTATION_COLOR_READ_TYPE)||k.type===THREE.FloatType&&U.get("WEBGL_color_buffer_float")||k.type===THREE.HalfFloatType&&U.get("EXT_color_buffer_half_float")?x.checkFramebufferStatus(x.FRAMEBUFFER)===x.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&x.readPixels(b,c,d,e,t(k.format),t(k.type),g):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{h&&x.bindFramebuffer(x.FRAMEBUFFER,L)}}}}};THREE.WebGLRenderTarget=function(a,b,c){this.uuid=THREE.Math.generateUUID();this.width=a;this.height=b;this.scissor=new THREE.Vector4(0,0,a,b);this.scissorTest=!1;this.viewport=new THREE.Vector4(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=THREE.LinearFilter);this.texture=new THREE.Texture((void 0),(void 0),c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=null};Object.assign(THREE.WebGLRenderTarget.prototype,THREE.EventDispatcher.prototype,{setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.WebGLBufferRenderer=function(a,b,c){var d;this.setMode=function(a){d=a};this.render=function(b,f){a.drawArrays(d,b,f);c.calls++;c.vertices+=f;d===a.TRIANGLES&&(c.faces+=f/3)};this.renderInstances=function(e){var f=b.get("ANGLE_instanced_arrays");if(null===f)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var g=e.attributes.position,h=0,h=g instanceof THREE.InterleavedBufferAttribute?g.data.count:g.count;f.drawArraysInstancedANGLE(d,0,h,e.maxInstancedCount);c.calls++;c.vertices+=h*e.maxInstancedCount;d===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*h/3)}}};THREE.WebGLClipping=function(){function a(){l.value!==d&&(l.value=d,l.needsUpdate=0<e);c.numPlanes=e}function b(a,b,d,e){var g=null!==a?a.length:0,f=null;if(0!==g){f=l.value;if(!0!==e||null===f){e=d+4*g;b=b.matrixWorldInverse;k.getNormalMatrix(b);if(null===f||f.length<e)f=new Float32Array(e);for(e=0;e!==g;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(f,d),f[d+3]=h.constant}l.value=f;l.needsUpdate=!0}c.numPlanes=g;return f}var c=this,d=null,e=0,f=!1,g=!1,h=new THREE.Plane,k=new THREE.Matrix3,l={value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(a,c,g){var h=0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return h};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,k,q,r){if(!f||null===c||0===c.length||g&&!h)g?b(null):a();else{h=g?0:e;var s=4*h,v=q.clippingState||null;l.value=v;v=b(c,k,s,r);for(c=0;c!==s;++c)v[c]=d[c];q.clippingState=v;this.numPlanes+=h}}};THREE.WebGLIndexedBufferRenderer=function(a,b,c){var d,e,f;this.setMode=function(a){d=a};this.setIndex=function(c){c.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(e=a.UNSIGNED_INT,f=4):(e=a.UNSIGNED_SHORT,f=2)};this.render=function(b,h){a.drawElements(d,h,e,b*f);c.calls++;c.vertices+=h;d===a.TRIANGLES&&(c.faces+=h/3)};this.renderInstances=function(g,h,k){var l=b.get("ANGLE_instanced_arrays");null===l?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(l.drawElementsInstancedANGLE(d,k,e,h*f,g.maxInstancedCount),c.calls++,c.vertices+=k*g.maxInstancedCount,d===a.TRIANGLES&&(c.faces+=g.maxInstancedCount*k/3))}};THREE.WebGLExtensions=function(a){var b={};this.get=function(c){if(void 0!==b[c])return b[c];var d;switch(c){case"WEBGL_depth_texture":d=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":d=a.getExtension("WEBGL_compressed_texture_etc1");break;default:d=a.getExtension(c)}null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=d}};THREE.WebGLCapabilities=function(a,b,c){function d(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var e;this.getMaxAnisotropy=function(){if(void 0!==e)return e;var c=b.get("EXT_texture_filter_anisotropic");return e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0};this.getMaxPrecision=d;this.precision=void 0!==c.precision?c.precision:"highp";this.logarithmicDepthBuffer=void 0!==c.logarithmicDepthBuffer?c.logarithmicDepthBuffer:!1;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS);this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=0<this.maxVertexTextures;this.floatFragmentTextures=!!b.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;c=d(this.precision);c!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",c,"instead."),this.precision=c);this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get("EXT_frag_depth"))};THREE.WebGLGeometries=function(a,b,c){function d(a){var h=a.target;a=f[h.id];null!==a.index&&e(a.index);var k=a.attributes,l;for(l in k)e(k[l]);h.removeEventListener("dispose",d);delete f[h.id];l=b.get(h);l.wireframe&&e(l.wireframe);b.delete(h);h=b.get(a);h.wireframe&&e(h.wireframe);b.delete(a);c.memory.geometries--}function e(c){var d;d=c instanceof THREE.InterleavedBufferAttribute?b.get(c.data).__webglBuffer:b.get(c).__webglBuffer;void 0!==d&&(a.deleteBuffer(d),c instanceof THREE.InterleavedBufferAttribute?b.delete(c.data):b.delete(c))}var f={};this.get=function(a){var b=a.geometry;if(void 0!==f[b.id])return f[b.id];b.addEventListener("dispose",d);var e;b instanceof THREE.BufferGeometry?e=b:b instanceof THREE.Geometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new THREE.BufferGeometry).setFromObject(a)),e=b._bufferGeometry);f[b.id]=e;c.memory.geometries++;return e}};THREE.WebGLLights=function(){var a={};this.get=function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case"DirectionalLight":c={direction:new THREE.Vector3,color:new THREE.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"SpotLight":c={position:new THREE.Vector3,direction:new THREE.Vector3,color:new THREE.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"PointLight":c={position:new THREE.Vector3,color:new THREE.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"HemisphereLight":c={direction:new THREE.Vector3,skyColor:new THREE.Color,groundColor:new THREE.Color}}return a[b.id]=c}};THREE.WebGLObjects=function(a,b,c){function d(c,d){var e=c instanceof THREE.InterleavedBufferAttribute?c.data:c,f=b.get(e);void 0===f.__webglBuffer?(f.__webglBuffer=a.createBuffer(),a.bindBuffer(d,f.__webglBuffer),a.bufferData(d,e.array,e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),f.version=e.version):f.version!==e.version&&(a.bindBuffer(d,f.__webglBuffer),!1===e.dynamic||-1===e.updateRange.count?a.bufferSubData(d,0,e.array):0===e.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(d,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0),f.version=e.version)}function e(a,b,c){if(b>c){var d=b;b=c;c=d}d=a[b];return void 0===d?(a[b]=[c],!0):-1===d.indexOf(c)?(d.push(c),!0):!1}var f=new THREE.WebGLGeometries(a,b,c);this.getAttributeBuffer=function(a){return a instanceof THREE.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer};this.getWireframeAttribute=function(c){var f=b.get(c);if(void 0!==f.wireframe)return f.wireframe;var k=[],l=c.index,m=c.attributes;c=m.position;if(null!==l)for(var m={},l=l.array,p=0,n=l.length;p<n;p+=3){var q=l[p+0],r=l[p+1],s=l[p+2];e(m,q,r)&&k.push(q,r);e(m,r,s)&&k.push(r,s);e(m,s,q)&&k.push(s,q)}else for(l=m.position.array,p=0,n=l.length/3-1;p<n;p+=3)q=p+0,r=p+1,s=p+2,k.push(q,r,r,s,s,q);k=new THREE.BufferAttribute(new(65535<c.count?Uint32Array:Uint16Array)(k),1);d(k,a.ELEMENT_ARRAY_BUFFER);return f.wireframe=k};this.update=function(b){var c=f.get(b);b.geometry instanceof THREE.Geometry&&c.updateFromObject(b);b=c.index;var e=c.attributes;null!==b&&d(b,a.ELEMENT_ARRAY_BUFFER);for(var l in e)d(e[l],a.ARRAY_BUFFER);b=c.morphAttributes;for(l in b)for(var e=b[l],m=0,p=e.length;m<p;m++)d(e[m],a.ARRAY_BUFFER);return c}};THREE.WebGLProgram=function(){function a(a){switch(a){case THREE.LinearEncoding:return["Linear","( value )"];case THREE.sRGBEncoding:return["sRGB","( value )"];case THREE.RGBEEncoding:return["RGBE","( value )"];case THREE.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case THREE.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case THREE.RGBDEncoding:return["RGBD","( value, 256.0 )"];case THREE.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a)}}function b(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function c(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function d(a,b){var c;switch(b){case THREE.LinearToneMapping:c="Linear";break;case THREE.ReinhardToneMapping:c="Reinhard";break;case THREE.Uncharted2ToneMapping:c="Uncharted2";break;case THREE.CineonToneMapping:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+b)}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function e(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(g).join("\n")}function f(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function g(a){return""!==a}function h(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function k(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,b){var c=THREE.ShaderChunk[b];if(void 0===c)throw Error("Can not resolve #include <"+b+">");return k(c)})}function l(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,b,c,d){a="";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\[ i \]/g,"[ "+b+" ]");return a})}var m=0;return function(a,n,q,r){var s=a.context,v=q.extensions,t=q.defines,u=q.__webglShader.vertexShader,D=q.__webglShader.fragmentShader,w="SHADOWMAP_TYPE_BASIC";r.shadowMapType===THREE.PCFShadowMap?w="SHADOWMAP_TYPE_PCF":r.shadowMapType===THREE.PCFSoftShadowMap&&(w="SHADOWMAP_TYPE_PCF_SOFT");var I="ENVMAP_TYPE_CUBE",z="ENVMAP_MODE_REFLECTION",y="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(q.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:I="ENVMAP_TYPE_CUBE";break;case THREE.CubeUVReflectionMapping:case THREE.CubeUVRefractionMapping:I="ENVMAP_TYPE_CUBE_UV";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:I="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:I="ENVMAP_TYPE_SPHERE"}switch(q.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:z="ENVMAP_MODE_REFRACTION"}switch(q.combine){case THREE.MultiplyOperation:y="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:y="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:y="ENVMAP_BLENDING_ADD"}}var A=0<a.gammaFactor?a.gammaFactor:1,v=e(v,r,a.extensions),G=f(t),B=s.createProgram();q instanceof THREE.RawShaderMaterial?(t=[G].filter(g).join("\n"),w=[G].filter(g).join("\n")):(t=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+q.__webglShader.name,G,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+A,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+z:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+w:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(g).join("\n"),w=[v,"precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+q.__webglShader.name,G,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"","#define GAMMA_FACTOR "+A,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+I:"",r.envMap?"#define "+z:"",r.envMap?"#define "+y:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+w:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",r.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",r.toneMapping!==THREE.NoToneMapping?"#define TONE_MAPPING":"",r.toneMapping!==THREE.NoToneMapping?THREE.ShaderChunk.tonemapping_pars_fragment:"",r.toneMapping!==THREE.NoToneMapping?d("toneMapping",r.toneMapping):"",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?THREE.ShaderChunk.encodings_pars_fragment:"",r.mapEncoding?b("mapTexelToLinear",r.mapEncoding):"",r.envMapEncoding?b("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?b("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.outputEncoding?c("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+q.depthPacking:"","\n"].filter(g).join("\n"));u=k(u,r);u=h(u,r);D=k(D,r);D=h(D,r);!1===q instanceof THREE.ShaderMaterial&&(u=l(u),D=l(D));D=w+D;u=THREE.WebGLShader(s,s.VERTEX_SHADER,t+u);D=THREE.WebGLShader(s,s.FRAGMENT_SHADER,D);s.attachShader(B,u);s.attachShader(B,D);void 0!==q.index0AttributeName?s.bindAttribLocation(B,0,q.index0AttributeName):!0===r.morphTargets&&s.bindAttribLocation(B,0,"position");s.linkProgram(B);r=s.getProgramInfoLog(B);I=s.getShaderInfoLog(u);z=s.getShaderInfoLog(D);A=y=!0;if(!1===s.getProgramParameter(B,s.LINK_STATUS))y=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(B,s.VALIDATE_STATUS),"gl.getProgramInfoLog",r,I,z);else if(""!==r)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",r);else if(""===I||""===z)A=!1;A&&(this.diagnostics={runnable:y,material:q,programLog:r,vertexShader:{log:I,prefix:t},fragmentShader:{log:z,prefix:w}});s.deleteShader(u);s.deleteShader(D);var F;this.getUniforms=function(){void 0===F&&(F=new THREE.WebGLUniforms(s,B,a));return F};var J;this.getAttributes=function(){if(void 0===J){for(var a={},b=s.getProgramParameter(B,s.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=s.getActiveAttrib(B,c).name;a[d]=s.getAttribLocation(B,d)}J=a}return J};this.destroy=function(){s.deleteProgram(B);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=m++;this.code=n;this.usedTimes=1;this.program=B;this.vertexShader=u;this.fragmentShader=D;return this}}();THREE.WebGLPrograms=function(a,b){function c(a,b){var c;a?a instanceof THREE.Texture?c=a.encoding:a instanceof THREE.WebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),c=a.texture.encoding):c=THREE.LinearEncoding;c===THREE.LinearEncoding&&b&&(c=THREE.GammaEncoding);return c}var d=[],e={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},f="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");this.getParameters=function(d,f,k,l,m){var p=e[d.type],n;b.floatVertexTextures&&m&&m.skeleton&&m.skeleton.useVertexTexture?n=1024:(n=Math.floor((b.maxVertexUniforms-20)/4),void 0!==m&&m instanceof THREE.SkinnedMesh&&(n=Math.min(m.skeleton.bones.length,n),n<m.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+m.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")));var q=a.getPrecision();null!==d.precision&&(q=b.getMaxPrecision(d.precision),q!==d.precision&&console.warn("THREE.WebGLProgram.getParameters:",d.precision,"not supported, using",q,"instead."));var r=a.getCurrentRenderTarget();return{shaderID:p,precision:q,supportsVertexTextures:b.vertexTextures,outputEncoding:c(r?r.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:c(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:c(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(d.envMap.mapping===THREE.CubeUVReflectionMapping||d.envMap.mapping===THREE.CubeUVRefractionMapping),lightMap:!!d.lightMap,aoMap:!!d.aoMap,emissiveMap:!!d.emissiveMap,emissiveMapEncoding:c(d.emissiveMap,a.gammaInput),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,combine:d.combine,vertexColors:d.vertexColors,fog:!!k,useFog:d.fog,fogExp:k instanceof THREE.FogExp2,flatShading:d.shading===THREE.FlatShading,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:d.skinning,maxBones:n,useVertexTexture:b.floatVertexTextures&&m&&m.skeleton&&m.skeleton.useVertexTexture,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numHemiLights:f.hemi.length,numClippingPlanes:l,shadowMapEnabled:a.shadowMap.enabled&&m.receiveShadow&&0<f.shadows.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,alphaTest:d.alphaTest,doubleSided:d.side===THREE.DoubleSide,flipSided:d.side===THREE.BackSide,depthPacking:void 0!==d.depthPacking?d.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<f.length;d++)c.push(b[f[d]]);return c.join()};this.acquireProgram=function(b,c,e){for(var f,m=0,p=d.length;m<p;m++){var n=d[m];if(n.code===e){f=n;++f.usedTimes;break}}void 0===f&&(f=new THREE.WebGLProgram(a,e,b,c),d.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=d.indexOf(a);d[b]=d[d.length-1];d.pop();a.destroy()}};this.programs=d};THREE.WebGLProperties=function(){var a={};this.get=function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c};this.delete=function(b){delete a[b.uuid]};this.clear=function(){a={}}};THREE.WebGLShader=function(){function a(a){a=a.split("\n");for(var c=0;c<a.length;c++)a[c]=c+1+": "+a[c];return a.join("\n")}return function(b,c,d){var e=b.createShader(c);b.shaderSource(e,d);b.compileShader(e);!1===b.getShaderParameter(e,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(e)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",c===b.VERTEX_SHADER?"vertex":"fragment",b.getShaderInfoLog(e),a(d));return e}}();THREE.WebGLShadowMap=function(a,b,c,d){function e(b,c,d,e){var f=b.geometry,g=null,g=v,h=b.customDepthMaterial;d&&(g=t,h=b.customDistanceMaterial);h?g=h:(h=!1,c.morphTargets&&(f instanceof THREE.BufferGeometry?h=f.morphAttributes&&f.morphAttributes.position&&0<f.morphAttributes.position.length:f instanceof THREE.Geometry&&(h=f.morphTargets&&0<f.morphTargets.length)),b=b instanceof THREE.SkinnedMesh&&c.skinning,f=0,h&&(f|=1),b&&(f|=2),g=g[f]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&(h=g.uuid,b=c.uuid,f=u[h],void 0===f&&(f={},u[h]=f),h=f[b],void 0===h&&(h=g.clone(),f[b]=h),g=h);g.visible=c.visible;g.wireframe=c.wireframe;b=c.side;F.renderSingleSided&&b==THREE.DoubleSide&&(b=THREE.FrontSide);F.renderReverseSided&&(b===THREE.FrontSide?b=THREE.BackSide:b===THREE.BackSide&&(b=THREE.FrontSide));g.side=b;g.clipShadows=c.clipShadows;g.clippingPlanes=c.clippingPlanes;g.wireframeLinewidth=c.wireframeLinewidth;g.linewidth=c.linewidth;d&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e);return g}function f(a,b,c){if(!1!==a.visible){a.layers.test(b.layers)&&(a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===k.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),s.push(a));a=a.children;for(var d=0,e=a.length;d<e;d++)f(a[d],b,c)}}var g=a.context,h=a.state,k=new THREE.Frustum,l=new THREE.Matrix4,m=b.shadows,p=new THREE.Vector2,n=new THREE.Vector2(d.maxTextureSize,d.maxTextureSize),q=new THREE.Vector3,r=new THREE.Vector3,s=[],v=Array(4),t=Array(4),u={},D=[new THREE.Vector3(1,0,0),new THREE.Vector3((-1),0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,(-1)),new THREE.Vector3(0,1,0),new THREE.Vector3(0,(-1),0)],w=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,(-1))],I=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4];
b=new THREE.MeshDepthMaterial;b.depthPacking=THREE.RGBADepthPacking;b.clipping=!0;d=THREE.ShaderLib.distanceRGBA;for(var z=THREE.UniformsUtils.clone(d.uniforms),y=0;4!==y;++y){var A=0!==(y&1),G=0!==(y&2),B=b.clone();B.morphTargets=A;B.skinning=G;v[y]=B;A=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:z,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,morphTargets:A,skinning:G,clipping:!0});t[y]=A}var F=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=THREE.PCFShadowMap;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(b,d){if(!1!==F.enabled&&(!1!==F.autoUpdate||!1!==F.needsUpdate)&&0!==m.length){h.clearColor(1,1,1,1);h.disable(g.BLEND);h.setDepthTest(!0);h.setScissorTest(!1);for(var u,t,v=0,y=m.length;v<y;v++){var z=m[v],A=z.shadow;if(void 0===A)console.warn("THREE.WebGLShadowMap:",z,"has no shadow.");else{var C=A.camera;p.copy(A.mapSize);p.min(n);if(z instanceof THREE.PointLight){u=6;t=!0;var L=p.x,E=p.y;I[0].set(2*L,E,L,E);I[1].set(0,E,L,E);I[2].set(3*L,E,L,E);I[3].set(L,E,L,E);I[4].set(3*L,0,L,E);I[5].set(L,0,L,E);p.x*=4;p.y*=2}else u=1,t=!1;null===A.map&&(A.map=new THREE.WebGLRenderTarget(p.x,p.y,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),C.updateProjectionMatrix());A instanceof THREE.SpotLightShadow&&A.update(z);L=A.map;A=A.matrix;r.setFromMatrixPosition(z.matrixWorld);C.position.copy(r);a.setRenderTarget(L);a.clear();for(L=0;L<u;L++){t?(q.copy(C.position),q.add(D[L]),C.up.copy(w[L]),C.lookAt(q),h.viewport(I[L])):(q.setFromMatrixPosition(z.target.matrixWorld),C.lookAt(q));C.updateMatrixWorld();C.matrixWorldInverse.getInverse(C.matrixWorld);A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);A.multiply(C.projectionMatrix);A.multiply(C.matrixWorldInverse);l.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse);k.setFromMatrix(l);s.length=0;f(b,d,C);for(var E=0,B=s.length;E<B;E++){var G=s[E],X=c.update(G),ea=G.material;if(ea instanceof THREE.MultiMaterial)for(var fa=X.groups,ea=ea.materials,ga=0,V=fa.length;ga<V;ga++){var ba=fa[ga],aa=ea[ba.materialIndex];!0===aa.visible&&(aa=e(G,aa,t,r),a.renderBufferDirect(C,null,X,aa,G,ba))}else aa=e(G,ea,t,r),a.renderBufferDirect(C,null,X,aa,G,null)}}}}u=a.getClearColor();t=a.getClearAlpha();a.setClearColor(u,t);F.needsUpdate=!1}}};THREE.WebGLState=function(a,b,c){function d(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}var e=this;this.buffers={color:new THREE.WebGLColorBuffer(a,this),depth:new THREE.WebGLDepthBuffer(a,this),stencil:new THREE.WebGLStencilBuffer(a,this)};var f=a.getParameter(a.MAX_VERTEX_ATTRIBS),g=new Uint8Array(f),h=new Uint8Array(f),k=new Uint8Array(f),l={},m=null,p=null,n=null,q=null,r=null,s=null,v=null,t=null,u=!1,D=null,w=null,I=null,z=null,y=null,A=null,G=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),B=null,F={},J=new THREE.Vector4,P=new THREE.Vector4,K={};K[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);K[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);this.init=function(){this.clearColor(0,0,0,1);this.clearDepth(1);this.clearStencil(0);this.enable(a.DEPTH_TEST);this.setDepthFunc(THREE.LessEqualDepth);this.setFlipSided(!1);this.setCullFace(THREE.CullFaceBack);this.enable(a.CULL_FACE);this.enable(a.BLEND);this.setBlending(THREE.NormalBlending)};this.initAttributes=function(){for(var a=0,b=g.length;a<b;a++)g[a]=0};this.enableAttribute=function(c){g[c]=1;0===h[c]&&(a.enableVertexAttribArray(c),h[c]=1);0!==k[c]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),k[c]=0)};this.enableAttributeAndDivisor=function(b,c,d){g[b]=1;0===h[b]&&(a.enableVertexAttribArray(b),h[b]=1);k[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),k[b]=c)};this.disableUnusedAttributes=function(){for(var b=0,c=h.length;b!==c;++b)h[b]!==g[b]&&(a.disableVertexAttribArray(b),h[b]=0)};this.enable=function(b){!0!==l[b]&&(a.enable(b),l[b]=!0)};this.disable=function(b){!1!==l[b]&&(a.disable(b),l[b]=!1)};this.getCompressedTextureFormats=function(){if(null===m&&(m=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)m.push(c[d]);return m};this.setBlending=function(b,d,e,f,g,h,k,l){if(b!==THREE.NoBlending){this.enable(a.BLEND);if(b!==p||l!==u)b===THREE.AdditiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===THREE.SubtractiveBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):b===THREE.MultiplyBlending?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),p=b,u=l;if(b===THREE.CustomBlending){g=g||d;h=h||e;k=k||f;if(d!==n||g!==s)a.blendEquationSeparate(c(d),c(g)),n=d,s=g;if(e!==q||f!==r||h!==v||k!==t)a.blendFuncSeparate(c(e),c(f),c(h),c(k)),q=e,r=f,v=h,t=k}else t=v=s=r=q=n=null}else this.disable(a.BLEND),p=b};this.setColorWrite=function(a){this.buffers.color.setMask(a)};this.setDepthTest=function(a){this.buffers.depth.setTest(a)};this.setDepthWrite=function(a){this.buffers.depth.setMask(a)};this.setDepthFunc=function(a){this.buffers.depth.setFunc(a)};this.setStencilTest=function(a){this.buffers.stencil.setTest(a)};this.setStencilWrite=function(a){this.buffers.stencil.setMask(a)};this.setStencilFunc=function(a,b,c){this.buffers.stencil.setFunc(a,b,c)};this.setStencilOp=function(a,b,c){this.buffers.stencil.setOp(a,b,c)};this.setFlipSided=function(b){D!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),D=b)};this.setCullFace=function(b){b!==THREE.CullFaceNone?(this.enable(a.CULL_FACE),b!==w&&(b===THREE.CullFaceBack?a.cullFace(a.BACK):b===THREE.CullFaceFront?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):this.disable(a.CULL_FACE);w=b};this.setLineWidth=function(b){b!==I&&(a.lineWidth(b),I=b)};this.setPolygonOffset=function(b,c,d){if(b){if(this.enable(a.POLYGON_OFFSET_FILL),z!==c||y!==d)a.polygonOffset(c,d),z=c,y=d}else this.disable(a.POLYGON_OFFSET_FILL)};this.getScissorTest=function(){return A};this.setScissorTest=function(b){(A=b)?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)};this.activeTexture=function(b){void 0===b&&(b=a.TEXTURE0+G-1);B!==b&&(a.activeTexture(b),B=b)};this.bindTexture=function(b,c){null===B&&e.activeTexture();var d=F[B];void 0===d&&(d={type:void 0,texture:void 0},F[B]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||K[b]),d.type=b,d.texture=c};this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}};this.clearColor=function(a,b,c,d){this.buffers.color.setClear(a,b,c,d)};this.clearDepth=function(a){this.buffers.depth.setClear(a)};this.clearStencil=function(a){this.buffers.stencil.setClear(a)};this.scissor=function(b){!1===J.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),J.copy(b))};this.viewport=function(b){!1===P.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),P.copy(b))};this.reset=function(){for(var b=0;b<h.length;b++)1===h[b]&&(a.disableVertexAttribArray(b),h[b]=0);l={};B=m=null;F={};w=D=p=null;this.buffers.color.reset();this.buffers.depth.reset();this.buffers.stencil.reset()}};THREE.WebGLColorBuffer=function(a,b){var c=!1,d=new THREE.Vector4,e=null,f=new THREE.Vector4;this.setMask=function(b){e===b||c||(a.colorMask(b,b,b,b),e=b)};this.setLocked=function(a){c=a};this.setClear=function(b,c,e,l){d.set(b,c,e,l);!1===f.equals(d)&&(a.clearColor(b,c,e,l),f.copy(d))};this.reset=function(){c=!1;e=null;f=new THREE.Vector4}};THREE.WebGLDepthBuffer=function(a,b){var c=!1,d=null,e=null,f=null;this.setTest=function(c){c?b.enable(a.DEPTH_TEST):b.disable(a.DEPTH_TEST)};this.setMask=function(b){d===b||c||(a.depthMask(b),d=b)};this.setFunc=function(b){if(e!==b){if(b)switch(b){case THREE.NeverDepth:a.depthFunc(a.NEVER);break;case THREE.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case THREE.LessDepth:a.depthFunc(a.LESS);break;case THREE.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case THREE.EqualDepth:a.depthFunc(a.EQUAL);break;case THREE.GreaterEqualDepth:a.depthFunc(a.GEQUAL);break;case THREE.GreaterDepth:a.depthFunc(a.GREATER);break;case THREE.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);e=b}};this.setLocked=function(a){c=a};this.setClear=function(b){f!==b&&(a.clearDepth(b),f=b)};this.reset=function(){c=!1;f=e=d=null}};THREE.WebGLStencilBuffer=function(a,b){var c=!1,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null;this.setTest=function(c){c?b.enable(a.STENCIL_TEST):b.disable(a.STENCIL_TEST)};this.setMask=function(b){d===b||c||(a.stencilMask(b),d=b)};this.setFunc=function(b,c,d){if(e!==b||f!==c||g!==d)a.stencilFunc(b,c,d),e=b,f=c,g=d};this.setOp=function(b,c,d){if(h!==b||k!==c||l!==d)a.stencilOp(b,c,d),h=b,k=c,l=d};this.setLocked=function(a){c=a};this.setClear=function(b){m!==b&&(a.clearStencil(b),m=b)};this.reset=function(){c=!1;m=l=k=h=g=f=e=d=null}};THREE.WebGLTextures=function(a,b,c,d,e,f,g){function h(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}function k(a){return THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height)}function l(b){return b===THREE.NearestFilter||b===THREE.NearestMipMapNearestFilter||b===THREE.NearestMipMapLinearFilter?a.NEAREST:a.LINEAR}function m(b){b=b.target;b.removeEventListener("dispose",m);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d.delete(b)}v.textures--}function p(b){b=b.target;b.removeEventListener("dispose",p);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b instanceof THREE.WebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d.delete(b.texture);d.delete(b)}v.textures--}function n(b,g){var l=d.get(b);if(0<b.version&&l.__version!==b.version){var n=b.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",b);else if(!1===n.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",b);else{void 0===l.__webglInit&&(l.__webglInit=!0,b.addEventListener("dispose",m),l.__webglTexture=a.createTexture(),v.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,l.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);var p=h(b.image,e.maxTextureSize);if((b.wrapS!==THREE.ClampToEdgeWrapping||b.wrapT!==THREE.ClampToEdgeWrapping||b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter)&&!1===k(p))if(n=p,n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=THREE.Math.nearestPowerOfTwo(n.width);r.height=THREE.Math.nearestPowerOfTwo(n.height);r.getContext("2d").drawImage(n,0,0,r.width,r.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+n.width+"x"+n.height+"). Resized to "+r.width+"x"+r.height,n);p=r}else p=n;var n=k(p),r=f(b.format),s=f(b.type);q(a.TEXTURE_2D,b,n);var G=b.mipmaps;if(b instanceof THREE.DepthTexture){G=a.DEPTH_COMPONENT;if(b.type===THREE.FloatType){if(!t)throw Error("Float Depth Texture only supported in WebGL2.0");G=a.DEPTH_COMPONENT32F}else t&&(G=a.DEPTH_COMPONENT16);c.texImage2D(a.TEXTURE_2D,0,G,p.width,p.height,0,r,s,null)}else if(b instanceof THREE.DataTexture)if(0<G.length&&n){for(var B=0,F=G.length;B<F;B++)p=G[B],c.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,r,p.width,p.height,0,r,s,p.data);else if(b instanceof THREE.CompressedTexture)for(B=0,F=G.length;B<F;B++)p=G[B],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(r)?c.compressedTexImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(a.TEXTURE_2D,B,r,p.width,p.height,0,r,s,p.data);else if(0<G.length&&n){B=0;for(F=G.length;B<F;B++)p=G[B],c.texImage2D(a.TEXTURE_2D,B,r,r,s,p);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,r,r,s,p);b.generateMipmaps&&n&&a.generateMipmap(a.TEXTURE_2D);l.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,l.__webglTexture)}function q(c,g,h){h?(a.texParameteri(c,a.TEXTURE_WRAP_S,f(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,f(g.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,f(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,f(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),g.wrapS===THREE.ClampToEdgeWrapping&&g.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",g),a.texParameteri(c,a.TEXTURE_MAG_FILTER,l(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,l(g.minFilter)),g.minFilter!==THREE.NearestFilter&&g.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",g));!(h=b.get("EXT_texture_filter_anisotropic"))||g.type===THREE.FloatType&&null===b.get("OES_texture_float_linear")||g.type===THREE.HalfFloatType&&null===b.get("OES_texture_half_float_linear")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=g.anisotropy)}function r(b,e,g,h){var k=f(e.texture.format),l=f(e.texture.type);c.texImage2D(h,0,k,e.width,e.height,0,k,l,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function s(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var v=g.memory,t="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;this.setTexture2D=n;this.setTextureCube=function(b,g){var l=d.get(b);if(6===b.image.length)if(0<b.version&&l.__version!==b.version){l.__image__webglTextureCube||(b.addEventListener("dispose",m),l.__image__webglTextureCube=a.createTexture(),v.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);for(var n=b instanceof THREE.CompressedTexture,p=b.image[0]instanceof THREE.DataTexture,r=[],s=0;6>s;s++)r[s]=n||p?p?b.image[s].image:b.image[s]:h(b.image[s],e.maxCubemapSize);var t=k(r[0]),B=f(b.format),F=f(b.type);q(a.TEXTURE_CUBE_MAP,b,t);for(s=0;6>s;s++)if(n)for(var J,P=r[s].mipmaps,K=0,H=P.length;K<H;K++)J=P[K],b.format!==THREE.RGBAFormat&&b.format!==THREE.RGBFormat?-1<c.getCompressedTextureFormats().indexOf(B)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,K,B,J.width,J.height,0,J.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,K,B,J.width,J.height,0,B,F,J.data);else p?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,B,r[s].width,r[s].height,0,B,F,r[s].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,B,B,F,r[s]);b.generateMipmaps&&t&&a.generateMipmap(a.TEXTURE_CUBE_MAP);l.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+g),c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+e);c.bindTexture(a.TEXTURE_CUBE_MAP,d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener("dispose",p);f.__webglTexture=a.createTexture();v.textures++;var g=b instanceof THREE.WebGLRenderTargetCube,h=k(b);if(g){e.__webglFramebuffer=[];for(var l=0;6>l;l++)e.__webglFramebuffer[l]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);q(a.TEXTURE_CUBE_MAP,b.texture,h);for(l=0;6>l;l++)r(e.__webglFramebuffer[l],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+l);b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),q(a.TEXTURE_2D,b.texture,h),r(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=b instanceof THREE.WebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error("target.depthTexture not supported in Cube render targets");if(b instanceof THREE.WebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!(b.depthTexture instanceof THREE.DepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0);n(b.depthTexture,0);b=d.get(b.depthTexture).__webglTexture;a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,b,0)}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),s(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),s(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(b){var e=b.texture;e.generateMipmaps&&k(b)&&e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter&&(b=b instanceof THREE.WebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}};THREE.WebGLUniforms=function(){var a=new THREE.Texture,b=new THREE.CubeTexture,c=[],d=[],e=function(a,b,d){var e=a[0];if(0>=e||0<e)return a;var f=b*d,g=c[f];void 0===g&&(g=new Float32Array(f),c[f]=g);if(0!==b)for(e.toArray(g,0),e=1,f=0;e!==b;++e)f+=d,a[e].toArray(g,f);return g},f=function(a,b){var c=d[b];void 0===c&&(c=new Int32Array(b),d[b]=c);for(var e=0;e!==b;++e)c[e]=a.allocTextureUnit();return c},g=function(a,b){a.uniform1f(this.addr,b)},h=function(a,b){a.uniform1i(this.addr,b)},k=function(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)},l=function(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)},m=function(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)},p=function(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)},n=function(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)},q=function(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)},r=function(b,c,d){var e=d.allocTextureUnit();b.uniform1i(this.addr,e);d.setTexture2D(c||a,e)},s=function(a,c,d){var e=d.allocTextureUnit();a.uniform1i(this.addr,e);d.setTextureCube(c||b,e)},v=function(a,b){a.uniform2iv(this.addr,b)},t=function(a,b){a.uniform3iv(this.addr,b)},u=function(a,b){a.uniform4iv(this.addr,b)},D=function(a){switch(a){case 5126:return g;case 35664:return k;case 35665:return l;case 35666:return m;case 35674:return p;case 35675:return n;case 35676:return q;case 35678:return r;case 35680:return s;case 5124:case 35670:return h;case 35667:case 35671:return v;case 35668:case 35672:return t;case 35669:case 35673:return u}},w=function(a,b){a.uniform1fv(this.addr,b)},I=function(a,b){a.uniform1iv(this.addr,b)},z=function(a,b){a.uniform2fv(this.addr,e(b,this.size,2))},y=function(a,b){a.uniform3fv(this.addr,e(b,this.size,3))},A=function(a,b){a.uniform4fv(this.addr,e(b,this.size,4))},G=function(a,b){a.uniformMatrix2fv(this.addr,!1,e(b,this.size,4))},B=function(a,b){a.uniformMatrix3fv(this.addr,!1,e(b,this.size,9))},F=function(a,b){a.uniformMatrix4fv(this.addr,!1,e(b,this.size,16))},J=function(b,c,d){var e=c.length,g=f(d,e);b.uniform1iv(this.addr,g);for(b=0;b!==e;++b)d.setTexture2D(c[b]||a,g[b])},P=function(a,c,d){var e=c.length,g=f(d,e);a.uniform1iv(this.addr,g);for(a=0;a!==e;++a)d.setTextureCube(c[a]||b,g[a])},K=function(a){switch(a){case 5126:return w;case 35664:return z;case 35665:return y;case 35666:return A;case 35674:return G;case 35675:return B;case 35676:return F;case 35678:return J;case 35680:return P;case 5124:case 35670:return I;case 35667:case 35671:return v;case 35668:case 35672:return t;case 35669:case 35673:return u}},H=function(a,b,c){this.id=a;this.addr=c;this.setValue=D(b.type)},M=function(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=K(b.type)},O=function(a){this.id=a;this.seq=[];this.map={}};O.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var N=/([\w\d_]+)(\])?(\[|\.)?/g,Q=function(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,k=h.length;for(N.lastIndex=0;;){var l=N.exec(h),m=N.lastIndex,n=l[1],p=l[3];"]"===l[2]&&(n|=0);if(void 0===p||"["===p&&m+2===k){h=g;e=void 0===p?new H(n,e,f):new M(n,e,f);h.seq.push(e);h.map[e.id]=e;break}else p=g.map[n],void 0===p&&(p=new O(n),n=g,g=p,n.seq.push(g),n.map[g.id]=g),g=p}}};Q.prototype.setValue=function(a,b,c){b=this.map[b];void 0!==b&&b.setValue(a,c,this.renderer)};Q.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};Q.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};Q.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};Q.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};Q.splitDynamic=function(a,b){for(var c=null,d=a.length,e=0,f=0;f!==d;++f){var g=a[f],h=b[g.id];h&&!0===h.dynamic?(null===c&&(c=[]),c.push(g)):(e<f&&(a[e]=g),++e)}e<d&&(a.length=e);return c};Q.evalDynamic=function(a,b,c,d){for(var e=0,f=a.length;e!==f;++e){var g=b[a[e].id],h=g.onUpdateCallback;void 0!==h&&h.call(g,c,d)}};return Q}();THREE.LensFlarePlugin=function(a,b){var c,d,e,f,g,h,k,l,m,p,n=a.context,q=a.state,r,s,v,t,u,D;this.render=function(w,I,z){if(0!==b.length){w=new THREE.Vector3;var y=z.w/z.z,A=.5*z.z,G=.5*z.w,B=16/z.w,F=new THREE.Vector2(B*y,B),J=new THREE.Vector3(1,1,0),P=new THREE.Vector2(1,1),K=new THREE.Box2;K.min.set(0,0);K.max.set(z.z-16,z.w-16);if(void 0===t){var B=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),H=new Uint16Array([0,1,2,0,2,3]);r=n.createBuffer();s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r);n.bufferData(n.ARRAY_BUFFER,B,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s);n.bufferData(n.ELEMENT_ARRAY_BUFFER,H,n.STATIC_DRAW);u=n.createTexture();D=n.createTexture();q.bindTexture(n.TEXTURE_2D,u);n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);q.bindTexture(n.TEXTURE_2D,D);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);var B=v={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},H=n.createProgram(),M=n.createShader(n.FRAGMENT_SHADER),O=n.createShader(n.VERTEX_SHADER),N="precision "+a.getPrecision()+" float;\n";n.shaderSource(M,N+B.fragmentShader);n.shaderSource(O,N+B.vertexShader);n.compileShader(M);n.compileShader(O);n.attachShader(H,M);n.attachShader(H,O);n.linkProgram(H);t=H;m=n.getAttribLocation(t,"position");p=n.getAttribLocation(t,"uv");c=n.getUniformLocation(t,"renderType");d=n.getUniformLocation(t,"map");e=n.getUniformLocation(t,"occlusionMap");f=n.getUniformLocation(t,"opacity");g=n.getUniformLocation(t,"color");h=n.getUniformLocation(t,"scale");k=n.getUniformLocation(t,"rotation");l=n.getUniformLocation(t,"screenPosition")}n.useProgram(t);q.initAttributes();q.enableAttribute(m);q.enableAttribute(p);q.disableUnusedAttributes();n.uniform1i(e,0);n.uniform1i(d,1);n.bindBuffer(n.ARRAY_BUFFER,r);n.vertexAttribPointer(m,2,n.FLOAT,!1,16,0);n.vertexAttribPointer(p,2,n.FLOAT,!1,16,8);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s);q.disable(n.CULL_FACE);q.setDepthWrite(!1);H=0;for(M=b.length;H<M;H++)if(B=16/z.w,F.set(B*y,B),O=b[H],w.set(O.matrixWorld.elements[12],O.matrixWorld.elements[13],O.matrixWorld.elements[14]),w.applyMatrix4(I.matrixWorldInverse),w.applyProjection(I.projectionMatrix),J.copy(w),P.x=z.x+J.x*A+A-8,P.y=z.y+J.y*G+G-8,!0===K.containsPoint(P)){q.activeTexture(n.TEXTURE0);q.bindTexture(n.TEXTURE_2D,null);q.activeTexture(n.TEXTURE1);q.bindTexture(n.TEXTURE_2D,u);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,P.x,P.y,16,16,0);n.uniform1i(c,0);n.uniform2f(h,F.x,F.y);n.uniform3f(l,J.x,J.y,J.z);q.disable(n.BLEND);q.enable(n.DEPTH_TEST);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);q.activeTexture(n.TEXTURE0);q.bindTexture(n.TEXTURE_2D,D);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,P.x,P.y,16,16,0);n.uniform1i(c,1);q.disable(n.DEPTH_TEST);q.activeTexture(n.TEXTURE1);q.bindTexture(n.TEXTURE_2D,u);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);O.positionScreen.copy(J);O.customUpdateCallback?O.customUpdateCallback(O):O.updateLensFlares();n.uniform1i(c,2);q.enable(n.BLEND);for(var N=0,Q=O.lensFlares.length;N<Q;N++){var C=O.lensFlares[N];.001<C.opacity&&.001<C.scale&&(J.x=C.x,J.y=C.y,J.z=C.z,B=C.size*C.scale/z.w,F.x=B*y,F.y=B,n.uniform3f(l,J.x,J.y,J.z),n.uniform2f(h,F.x,F.y),n.uniform1f(k,C.rotation),n.uniform1f(f,C.opacity),n.uniform3f(g,C.color.r,C.color.g,C.color.b),q.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),a.setTexture2D(C.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}}q.enable(n.CULL_FACE);q.enable(n.DEPTH_TEST);q.setDepthWrite(!0);a.resetGLState()}}};THREE.SpritePlugin=function(a,b){var c,d,e,f,g,h,k,l,m,p,n,q,r,s,v,t,u;function D(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var w=a.context,I=a.state,z,y,A,G,B=new THREE.Vector3,F=new THREE.Quaternion,J=new THREE.Vector3;this.render=function(P,K){if(0!==b.length){if(void 0===A){var H=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),M=new Uint16Array([0,1,2,0,2,3]);z=w.createBuffer();y=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,z);w.bufferData(w.ARRAY_BUFFER,H,w.STATIC_DRAW);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.bufferData(w.ELEMENT_ARRAY_BUFFER,M,w.STATIC_DRAW);var H=w.createProgram(),M=w.createShader(w.VERTEX_SHADER),O=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(M,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));w.shaderSource(O,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
w.compileShader(M);w.compileShader(O);w.attachShader(H,M);w.attachShader(H,O);w.linkProgram(H);A=H;t=w.getAttribLocation(A,"position");u=w.getAttribLocation(A,"uv");c=w.getUniformLocation(A,"uvOffset");d=w.getUniformLocation(A,"uvScale");e=w.getUniformLocation(A,"rotation");f=w.getUniformLocation(A,"scale");g=w.getUniformLocation(A,"color");h=w.getUniformLocation(A,"map");k=w.getUniformLocation(A,"opacity");l=w.getUniformLocation(A,"modelViewMatrix");m=w.getUniformLocation(A,"projectionMatrix");p=w.getUniformLocation(A,"fogType");n=w.getUniformLocation(A,"fogDensity");q=w.getUniformLocation(A,"fogNear");r=w.getUniformLocation(A,"fogFar");s=w.getUniformLocation(A,"fogColor");v=w.getUniformLocation(A,"alphaTest");H=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");H.width=8;H.height=8;M=H.getContext("2d");M.fillStyle="white";M.fillRect(0,0,8,8);G=new THREE.Texture(H);G.needsUpdate=!0}w.useProgram(A);I.initAttributes();I.enableAttribute(t);I.enableAttribute(u);I.disableUnusedAttributes();I.disable(w.CULL_FACE);I.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,z);w.vertexAttribPointer(t,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(u,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,y);w.uniformMatrix4fv(m,!1,K.projectionMatrix.elements);I.activeTexture(w.TEXTURE0);w.uniform1i(h,0);M=H=0;(O=P.fog)?(w.uniform3f(s,O.color.r,O.color.g,O.color.b),O instanceof THREE.Fog?(w.uniform1f(q,O.near),w.uniform1f(r,O.far),w.uniform1i(p,1),M=H=1):O instanceof THREE.FogExp2&&(w.uniform1f(n,O.density),w.uniform1i(p,2),M=H=2)):(w.uniform1i(p,0),M=H=0);for(var O=0,N=b.length;O<N;O++){var Q=b[O];Q.modelViewMatrix.multiplyMatrices(K.matrixWorldInverse,Q.matrixWorld);Q.z=-Q.modelViewMatrix.elements[14]}b.sort(D);for(var C=[],O=0,N=b.length;O<N;O++){var Q=b[O],L=Q.material;!1!==L.visible&&(w.uniform1f(v,L.alphaTest),w.uniformMatrix4fv(l,!1,Q.modelViewMatrix.elements),Q.matrixWorld.decompose(B,F,J),C[0]=J.x,C[1]=J.y,Q=0,P.fog&&L.fog&&(Q=M),H!==Q&&(w.uniform1i(p,Q),H=Q),null!==L.map?(w.uniform2f(c,L.map.offset.x,L.map.offset.y),w.uniform2f(d,L.map.repeat.x,L.map.repeat.y)):(w.uniform2f(c,0,0),w.uniform2f(d,1,1)),w.uniform1f(k,L.opacity),w.uniform3f(g,L.color.r,L.color.g,L.color.b),w.uniform1f(e,L.rotation),w.uniform2fv(f,C),I.setBlending(L.blending,L.blendEquation,L.blendSrc,L.blendDst),I.setDepthTest(L.depthTest),I.setDepthWrite(L.depthWrite),L.map?a.setTexture2D(L.map,0):a.setTexture2D(G,0),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0))}I.enable(w.CULL_FACE);a.resetGLState()}}};Object.assign(THREE,{Face4:function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,e,f,g)},LineStrip:0,LinePieces:1,MeshFaceMaterial:THREE.MultiMaterial,PointCloud:function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new THREE.Points(a,b)},Particle:THREE.Sprite,ParticleSystem:function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new THREE.Points(a,b)},PointCloudMaterial:function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)},ParticleBasicMaterial:function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)},ParticleSystemMaterial:function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(a)},Vertex:function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new THREE.Vector3(a,b,c)}});Object.assign(THREE.Box2.prototype,{empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)}});Object.assign(THREE.Box3.prototype,{empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(THREE.Matrix3.prototype,{multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)}});Object.assign(THREE.Matrix4.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},translate:function(a){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}});Object.assign(THREE.Plane.prototype,{isIntersectionLine:function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)}});Object.assign(THREE.Quaternion.prototype,{multiplyVector3:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)}});Object.assign(THREE.Ray.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(THREE.Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)}});Object.assign(THREE.Object3D.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)}});Object.defineProperties(THREE.Object3D.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(THREE.LOD.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});THREE.PerspectiveCamera.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length}}});Object.assign(THREE.BufferGeometry.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(THREE.BufferGeometry.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(THREE.Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new THREE.Color}}});Object.defineProperties(THREE.MeshPhongMaterial.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(THREE.ShaderMaterial.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});THREE.EventDispatcher.prototype=Object.assign(Object.create({constructor:THREE.EventDispatcher,apply:function(a){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.");Object.assign(a,this)}}),THREE.EventDispatcher.prototype);Object.assign(THREE.WebGLRenderer.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(THREE.WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});Object.defineProperties(THREE.WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?THREE.CullFaceFront:THREE.CullFaceBack},set:function(a){a=a!==THREE.CullFaceBack;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(THREE.WebGLRenderTarget.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});Object.assign(THREE.Audio.prototype,{load:function(a){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var b=this;(new THREE.AudioLoader).load(a,function(a){b.setBuffer(a)});return this}});Object.assign(THREE.AudioAnalyser.prototype,{getData:function(a){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()}});THREE.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var e=new THREE.TextureLoader;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var e=new THREE.CubeTextureLoader;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.CurveUtils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};THREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Group,d=0,e=b.length;d<e;d++)c.add(new THREE.Mesh(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};THREE.ShapeUtils={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},triangulate:function(){return function(a,b){var c=a.length;if(3>c)return null;var d=[],e=[],f=[],g,h,k;if(0<THREE.ShapeUtils.area(a))for(h=0;h<c;h++)e[h]=h;else for(h=0;h<c;h++)e[h]=c-1-h;var l=2*c;for(h=c-1;2<c;){if(0>=l--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}g=h;c<=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var m;a:{var p=m=void 0,n=void 0,q=void 0,r=void 0,s=void 0,v=void 0,t=void 0,u=void 0,p=a[e[g]].x,n=a[e[g]].y,q=a[e[h]].x,r=a[e[h]].y,s=a[e[k]].x,v=a[e[k]].y;if(Number.EPSILON>(q-p)*(v-n)-(r-n)*(s-p))m=!1;else{var D=void 0,w=void 0,I=void 0,z=void 0,y=void 0,A=void 0,G=void 0,B=void 0,F=void 0,J=void 0,F=B=G=u=t=void 0,D=s-q,w=v-r,I=p-s,z=n-v,y=q-p,A=r-n;for(m=0;m<c;m++)if(t=a[e[m]].x,u=a[e[m]].y,!(t===p&&u===n||t===q&&u===r||t===s&&u===v)&&(G=t-p,B=u-n,F=t-q,J=u-r,t-=s,u-=v,F=D*J-w*F,G=y*B-A*G,B=I*u-z*t,F>=-Number.EPSILON&&B>=-Number.EPSILON&&G>=-Number.EPSILON)){m=!1;break a}m=!0}}if(m){d.push([a[e[g]],a[e[h]],a[e[k]]]);f.push([e[g],e[h],e[k]]);g=h;for(k=h+1;k<c;g++,k++)e[g]=e[k];c--;l=2*c}}return b?f:d}}(),triangulateShape:function(a,b){function c(a){var b=a.length;2<b&&a[b-1].equals(a[0])&&a.pop()}function d(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function e(a,b,c,e,f){var g=b.x-a.x,h=b.y-a.y,k=e.x-c.x,l=e.y-c.y,m=a.x-c.x,n=a.y-c.y,p=h*k-g*l,G=h*m-g*n;if(Math.abs(p)>Number.EPSILON){if(0<p){if(0>G||G>p)return[];k=l*m-k*n;if(0>k||k>p)return[]}else{if(0<G||G<p)return[];k=l*m-k*n;if(0<k||k<p)return[]}if(0===k)return!f||0!==G&&G!==p?[a]:[];if(k===p)return!f||0!==G&&G!==p?[b]:[];if(0===G)return[c];if(G===p)return[e];f=k/p;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!==G||l*m!==k*n)return[];h=0===g&&0===h;k=0===k&&0===l;if(h&&k)return a.x!==c.x||a.y!==c.y?[]:[a];if(h)return d(c,e,a)?[a]:[];if(k)return d(a,b,c)?[c]:[];0!==g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),c.x<e.x?(b=c,p=c.x,l=e,c=e.x):(b=e,p=e.x,l=c,c=c.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),c.y<e.y?(b=c,p=c.y,l=e,c=e.y):(b=e,p=e.y,l=c,c=c.y));return k<=p?a<p?[]:a===p?f?[]:[b]:a<=c?[b,h]:[b,l]:k>c?[]:k===c?f?[]:[g]:a<=c?[g,h]:[g,l]}function f(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return Math.abs(a)>Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}c(a);b.forEach(c);var g,h,k,l,m,p={};k=a.concat();g=0;for(h=b.length;g<h;g++)Array.prototype.push.apply(k,b[g]);g=0;for(h=k.length;g<h;g++)m=k[g].x+":"+k[g].y,void 0!==p[m]&&console.warn("THREE.ShapeUtils: Duplicate point",m,g),p[m]=g;g=function(a,b){function c(a,b){var d=h.length-1,e=a-1;0>e&&(e=d);var g=a+1;g>d&&(g=0);d=f(h[a],h[e],h[g],k[b]);if(!d)return!1;d=k.length-1;e=b-1;0>e&&(e=d);g=b+1;g>d&&(g=0);return(d=f(k[b],k[e],k[g],h[a]))?!0:!1}function d(a,b){var c,f;for(c=0;c<h.length;c++)if(f=c+1,f%=h.length,f=e(a,b,h[c],h[f],!0),0<f.length)return!0;return!1}function g(a,c){var d,f,h,k;for(d=0;d<l.length;d++)for(f=b[l[d]],h=0;h<f.length;h++)if(k=h+1,k%=f.length,k=e(a,c,f[h],f[k],!0),0<k.length)return!0;return!1}var h=a.concat(),k,l=[],m,n,p,A,G,B=[],F,J,P,K=0;for(m=b.length;K<m;K++)l.push(K);F=0;for(var H=2*l.length;0<l.length;){H--;if(0>H){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(n=F;n<h.length;n++){p=h[n];m=-1;for(K=0;K<l.length;K++)if(A=l[K],G=p.x+":"+p.y+":"+A,void 0===B[G]){k=b[A];for(J=0;J<k.length;J++)if(A=k[J],c(n,J)&&!d(p,A)&&!g(p,A)){m=J;l.splice(K,1);F=h.slice(0,n+1);A=h.slice(n);J=k.slice(m);P=k.slice(0,m+1);h=F.concat(J).concat(P).concat(A);F=n;break}if(0<=m)break;B[G]=!0}if(0<=m)break}}return h}(a,b);var n=THREE.ShapeUtils.triangulate(g,!1);g=0;for(h=n.length;g<h;g++)for(l=n[g],k=0;3>k;k++)m=l[k].x+":"+l[k].y,m=p[m],void 0!==m&&(l[k]=m);return n.concat()},isClockWise:function(a){return 0>THREE.ShapeUtils.area(a)},b2:function(){return function(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}}(),b3:function(){return function(a,b,c,d,e){var f=1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}}()};THREE.Curve=function(){};THREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(a){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return b},getSpacedPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,h=e-1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return d/(e-1);g=c[d];return c=(d+(f-g)/(c[d+1]-g))/(e-1)},getTangent:function(a){var b=a-1e-4;a+=1e-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)}};THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.assign(Object.create(THREE.Curve.prototype),{constructor:THREE.CurvePath,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))},getPoint:function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],c=a.getLength(),a.getPointAt(0===c?0:1-b/c);a++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){a||(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=a||12;for(var b=[],c,d=0,e=this.curves;d<e.length;d++)for(var f=e[d],f=f.getPoints(f instanceof THREE.EllipseCurve?2*a:f instanceof THREE.LineCurve?1:f instanceof THREE.SplineCurve?a*f.points.length:a),g=0;g<f.length;g++){var h=f[g];c&&c.equals(h)||(b.push(h),c=h)}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){for(var b=new THREE.Geometry,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new THREE.Vector3(e.x,e.y,e.z||0))}return b}});THREE.Font=function(a){this.data=a};Object.assign(THREE.Font.prototype,{generateShapes:function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var d=this.data;a=String(a).split("");var e=b/d.resolution,f=0;b=[];for(var g=0;g<a.length;g++){var h;h=e;var k=f,l=d.glyphs[a[g]]||d.glyphs["?"];if(l){var m=new THREE.ShapePath,p=[],n=THREE.ShapeUtils.b2,q=THREE.ShapeUtils.b3,r=void 0,s=void 0,v=s=r=void 0,t=void 0,u=void 0,D=void 0,w=void 0,I=void 0,t=void 0;if(l.o)for(var z=l._cachedOutline||(l._cachedOutline=l.o.split(" ")),y=0,A=z.length;y<A;)switch(z[y++]){case"m":r=z[y++]*h+k;s=z[y++]*h;m.moveTo(r,s);break;case"l":r=z[y++]*h+k;s=z[y++]*h;m.lineTo(r,s);break;case"q":r=z[y++]*h+k;s=z[y++]*h;u=z[y++]*h+k;D=z[y++]*h;m.quadraticCurveTo(u,D,r,s);if(t=p[p.length-1])for(var v=t.x,t=t.y,G=1;G<=c;G++){var B=G/c;n(B,v,u,r);n(B,t,D,s)}break;case"b":if(r=z[y++]*h+k,s=z[y++]*h,u=z[y++]*h+k,D=z[y++]*h,w=z[y++]*h+k,I=z[y++]*h,m.bezierCurveTo(u,D,w,I,r,s),t=p[p.length-1])for(v=t.x,t=t.y,G=1;G<=c;G++)B=G/c,q(B,v,u,w,r),q(B,t,D,I,s)}h={offset:l.ha*h,path:m}}else h=void 0;f+=h.offset;b.push(h.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,b[d].toShapes());return c}});THREE.Path=function(a){THREE.CurvePath.call(this);this.currentPoint=new THREE.Vector2;a&&this.fromPoints(a)};THREE.Path.prototype=Object.assign(Object.create(THREE.CurvePath.prototype),{constructor:THREE.Path,fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.currentPoint.set(a,b)},lineTo:function(a,b){var c=new THREE.LineCurve(this.currentPoint.clone(),new THREE.Vector2(a,b));this.curves.push(c);this.currentPoint.set(a,b)},quadraticCurveTo:function(a,b,c,d){
a=new THREE.QuadraticBezierCurve(this.currentPoint.clone(),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(a);this.currentPoint.set(c,d)},bezierCurveTo:function(a,b,c,d,e,f){a=new THREE.CubicBezierCurve(this.currentPoint.clone(),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(a);this.currentPoint.set(e,f)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a),b=new THREE.SplineCurve(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,b,c,d,e,f){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f,g,h)},absellipse:function(a,b,c,d,e,f,g,h){a=new THREE.EllipseCurve(a,b,c,d,e,f,g,h);0<this.curves.length&&(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});THREE.ShapePath=function(){this.subPaths=[];this.currentPath=null};THREE.ShapePath.prototype={moveTo:function(a,b){this.currentPath=new THREE.Path;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b)},lineTo:function(a,b){this.currentPath.lineTo(a,b)},quadraticCurveTo:function(a,b,c,d){this.currentPath.quadraticCurveTo(a,b,c,d)},bezierCurveTo:function(a,b,c,d,e,f){this.currentPath.bezierCurveTo(a,b,c,d,e,f)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,l=h.y-g.y;if(Math.abs(l)>Number.EPSILON){if(0>l&&(g=b[f],k=-k,h=b[e],l=-l),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=l*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=THREE.ShapeUtils.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===b)return c(f);var g,h,k,l=[];if(1===f.length)return h=f[0],k=new THREE.Shape,k.curves=h.curves,l.push(k),l;var m=!e(f[0].getPoints()),m=a?!m:m;k=[];var p=[],n=[],q=0,r;p[q]=void 0;n[q]=[];for(var s=0,v=f.length;s<v;s++)h=f[s],r=h.getPoints(),g=e(r),(g=a?!g:g)?(!m&&p[q]&&q++,p[q]={s:new THREE.Shape,p:r},p[q].s.curves=h.curves,m&&q++,n[q]=[]):n[q].push({h:h,p:r[0]});if(!p[0])return c(f);if(1<p.length){s=!1;h=[];e=0;for(f=p.length;e<f;e++)k[e]=[];e=0;for(f=p.length;e<f;e++)for(g=n[e],m=0;m<g.length;m++){q=g[m];r=!0;for(v=0;v<p.length;v++)d(q.p,p[v].p)&&(e!==v&&h.push({froms:e,tos:v,hole:m}),r?(r=!1,k[v].push(q)):s=!0);r&&k[e].push(q)}0<h.length&&(s||(n=k))}s=0;for(e=p.length;s<e;s++)for(k=p[s].s,l.push(k),h=n[s],f=0,g=h.length;f<g;f++)k.holes.push(h[f].h);return l}};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.assign(Object.create(THREE.Path.prototype),{constructor:THREE.Shape,extrude:function(a){return new THREE.ExtrudeGeometry(this,a)},makeGeometry:function(a){return new THREE.ShapeGeometry(this,a)},getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});THREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentQuadraticBezier;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y)).normalize()};THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b=THREE.CurveUtils.tangentCubicBezier;return new THREE.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()};THREE.SplineCurve=function(a){this.points=void 0==a?[]:a};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0===c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a))};THREE.EllipseCurve=function(a,b,c,d,e,f,g,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;this.aRotation=h||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;THREE.EllipseCurve.prototype.getPoint=function(a){for(var b=2*Math.PI,c=this.aEndAngle-this.aStartAngle,d=Math.abs(c)<Number.EPSILON;0>c;)c+=b;for(;c>b;)c-=b;c<Number.EPSILON&&(c=d?0:b);!0!==this.aClockwise||d||(c=c===b?-b:c-b);b=this.aStartAngle+a*c;a=this.aX+this.xRadius*Math.cos(b);var e=this.aY+this.yRadius*Math.sin(b);0!==this.aRotation&&(b=Math.cos(this.aRotation),c=Math.sin(this.aRotation),d=a-this.aX,e-=this.aY,a=d*b-e*c+this.aX,e=d*c+e*b+this.aY);return new THREE.Vector2(a,e)};THREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){if(1===a)return this.v2.clone();var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=THREE.ShapeUtils.b2;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=THREE.ShapeUtils.b3;return new THREE.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});THREE.SplineCurve3=THREE.Curve.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))});THREE.CatmullRomCurve3=function(){function a(){}var b=new THREE.Vector3,c=new a,d=new a,e=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,m,p){a=((b-a)/e-(c-a)/(e+m)+(c-b)/m)*m;d=((c-b)/m-(d-b)/(m+p)+(d-c)/p)*m;this.init(b,c,a,d)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*b*a};return THREE.Curve.create(function(a){this.points=a||[];this.closed=!1},function(a){var g=this.points,h,k;k=g.length;2>k&&console.log("duh, you need at least 2 points");a*=k-(this.closed?0:1);h=Math.floor(a);a-=h;this.closed?h+=0<h?0:(Math.floor(Math.abs(h)/g.length)+1)*g.length:0===a&&h===k-1&&(h=k-2,a=1);var l,m,p;this.closed||0<h?l=g[(h-1)%k]:(b.subVectors(g[0],g[1]).add(g[0]),l=b);m=g[h%k];p=g[(h+1)%k];this.closed||h+2<k?g=g[(h+2)%k]:(b.subVectors(g[k-1],g[k-2]).add(g[k-1]),g=b);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var n="chordal"===this.type?.5:.25;k=Math.pow(l.distanceToSquared(m),n);h=Math.pow(m.distanceToSquared(p),n);n=Math.pow(p.distanceToSquared(g),n);1e-4>h&&(h=1);1e-4>k&&(k=h);1e-4>n&&(n=h);c.initNonuniformCatmullRom(l.x,m.x,p.x,g.x,k,h,n);d.initNonuniformCatmullRom(l.y,m.y,p.y,g.y,k,h,n);e.initNonuniformCatmullRom(l.z,m.z,p.z,g.z,k,h,n)}else"catmullrom"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,m.x,p.x,g.x,k),d.initCatmullRom(l.y,m.y,p.y,g.y,k),e.initCatmullRom(l.z,m.z,p.z,g.z,k));return new THREE.Vector3(c.calc(a),d.calc(a),e.calc(a))})}();THREE.ClosedSplineCurve3=function(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.");THREE.CatmullRomCurve3.call(this,a);this.type="catmullrom";this.closed=!0};THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype);THREE.BoxGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new THREE.BoxBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CubeGeometry=THREE.BoxGeometry;THREE.BoxBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,k,l,J,P){var K=f/l,H=g/J,M=f/2,O=g/2,N=k/2;g=l+1;for(var Q=J+1,C=f=0,L=new THREE.Vector3,E=0;E<Q;E++)for(var $=E*H-O,T=0;T<g;T++)L[a]=(T*K-M)*d,L[b]=$*e,L[c]=N,p[r]=L.x,p[r+1]=L.y,p[r+2]=L.z,L[a]=0,L[b]=0,L[c]=0<k?1:-1,n[r]=L.x,n[r+1]=L.y,n[r+2]=L.z,q[s]=T/l,q[s+1]=1-E/J,r+=3,s+=2,f+=1;for(E=0;E<J;E++)for(T=0;T<l;T++)a=t+T+g*(E+1),b=t+(T+1)+g*(E+1),c=t+(T+1)+g*E,m[v]=t+T+g*E,m[v+1]=a,m[v+2]=c,m[v+3]=a,m[v+4]=b,m[v+5]=c,v+=6,C+=6;h.addGroup(u,C,P);u+=C;t+=f}THREE.BufferGeometry.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var h=this;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=function(a,b,c){a=0+(a+1)*(b+1)*2+(a+1)*(c+1)*2;return a+=(c+1)*(b+1)*2}(d,e,f),l=function(a,b,c){a=0+a*b*2+a*c*2;a+=c*b*2;return 6*a}(d,e,f),m=new(65535<l?Uint32Array:Uint16Array)(l),p=new Float32Array(3*k),n=new Float32Array(3*k),q=new Float32Array(2*k),r=0,s=0,v=0,t=0,u=0;g("z","y","x",-1,-1,c,b,a,f,e,0);g("z","y","x",1,-1,c,b,-a,f,e,1);g("x","z","y",1,1,a,c,b,d,f,2);g("x","z","y",1,-1,a,c,-b,d,f,3);g("x","y","z",1,-1,a,b,c,d,e,4);g("x","y","z",-1,-1,a,b,-c,d,e,5);this.setIndex(new THREE.BufferAttribute(m,1));this.addAttribute("position",new THREE.BufferAttribute(p,3));this.addAttribute("normal",new THREE.BufferAttribute(n,3));this.addAttribute("uv",new THREE.BufferAttribute(q,2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new THREE.CircleBufferGeometry(a,b,c,d))};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;THREE.CircleBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=b+2,f=new Float32Array(3*e),g=new Float32Array(3*e),e=new Float32Array(2*e);g[2]=1;e[0]=.5;e[1]=.5;for(var h=0,k=3,l=2;h<=b;h++,k+=3,l+=2){var m=c+h/b*d;f[k]=a*Math.cos(m);f[k+1]=a*Math.sin(m);g[k+2]=1;e[l]=(f[k]/a+1)/2;e[l+1]=(f[k+1]/a+1)/2}c=[];for(k=1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(c),1));this.addAttribute("position",new THREE.BufferAttribute(f,3));this.addAttribute("normal",new THREE.BufferAttribute(g,3));this.addAttribute("uv",new THREE.BufferAttribute(e,2));this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;THREE.CylinderBufferGeometry=function(a,b,c,d,e,f,g,h){function k(c){var e,f,k,m=new THREE.Vector2,n=new THREE.Vector3,p=0,D=!0===c?a:b,K=!0===c?1:-1;f=t;for(e=1;e<=d;e++)r.setXYZ(t,0,w*K,0),s.setXYZ(t,0,K,0),m.x=.5,m.y=.5,v.setXY(t,m.x,m.y),t++;k=t;for(e=0;e<=d;e++){var H=e/d*h+g,M=Math.cos(H),H=Math.sin(H);n.x=D*H;n.y=w*K;n.z=D*M;r.setXYZ(t,n.x,n.y,n.z);s.setXYZ(t,0,K,0);m.x=.5*M+.5;m.y=.5*H*K+.5;v.setXY(t,m.x,m.y);t++}for(e=0;e<d;e++)m=f+e,n=k+e,!0===c?(q.setX(u,n),u++,q.setX(u,n+1)):(q.setX(u,n+1),u++,q.setX(u,n)),u++,q.setX(u,m),u++,p+=3;l.addGroup(I,p,!0===c?1:2);I+=p}THREE.BufferGeometry.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var l=this;a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var m=0;!1===f&&(0<a&&m++,0<b&&m++);var p=function(){var a=(d+1)*(e+1);!1===f&&(a+=(d+1)*m+d*m);return a}(),n=function(){var a=d*e*6;!1===f&&(a+=d*m*3);return a}(),q=new THREE.BufferAttribute(new(65535<n?Uint32Array:Uint16Array)(n),1),r=new THREE.BufferAttribute(new Float32Array(3*p),3),s=new THREE.BufferAttribute(new Float32Array(3*p),3),v=new THREE.BufferAttribute(new Float32Array(2*p),2),t=0,u=0,D=[],w=c/2,I=0;(function(){var f,k,m=new THREE.Vector3,n=new THREE.Vector3,p=0,F=(b-a)/c;for(k=0;k<=e;k++){var J=[],P=k/e,K=P*(b-a)+a;for(f=0;f<=d;f++){var H=f/d;n.x=K*Math.sin(H*h+g);n.y=-P*c+w;n.z=K*Math.cos(H*h+g);r.setXYZ(t,n.x,n.y,n.z);m.copy(n);if(0===a&&0===k||0===b&&k===e)m.x=Math.sin(H*h+g),m.z=Math.cos(H*h+g);m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*F).normalize();s.setXYZ(t,m.x,m.y,m.z);v.setXY(t,H,1-P);J.push(t);t++}D.push(J)}for(f=0;f<d;f++)for(k=0;k<e;k++)m=D[k+1][f],n=D[k+1][f+1],F=D[k][f+1],q.setX(u,D[k][f]),u++,q.setX(u,m),u++,q.setX(u,F),u++,q.setX(u,m),u++,q.setX(u,n),u++,q.setX(u,F),u++,p+=6;l.addGroup(I,p,0);I+=p})();!1===f&&(0<a&&k(!0),0<b&&k(!1));this.setIndex(q);this.addAttribute("position",r);this.addAttribute("normal",s);this.addAttribute("uv",v)};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;THREE.CylinderGeometry=function(a,b,c,d,e,f,g,h){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new THREE.CylinderBufferGeometry(a,b,c,d,e,f,g,h));this.mergeVertices()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ConeBufferGeometry=function(a,b,c,d,e,f,g){THREE.CylinderBufferGeometry.call(this,0,a,b,c,d,e,f,g);this.type="ConeBufferGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,thetaStart:f,thetaLength:g}};THREE.ConeBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.ConeBufferGeometry.prototype.constructor=THREE.ConeBufferGeometry;THREE.ConeGeometry=function(a,b,c,d,e,f,g){THREE.CylinderGeometry.call(this,0,a,b,c,d,e,f,g);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}};THREE.ConeGeometry.prototype=Object.create(THREE.CylinderGeometry.prototype);THREE.ConeGeometry.prototype.constructor=THREE.ConeGeometry;THREE.EdgesGeometry=function(a,b){function c(a,b){return a-b}THREE.BufferGeometry.call(this);var d=Math.cos(THREE.Math.DEG2RAD*(void 0!==b?b:1)),e=[0,0],f={},g=["a","b","c"],h;a instanceof THREE.BufferGeometry?(h=new THREE.Geometry,h.fromBufferGeometry(a)):h=a.clone();h.mergeVertices();h.computeFaceNormals();var k=h.vertices;h=h.faces;for(var l=0,m=h.length;l<m;l++)for(var p=h[l],n=0;3>n;n++){e[0]=p[g[n]];e[1]=p[g[(n+1)%3]];e.sort(c);var q=e.toString();void 0===f[q]?f[q]={vert1:e[0],vert2:e[1],face1:l,face2:void 0}:f[q].face2=l}e=[];for(q in f)if(g=f[q],void 0===g.face2||h[g.face1].normal.dot(h[g.face2].normal)<=d)l=k[g.vert1],e.push(l.x),e.push(l.y),e.push(l.z),l=k[g.vert2],e.push(l.x),e.push(l.y),e.push(l.z);this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(e),3))};THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;THREE.ExtrudeGeometry=function(a,b){"undefined"!==typeof a&&(THREE.Geometry.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],b)};THREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=1,d=a.x-b.x,e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)>Number.EPSILON){var k=Math.sqrt(h),l=Math.sqrt(f*f+g*g),h=b.x-e/k;b=b.y+d/k;f=((c.x-g/l-h)*g-(c.y+f/l-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,d>Number.EPSILON?f>Number.EPSILON&&(a=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(g)&&(a=!0),a?(c=-e,a=d,d=Math.sqrt(h)):(c=d,a=e,d=Math.sqrt(h/2));return new THREE.Vector2(c/d,a/d)}function e(a,b){var c,d;for(E=a.length;0<=--E;){c=E;d=E-1;0>d&&(d=a.length-1);for(var e=0,f=q+2*m,e=0;e<f;e++){var g=Q*e,h=Q*(e+1),k=b+c+g,g=b+d+g,l=b+d+h,h=b+c+h,k=k+B,g=g+B,l=l+B,h=h+B;G.faces.push(new THREE.Face3(k,g,h,null,null,1));G.faces.push(new THREE.Face3(g,l,h,null,null,1));k=t.generateSideWallUV(G,k,g,l,h);G.faceVertexUvs[0].push([k[0],k[1],k[3]]);G.faceVertexUvs[0].push([k[1],k[2],k[3]])}}}function f(a,b,c){G.vertices.push(new THREE.Vector3(a,b,c))}function g(a,b,c){a+=B;b+=B;c+=B;G.faces.push(new THREE.Face3(a,b,c,null,null,0));a=t.generateTopUV(G,a,b,c);G.faceVertexUvs[0].push(a)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,l=void 0!==b.bevelSize?b.bevelSize:k-2,m=void 0!==b.bevelSegments?b.bevelSegments:3,p=void 0!==b.bevelEnabled?b.bevelEnabled:!0,n=void 0!==b.curveSegments?b.curveSegments:12,q=void 0!==b.steps?b.steps:1,r=b.extrudePath,s,v=!1,t=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,u,D,w,I;r&&(s=r.getSpacedPoints(q),v=!0,p=!1,u=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(r,q,(!1)),D=new THREE.Vector3,w=new THREE.Vector3,I=new THREE.Vector3);p||(l=k=m=0);var z,y,A,G=this,B=this.vertices.length,r=a.extractPoints(n),n=r.shape,F=r.holes;if(r=!THREE.ShapeUtils.isClockWise(n)){n=n.reverse();y=0;for(A=F.length;y<A;y++)z=F[y],THREE.ShapeUtils.isClockWise(z)&&(F[y]=z.reverse());r=!1}var J=THREE.ShapeUtils.triangulateShape(n,F),P=n;y=0;for(A=F.length;y<A;y++)z=F[y],n=n.concat(z);var K,H,M,O,N,Q=n.length,C,L=J.length,r=[],E=0;M=P.length;K=M-1;for(H=E+1;E<M;E++,K++,H++)K===M&&(K=0),H===M&&(H=0),r[E]=d(P[E],P[K],P[H]);var $=[],T,X=r.concat();y=0;for(A=F.length;y<A;y++){z=F[y];T=[];E=0;M=z.length;K=M-1;for(H=E+1;E<M;E++,K++,H++)K===M&&(K=0),H===M&&(H=0),T[E]=d(z[E],z[K],z[H]);$.push(T);X=X.concat(T)}for(K=0;K<m;K++){M=K/m;O=k*(1-M);H=l*Math.sin(M*Math.PI/2);E=0;for(M=P.length;E<M;E++)N=c(P[E],r[E],H),f(N.x,N.y,-O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=$[y],E=0,M=z.length;E<M;E++)N=c(z[E],T[E],H),f(N.x,N.y,-O)}H=l;for(E=0;E<Q;E++)N=p?c(n[E],X[E],H):n[E],v?(w.copy(u.normals[0]).multiplyScalar(N.x),D.copy(u.binormals[0]).multiplyScalar(N.y),I.copy(s[0]).add(w).add(D),f(I.x,I.y,I.z)):f(N.x,N.y,0);for(M=1;M<=q;M++)for(E=0;E<Q;E++)N=p?c(n[E],X[E],H):n[E],v?(w.copy(u.normals[M]).multiplyScalar(N.x),D.copy(u.binormals[M]).multiplyScalar(N.y),I.copy(s[M]).add(w).add(D),f(I.x,I.y,I.z)):f(N.x,N.y,h/q*M);for(K=m-1;0<=K;K--){M=K/m;O=k*(1-M);H=l*Math.sin(M*Math.PI/2);E=0;for(M=P.length;E<M;E++)N=c(P[E],r[E],H),f(N.x,N.y,h+O);y=0;for(A=F.length;y<A;y++)for(z=F[y],T=$[y],E=0,M=z.length;E<M;E++)N=c(z[E],T[E],H),v?f(N.x,N.y+s[q-1].y,s[q-1].x+O):f(N.x,N.y,h+O)}(function(){if(p){var a;a=0*Q;for(E=0;E<L;E++)C=J[E],g(C[2]+a,C[1]+a,C[0]+a);a=q+2*m;a*=Q;for(E=0;E<L;E++)C=J[E],g(C[0]+a,C[1]+a,C[2]+a)}else{for(E=0;E<L;E++)C=J[E],g(C[2],C[1],C[0]);for(E=0;E<L;E++)C=J[E],g(C[0]+Q*q,C[1]+Q*q,C[2]+Q*q)}})();(function(){var a=0;e(P,a);a+=P.length;y=0;for(A=F.length;y<A;y++)z=F[y],e(z,a),a+=z.length})()};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y),new THREE.Vector2(d.x,d.y)]},generateSideWallUV:function(a,b,c,d,e){a=a.vertices;b=a[b];c=a[c];d=a[d];e=a[e];return.01>Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z),new THREE.Vector2(e.x,1-e.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,1-d.z),new THREE.Vector2(e.y,1-e.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type="ShapeGeometry";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this};THREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,d=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,e,f,g,h=this.vertices.length;e=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var k=e.shape,l=e.holes;if(!THREE.ShapeUtils.isClockWise(k))for(k=k.reverse(),e=0,f=l.length;e<f;e++)g=l[e],THREE.ShapeUtils.isClockWise(g)&&(l[e]=g.reverse());var m=THREE.ShapeUtils.triangulateShape(k,l);e=0;for(f=l.length;e<f;e++)g=l[e],k=k.concat(g);l=k.length;f=m.length;for(e=0;e<l;e++)g=k[e],this.vertices.push(new THREE.Vector3(g.x,g.y,0));for(e=0;e<f;e++)l=m[e],k=l[0]+h,g=l[1]+h,l=l[2]+h,this.faces.push(new THREE.Face3(k,g,l,null,null,c)),this.faceVertexUvs[0].push(d.generateTopUV(this,k,g,l))};THREE.LatheBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=THREE.Math.clamp(d,0,2*Math.PI);for(var e=(b+1)*a.length,f=b*a.length*6,g=new THREE.BufferAttribute(new(65535<f?Uint32Array:Uint16Array)(f),1),h=new THREE.BufferAttribute(new Float32Array(3*e),3),k=new THREE.BufferAttribute(new Float32Array(2*e),2),l=0,m=0,p=1/b,n=new THREE.Vector3,q=new THREE.Vector2,e=0;e<=b;e++)for(var f=c+e*p*d,r=Math.sin(f),s=Math.cos(f),f=0;f<=a.length-1;f++)n.x=a[f].x*r,n.y=a[f].y,n.z=a[f].x*s,h.setXYZ(l,n.x,n.y,n.z),q.x=e/b,q.y=f/(a.length-1),k.setXY(l,q.x,q.y),l++;for(e=0;e<b;e++)for(f=0;f<a.length-1;f++)c=f+e*a.length,l=c+a.length,p=c+a.length+1,n=c+1,g.setX(m,c),m++,g.setX(m,l),m++,g.setX(m,n),m++,g.setX(m,l),m++,g.setX(m,p),m++,g.setX(m,n),m++;this.setIndex(g);this.addAttribute("position",h);this.addAttribute("uv",k);this.computeVertexNormals();if(d===2*Math.PI)for(d=this.attributes.normal.array,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,c=b*a.length*3,f=e=0;e<a.length;e++,f+=3)g.x=d[f+0],g.y=d[f+1],g.z=d[f+2],h.x=d[c+f+0],h.y=d[c+f+1],h.z=d[c+f+2],k.addVectors(g,h).normalize(),d[f+0]=d[c+f+0]=k.x,d[f+1]=d[c+f+1]=k.y,d[f+2]=d[c+f+2]=k.z};THREE.LatheBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.LatheBufferGeometry.prototype.constructor=THREE.LatheBufferGeometry;THREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new THREE.LatheBufferGeometry(a,b,c,d));this.mergeVertices()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(a,b,c,d))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,h=d+1,k=a/c,l=b/d;b=new Float32Array(g*h*3);a=new Float32Array(g*h*3);for(var m=new Float32Array(g*h*2),p=0,n=0,q=0;q<h;q++)for(var r=q*l-f,s=0;s<g;s++)b[p]=s*k-e,b[p+1]=-r,a[p+2]=1,m[n]=s/c,m[n+1]=1-q/d,p+=3,n+=2;p=0;e=new(65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(q=0;q<d;q++)for(s=0;s<c;s++)f=s+g*(q+1),h=s+1+g*(q+1),k=s+1+g*q,e[p]=s+g*q,e[p+1]=f,e[p+2]=k,e[p+3]=f,e[p+4]=h,e[p+5]=k,p+=6;this.setIndex(new THREE.BufferAttribute(e,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(m,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;THREE.RingBufferGeometry=function(a,b,c,d,e,f){THREE.BufferGeometry.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||20;b=b||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=(c+1)*(d+1),h=c*d*6,h=new THREE.BufferAttribute(new(65535<h?Uint32Array:Uint16Array)(h),1),k=new THREE.BufferAttribute(new Float32Array(3*g),3),l=new THREE.BufferAttribute(new Float32Array(3*g),3),g=new THREE.BufferAttribute(new Float32Array(2*g),2),m=0,p=0,n,q=a,r=(b-a)/d,s=new THREE.Vector3,v=new THREE.Vector2,t;for(a=0;a<=d;a++){for(t=0;t<=c;t++)n=e+t/c*f,s.x=q*Math.cos(n),s.y=q*Math.sin(n),k.setXYZ(m,s.x,s.y,s.z),l.setXYZ(m,0,0,1),v.x=(s.x/b+1)/2,v.y=(s.y/b+1)/2,g.setXY(m,v.x,v.y),m++;q+=r}for(a=0;a<d;a++)for(b=a*(c+1),t=0;t<c;t++)e=n=t+b,f=n+c+1,m=n+c+2,n+=1,h.setX(p,e),p++,h.setX(p,f),p++,h.setX(p,m),p++,h.setX(p,e),p++,h.setX(p,m),p++,h.setX(p,n),p++;this.setIndex(h);this.addAttribute("position",k);this.addAttribute("normal",l);this.addAttribute("uv",g)};THREE.RingBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.RingBufferGeometry.prototype.constructor=THREE.RingBufferGeometry;THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new THREE.RingBufferGeometry(a,b,c,d,e,f))};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new THREE.SphereBufferGeometry(a,b,c,d,e,f,g))};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.SphereBufferGeometry=function(a,b,c,d,e,f,g){THREE.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;for(var h=f+g,k=(b+1)*(c+1),l=new THREE.BufferAttribute(new Float32Array(3*k),3),m=new THREE.BufferAttribute(new Float32Array(3*k),3),k=new THREE.BufferAttribute(new Float32Array(2*k),2),p=0,n=[],q=new THREE.Vector3,r=0;r<=c;r++){for(var s=[],v=r/c,t=0;t<=b;t++){var u=t/b,D=-a*Math.cos(d+u*e)*Math.sin(f+v*g),w=a*Math.cos(f+v*g),I=a*Math.sin(d+u*e)*Math.sin(f+v*g);q.set(D,w,I).normalize();l.setXYZ(p,D,w,I);m.setXYZ(p,q.x,q.y,q.z);k.setXY(p,u,1-v);s.push(p);p++}n.push(s)}d=[];for(r=0;r<c;r++)for(t=0;t<b;t++)e=n[r][t+1],g=n[r][t],p=n[r+1][t],q=n[r+1][t+1],(0!==r||0<f)&&d.push(e,g,q),(r!==c-1||h<Math.PI)&&d.push(g,p,q);this.setIndex(new(65535<l.count?THREE.Uint32Attribute:THREE.Uint16Attribute)(d,1));this.addAttribute("position",l);this.addAttribute("normal",m);this.addAttribute("uv",k);this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;THREE.TextGeometry=function(a,b){b=b||{};var c=b.font;if(!1===c instanceof THREE.Font)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new THREE.Geometry;c=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,b);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.TorusBufferGeometry=function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=(c+1)*(d+1),g=c*d*6,g=new(65535<g?Uint32Array:Uint16Array)(g),h=new Float32Array(3*f),k=new Float32Array(3*f),f=new Float32Array(2*f),l=0,m=0,p=0,n=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3,s,v;for(s=0;s<=c;s++)for(v=0;v<=d;v++){var t=v/d*e,u=s/c*Math.PI*2;q.x=(a+b*Math.cos(u))*Math.cos(t);q.y=(a+b*Math.cos(u))*Math.sin(t);q.z=b*Math.sin(u);h[l]=q.x;h[l+1]=q.y;h[l+2]=q.z;n.x=a*Math.cos(t);n.y=a*Math.sin(t);r.subVectors(q,n).normalize();k[l]=r.x;k[l+1]=r.y;k[l+2]=r.z;f[m]=v/d;f[m+1]=s/c;l+=3;m+=2}for(s=1;s<=c;s++)for(v=1;v<=d;v++)a=(d+1)*(s-1)+v-1,b=(d+1)*(s-1)+v,e=(d+1)*s+v,g[p]=(d+1)*s+v-1,g[p+1]=a,g[p+2]=e,g[p+3]=a,g[p+4]=b,g[p+5]=e,p+=6;this.setIndex(new THREE.BufferAttribute(g,1));this.addAttribute("position",new THREE.BufferAttribute(h,3));this.addAttribute("normal",new THREE.BufferAttribute(k,3));this.addAttribute("uv",new THREE.BufferAttribute(f,2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);
THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new THREE.TorusBufferGeometry(a,b,c,d,e))};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotBufferGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=c/b;b=Math.cos(a);e.x=d*(2+b)*.5*f;e.y=d*(2+b)*g*.5;e.z=d*Math.sin(a)*.5}THREE.BufferGeometry.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||100;b=b||40;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;var h=(d+1)*(c+1),k=d*c*6,k=new THREE.BufferAttribute(new(65535<k?Uint32Array:Uint16Array)(k),1),l=new THREE.BufferAttribute(new Float32Array(3*h),3),m=new THREE.BufferAttribute(new Float32Array(3*h),3),h=new THREE.BufferAttribute(new Float32Array(2*h),2),p,n,q=0,r=0,s=new THREE.Vector3,v=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector3,D=new THREE.Vector3,w=new THREE.Vector3,I=new THREE.Vector3,z=new THREE.Vector3;for(p=0;p<=c;++p)for(n=p/c*e*Math.PI*2,g(n,e,f,a,u),g(n+.01,e,f,a,D),I.subVectors(D,u),z.addVectors(D,u),w.crossVectors(I,z),z.crossVectors(w,I),w.normalize(),z.normalize(),n=0;n<=d;++n){var y=n/d*Math.PI*2,A=-b*Math.cos(y),y=b*Math.sin(y);s.x=u.x+(A*z.x+y*w.x);s.y=u.y+(A*z.y+y*w.y);s.z=u.z+(A*z.z+y*w.z);l.setXYZ(q,s.x,s.y,s.z);v.subVectors(s,u).normalize();m.setXYZ(q,v.x,v.y,v.z);t.x=p/c;t.y=n/d;h.setXY(q,t.x,t.y);q++}for(n=1;n<=c;n++)for(p=1;p<=d;p++)a=(d+1)*n+(p-1),b=(d+1)*n+p,e=(d+1)*(n-1)+p,k.setX(r,(d+1)*(n-1)+(p-1)),r++,k.setX(r,a),r++,k.setX(r,e),r++,k.setX(r,a),r++,k.setX(r,b),r++,k.setX(r,e),r++;this.setIndex(k);this.addAttribute("position",l);this.addAttribute("normal",m);this.addAttribute("uv",h)};THREE.TorusKnotBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusKnotBufferGeometry.prototype.constructor=THREE.TorusKnotBufferGeometry;THREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new THREE.TorusKnotBufferGeometry(a,b,c,d,e,f));this.mergeVertices()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TubeGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e,taper:f};b=b||64;c=c||1;d=d||8;e=e||!1;f=f||THREE.TubeGeometry.NoTaper;var g=[],h,k,l=b+1,m,p,n,q,r,s=new THREE.Vector3,v,t,u;v=new THREE.TubeGeometry.FrenetFrames(a,b,e);t=v.normals;u=v.binormals;this.tangents=v.tangents;this.normals=t;this.binormals=u;for(v=0;v<l;v++)for(g[v]=[],m=v/(l-1),r=a.getPointAt(m),h=t[v],k=u[v],n=c*f(m),m=0;m<d;m++)p=m/d*2*Math.PI,q=-n*Math.cos(p),p=n*Math.sin(p),s.copy(r),s.x+=q*h.x+p*k.x,s.y+=q*h.y+p*k.y,s.z+=q*h.z+p*k.z,g[v][m]=this.vertices.push(new THREE.Vector3(s.x,s.y,s.z))-1;for(v=0;v<b;v++)for(m=0;m<d;m++)f=e?(v+1)%b:v+1,l=(m+1)%d,a=g[v][m],c=g[f][m],f=g[f][l],l=g[v][l],s=new THREE.Vector2(v/b,m/d),t=new THREE.Vector2((v+1)/b,m/d),u=new THREE.Vector2((v+1)/b,(m+1)/d),h=new THREE.Vector2(v/b,(m+1)/d),this.faces.push(new THREE.Face3(a,c,l)),this.faceVertexUvs[0].push([s,t,h]),this.faces.push(new THREE.Face3(c,f,l)),this.faceVertexUvs[0].push([t.clone(),u,h.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(a){return 1};THREE.TubeGeometry.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)};THREE.TubeGeometry.FrenetFrames=function(a,b,c){var d=new THREE.Vector3,e=[],f=[],g=[],h=new THREE.Vector3,k=new THREE.Matrix4;b+=1;var l,m,p;this.tangents=e;this.normals=f;this.binormals=g;for(l=0;l<b;l++)m=l/(b-1),e[l]=a.getTangentAt(m),e[l].normalize();f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;a=Number.MAX_VALUE;l=Math.abs(e[0].x);m=Math.abs(e[0].y);p=Math.abs(e[0].z);l<=a&&(a=l,d.set(1,0,0));m<=a&&(a=m,d.set(0,1,0));p<=a&&d.set(0,0,1);h.crossVectors(e[0],d).normalize();f[0].crossVectors(e[0],h);g[0].crossVectors(e[0],f[0]);for(l=1;l<b;l++)f[l]=f[l-1].clone(),g[l]=g[l-1].clone(),h.crossVectors(e[l-1],e[l]),h.length()>Number.EPSILON&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[l-1].dot(e[l]),-1,1)),f[l].applyMatrix4(k.makeRotationAxis(h,d))),g[l].crossVectors(e[l],f[l]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossVectors(f[0],f[b-1]))&&(d=-d),l=1;l<b;l++)f[l].applyMatrix4(k.makeRotationAxis(e[l],d*l)),g[l].crossVectors(e[l],f[l])};THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);v.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(v.z,-v.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,b){for(var c=Math.pow(2,b),d=e(k.vertices[a.a]),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),l=[],m=0;m<=c;m++){l[m]=[];for(var n=e(d.clone().lerp(h,m/c)),p=e(g.clone().lerp(h,m/c)),q=c-m,r=0;r<=q;r++)l[m][r]=0===r&&m===c?n:e(n.clone().lerp(p,r/q))}for(m=0;m<c;m++)for(r=0;r<2*(c-m)-1;r++)d=Math.floor(r/2),0===r%2?f(l[m][d+1],l[m+1][d],l[m][d]):f(l[m][d+1],l[m+1][d+1],l[m+1][d])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));return a.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var k=this,l=0,m=a.length;l<m;l+=3)e(new THREE.Vector3(a[l],a[l+1],a[l+2]));a=this.vertices;for(var p=[],n=l=0,m=b.length;l<m;l+=3,n++){var q=a[b[l]],r=a[b[l+1]],s=a[b[l+2]];p[n]=new THREE.Face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var v=new THREE.Vector3,l=0,m=p.length;l<m;l++)g(p[l],d);l=0;for(m=this.faceVertexUvs[0].length;l<m;l++)b=this.faceVertexUvs[0][l],d=b[0].x,a=b[1].x,p=b[2].x,n=Math.max(d,a,p),q=Math.min(d,a,p),.9<n&&.1>q&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>p&&(b[2].x+=1));l=0;for(m=this.vertices.length;l<m;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.DodecahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;THREE.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,l,m=b+1;for(g=0;g<=c;g++)for(l=g/c,h=0;h<=b;h++)k=h/b,k=a(k,l),d.push(k);var p,n,q,r;for(g=0;g<c;g++)for(h=0;h<b;h++)a=g*m+h,d=g*m+h+1,l=(g+1)*m+h+1,k=(g+1)*m+h,p=new THREE.Vector2(h/b,g/c),n=new THREE.Vector2((h+1)/b,g/c),q=new THREE.Vector2((h+1)/b,(g+1)/c),r=new THREE.Vector2(h/b,(g+1)/c),e.push(new THREE.Face3(a,d,k)),f.push([p,n,r]),e.push(new THREE.Face3(d,l,k)),f.push([n.clone(),q,r.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.WireframeGeometry=function(a){function b(a,b){return a-b}THREE.BufferGeometry.call(this);var c=[0,0],d={},e=["a","b","c"];if(a instanceof THREE.Geometry){var f=a.vertices,g=a.faces,h=0,k=new Uint32Array(6*g.length);a=0;for(var l=g.length;a<l;a++)for(var m=g[a],p=0;3>p;p++){c[0]=m[e[p]];c[1]=m[e[(p+1)%3]];c.sort(b);var n=c.toString();void 0===d[n]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[n]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(p=0;2>p;p++)d=f[k[2*a+p]],h=6*a+3*p,c[h+0]=d.x,c[h+1]=d.y,c[h+2]=d.z;this.addAttribute("position",new THREE.BufferAttribute(c,3))}else if(a instanceof THREE.BufferGeometry){if(null!==a.index){l=a.index.array;f=a.attributes.position;e=a.groups;h=0;0===e.length&&a.addGroup(0,l.length);k=new Uint32Array(2*l.length);g=0;for(m=e.length;g<m;++g){a=e[g];p=a.start;n=a.count;a=p;for(var q=p+n;a<q;a+=3)for(p=0;3>p;p++)c[0]=l[a+p],c[1]=l[a+(p+1)%3],c.sort(b),n=c.toString(),void 0===d[n]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[n]=!0,h++)}c=new Float32Array(6*h);a=0;for(l=h;a<l;a++)for(p=0;2>p;p++)h=6*a+3*p,d=k[2*a+p],c[h+0]=f.getX(d),c[h+1]=f.getY(d),c[h+2]=f.getZ(d)}else for(f=a.attributes.position.array,h=f.length/3,k=h/3,c=new Float32Array(6*h),a=0,l=k;a<l;a++)for(p=0;3>p;p++)h=18*a+6*p,k=9*a+3*p,c[h+0]=f[k],c[h+1]=f[k+1],c[h+2]=f[k+2],d=9*a+(p+1)%3*3,c[h+3]=f[d],c[h+4]=f[d+1],c[h+5]=f[d+2];this.addAttribute("position",new THREE.BufferAttribute(c,3))}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(b,3));a.addAttribute("color",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,b)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(){var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var b=new THREE.CylinderBufferGeometry(0,.5,1,5,1);b.translate(0,-.5,0);return function(c,d,e,f,g,h){THREE.Object3D.call(this);void 0===f&&(f=16776960);void 0===e&&(e=1);void 0===g&&(g=.2*e);void 0===h&&(h=.2*g);this.position.copy(d);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:f}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:f}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(e,g,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};THREE.BoxHelper=function(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),e=new THREE.BufferGeometry;e.setIndex(new THREE.BufferAttribute(c,1));e.addAttribute("position",new THREE.BufferAttribute(d,3));THREE.LineSegments.call(this,e,new THREE.LineBasicMaterial({color:b}));void 0!==a&&this.update(a)};THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;THREE.BoxHelper.prototype.update=function(){var a=new THREE.Box3;return function(b){b instanceof THREE.Box3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();THREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b("n1","n2",16755200);b("n2","n4",16755200);b("n4","n3",16755200);b("n3","n1",16755200);b("f1","f2",16755200);b("f2","f4",16755200);b("f4","f3",16755200);b("f3","f1",16755200);b("n1","f1",16755200);b("n2","f2",16755200);b("n3","f3",16755200);b("n4","f4",16755200);b("p","n1",16711680);b("p","n2",16711680);b("p","n3",16711680);b("p","n4",16711680);b("u1","u2",43775);b("u2","u3",43775);b("u3","u1",43775);b("c","t",16777215);b("p","c",3355443);b("cn1","cn2",3355443);b("cn3","cn4",3355443);b("cf1","cf2",3355443);b("cf3","cf4",3355443);THREE.LineSegments.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=f;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){function a(a,g,h,k){d.set(g,h,k).unproject(e);a=c[a];if(void 0!==a)for(g=0,h=a.length;g<h;g++)b.vertices[a[g]].copy(d)}var b,c,d=new THREE.Vector3,e=new THREE.Camera;return function(){b=this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.verticesNeedUpdate=!0}}();THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===b&&(b=1);var c=new THREE.BufferGeometry;c.addAttribute("position",new THREE.Float32Attribute([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var d=new THREE.LineBasicMaterial({fog:!1});this.add(new THREE.Line(c,d));c=new THREE.BufferGeometry;c.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));this.add(new THREE.Line(c,d));this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){var a=this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);var d=this.children[0],e=this.children[1];d.lookAt(c);d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);e.lookAt(c);e.scale.z=c.length()}}();THREE.EdgesHelper=function(a,b,c){b=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(a.geometry,c),new THREE.LineBasicMaterial({color:b}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;THREE.FaceNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute("position",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;THREE.FaceNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);for(var d=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices,f=f.faces,h=0,k=0,l=f.length;k<l;k++){var m=f[k],p=m.normal;a.copy(g[m.a]).add(g[m.b]).add(g[m.c]).divideScalar(3).applyMatrix4(d);b.copy(p).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);e.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0;return this}}();THREE.GridHelper=function(a,b,c,d){b=b||1;c=new THREE.Color(void 0!==c?c:4473924);d=new THREE.Color(void 0!==d?d:8947848);for(var e=b/2,f=2*a/b,g=[],h=[],k=0,l=0,m=-a;k<=b;k++,m+=f){g.push(-a,0,m,a,0,m);g.push(m,0,-a,m,0,a);var p=k===e?c:d;p.toArray(h,l);l+=3;p.toArray(h,l);l+=3;p.toArray(h,l);l+=3;p.toArray(h,l);l+=3}a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.Float32Attribute(g,3));a.addAttribute("color",new THREE.Float32Attribute(h,3));g=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,a,g)};THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};THREE.HemisphereLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];var c=new THREE.SphereGeometry(b,4,2);c.rotateX(-Math.PI/2);for(var d=0;8>d;d++)c.faces[d].color=this.colors[4>d?0:1];d=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,d);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();THREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereBufferGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof THREE.Bone&&(b.vertices.push(new THREE.Vector3),b.vertices.push(new THREE.Vector3),b.colors.push(new THREE.Color(0,0,1)),b.colors.push(new THREE.Color(0,1,0)));b.dynamic=!0;c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,b,c);this.root=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof THREE.Bone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};THREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new THREE.Matrix4).getInverse(this.root.matrixWorld),c=new THREE.Matrix4,d=0,e=0;e<this.bones.length;e++){var f=this.bones[e];f.parent instanceof THREE.Bone&&(c.multiplyMatrices(b,f.matrixWorld),a.vertices[d].setFromMatrixPosition(c),c.multiplyMatrices(b,f.parent.matrixWorld),a.vertices[d+1].setFromMatrixPosition(c),d+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};THREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new THREE.BufferGeometry;for(var b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute("position",new THREE.Float32Attribute(b,3));b=new THREE.LineBasicMaterial({fog:!1});this.cone=new THREE.LineSegments(a,b);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1e3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;c=this.object.geometry;c instanceof THREE.Geometry?b=3*c.faces.length:c instanceof THREE.BufferGeometry&&(b=c.attributes.normal.count);c=new THREE.BufferGeometry;b=new THREE.Float32Attribute(6*b,3);c.addAttribute("position",b);THREE.LineSegments.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;THREE.VertexNormalsHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(){var d=["a","b","c"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g instanceof THREE.Geometry)for(var h=g.vertices,k=g.faces,l=g=0,m=k.length;l<m;l++)for(var p=k[l],n=0,q=p.vertexNormals.length;n<q;n++){var r=p.vertexNormals[n];a.copy(h[p[d[n]]]).applyMatrix4(e);b.copy(r).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g instanceof THREE.BufferGeometry)for(d=g.attributes.position,h=g.attributes.normal,n=g=0,q=d.count;n<q;n++)a.set(d.getX(n),d.getY(n),d.getZ(n)).applyMatrix4(e),b.set(h.getX(n),h.getY(n),h.getZ(n)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0;return this}}();THREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(a.geometry),new THREE.LineBasicMaterial({color:c}));this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(a){THREE.Object3D.call(this);this.material=a;this.render=function(a){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){b={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(b);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}}},{}],355:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){
return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}],356:[function(require,module,exports){module.exports=UnitBezier;function UnitBezier(p1x,p1y,p2x,p2y){this.cx=3*p1x;this.bx=3*(p2x-p1x)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*p1y;this.by=3*(p2y-p1y)-this.cy;this.ay=1-this.cy-this.by;this.p1x=p1x;this.p1y=p2y;this.p2x=p2x;this.p2y=p2y}UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t};UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t};UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx};UnitBezier.prototype.solveCurveX=function(x,epsilon){if(typeof epsilon==="undefined")epsilon=1e-6;var t0,t1,t2,x2,i;for(t2=x,i=0;i<8;i++){x2=this.sampleCurveX(t2)-x;if(Math.abs(x2)<epsilon)return t2;var d2=this.sampleCurveDerivativeX(t2);if(Math.abs(d2)<1e-6)break;t2=t2-x2/d2}t0=0;t1=1;t2=x;if(t2<t0)return t0;if(t2>t1)return t1;while(t0<t1){x2=this.sampleCurveX(t2);if(Math.abs(x2-x)<epsilon)return t2;if(x>x2){t0=t2}else{t1=t2}t2=(t1-t0)*.5+t0}return t2};UnitBezier.prototype.solve=function(x,epsilon){return this.sampleCurveY(this.solveCurveX(x,epsilon))}},{}],357:[function(require,module,exports){var createElement=require("./vdom/create-element.js");module.exports=createElement},{"./vdom/create-element.js":363}],358:[function(require,module,exports){var diff=require("./vtree/diff.js");module.exports=diff},{"./vtree/diff.js":383}],359:[function(require,module,exports){var h=require("./virtual-hyperscript/index.js");module.exports=h},{"./virtual-hyperscript/index.js":370}],360:[function(require,module,exports){var diff=require("./diff.js");var patch=require("./patch.js");var h=require("./h.js");var create=require("./create-element.js");var VNode=require("./vnode/vnode.js");var VText=require("./vnode/vtext.js");module.exports={diff:diff,patch:patch,h:h,create:create,VNode:VNode,VText:VText}},{"./create-element.js":357,"./diff.js":358,"./h.js":359,"./patch.js":361,"./vnode/vnode.js":379,"./vnode/vtext.js":381}],361:[function(require,module,exports){var patch=require("./vdom/patch.js");module.exports=patch},{"./vdom/patch.js":366}],362:[function(require,module,exports){var isObject=require("is-object");var isHook=require("../vnode/is-vhook.js");module.exports=applyProperties;function applyProperties(node,props,previous){for(var propName in props){var propValue=props[propName];if(propValue===undefined){removeProperty(node,propName,propValue,previous)}else if(isHook(propValue)){removeProperty(node,propName,propValue,previous);if(propValue.hook){propValue.hook(node,propName,previous?previous[propName]:undefined)}}else{if(isObject(propValue)){patchObject(node,props,previous,propName,propValue)}else{node[propName]=propValue}}}}function removeProperty(node,propName,propValue,previous){if(previous){var previousValue=previous[propName];if(!isHook(previousValue)){if(propName==="attributes"){for(var attrName in previousValue){node.removeAttribute(attrName)}}else if(propName==="style"){for(var i in previousValue){node.style[i]=""}}else if(typeof previousValue==="string"){node[propName]=""}else{node[propName]=null}}else if(previousValue.unhook){previousValue.unhook(node,propName,propValue)}}}function patchObject(node,props,previous,propName,propValue){var previousValue=previous?previous[propName]:undefined;if(propName==="attributes"){for(var attrName in propValue){var attrValue=propValue[attrName];if(attrValue===undefined){node.removeAttribute(attrName)}else{node.setAttribute(attrName,attrValue)}}return}if(previousValue&&isObject(previousValue)&&getPrototype(previousValue)!==getPrototype(propValue)){node[propName]=propValue;return}if(!isObject(node[propName])){node[propName]={}}var replacer=propName==="style"?"":undefined;for(var k in propValue){var value=propValue[k];node[propName][k]=value===undefined?replacer:value}}function getPrototype(value){if(Object.getPrototypeOf){return Object.getPrototypeOf(value)}else if(value.__proto__){return value.__proto__}else if(value.constructor){return value.constructor.prototype}}},{"../vnode/is-vhook.js":374,"is-object":180}],363:[function(require,module,exports){var document=require("global/document");var applyProperties=require("./apply-properties");var isVNode=require("../vnode/is-vnode.js");var isVText=require("../vnode/is-vtext.js");var isWidget=require("../vnode/is-widget.js");var handleThunk=require("../vnode/handle-thunk.js");module.exports=createElement;function createElement(vnode,opts){var doc=opts?opts.document||document:document;var warn=opts?opts.warn:null;vnode=handleThunk(vnode).a;if(isWidget(vnode)){return vnode.init()}else if(isVText(vnode)){return doc.createTextNode(vnode.text)}else if(!isVNode(vnode)){if(warn){warn("Item is not a valid virtual dom node",vnode)}return null}var node=vnode.namespace===null?doc.createElement(vnode.tagName):doc.createElementNS(vnode.namespace,vnode.tagName);var props=vnode.properties;applyProperties(node,props);var children=vnode.children;for(var i=0;i<children.length;i++){var childNode=createElement(children[i],opts);if(childNode){node.appendChild(childNode)}}return node}},{"../vnode/handle-thunk.js":372,"../vnode/is-vnode.js":375,"../vnode/is-vtext.js":376,"../vnode/is-widget.js":377,"./apply-properties":362,"global/document":156}],364:[function(require,module,exports){var noChild={};module.exports=domIndex;function domIndex(rootNode,tree,indices,nodes){if(!indices||indices.length===0){return{}}else{indices.sort(ascending);return recurse(rootNode,tree,indices,nodes,0)}}function recurse(rootNode,tree,indices,nodes,rootIndex){nodes=nodes||{};if(rootNode){if(indexInRange(indices,rootIndex,rootIndex)){nodes[rootIndex]=rootNode}var vChildren=tree.children;if(vChildren){var childNodes=rootNode.childNodes;for(var i=0;i<tree.children.length;i++){rootIndex+=1;var vChild=vChildren[i]||noChild;var nextIndex=rootIndex+(vChild.count||0);if(indexInRange(indices,rootIndex,nextIndex)){recurse(childNodes[i],vChild,indices,nodes,rootIndex)}rootIndex=nextIndex}}}return nodes}function indexInRange(indices,left,right){if(indices.length===0){return false}var minIndex=0;var maxIndex=indices.length-1;var currentIndex;var currentItem;while(minIndex<=maxIndex){currentIndex=(maxIndex+minIndex)/2>>0;currentItem=indices[currentIndex];if(minIndex===maxIndex){return currentItem>=left&&currentItem<=right}else if(currentItem<left){minIndex=currentIndex+1}else if(currentItem>right){maxIndex=currentIndex-1}else{return true}}return false}function ascending(a,b){return a>b?1:-1}},{}],365:[function(require,module,exports){var applyProperties=require("./apply-properties");var isWidget=require("../vnode/is-widget.js");var VPatch=require("../vnode/vpatch.js");var updateWidget=require("./update-widget");module.exports=applyPatch;function applyPatch(vpatch,domNode,renderOptions){var type=vpatch.type;var vNode=vpatch.vNode;var patch=vpatch.patch;switch(type){case VPatch.REMOVE:return removeNode(domNode,vNode);case VPatch.INSERT:return insertNode(domNode,patch,renderOptions);case VPatch.VTEXT:return stringPatch(domNode,vNode,patch,renderOptions);case VPatch.WIDGET:return widgetPatch(domNode,vNode,patch,renderOptions);case VPatch.VNODE:return vNodePatch(domNode,vNode,patch,renderOptions);case VPatch.ORDER:reorderChildren(domNode,patch);return domNode;case VPatch.PROPS:applyProperties(domNode,patch,vNode.properties);return domNode;case VPatch.THUNK:return replaceRoot(domNode,renderOptions.patch(domNode,patch,renderOptions));default:return domNode}}function removeNode(domNode,vNode){var parentNode=domNode.parentNode;if(parentNode){parentNode.removeChild(domNode)}destroyWidget(domNode,vNode);return null}function insertNode(parentNode,vNode,renderOptions){var newNode=renderOptions.render(vNode,renderOptions);if(parentNode){parentNode.appendChild(newNode)}return parentNode}function stringPatch(domNode,leftVNode,vText,renderOptions){var newNode;if(domNode.nodeType===3){domNode.replaceData(0,domNode.length,vText.text);newNode=domNode}else{var parentNode=domNode.parentNode;newNode=renderOptions.render(vText,renderOptions);if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode)}}return newNode}function widgetPatch(domNode,leftVNode,widget,renderOptions){
var updating=updateWidget(leftVNode,widget);var newNode;if(updating){newNode=widget.update(leftVNode,domNode)||domNode}else{newNode=renderOptions.render(widget,renderOptions)}var parentNode=domNode.parentNode;if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode)}if(!updating){destroyWidget(domNode,leftVNode)}return newNode}function vNodePatch(domNode,leftVNode,vNode,renderOptions){var parentNode=domNode.parentNode;var newNode=renderOptions.render(vNode,renderOptions);if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode)}return newNode}function destroyWidget(domNode,w){if(typeof w.destroy==="function"&&isWidget(w)){w.destroy(domNode)}}function reorderChildren(domNode,moves){var childNodes=domNode.childNodes;var keyMap={};var node;var remove;var insert;for(var i=0;i<moves.removes.length;i++){remove=moves.removes[i];node=childNodes[remove.from];if(remove.key){keyMap[remove.key]=node}domNode.removeChild(node)}var length=childNodes.length;for(var j=0;j<moves.inserts.length;j++){insert=moves.inserts[j];node=keyMap[insert.key];domNode.insertBefore(node,insert.to>=length++?null:childNodes[insert.to])}}function replaceRoot(oldRoot,newRoot){if(oldRoot&&newRoot&&oldRoot!==newRoot&&oldRoot.parentNode){oldRoot.parentNode.replaceChild(newRoot,oldRoot)}return newRoot}},{"../vnode/is-widget.js":377,"../vnode/vpatch.js":380,"./apply-properties":362,"./update-widget":367}],366:[function(require,module,exports){var document=require("global/document");var isArray=require("x-is-array");var render=require("./create-element");var domIndex=require("./dom-index");var patchOp=require("./patch-op");module.exports=patch;function patch(rootNode,patches,renderOptions){renderOptions=renderOptions||{};renderOptions.patch=renderOptions.patch&&renderOptions.patch!==patch?renderOptions.patch:patchRecursive;renderOptions.render=renderOptions.render||render;return renderOptions.patch(rootNode,patches,renderOptions)}function patchRecursive(rootNode,patches,renderOptions){var indices=patchIndices(patches);if(indices.length===0){return rootNode}var index=domIndex(rootNode,patches.a,indices);var ownerDocument=rootNode.ownerDocument;if(!renderOptions.document&&ownerDocument!==document){renderOptions.document=ownerDocument}for(var i=0;i<indices.length;i++){var nodeIndex=indices[i];rootNode=applyPatch(rootNode,index[nodeIndex],patches[nodeIndex],renderOptions)}return rootNode}function applyPatch(rootNode,domNode,patchList,renderOptions){if(!domNode){return rootNode}var newNode;if(isArray(patchList)){for(var i=0;i<patchList.length;i++){newNode=patchOp(patchList[i],domNode,renderOptions);if(domNode===rootNode){rootNode=newNode}}}else{newNode=patchOp(patchList,domNode,renderOptions);if(domNode===rootNode){rootNode=newNode}}return rootNode}function patchIndices(patches){var indices=[];for(var key in patches){if(key!=="a"){indices.push(Number(key))}}return indices}},{"./create-element":363,"./dom-index":364,"./patch-op":365,"global/document":156,"x-is-array":402}],367:[function(require,module,exports){var isWidget=require("../vnode/is-widget.js");module.exports=updateWidget;function updateWidget(a,b){if(isWidget(a)&&isWidget(b)){if("name"in a&&"name"in b){return a.id===b.id}else{return a.init===b.init}}return false}},{"../vnode/is-widget.js":377}],368:[function(require,module,exports){"use strict";var EvStore=require("ev-store");module.exports=EvHook;function EvHook(value){if(!(this instanceof EvHook)){return new EvHook(value)}this.value=value}EvHook.prototype.hook=function(node,propertyName){var es=EvStore(node);var propName=propertyName.substr(3);es[propName]=this.value};EvHook.prototype.unhook=function(node,propertyName){var es=EvStore(node);var propName=propertyName.substr(3);es[propName]=undefined}},{"ev-store":9}],369:[function(require,module,exports){"use strict";module.exports=SoftSetHook;function SoftSetHook(value){if(!(this instanceof SoftSetHook)){return new SoftSetHook(value)}this.value=value}SoftSetHook.prototype.hook=function(node,propertyName){if(node[propertyName]!==this.value){node[propertyName]=this.value}}},{}],370:[function(require,module,exports){"use strict";var isArray=require("x-is-array");var VNode=require("../vnode/vnode.js");var VText=require("../vnode/vtext.js");var isVNode=require("../vnode/is-vnode");var isVText=require("../vnode/is-vtext");var isWidget=require("../vnode/is-widget");var isHook=require("../vnode/is-vhook");var isVThunk=require("../vnode/is-thunk");var parseTag=require("./parse-tag.js");var softSetHook=require("./hooks/soft-set-hook.js");var evHook=require("./hooks/ev-hook.js");module.exports=h;function h(tagName,properties,children){var childNodes=[];var tag,props,key,namespace;if(!children&&isChildren(properties)){children=properties;props={}}props=props||properties||{};tag=parseTag(tagName,props);if(props.hasOwnProperty("key")){key=props.key;props.key=undefined}if(props.hasOwnProperty("namespace")){namespace=props.namespace;props.namespace=undefined}if(tag==="INPUT"&&!namespace&&props.hasOwnProperty("value")&&props.value!==undefined&&!isHook(props.value)){props.value=softSetHook(props.value)}transformProperties(props);if(children!==undefined&&children!==null){addChild(children,childNodes,tag,props)}return new VNode(tag,props,childNodes,key,namespace)}function addChild(c,childNodes,tag,props){if(typeof c==="string"){childNodes.push(new VText(c))}else if(typeof c==="number"){childNodes.push(new VText(String(c)))}else if(isChild(c)){childNodes.push(c)}else if(isArray(c)){for(var i=0;i<c.length;i++){addChild(c[i],childNodes,tag,props)}}else if(c===null||c===undefined){return}else{throw UnexpectedVirtualElement({foreignObject:c,parentVnode:{tagName:tag,properties:props}})}}function transformProperties(props){for(var propName in props){if(props.hasOwnProperty(propName)){var value=props[propName];if(isHook(value)){continue}if(propName.substr(0,3)==="ev-"){props[propName]=evHook(value)}}}}function isChild(x){return isVNode(x)||isVText(x)||isWidget(x)||isVThunk(x)}function isChildren(x){return typeof x==="string"||isArray(x)||isChild(x)}function UnexpectedVirtualElement(data){var err=new Error;err.type="virtual-hyperscript.unexpected.virtual-element";err.message="Unexpected virtual child passed to h().\n"+"Expected a VNode / Vthunk / VWidget / string but:\n"+"got:\n"+errorString(data.foreignObject)+".\n"+"The parent vnode is:\n"+errorString(data.parentVnode);"\n"+"Suggested fix: change your `h(..., [ ... ])` callsite.";err.foreignObject=data.foreignObject;err.parentVnode=data.parentVnode;return err}function errorString(obj){try{return JSON.stringify(obj,null,"    ")}catch(e){return String(obj)}}},{"../vnode/is-thunk":373,"../vnode/is-vhook":374,"../vnode/is-vnode":375,"../vnode/is-vtext":376,"../vnode/is-widget":377,"../vnode/vnode.js":379,"../vnode/vtext.js":381,"./hooks/ev-hook.js":368,"./hooks/soft-set-hook.js":369,"./parse-tag.js":371,"x-is-array":402}],371:[function(require,module,exports){"use strict";var split=require("browser-split");var classIdSplit=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/;var notClassId=/^\.|#/;module.exports=parseTag;function parseTag(tag,props){if(!tag){return"DIV"}var noId=!props.hasOwnProperty("id");var tagParts=split(tag,classIdSplit);var tagName=null;if(notClassId.test(tagParts[1])){tagName="DIV"}var classes,part,type,i;for(i=0;i<tagParts.length;i++){part=tagParts[i];if(!part){continue}type=part.charAt(0);if(!tagName){tagName=part}else if(type==="."){classes=classes||[];classes.push(part.substring(1,part.length))}else if(type==="#"&&noId){props.id=part.substring(1,part.length)}}if(classes){if(props.className){classes.push(props.className)}props.className=classes.join(" ")}return props.namespace?tagName:tagName.toUpperCase()}},{"browser-split":5}],372:[function(require,module,exports){var isVNode=require("./is-vnode");var isVText=require("./is-vtext");var isWidget=require("./is-widget");var isThunk=require("./is-thunk");module.exports=handleThunk;function handleThunk(a,b){var renderedA=a;var renderedB=b;if(isThunk(b)){renderedB=renderThunk(b,a)}if(isThunk(a)){renderedA=renderThunk(a,null)}return{a:renderedA,b:renderedB}}function renderThunk(thunk,previous){var renderedThunk=thunk.vnode;if(!renderedThunk){renderedThunk=thunk.vnode=thunk.render(previous)}if(!(isVNode(renderedThunk)||isVText(renderedThunk)||isWidget(renderedThunk))){throw new Error("thunk did not return a valid node")}return renderedThunk}},{"./is-thunk":373,"./is-vnode":375,"./is-vtext":376,"./is-widget":377}],373:[function(require,module,exports){module.exports=isThunk;function isThunk(t){return t&&t.type==="Thunk"}},{}],374:[function(require,module,exports){module.exports=isHook;function isHook(hook){return hook&&(typeof hook.hook==="function"&&!hook.hasOwnProperty("hook")||typeof hook.unhook==="function"&&!hook.hasOwnProperty("unhook"))}},{}],375:[function(require,module,exports){var version=require("./version");module.exports=isVirtualNode;function isVirtualNode(x){return x&&x.type==="VirtualNode"&&x.version===version}},{"./version":378}],376:[function(require,module,exports){var version=require("./version");module.exports=isVirtualText;function isVirtualText(x){return x&&x.type==="VirtualText"&&x.version===version}},{"./version":378}],377:[function(require,module,exports){module.exports=isWidget;function isWidget(w){return w&&w.type==="Widget"}},{}],378:[function(require,module,exports){module.exports="2"},{}],379:[function(require,module,exports){var version=require("./version");var isVNode=require("./is-vnode");var isWidget=require("./is-widget");var isThunk=require("./is-thunk");var isVHook=require("./is-vhook");module.exports=VirtualNode;var noProperties={};var noChildren=[];function VirtualNode(tagName,properties,children,key,namespace){this.tagName=tagName;this.properties=properties||noProperties;this.children=children||noChildren;this.key=key!=null?String(key):undefined;this.namespace=typeof namespace==="string"?namespace:null;var count=children&&children.length||0;var descendants=0;var hasWidgets=false;var hasThunks=false;var descendantHooks=false;var hooks;for(var propName in properties){if(properties.hasOwnProperty(propName)){var property=properties[propName];if(isVHook(property)&&property.unhook){if(!hooks){hooks={}}hooks[propName]=property}}}for(var i=0;i<count;i++){var child=children[i];if(isVNode(child)){descendants+=child.count||0;if(!hasWidgets&&child.hasWidgets){hasWidgets=true}if(!hasThunks&&child.hasThunks){hasThunks=true}if(!descendantHooks&&(child.hooks||child.descendantHooks)){descendantHooks=true}}else if(!hasWidgets&&isWidget(child)){if(typeof child.destroy==="function"){hasWidgets=true}}else if(!hasThunks&&isThunk(child)){hasThunks=true}}this.count=count+descendants;this.hasWidgets=hasWidgets;this.hasThunks=hasThunks;this.hooks=hooks;this.descendantHooks=descendantHooks}VirtualNode.prototype.version=version;VirtualNode.prototype.type="VirtualNode"},{"./is-thunk":373,"./is-vhook":374,"./is-vnode":375,"./is-widget":377,"./version":378}],380:[function(require,module,exports){var version=require("./version");VirtualPatch.NONE=0;VirtualPatch.VTEXT=1;VirtualPatch.VNODE=2;VirtualPatch.WIDGET=3;VirtualPatch.PROPS=4;VirtualPatch.ORDER=5;VirtualPatch.INSERT=6;VirtualPatch.REMOVE=7;VirtualPatch.THUNK=8;module.exports=VirtualPatch;function VirtualPatch(type,vNode,patch){this.type=Number(type);this.vNode=vNode;this.patch=patch}VirtualPatch.prototype.version=version;VirtualPatch.prototype.type="VirtualPatch"},{"./version":378}],381:[function(require,module,exports){var version=require("./version");module.exports=VirtualText;function VirtualText(text){this.text=String(text)}VirtualText.prototype.version=version;VirtualText.prototype.type="VirtualText"},{"./version":378}],382:[function(require,module,exports){var isObject=require("is-object");var isHook=require("../vnode/is-vhook");module.exports=diffProps;function diffProps(a,b){var diff;for(var aKey in a){if(!(aKey in b)){diff=diff||{};diff[aKey]=undefined}var aValue=a[aKey];var bValue=b[aKey];if(aValue===bValue){continue}else if(isObject(aValue)&&isObject(bValue)){if(getPrototype(bValue)!==getPrototype(aValue)){diff=diff||{};diff[aKey]=bValue}else if(isHook(bValue)){diff=diff||{};diff[aKey]=bValue}else{var objectDiff=diffProps(aValue,bValue);if(objectDiff){diff=diff||{};diff[aKey]=objectDiff}}}else{diff=diff||{};diff[aKey]=bValue}}for(var bKey in b){if(!(bKey in a)){diff=diff||{};diff[bKey]=b[bKey]}}return diff}function getPrototype(value){if(Object.getPrototypeOf){return Object.getPrototypeOf(value)}else if(value.__proto__){return value.__proto__}else if(value.constructor){return value.constructor.prototype}}},{"../vnode/is-vhook":374,"is-object":180}],383:[function(require,module,exports){var isArray=require("x-is-array");var VPatch=require("../vnode/vpatch");var isVNode=require("../vnode/is-vnode");var isVText=require("../vnode/is-vtext");var isWidget=require("../vnode/is-widget");var isThunk=require("../vnode/is-thunk");var handleThunk=require("../vnode/handle-thunk");var diffProps=require("./diff-props");module.exports=diff;function diff(a,b){var patch={a:a};walk(a,b,patch,0);return patch}function walk(a,b,patch,index){if(a===b){return}var apply=patch[index];var applyClear=false;if(isThunk(a)||isThunk(b)){thunks(a,b,patch,index)}else if(b==null){if(!isWidget(a)){clearState(a,patch,index);apply=patch[index]}apply=appendPatch(apply,new VPatch(VPatch.REMOVE,a,b))}else if(isVNode(b)){if(isVNode(a)){if(a.tagName===b.tagName&&a.namespace===b.namespace&&a.key===b.key){var propsPatch=diffProps(a.properties,b.properties);if(propsPatch){apply=appendPatch(apply,new VPatch(VPatch.PROPS,a,propsPatch))}apply=diffChildren(a,b,patch,apply,index)}else{apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b));applyClear=true}}else{apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b));applyClear=true}}else if(isVText(b)){if(!isVText(a)){apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b));applyClear=true}else if(a.text!==b.text){apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b))}}else if(isWidget(b)){if(!isWidget(a)){applyClear=true}apply=appendPatch(apply,new VPatch(VPatch.WIDGET,a,b))}if(apply){patch[index]=apply}if(applyClear){clearState(a,patch,index)}}function diffChildren(a,b,patch,apply,index){var aChildren=a.children;var orderedSet=reorder(aChildren,b.children);var bChildren=orderedSet.children;var aLen=aChildren.length;var bLen=bChildren.length;var len=aLen>bLen?aLen:bLen;for(var i=0;i<len;i++){var leftNode=aChildren[i];var rightNode=bChildren[i];index+=1;if(!leftNode){if(rightNode){apply=appendPatch(apply,new VPatch(VPatch.INSERT,null,rightNode))}}else{walk(leftNode,rightNode,patch,index)}if(isVNode(leftNode)&&leftNode.count){index+=leftNode.count}}if(orderedSet.moves){apply=appendPatch(apply,new VPatch(VPatch.ORDER,a,orderedSet.moves))}return apply}function clearState(vNode,patch,index){unhook(vNode,patch,index);destroyWidgets(vNode,patch,index)}function destroyWidgets(vNode,patch,index){if(isWidget(vNode)){if(typeof vNode.destroy==="function"){patch[index]=appendPatch(patch[index],new VPatch(VPatch.REMOVE,vNode,null))}}else if(isVNode(vNode)&&(vNode.hasWidgets||vNode.hasThunks)){var children=vNode.children;var len=children.length;for(var i=0;i<len;i++){var child=children[i];index+=1;destroyWidgets(child,patch,index);if(isVNode(child)&&child.count){index+=child.count}}}else if(isThunk(vNode)){thunks(vNode,null,patch,index)}}function thunks(a,b,patch,index){var nodes=handleThunk(a,b);var thunkPatch=diff(nodes.a,nodes.b);if(hasPatches(thunkPatch)){patch[index]=new VPatch(VPatch.THUNK,null,thunkPatch)}}function hasPatches(patch){for(var index in patch){if(index!=="a"){return true}}return false}function unhook(vNode,patch,index){if(isVNode(vNode)){if(vNode.hooks){patch[index]=appendPatch(patch[index],new VPatch(VPatch.PROPS,vNode,undefinedKeys(vNode.hooks)))}if(vNode.descendantHooks||vNode.hasThunks){var children=vNode.children;var len=children.length;for(var i=0;i<len;i++){var child=children[i];index+=1;unhook(child,patch,index);if(isVNode(child)&&child.count){index+=child.count}}}}else if(isThunk(vNode)){thunks(vNode,null,patch,index)}}function undefinedKeys(obj){var result={};for(var key in obj){result[key]=undefined}return result}function reorder(aChildren,bChildren){var bChildIndex=keyIndex(bChildren);var bKeys=bChildIndex.keys;var bFree=bChildIndex.free;if(bFree.length===bChildren.length){return{children:bChildren,moves:null}}var aChildIndex=keyIndex(aChildren);var aKeys=aChildIndex.keys;var aFree=aChildIndex.free;if(aFree.length===aChildren.length){return{children:bChildren,moves:null}}var newChildren=[];var freeIndex=0;var freeCount=bFree.length;var deletedItems=0;for(var i=0;i<aChildren.length;i++){var aItem=aChildren[i];var itemIndex;if(aItem.key){if(bKeys.hasOwnProperty(aItem.key)){itemIndex=bKeys[aItem.key];newChildren.push(bChildren[itemIndex])}else{itemIndex=i-deletedItems++;newChildren.push(null)}}else{if(freeIndex<freeCount){itemIndex=bFree[freeIndex++];newChildren.push(bChildren[itemIndex])}else{itemIndex=i-deletedItems++;newChildren.push(null)}}}var lastFreeIndex=freeIndex>=bFree.length?bChildren.length:bFree[freeIndex];for(var j=0;j<bChildren.length;j++){var newItem=bChildren[j];if(newItem.key){if(!aKeys.hasOwnProperty(newItem.key)){newChildren.push(newItem)}}else if(j>=lastFreeIndex){newChildren.push(newItem)}}var simulate=newChildren.slice();var simulateIndex=0;var removes=[];var inserts=[];var simulateItem;for(var k=0;k<bChildren.length;){var wantedItem=bChildren[k];simulateItem=simulate[simulateIndex];while(simulateItem===null&&simulate.length){removes.push(remove(simulate,simulateIndex,null));simulateItem=simulate[simulateIndex]}if(!simulateItem||simulateItem.key!==wantedItem.key){if(wantedItem.key){if(simulateItem&&simulateItem.key){if(bKeys[simulateItem.key]!==k+1){removes.push(remove(simulate,simulateIndex,simulateItem.key));simulateItem=simulate[simulateIndex];if(!simulateItem||simulateItem.key!==wantedItem.key){inserts.push({key:wantedItem.key,to:k})}else{simulateIndex++}}else{inserts.push({key:wantedItem.key,to:k})}}else{inserts.push({key:wantedItem.key,to:k})}k++}else if(simulateItem&&simulateItem.key){removes.push(remove(simulate,simulateIndex,simulateItem.key))}}else{simulateIndex++;k++}}while(simulateIndex<simulate.length){simulateItem=simulate[simulateIndex];removes.push(remove(simulate,simulateIndex,simulateItem&&simulateItem.key))}if(removes.length===deletedItems&&!inserts.length){return{children:newChildren,moves:null}}return{children:newChildren,moves:{removes:removes,inserts:inserts}}}function remove(arr,index,key){arr.splice(index,1);return{from:index,key:key}}function keyIndex(children){var keys={};var free=[];var length=children.length;for(var i=0;i<length;i++){var child=children[i];if(child.key){keys[child.key]=i}else{free.push(i)}}return{keys:keys,free:free}}function appendPatch(apply,patch){if(apply){if(isArray(apply)){apply.push(patch)}else{apply=[apply,patch]}return apply}else{return patch}}},{"../vnode/handle-thunk":372,"../vnode/is-thunk":373,"../vnode/is-vnode":375,"../vnode/is-vtext":376,"../vnode/is-widget":377,"../vnode/vpatch":380,"./diff-props":382,"x-is-array":402}],384:[function(require,module,exports){(function(define){"use strict";define(function(require){var makePromise=require("./makePromise");var Scheduler=require("./Scheduler");var async=require("./env").asap;return makePromise({scheduler:new Scheduler(async)})})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./Scheduler":385,"./env":397,"./makePromise":399}],385:[function(require,module,exports){(function(define){"use strict";define(function(){function Scheduler(async){this._async=async;this._running=false;this._queue=this;this._queueLen=0;this._afterQueue={};this._afterQueueLen=0;var self=this;this.drain=function(){self._drain()}}Scheduler.prototype.enqueue=function(task){this._queue[this._queueLen++]=task;this.run()};Scheduler.prototype.afterQueue=function(task){this._afterQueue[this._afterQueueLen++]=task;this.run()};Scheduler.prototype.run=function(){if(!this._running){this._running=true;this._async(this.drain)}};Scheduler.prototype._drain=function(){var i=0;for(;i<this._queueLen;++i){this._queue[i].run();this._queue[i]=void 0}this._queueLen=0;this._running=false;for(i=0;i<this._afterQueueLen;++i){this._afterQueue[i].run();this._afterQueue[i]=void 0}this._afterQueueLen=0};return Scheduler})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],386:[function(require,module,exports){(function(define){"use strict";define(function(){function TimeoutError(message){Error.call(this);this.message=message;this.name=TimeoutError.name;if(typeof Error.captureStackTrace==="function"){Error.captureStackTrace(this,TimeoutError)}}TimeoutError.prototype=Object.create(Error.prototype);TimeoutError.prototype.constructor=TimeoutError;return TimeoutError})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],387:[function(require,module,exports){(function(define){"use strict";define(function(){makeApply.tryCatchResolve=tryCatchResolve;return makeApply;function makeApply(Promise,call){if(arguments.length<2){call=tryCatchResolve}return apply;function apply(f,thisArg,args){var p=Promise._defer();var l=args.length;var params=new Array(l);callAndResolve({f:f,thisArg:thisArg,args:args,params:params,i:l-1,call:call},p._handler);return p}function callAndResolve(c,h){if(c.i<0){return call(c.f,c.thisArg,c.params,h)}var handler=Promise._handler(c.args[c.i]);handler.fold(callAndResolveNext,c,void 0,h)}function callAndResolveNext(c,x,h){c.params[c.i]=x;c.i-=1;callAndResolve(c,h)}}function tryCatchResolve(f,thisArg,args,resolver){try{resolver.resolve(f.apply(thisArg,args))}catch(e){resolver.reject(e)}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],388:[function(require,module,exports){(function(define){"use strict";define(function(require){var state=require("../state");var applier=require("../apply");return function array(Promise){var applyFold=applier(Promise);var toPromise=Promise.resolve;var all=Promise.all;var ar=Array.prototype.reduce;var arr=Array.prototype.reduceRight;var slice=Array.prototype.slice;Promise.any=any;Promise.some=some;Promise.settle=settle;Promise.map=map;Promise.filter=filter;Promise.reduce=reduce;Promise.reduceRight=reduceRight;Promise.prototype.spread=function(onFulfilled){return this.then(all).then(function(array){return onFulfilled.apply(this,array)})};return Promise;function any(promises){var p=Promise._defer();var resolver=p._handler;var l=promises.length>>>0;var pending=l;var errors=[];for(var h,x,i=0;i<l;++i){x=promises[i];if(x===void 0&&!(i in promises)){--pending;continue}h=Promise._handler(x);if(h.state()>0){resolver.become(h);Promise._visitRemaining(promises,i,h);break}else{h.visit(resolver,handleFulfill,handleReject)}}if(pending===0){resolver.reject(new RangeError("any(): array must not be empty"))}return p;function handleFulfill(x){errors=null;this.resolve(x)}function handleReject(e){if(this.resolved){return}errors.push(e);if(--pending===0){this.reject(errors)}}}function some(promises,n){var p=Promise._defer();var resolver=p._handler;var results=[];var errors=[];var l=promises.length>>>0;var nFulfill=0;var nReject;var x,i;for(i=0;i<l;++i){x=promises[i];if(x===void 0&&!(i in promises)){continue}++nFulfill}n=Math.max(n,0);nReject=nFulfill-n+1;nFulfill=Math.min(n,nFulfill);if(n>nFulfill){resolver.reject(new RangeError("some(): array must contain at least "+n+" item(s), but had "+nFulfill))}else if(nFulfill===0){resolver.resolve(results)}for(i=0;i<l;++i){x=promises[i];if(x===void 0&&!(i in promises)){continue}Promise._handler(x).visit(resolver,fulfill,reject,resolver.notify)}return p;function fulfill(x){if(this.resolved){return}results.push(x);if(--nFulfill===0){errors=null;this.resolve(results)}}function reject(e){if(this.resolved){return}errors.push(e);if(--nReject===0){results=null;this.reject(errors)}}}function map(promises,f){return Promise._traverse(f,promises)}function filter(promises,predicate){var a=slice.call(promises);return Promise._traverse(predicate,a).then(function(keep){return filterSync(a,keep)})}function filterSync(promises,keep){var l=keep.length;var filtered=new Array(l);for(var i=0,j=0;i<l;++i){if(keep[i]){filtered[j++]=Promise._handler(promises[i]).value}}filtered.length=j;return filtered}function settle(promises){return all(promises.map(settleOne))}function settleOne(p){var h=Promise._handler(p);if(h.state()===0){return toPromise(p).then(state.fulfilled,state.rejected)}h._unreport();return state.inspect(h)}function reduce(promises,f){return arguments.length>2?ar.call(promises,liftCombine(f),arguments[2]):ar.call(promises,liftCombine(f))}function reduceRight(promises,f){return arguments.length>2?arr.call(promises,liftCombine(f),arguments[2]):arr.call(promises,liftCombine(f))}function liftCombine(f){return function(z,x,i){return applyFold(f,void 0,[z,x,i])}}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../apply":387,"../state":400}],389:[function(require,module,exports){(function(define){"use strict";define(function(){return function flow(Promise){var resolve=Promise.resolve;var reject=Promise.reject;var origCatch=Promise.prototype["catch"];Promise.prototype.done=function(onResult,onError){this._handler.visit(this._handler.receiver,onResult,onError)};Promise.prototype["catch"]=Promise.prototype.otherwise=function(onRejected){if(arguments.length<2){return origCatch.call(this,onRejected)}if(typeof onRejected!=="function"){return this.ensure(rejectInvalidPredicate)}return origCatch.call(this,createCatchFilter(arguments[1],onRejected))};function createCatchFilter(handler,predicate){return function(e){return evaluatePredicate(e,predicate)?handler.call(this,e):reject(e)}}Promise.prototype["finally"]=Promise.prototype.ensure=function(handler){if(typeof handler!=="function"){return this}return this.then(function(x){return runSideEffect(handler,this,identity,x)},function(e){return runSideEffect(handler,this,reject,e)})};function runSideEffect(handler,thisArg,propagate,value){var result=handler.call(thisArg);return maybeThenable(result)?propagateValue(result,propagate,value):propagate(value)}function propagateValue(result,propagate,x){return resolve(result).then(function(){return propagate(x)})}Promise.prototype["else"]=Promise.prototype.orElse=function(defaultValue){return this.then(void 0,function(){return defaultValue})};Promise.prototype["yield"]=function(value){return this.then(function(){return value})};Promise.prototype.tap=function(onFulfilledSideEffect){return this.then(onFulfilledSideEffect)["yield"](this)};return Promise};function rejectInvalidPredicate(){throw new TypeError("catch predicate must be a function")}function evaluatePredicate(e,predicate){return isError(predicate)?e instanceof predicate:predicate(e)}function isError(predicate){return predicate===Error||predicate!=null&&predicate.prototype instanceof Error}function maybeThenable(x){return(typeof x==="object"||typeof x==="function")&&x!==null}function identity(x){return x}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],390:[function(require,module,exports){(function(define){"use strict";define(function(){return function fold(Promise){Promise.prototype.fold=function(f,z){var promise=this._beget();this._handler.fold(function(z,x,to){Promise._handler(z).fold(function(x,z,to){to.resolve(f.call(this,z,x))},x,this,to)},z,promise._handler.receiver,promise._handler);return promise};return Promise}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],391:[function(require,module,exports){(function(define){"use strict";define(function(require){var inspect=require("../state").inspect;return function inspection(Promise){Promise.prototype.inspect=function(){return inspect(Promise._handler(this))};return Promise}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../state":400}],392:[function(require,module,exports){(function(define){"use strict";define(function(){return function generate(Promise){var resolve=Promise.resolve;Promise.iterate=iterate;Promise.unfold=unfold;return Promise;function iterate(f,condition,handler,x){return unfold(function(x){return[x,f(x)]},condition,handler,x)}function unfold(unspool,condition,handler,x){return resolve(x).then(function(seed){return resolve(condition(seed)).then(function(done){return done?seed:resolve(unspool(seed)).spread(next)})});function next(item,newSeed){return resolve(handler(item)).then(function(){return unfold(unspool,condition,handler,newSeed)})}}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],393:[function(require,module,exports){(function(define){"use strict";define(function(){return function progress(Promise){Promise.prototype.progress=function(onProgress){return this.then(void 0,void 0,onProgress)};return Promise}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],394:[function(require,module,exports){(function(define){"use strict";define(function(require){var env=require("../env");var TimeoutError=require("../TimeoutError");function setTimeout(f,ms,x,y){return env.setTimer(function(){f(x,y,ms)},ms)}return function timed(Promise){Promise.prototype.delay=function(ms){var p=this._beget();this._handler.fold(handleDelay,ms,void 0,p._handler);return p};function handleDelay(ms,x,h){setTimeout(resolveDelay,ms,x,h)}function resolveDelay(x,h){h.resolve(x)}Promise.prototype.timeout=function(ms,reason){var p=this._beget();var h=p._handler;var t=setTimeout(onTimeout,ms,reason,p._handler);this._handler.visit(h,function onFulfill(x){env.clearTimer(t);this.resolve(x)},function onReject(x){env.clearTimer(t);this.reject(x)},h.notify);return p};function onTimeout(reason,h,ms){var e=typeof reason==="undefined"?new TimeoutError("timed out after "+ms+"ms"):reason;h.reject(e)}return Promise}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../TimeoutError":386,"../env":397}],395:[function(require,module,exports){(function(define){"use strict";define(function(require){var setTimer=require("../env").setTimer;var format=require("../format");return function unhandledRejection(Promise){var logError=noop;var logInfo=noop;var localConsole;if(typeof console!=="undefined"){localConsole=console;logError=typeof localConsole.error!=="undefined"?function(e){localConsole.error(e)}:function(e){localConsole.log(e)};logInfo=typeof localConsole.info!=="undefined"?function(e){localConsole.info(e)}:function(e){localConsole.log(e)}}Promise.onPotentiallyUnhandledRejection=function(rejection){enqueue(report,rejection)};Promise.onPotentiallyUnhandledRejectionHandled=function(rejection){enqueue(unreport,rejection)};Promise.onFatalRejection=function(rejection){enqueue(throwit,rejection.value)};var tasks=[];var reported=[];var running=null;function report(r){if(!r.handled){reported.push(r);logError("Potentially unhandled rejection ["+r.id+"] "+format.formatError(r.value))}}function unreport(r){var i=reported.indexOf(r);if(i>=0){reported.splice(i,1);logInfo("Handled previous rejection ["+r.id+"] "+format.formatObject(r.value))}}function enqueue(f,x){tasks.push(f,x);if(running===null){running=setTimer(flush,0)}}function flush(){running=null;while(tasks.length>0){tasks.shift()(tasks.shift())}}return Promise};function throwit(e){throw e}function noop(){}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"../env":397,"../format":398}],396:[function(require,module,exports){(function(define){"use strict";define(function(){return function addWith(Promise){Promise.prototype["with"]=Promise.prototype.withThis=function(receiver){
var p=this._beget();var child=p._handler;child.receiver=receiver;this._handler.chain(child,receiver);return p};return Promise}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],397:[function(require,module,exports){(function(process){(function(define){"use strict";define(function(require){var MutationObs;var capturedSetTimeout=typeof setTimeout!=="undefined"&&setTimeout;var setTimer=function(f,ms){return setTimeout(f,ms)};var clearTimer=function(t){return clearTimeout(t)};var asap=function(f){return capturedSetTimeout(f,0)};if(isNode()){asap=function(f){return process.nextTick(f)}}else if(MutationObs=hasMutationObserver()){asap=initMutationObserver(MutationObs)}else if(!capturedSetTimeout){var vertxRequire=require;var vertx=vertxRequire("vertx");setTimer=function(f,ms){return vertx.setTimer(ms,f)};clearTimer=vertx.cancelTimer;asap=vertx.runOnLoop||vertx.runOnContext}return{setTimer:setTimer,clearTimer:clearTimer,asap:asap};function isNode(){return typeof process!=="undefined"&&Object.prototype.toString.call(process)==="[object process]"}function hasMutationObserver(){return typeof MutationObserver==="function"&&MutationObserver||typeof WebKitMutationObserver==="function"&&WebKitMutationObserver}function initMutationObserver(MutationObserver){var scheduled;var node=document.createTextNode("");var o=new MutationObserver(run);o.observe(node,{characterData:true});function run(){var f=scheduled;scheduled=void 0;f()}var i=0;return function(f){scheduled=f;node.data=i^=1}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})}).call(this,require("_process"))},{_process:6}],398:[function(require,module,exports){(function(define){"use strict";define(function(){return{formatError:formatError,formatObject:formatObject,tryStringify:tryStringify};function formatError(e){var s=typeof e==="object"&&e!==null&&(e.stack||e.message)?e.stack||e.message:formatObject(e);return e instanceof Error?s:s+" (WARNING: non-Error used)"}function formatObject(o){var s=String(o);if(s==="[object Object]"&&typeof JSON!=="undefined"){s=tryStringify(o,s)}return s}function tryStringify(x,defaultValue){try{return JSON.stringify(x)}catch(e){return defaultValue}}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],399:[function(require,module,exports){(function(process){(function(define){"use strict";define(function(){return function makePromise(environment){var tasks=environment.scheduler;var emitRejection=initEmitRejection();var objectCreate=Object.create||function(proto){function Child(){}Child.prototype=proto;return new Child};function Promise(resolver,handler){this._handler=resolver===Handler?handler:init(resolver)}function init(resolver){var handler=new Pending;try{resolver(promiseResolve,promiseReject,promiseNotify)}catch(e){promiseReject(e)}return handler;function promiseResolve(x){handler.resolve(x)}function promiseReject(reason){handler.reject(reason)}function promiseNotify(x){handler.notify(x)}}Promise.resolve=resolve;Promise.reject=reject;Promise.never=never;Promise._defer=defer;Promise._handler=getHandler;function resolve(x){return isPromise(x)?x:new Promise(Handler,new Async(getHandler(x)))}function reject(x){return new Promise(Handler,new Async(new Rejected(x)))}function never(){return foreverPendingPromise}function defer(){return new Promise(Handler,new Pending)}Promise.prototype.then=function(onFulfilled,onRejected,onProgress){var parent=this._handler;var state=parent.join().state();if(typeof onFulfilled!=="function"&&state>0||typeof onRejected!=="function"&&state<0){return new this.constructor(Handler,parent)}var p=this._beget();var child=p._handler;parent.chain(child,parent.receiver,onFulfilled,onRejected,onProgress);return p};Promise.prototype["catch"]=function(onRejected){return this.then(void 0,onRejected)};Promise.prototype._beget=function(){return begetFrom(this._handler,this.constructor)};function begetFrom(parent,Promise){var child=new Pending(parent.receiver,parent.join().context);return new Promise(Handler,child)}Promise.all=all;Promise.race=race;Promise._traverse=traverse;function all(promises){return traverseWith(snd,null,promises)}function traverse(f,promises){return traverseWith(tryCatch2,f,promises)}function traverseWith(tryMap,f,promises){var handler=typeof f==="function"?mapAt:settleAt;var resolver=new Pending;var pending=promises.length>>>0;var results=new Array(pending);for(var i=0,x;i<promises.length&&!resolver.resolved;++i){x=promises[i];if(x===void 0&&!(i in promises)){--pending;continue}traverseAt(promises,handler,i,x,resolver)}if(pending===0){resolver.become(new Fulfilled(results))}return new Promise(Handler,resolver);function mapAt(i,x,resolver){if(!resolver.resolved){traverseAt(promises,settleAt,i,tryMap(f,x,i),resolver)}}function settleAt(i,x,resolver){results[i]=x;if(--pending===0){resolver.become(new Fulfilled(results))}}}function traverseAt(promises,handler,i,x,resolver){if(maybeThenable(x)){var h=getHandlerMaybeThenable(x);var s=h.state();if(s===0){h.fold(handler,i,void 0,resolver)}else if(s>0){handler(i,h.value,resolver)}else{resolver.become(h);visitRemaining(promises,i+1,h)}}else{handler(i,x,resolver)}}Promise._visitRemaining=visitRemaining;function visitRemaining(promises,start,handler){for(var i=start;i<promises.length;++i){markAsHandled(getHandler(promises[i]),handler)}}function markAsHandled(h,handler){if(h===handler){return}var s=h.state();if(s===0){h.visit(h,void 0,h._unreport)}else if(s<0){h._unreport()}}function race(promises){if(typeof promises!=="object"||promises===null){return reject(new TypeError("non-iterable passed to race()"))}return promises.length===0?never():promises.length===1?resolve(promises[0]):runRace(promises)}function runRace(promises){var resolver=new Pending;var i,x,h;for(i=0;i<promises.length;++i){x=promises[i];if(x===void 0&&!(i in promises)){continue}h=getHandler(x);if(h.state()!==0){resolver.become(h);visitRemaining(promises,i+1,h);break}else{h.visit(resolver,resolver.resolve,resolver.reject)}}return new Promise(Handler,resolver)}function getHandler(x){if(isPromise(x)){return x._handler.join()}return maybeThenable(x)?getHandlerUntrusted(x):new Fulfilled(x)}function getHandlerMaybeThenable(x){return isPromise(x)?x._handler.join():getHandlerUntrusted(x)}function getHandlerUntrusted(x){try{var untrustedThen=x.then;return typeof untrustedThen==="function"?new Thenable(untrustedThen,x):new Fulfilled(x)}catch(e){return new Rejected(e)}}function Handler(){}Handler.prototype.when=Handler.prototype.become=Handler.prototype.notify=Handler.prototype.fail=Handler.prototype._unreport=Handler.prototype._report=noop;Handler.prototype._state=0;Handler.prototype.state=function(){return this._state};Handler.prototype.join=function(){var h=this;while(h.handler!==void 0){h=h.handler}return h};Handler.prototype.chain=function(to,receiver,fulfilled,rejected,progress){this.when({resolver:to,receiver:receiver,fulfilled:fulfilled,rejected:rejected,progress:progress})};Handler.prototype.visit=function(receiver,fulfilled,rejected,progress){this.chain(failIfRejected,receiver,fulfilled,rejected,progress)};Handler.prototype.fold=function(f,z,c,to){this.when(new Fold(f,z,c,to))};function FailIfRejected(){}inherit(Handler,FailIfRejected);FailIfRejected.prototype.become=function(h){h.fail()};var failIfRejected=new FailIfRejected;function Pending(receiver,inheritedContext){Promise.createContext(this,inheritedContext);this.consumers=void 0;this.receiver=receiver;this.handler=void 0;this.resolved=false}inherit(Handler,Pending);Pending.prototype._state=0;Pending.prototype.resolve=function(x){this.become(getHandler(x))};Pending.prototype.reject=function(x){if(this.resolved){return}this.become(new Rejected(x))};Pending.prototype.join=function(){if(!this.resolved){return this}var h=this;while(h.handler!==void 0){h=h.handler;if(h===this){return this.handler=cycle()}}return h};Pending.prototype.run=function(){var q=this.consumers;var handler=this.handler;this.handler=this.handler.join();this.consumers=void 0;for(var i=0;i<q.length;++i){handler.when(q[i])}};Pending.prototype.become=function(handler){if(this.resolved){return}this.resolved=true;this.handler=handler;if(this.consumers!==void 0){tasks.enqueue(this)}if(this.context!==void 0){handler._report(this.context)}};Pending.prototype.when=function(continuation){if(this.resolved){tasks.enqueue(new ContinuationTask(continuation,this.handler))}else{if(this.consumers===void 0){this.consumers=[continuation]}else{this.consumers.push(continuation)}}};Pending.prototype.notify=function(x){if(!this.resolved){tasks.enqueue(new ProgressTask(x,this))}};Pending.prototype.fail=function(context){var c=typeof context==="undefined"?this.context:context;this.resolved&&this.handler.join().fail(c)};Pending.prototype._report=function(context){this.resolved&&this.handler.join()._report(context)};Pending.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()};function Async(handler){this.handler=handler}inherit(Handler,Async);Async.prototype.when=function(continuation){tasks.enqueue(new ContinuationTask(continuation,this))};Async.prototype._report=function(context){this.join()._report(context)};Async.prototype._unreport=function(){this.join()._unreport()};function Thenable(then,thenable){Pending.call(this);tasks.enqueue(new AssimilateTask(then,thenable,this))}inherit(Pending,Thenable);function Fulfilled(x){Promise.createContext(this);this.value=x}inherit(Handler,Fulfilled);Fulfilled.prototype._state=1;Fulfilled.prototype.fold=function(f,z,c,to){runContinuation3(f,z,this,c,to)};Fulfilled.prototype.when=function(cont){runContinuation1(cont.fulfilled,this,cont.receiver,cont.resolver)};var errorId=0;function Rejected(x){Promise.createContext(this);this.id=++errorId;this.value=x;this.handled=false;this.reported=false;this._report()}inherit(Handler,Rejected);Rejected.prototype._state=-1;Rejected.prototype.fold=function(f,z,c,to){to.become(this)};Rejected.prototype.when=function(cont){if(typeof cont.rejected==="function"){this._unreport()}runContinuation1(cont.rejected,this,cont.receiver,cont.resolver)};Rejected.prototype._report=function(context){tasks.afterQueue(new ReportTask(this,context))};Rejected.prototype._unreport=function(){if(this.handled){return}this.handled=true;tasks.afterQueue(new UnreportTask(this))};Rejected.prototype.fail=function(context){this.reported=true;emitRejection("unhandledRejection",this);Promise.onFatalRejection(this,context===void 0?this.context:context)};function ReportTask(rejection,context){this.rejection=rejection;this.context=context}ReportTask.prototype.run=function(){if(!this.rejection.handled&&!this.rejection.reported){this.rejection.reported=true;emitRejection("unhandledRejection",this.rejection)||Promise.onPotentiallyUnhandledRejection(this.rejection,this.context)}};function UnreportTask(rejection){this.rejection=rejection}UnreportTask.prototype.run=function(){if(this.rejection.reported){emitRejection("rejectionHandled",this.rejection)||Promise.onPotentiallyUnhandledRejectionHandled(this.rejection)}};Promise.createContext=Promise.enterContext=Promise.exitContext=Promise.onPotentiallyUnhandledRejection=Promise.onPotentiallyUnhandledRejectionHandled=Promise.onFatalRejection=noop;var foreverPendingHandler=new Handler;var foreverPendingPromise=new Promise(Handler,foreverPendingHandler);function cycle(){return new Rejected(new TypeError("Promise cycle"))}function ContinuationTask(continuation,handler){this.continuation=continuation;this.handler=handler}ContinuationTask.prototype.run=function(){this.handler.join().when(this.continuation)};function ProgressTask(value,handler){this.handler=handler;this.value=value}ProgressTask.prototype.run=function(){var q=this.handler.consumers;if(q===void 0){return}for(var c,i=0;i<q.length;++i){c=q[i];runNotify(c.progress,this.value,this.handler,c.receiver,c.resolver)}};function AssimilateTask(then,thenable,resolver){this._then=then;this.thenable=thenable;this.resolver=resolver}AssimilateTask.prototype.run=function(){var h=this.resolver;tryAssimilate(this._then,this.thenable,_resolve,_reject,_notify);function _resolve(x){h.resolve(x)}function _reject(x){h.reject(x)}function _notify(x){h.notify(x)}};function tryAssimilate(then,thenable,resolve,reject,notify){try{then.call(thenable,resolve,reject,notify)}catch(e){reject(e)}}function Fold(f,z,c,to){this.f=f;this.z=z;this.c=c;this.to=to;this.resolver=failIfRejected;this.receiver=this}Fold.prototype.fulfilled=function(x){this.f.call(this.c,this.z,x,this.to)};Fold.prototype.rejected=function(x){this.to.reject(x)};Fold.prototype.progress=function(x){this.to.notify(x)};function isPromise(x){return x instanceof Promise}function maybeThenable(x){return(typeof x==="object"||typeof x==="function")&&x!==null}function runContinuation1(f,h,receiver,next){if(typeof f!=="function"){return next.become(h)}Promise.enterContext(h);tryCatchReject(f,h.value,receiver,next);Promise.exitContext()}function runContinuation3(f,x,h,receiver,next){if(typeof f!=="function"){return next.become(h)}Promise.enterContext(h);tryCatchReject3(f,x,h.value,receiver,next);Promise.exitContext()}function runNotify(f,x,h,receiver,next){if(typeof f!=="function"){return next.notify(x)}Promise.enterContext(h);tryCatchReturn(f,x,receiver,next);Promise.exitContext()}function tryCatch2(f,a,b){try{return f(a,b)}catch(e){return reject(e)}}function tryCatchReject(f,x,thisArg,next){try{next.become(getHandler(f.call(thisArg,x)))}catch(e){next.become(new Rejected(e))}}function tryCatchReject3(f,x,y,thisArg,next){try{f.call(thisArg,x,y,next)}catch(e){next.become(new Rejected(e))}}function tryCatchReturn(f,x,thisArg,next){try{next.notify(f.call(thisArg,x))}catch(e){next.notify(e)}}function inherit(Parent,Child){Child.prototype=objectCreate(Parent.prototype);Child.prototype.constructor=Child}function snd(x,y){return y}function noop(){}function initEmitRejection(){if(typeof process!=="undefined"&&process!==null&&typeof process.emit==="function"){return function(type,rejection){return type==="unhandledRejection"?process.emit(type,rejection.value,rejection):process.emit(type,rejection)}}else if(typeof self!=="undefined"&&typeof CustomEvent==="function"){return function(noop,self,CustomEvent){var hasCustomEvent=false;try{var ev=new CustomEvent("unhandledRejection");hasCustomEvent=ev instanceof CustomEvent}catch(e){}return!hasCustomEvent?noop:function(type,rejection){var ev=new CustomEvent(type,{detail:{reason:rejection.value,key:rejection},bubbles:false,cancelable:true});return!self.dispatchEvent(ev)}}(noop,self,CustomEvent)}return noop}return Promise}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})}).call(this,require("_process"))},{_process:6}],400:[function(require,module,exports){(function(define){"use strict";define(function(){return{pending:toPendingState,fulfilled:toFulfilledState,rejected:toRejectedState,inspect:inspect};function toPendingState(){return{state:"pending"}}function toRejectedState(e){return{state:"rejected",reason:e}}function toFulfilledState(x){return{state:"fulfilled",value:x}}function inspect(handler){var state=handler.state();return state===0?toPendingState():state>0?toFulfilledState(handler.value):toRejectedState(handler.value)}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],401:[function(require,module,exports){(function(define){"use strict";define(function(require){var timed=require("./lib/decorators/timed");var array=require("./lib/decorators/array");var flow=require("./lib/decorators/flow");var fold=require("./lib/decorators/fold");var inspect=require("./lib/decorators/inspect");var generate=require("./lib/decorators/iterate");var progress=require("./lib/decorators/progress");var withThis=require("./lib/decorators/with");var unhandledRejection=require("./lib/decorators/unhandledRejection");var TimeoutError=require("./lib/TimeoutError");var Promise=[array,flow,fold,generate,progress,inspect,withThis,timed,unhandledRejection].reduce(function(Promise,feature){return feature(Promise)},require("./lib/Promise"));var apply=require("./lib/apply")(Promise);when.promise=promise;when.resolve=Promise.resolve;when.reject=Promise.reject;when.lift=lift;when["try"]=attempt;when.attempt=attempt;when.iterate=Promise.iterate;when.unfold=Promise.unfold;when.join=join;when.all=all;when.settle=settle;when.any=lift(Promise.any);when.some=lift(Promise.some);when.race=lift(Promise.race);when.map=map;when.filter=filter;when.reduce=lift(Promise.reduce);when.reduceRight=lift(Promise.reduceRight);when.isPromiseLike=isPromiseLike;when.Promise=Promise;when.defer=defer;when.TimeoutError=TimeoutError;function when(x,onFulfilled,onRejected,onProgress){var p=Promise.resolve(x);if(arguments.length<2){return p}return p.then(onFulfilled,onRejected,onProgress)}function promise(resolver){return new Promise(resolver)}function lift(f){return function(){for(var i=0,l=arguments.length,a=new Array(l);i<l;++i){a[i]=arguments[i]}return apply(f,this,a)}}function attempt(f){for(var i=0,l=arguments.length-1,a=new Array(l);i<l;++i){a[i]=arguments[i+1]}return apply(f,this,a)}function defer(){return new Deferred}function Deferred(){var p=Promise._defer();function resolve(x){p._handler.resolve(x)}function reject(x){p._handler.reject(x)}function notify(x){p._handler.notify(x)}this.promise=p;this.resolve=resolve;this.reject=reject;this.notify=notify;this.resolver={resolve:resolve,reject:reject,notify:notify}}function isPromiseLike(x){return x&&typeof x.then==="function"}function join(){return Promise.all(arguments)}function all(promises){return when(promises,Promise.all)}function settle(promises){return when(promises,Promise.settle)}function map(promises,mapFunc){return when(promises,function(promises){return Promise.map(promises,mapFunc)})}function filter(promises,predicate){return when(promises,function(promises){return Promise.filter(promises,predicate)})}return when})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./lib/Promise":384,"./lib/TimeoutError":386,"./lib/apply":387,"./lib/decorators/array":388,"./lib/decorators/flow":389,"./lib/decorators/fold":390,"./lib/decorators/inspect":391,"./lib/decorators/iterate":392,"./lib/decorators/progress":393,"./lib/decorators/timed":394,"./lib/decorators/unhandledRejection":395,"./lib/decorators/with":396}],402:[function(require,module,exports){var nativeIsArray=Array.isArray;var toString=Object.prototype.toString;module.exports=nativeIsArray||isArray;function isArray(obj){return toString.call(obj)==="[object Array]"}},{}],403:[function(require,module,exports){"use strict";var APIv2Call_1=require("./api/APIv2Call");exports.APIv2Call=APIv2Call_1.APIv2Call;var APIv2_1=require("./api/APIv2");exports.APIv2=APIv2_1.APIv2;var APIv3_1=require("./api/APIv3");exports.APIv3=APIv3_1.APIv3},{"./api/APIv2":419,"./api/APIv2Call":420,"./api/APIv3":421}],404:[function(require,module,exports){"use strict";var Component_1=require("./component/Component");exports.Component=Component_1.Component;var ComponentService_1=require("./component/ComponentService");exports.ComponentService=ComponentService_1.ComponentService;var AttributionComponent_1=require("./component/AttributionComponent");exports.AttributionComponent=AttributionComponent_1.AttributionComponent;var BackgroundComponent_1=require("./component/BackgroundComponent");exports.BackgroundComponent=BackgroundComponent_1.BackgroundComponent;var BearingComponent_1=require("./component/BearingComponent");exports.BearingComponent=BearingComponent_1.BearingComponent;var CacheComponent_1=require("./component/CacheComponent");exports.CacheComponent=CacheComponent_1.CacheComponent;var CoverComponent_1=require("./component/CoverComponent");exports.CoverComponent=CoverComponent_1.CoverComponent;var DebugComponent_1=require("./component/DebugComponent");exports.DebugComponent=DebugComponent_1.DebugComponent;var DetectionComponent_1=require("./component/DetectionComponent");exports.DetectionComponent=DetectionComponent_1.DetectionComponent;var DirectionComponent_1=require("./component/direction/DirectionComponent");exports.DirectionComponent=DirectionComponent_1.DirectionComponent;var DirectionDOMCalculator_1=require("./component/direction/DirectionDOMCalculator");exports.DirectionDOMCalculator=DirectionDOMCalculator_1.DirectionDOMCalculator;var DirectionDOMRenderer_1=require("./component/direction/DirectionDOMRenderer");exports.DirectionDOMRenderer=DirectionDOMRenderer_1.DirectionDOMRenderer;var ImageComponent_1=require("./component/ImageComponent");exports.ImageComponent=ImageComponent_1.ImageComponent;var KeyboardComponent_1=require("./component/KeyboardComponent");exports.KeyboardComponent=KeyboardComponent_1.KeyboardComponent;var LoadingComponent_1=require("./component/LoadingComponent");exports.LoadingComponent=LoadingComponent_1.LoadingComponent;var Marker_1=require("./component/marker/Marker");exports.Marker=Marker_1.Marker;var MarkerComponent_1=require("./component/marker/MarkerComponent");exports.MarkerComponent=MarkerComponent_1.MarkerComponent;var MouseComponent_1=require("./component/MouseComponent");exports.MouseComponent=MouseComponent_1.MouseComponent;var NavigationComponent_1=require("./component/NavigationComponent");exports.NavigationComponent=NavigationComponent_1.NavigationComponent;var NoneComponent_1=require("./component/NoneComponent");exports.NoneComponent=NoneComponent_1.NoneComponent;var RouteComponent_1=require("./component/RouteComponent");exports.RouteComponent=RouteComponent_1.RouteComponent;var SequenceComponent_1=require("./component/sequence/SequenceComponent");exports.SequenceComponent=SequenceComponent_1.SequenceComponent;var SequenceDOMRenderer_1=require("./component/sequence/SequenceDOMRenderer");exports.SequenceDOMRenderer=SequenceDOMRenderer_1.SequenceDOMRenderer;var SequenceDOMInteraction_1=require("./component/sequence/SequenceDOMInteraction");exports.SequenceDOMInteraction=SequenceDOMInteraction_1.SequenceDOMInteraction;var ImagePlaneComponent_1=require("./component/imageplane/ImagePlaneComponent");exports.ImagePlaneComponent=ImagePlaneComponent_1.ImagePlaneComponent;var ImagePlaneFactory_1=require("./component/imageplane/ImagePlaneFactory");exports.ImagePlaneFactory=ImagePlaneFactory_1.ImagePlaneFactory;var ImagePlaneGLRenderer_1=require("./component/imageplane/ImagePlaneGLRenderer");exports.ImagePlaneGLRenderer=ImagePlaneGLRenderer_1.ImagePlaneGLRenderer;var ImagePlaneScene_1=require("./component/imageplane/ImagePlaneScene");exports.ImagePlaneScene=ImagePlaneScene_1.ImagePlaneScene;var ImagePlaneShaders_1=require("./component/imageplane/ImagePlaneShaders");exports.ImagePlaneShaders=ImagePlaneShaders_1.ImagePlaneShaders;var SimpleMarker_1=require("./component/marker/SimpleMarker");exports.SimpleMarker=SimpleMarker_1.SimpleMarker;var SliderComponent_1=require("./component/imageplane/SliderComponent");exports.SliderComponent=SliderComponent_1.SliderComponent;var StatsComponent_1=require("./component/StatsComponent");exports.StatsComponent=StatsComponent_1.StatsComponent;var Tag_1=require("./component/tag/tag/Tag");exports.Tag=Tag_1.Tag;var Alignment_1=require("./component/tag/tag/Alignment");exports.Alignment=Alignment_1.Alignment;var OutlineTag_1=require("./component/tag/tag/OutlineTag");exports.OutlineTag=OutlineTag_1.OutlineTag;var OutlineCreateTag_1=require("./component/tag/tag/OutlineCreateTag");exports.OutlineCreateTag=OutlineCreateTag_1.OutlineCreateTag;var SpotTag_1=require("./component/tag/tag/SpotTag");exports.SpotTag=SpotTag_1.SpotTag;var TagComponent_1=require("./component/tag/TagComponent");exports.TagComponent=TagComponent_1.TagComponent;var TagCreator_1=require("./component/tag/TagCreator");exports.TagCreator=TagCreator_1.TagCreator;var TagDOMRenderer_1=require("./component/tag/TagDOMRenderer");exports.TagDOMRenderer=TagDOMRenderer_1.TagDOMRenderer;var TagGLRenderer_1=require("./component/tag/TagGLRenderer");exports.TagGLRenderer=TagGLRenderer_1.TagGLRenderer;var TagOperation_1=require("./component/tag/TagOperation");exports.TagOperation=TagOperation_1.TagOperation;var TagSet_1=require("./component/tag/TagSet");exports.TagSet=TagSet_1.TagSet;var Geometry_1=require("./component/tag/geometry/Geometry");exports.Geometry=Geometry_1.Geometry;var VertexGeometry_1=require("./component/tag/geometry/VertexGeometry");exports.VertexGeometry=VertexGeometry_1.VertexGeometry;var RectGeometry_1=require("./component/tag/geometry/RectGeometry");exports.RectGeometry=RectGeometry_1.RectGeometry;var PointGeometry_1=require("./component/tag/geometry/PointGeometry");exports.PointGeometry=PointGeometry_1.PointGeometry;var PolygonGeometry_1=require("./component/tag/geometry/PolygonGeometry");exports.PolygonGeometry=PolygonGeometry_1.PolygonGeometry;var GeometryTagError_1=require("./component/tag/error/GeometryTagError");exports.GeometryTagError=GeometryTagError_1.GeometryTagError},{"./component/AttributionComponent":422,"./component/BackgroundComponent":423,"./component/BearingComponent":424,"./component/CacheComponent":425,"./component/Component":426,"./component/ComponentService":427,"./component/CoverComponent":428,"./component/DebugComponent":429,"./component/DetectionComponent":430,"./component/ImageComponent":431,"./component/KeyboardComponent":432,"./component/LoadingComponent":433,"./component/MouseComponent":434,"./component/NavigationComponent":435,"./component/NoneComponent":436,"./component/RouteComponent":437,"./component/StatsComponent":438,"./component/direction/DirectionComponent":439,"./component/direction/DirectionDOMCalculator":440,"./component/direction/DirectionDOMRenderer":441,"./component/imageplane/ImagePlaneComponent":442,"./component/imageplane/ImagePlaneFactory":443,"./component/imageplane/ImagePlaneGLRenderer":444,"./component/imageplane/ImagePlaneScene":445,"./component/imageplane/ImagePlaneShaders":446,"./component/imageplane/SliderComponent":447,"./component/marker/Marker":448,"./component/marker/MarkerComponent":449,"./component/marker/SimpleMarker":450,"./component/sequence/SequenceComponent":451,"./component/sequence/SequenceDOMInteraction":452,"./component/sequence/SequenceDOMRenderer":453,"./component/tag/TagComponent":455,"./component/tag/TagCreator":456,"./component/tag/TagDOMRenderer":457,"./component/tag/TagGLRenderer":458,"./component/tag/TagOperation":459,"./component/tag/TagSet":460,"./component/tag/error/GeometryTagError":461,"./component/tag/geometry/Geometry":462,"./component/tag/geometry/PointGeometry":463,"./component/tag/geometry/PolygonGeometry":464,"./component/tag/geometry/RectGeometry":465,"./component/tag/geometry/VertexGeometry":466,"./component/tag/tag/Alignment":467,"./component/tag/tag/OutlineCreateTag":468,"./component/tag/tag/OutlineTag":469,"./component/tag/tag/SpotTag":470,"./component/tag/tag/Tag":471}],405:[function(require,module,exports){"use strict";var EdgeDirection_1=require("./graph/edge/EdgeDirection");exports.EdgeDirection=EdgeDirection_1.EdgeDirection;var EdgeCalculatorSettings_1=require("./graph/edge/EdgeCalculatorSettings");exports.EdgeCalculatorSettings=EdgeCalculatorSettings_1.EdgeCalculatorSettings;var EdgeCalculatorDirections_1=require("./graph/edge/EdgeCalculatorDirections");exports.EdgeCalculatorDirections=EdgeCalculatorDirections_1.EdgeCalculatorDirections;var EdgeCalculatorCoefficients_1=require("./graph/edge/EdgeCalculatorCoefficients");exports.EdgeCalculatorCoefficients=EdgeCalculatorCoefficients_1.EdgeCalculatorCoefficients;var EdgeCalculator_1=require("./graph/edge/EdgeCalculator");exports.EdgeCalculator=EdgeCalculator_1.EdgeCalculator},{"./graph/edge/EdgeCalculator":493,"./graph/edge/EdgeCalculatorCoefficients":494,"./graph/edge/EdgeCalculatorDirections":495,"./graph/edge/EdgeCalculatorSettings":496,"./graph/edge/EdgeDirection":497}],406:[function(require,module,exports){"use strict";var MapillaryError_1=require("./error/MapillaryError");exports.MapillaryError=MapillaryError_1.MapillaryError;var MoveTypeMapillaryError_1=require("./error/MoveTypeMapillaryError");exports.MoveTypeMapillaryError=MoveTypeMapillaryError_1.MoveTypeMapillaryError;var NotImplementedMapillaryError_1=require("./error/NotImplementedMapillaryError");exports.NotImplementedMapillaryError=NotImplementedMapillaryError_1.NotImplementedMapillaryError;var ParameterMapillaryError_1=require("./error/ParameterMapillaryError");exports.ParameterMapillaryError=ParameterMapillaryError_1.ParameterMapillaryError;var InitializationMapillaryError_1=require("./error/InitializationMapillaryError");exports.InitializationMapillaryError=InitializationMapillaryError_1.InitializationMapillaryError},{"./error/InitializationMapillaryError":472,"./error/MapillaryError":473,"./error/MoveTypeMapillaryError":474,"./error/NotImplementedMapillaryError":475,"./error/ParameterMapillaryError":476}],407:[function(require,module,exports){"use strict";var GeoCoords_1=require("./geo/GeoCoords");exports.GeoCoords=GeoCoords_1.GeoCoords;var WebMercator_1=require("./geo/WebMercator");exports.WebMercator=WebMercator_1.WebMercator;var Spatial_1=require("./geo/Spatial");exports.Spatial=Spatial_1.Spatial;var Transform_1=require("./geo/Transform");exports.Transform=Transform_1.Transform;var Camera_1=require("./geo/Camera");exports.Camera=Camera_1.Camera},{"./geo/Camera":477,"./geo/GeoCoords":478,"./geo/Spatial":479,"./geo/Transform":480,"./geo/WebMercator":481}],408:[function(require,module,exports){"use strict";var Graph_1=require("./graph/Graph");exports.Graph=Graph_1.Graph;var GraphService_1=require("./graph/GraphService");exports.GraphService=GraphService_1.GraphService;var ImageLoader_1=require("./graph/ImageLoader");exports.ImageLoader=ImageLoader_1.ImageLoader;var ImageLoadingService_1=require("./graph/ImageLoadingService");exports.ImageLoadingService=ImageLoadingService_1.ImageLoadingService;var MapillaryObject_1=require("./graph/MapillaryObject");exports.MapillaryObject=MapillaryObject_1.MapillaryObject;var MapillaryRect_1=require("./graph/MapillaryRect");exports.MapillaryRect=MapillaryRect_1.MapillaryRect;var MeshReader_1=require("./graph/MeshReader");exports.MeshReader=MeshReader_1.MeshReader;var Node_1=require("./graph/Node");exports.Node=Node_1.Node;var Sequence_1=require("./graph/Sequence");exports.Sequence=Sequence_1.Sequence;var TilesService_1=require("./graph/TilesService");exports.TilesService=TilesService_1.TilesService;var VectorTilesService_1=require("./graph/VectorTilesService");exports.VectorTilesService=VectorTilesService_1.VectorTilesService},{"./graph/Graph":482,"./graph/GraphService":483,"./graph/ImageLoader":484,"./graph/ImageLoadingService":485,"./graph/MapillaryObject":486,"./graph/MapillaryRect":487,"./graph/MeshReader":488,"./graph/Node":489,"./graph/Sequence":490,"./graph/TilesService":491,"./graph/VectorTilesService":492}],409:[function(require,module,exports){"use strict";var Edge_1=require("./Edge");exports.EdgeDirection=Edge_1.EdgeDirection;var Render_1=require("./Render");exports.RenderMode=Render_1.RenderMode;var Viewer_1=require("./Viewer");exports.ImageSize=Viewer_1.ImageSize;exports.Viewer=Viewer_1.Viewer;var TagComponent=require("./component/tag/Tag");exports.TagComponent=TagComponent},{"./Edge":405,"./Render":410,"./Viewer":413,"./component/tag/Tag":454}],410:[function(require,module,exports){"use strict";var DOMRenderer_1=require("./render/DOMRenderer");exports.DOMRenderer=DOMRenderer_1.DOMRenderer;var GLRenderer_1=require("./render/GLRenderer");exports.GLRenderer=GLRenderer_1.GLRenderer;var GLRenderStage_1=require("./render/GLRenderStage");exports.GLRenderStage=GLRenderStage_1.GLRenderStage;var RenderCamera_1=require("./render/RenderCamera");exports.RenderCamera=RenderCamera_1.RenderCamera;var RenderMode_1=require("./render/RenderMode");exports.RenderMode=RenderMode_1.RenderMode;var RenderService_1=require("./render/RenderService");exports.RenderService=RenderService_1.RenderService;
},{"./render/DOMRenderer":498,"./render/GLRenderStage":499,"./render/GLRenderer":500,"./render/RenderCamera":501,"./render/RenderMode":502,"./render/RenderService":503}],411:[function(require,module,exports){"use strict";var FrameGenerator_1=require("./state/FrameGenerator");exports.FrameGenerator=FrameGenerator_1.FrameGenerator;var StateService_1=require("./state/StateService");exports.StateService=StateService_1.StateService;var StateContext_1=require("./state/StateContext");exports.StateContext=StateContext_1.StateContext;var State_1=require("./state/State");exports.State=State_1.State;var StateBase_1=require("./state/states/StateBase");exports.StateBase=StateBase_1.StateBase;var TraversingState_1=require("./state/states/TraversingState");exports.TraversingState=TraversingState_1.TraversingState;var WaitingState_1=require("./state/states/WaitingState");exports.WaitingState=WaitingState_1.WaitingState},{"./state/FrameGenerator":504,"./state/State":505,"./state/StateContext":506,"./state/StateService":507,"./state/states/StateBase":508,"./state/states/TraversingState":509,"./state/states/WaitingState":510}],412:[function(require,module,exports){"use strict";var EventEmitter_1=require("./utils/EventEmitter");exports.EventEmitter=EventEmitter_1.EventEmitter;var Settings_1=require("./utils/Settings");exports.Settings=Settings_1.Settings;var Urls_1=require("./utils/Urls");exports.Urls=Urls_1.Urls},{"./utils/EventEmitter":511,"./utils/Settings":512,"./utils/Urls":513}],413:[function(require,module,exports){"use strict";var Container_1=require("./viewer/Container");exports.Container=Container_1.Container;var EventLauncher_1=require("./viewer/EventLauncher");exports.EventLauncher=EventLauncher_1.EventLauncher;var ImageSize_1=require("./viewer/ImageSize");exports.ImageSize=ImageSize_1.ImageSize;var LoadingService_1=require("./viewer/LoadingService");exports.LoadingService=LoadingService_1.LoadingService;var MouseService_1=require("./viewer/MouseService");exports.MouseService=MouseService_1.MouseService;var Navigator_1=require("./viewer/Navigator");exports.Navigator=Navigator_1.Navigator;var ComponentController_1=require("./viewer/ComponentController");exports.ComponentController=ComponentController_1.ComponentController;var SpriteAlignment_1=require("./viewer/SpriteAlignment");exports.SpriteAlignment=SpriteAlignment_1.SpriteAlignment;var SpriteService_1=require("./viewer/SpriteService");exports.SpriteService=SpriteService_1.SpriteService;var TouchService_1=require("./viewer/TouchService");exports.TouchService=TouchService_1.TouchService;exports.TouchMove=TouchService_1.TouchMove;var Viewer_1=require("./viewer/Viewer");exports.Viewer=Viewer_1.Viewer},{"./viewer/ComponentController":514,"./viewer/Container":515,"./viewer/EventLauncher":516,"./viewer/ImageSize":517,"./viewer/LoadingService":518,"./viewer/MouseService":519,"./viewer/Navigator":520,"./viewer/SpriteAlignment":521,"./viewer/SpriteService":522,"./viewer/TouchService":523,"./viewer/Viewer":524}],414:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var API_1=require("../API");var APIIm=function(_super){__extends(APIIm,_super);function APIIm(){_super.apply(this,arguments)}APIIm.prototype.callOr=function(imageId){return this.callApi("im/"+imageId+"/or")};return APIIm}(API_1.APIv2Call);exports.APIIm=APIIm;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APIIm},{"../API":403}],415:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var API_1=require("../API");var APINav=function(_super){__extends(APINav,_super);function APINav(){_super.apply(this,arguments)}APINav.prototype.callNav=function(path){return this.callApi("nav/"+path)};APINav.prototype.h=function(id){return this.callNav("h/"+id)};APINav.prototype.im=function(key){return this.callNav("im/"+key)};return APINav}(API_1.APIv2Call);exports.APINav=APINav;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APINav},{"../API":403}],416:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var API_1=require("../API");var APIS=function(_super){__extends(APIS,_super);function APIS(){_super.apply(this,arguments)}APIS.prototype.callS=function(path){return this.callApi("s/"+path)};APIS.prototype.get=function(sequenceKey){return this.callS(sequenceKey)};return APIS}(API_1.APIv2Call);exports.APIS=APIS;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APIS},{"../API":403}],417:[function(require,module,exports){"use strict";var APISearchIm_1=require("./APISearchIm");var APISearch=function(){function APISearch(clientId){this._clientId=clientId;this.im=new APISearchIm_1.default(clientId)}APISearch.prototype.auth=function(token,projectKey){this.im.auth(token,projectKey)};return APISearch}();exports.APISearch=APISearch;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APISearch},{"./APISearchIm":418}],418:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var API_1=require("../API");var APISearchIm=function(_super){__extends(APISearchIm,_super);function APISearchIm(){_super.apply(this,arguments)}APISearchIm.prototype.callSearchIm=function(path){return this.callApi("search/im/"+path)};APISearchIm.prototype.close2=function(lat,lon){return this.callSearchIm("close2?lat="+lat+"&lon="+lon)};return APISearchIm}(API_1.APIv2Call);exports.APISearchIm=APISearchIm;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APISearchIm},{"../API":403}],419:[function(require,module,exports){"use strict";var APIIm_1=require("./APIIm");var APINav_1=require("./APINav");var APISearch_1=require("./APISearch");var APIS_1=require("./APIS");var APIv2=function(){function APIv2(clientId){this._clientId=clientId;this.im=new APIIm_1.default(clientId);this.nav=new APINav_1.default(clientId);this.s=new APIS_1.default(clientId);this.search=new APISearch_1.default(clientId)}APIv2.prototype.auth=function(token,projectKey){this.im.auth(token,projectKey);this.nav.auth(token,projectKey);this.s.auth(token,projectKey);this.search.auth(token,projectKey)};return APIv2}();exports.APIv2=APIv2;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APIv2},{"./APIIm":414,"./APINav":415,"./APIS":416,"./APISearch":417}],420:[function(require,module,exports){"use strict";var rest=require("rest");var mime=require("rest/interceptor/mime");var oAuth=require("rest/interceptor/oAuth");var APIv2Call=function(){function APIv2Call(clientId){this._clientId=clientId;this._projectKey=null;this._httpsUrl="https://a.mapillary.com/v2/";this._client=this._createClient()}APIv2Call.prototype.auth=function(token,projectKey){this._client=this._createClient(token);this._projectKey=projectKey};APIv2Call.prototype.callApi=function(path){var uri=this._httpsUrl+path;var projectParam=!!this._projectKey?"&project="+this._projectKey:"";if(path.indexOf("?")>-1){uri+="&client_id="+this._clientId+projectParam}else{uri+="?client_id="+this._clientId+projectParam}return this._client(uri).entity()};APIv2Call.prototype._createClient=function(token){var client=rest.wrap(mime);if(!!token){client=client.wrap(oAuth,{token:"bearer "+token})}return client};return APIv2Call}();exports.APIv2Call=APIv2Call;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APIv2Call},{rest:197,"rest/interceptor/mime":202,"rest/interceptor/oAuth":203}],421:[function(require,module,exports){"use strict";var falcor=require("falcor");var HttpDataSource=require("falcor-http-datasource");var Utils_1=require("../Utils");var APIv3=function(){function APIv3(clientId){this._clientId=clientId;this._model=new falcor.Model({source:new HttpDataSource(Utils_1.Urls.falcorModel(clientId),{crossDomain:true,withCredentials:false})});this._modelMagic=new falcor.Model({source:new HttpDataSource(Utils_1.Urls.falcorModelMagic(clientId),{crossDomain:true,withCredentials:false})}).batch(10)}Object.defineProperty(APIv3.prototype,"model",{get:function(){return this._model},enumerable:true,configurable:true});Object.defineProperty(APIv3.prototype,"modelMagic",{get:function(){return this._modelMagic},enumerable:true,configurable:true});Object.defineProperty(APIv3.prototype,"clientId",{get:function(){return this._clientId},enumerable:true,configurable:true});return APIv3}();exports.APIv3=APIv3;Object.defineProperty(exports,"__esModule",{value:true});exports.default=APIv3},{"../Utils":412,falcor:65,"falcor-http-datasource":10}],422:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");var Component_1=require("../Component");var AttributionComponent=function(_super){__extends(AttributionComponent,_super);function AttributionComponent(name,container,navigator){_super.call(this,name,container,navigator)}AttributionComponent.prototype._activate=function(){var _this=this;this._disposable=this._navigator.stateService.currentNode$.map(function(node){return{name:_this._name,vnode:_this._getAttributionNode(node.user,node.key)}}).subscribe(this._container.domRenderer.render$)};AttributionComponent.prototype._deactivate=function(){this._disposable.unsubscribe()};AttributionComponent.prototype._getAttributionNode=function(username,photoId){return vd.h("div.Attribution",{},[vd.h("a",{href:"https://www.mapillary.com/app/user/"+username,target:"_blank",textContent:"@"+username},[]),vd.h("span",{textContent:"|"},[]),vd.h("a",{href:"https://www.mapillary.com/app/?pKey="+photoId+"&focus=photo",target:"_blank",textContent:"mapillary.com"},[])])};AttributionComponent.componentName="attribution";return AttributionComponent}(Component_1.Component);exports.AttributionComponent=AttributionComponent;Component_1.ComponentService.register(AttributionComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=AttributionComponent},{"../Component":404,"virtual-dom":360}],423:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");var Component_1=require("../Component");var BackgroundComponent=function(_super){__extends(BackgroundComponent,_super);function BackgroundComponent(name,container,navigator){_super.call(this,name,container,navigator)}BackgroundComponent.prototype._activate=function(){this._container.domRenderer.render$.next({name:this._name,vnode:this._getBackgroundNode("The viewer can't display the given photo.")})};BackgroundComponent.prototype._deactivate=function(){return};BackgroundComponent.prototype._getBackgroundNode=function(notice){return vd.h("div.BackgroundWrapper",{},[vd.h("p",{textContent:notice},[])])};BackgroundComponent.componentName="background";return BackgroundComponent}(Component_1.Component);exports.BackgroundComponent=BackgroundComponent;Component_1.ComponentService.register(BackgroundComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=BackgroundComponent},{"../Component":404,"virtual-dom":360}],424:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");var Component_1=require("../Component");var BearingComponent=function(_super){__extends(BearingComponent,_super);function BearingComponent(name,container,navigator){_super.call(this,name,container,navigator)}BearingComponent.prototype._activate=function(){var _this=this;this._renderSubscription=this._navigator.stateService.currentNode$.map(function(node){return node.fullPano}).map(function(pano){return{name:_this._name,vnode:pano?vd.h("div.BearingIndicator",{},[]):vd.h("div",{},[])}}).subscribe(this._container.domRenderer.render$)};BearingComponent.prototype._deactivate=function(){this._renderSubscription.unsubscribe()};BearingComponent.componentName="bearing";return BearingComponent}(Component_1.Component);exports.BearingComponent=BearingComponent;Component_1.ComponentService.register(BearingComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=BearingComponent},{"../Component":404,"virtual-dom":360}],425:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("rxjs/Observable");require("rxjs/add/observable/combineLatest");require("rxjs/add/observable/merge");require("rxjs/add/observable/of");require("rxjs/add/observable/zip");require("rxjs/add/operator/distinct");require("rxjs/add/operator/expand");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeAll");require("rxjs/add/operator/skip");require("rxjs/add/operator/switchMap");var Edge_1=require("../Edge");var Component_1=require("../Component");var CacheComponent=function(_super){__extends(CacheComponent,_super);function CacheComponent(name,container,navigator){_super.call(this,name,container,navigator)}Object.defineProperty(CacheComponent.prototype,"defaultConfiguration",{get:function(){return{depth:{pano:1,sequence:2,step:1,turn:0}}},enumerable:true,configurable:true});CacheComponent.prototype.setDepth=function(depth){this.configure({depth:depth})};CacheComponent.prototype._activate=function(){var _this=this;this._cacheSubscription=Observable_1.Observable.combineLatest(this._navigator.stateService.currentNode$,this._configuration$).switchMap(function(nc){var node=nc[0];var configuration=nc[1];var depth=configuration.depth;var sequenceDepth=Math.max(0,Math.min(4,depth.sequence));var panoDepth=Math.max(0,Math.min(2,depth.pano));var stepDepth=node.pano?0:Math.max(0,Math.min(3,depth.step));var turnDepth=node.pano?0:Math.max(0,Math.min(1,depth.turn));var next$=_this._cache$(node,Edge_1.EdgeDirection.Next,sequenceDepth);var prev$=_this._cache$(node,Edge_1.EdgeDirection.Prev,sequenceDepth);var pano$=_this._cache$(node,Edge_1.EdgeDirection.Pano,panoDepth);var forward$=_this._cache$(node,Edge_1.EdgeDirection.StepForward,stepDepth);var backward$=_this._cache$(node,Edge_1.EdgeDirection.StepBackward,stepDepth);var left$=_this._cache$(node,Edge_1.EdgeDirection.StepLeft,stepDepth);var right$=_this._cache$(node,Edge_1.EdgeDirection.StepRight,stepDepth);var turnLeft$=_this._cache$(node,Edge_1.EdgeDirection.TurnLeft,turnDepth);var turnRight$=_this._cache$(node,Edge_1.EdgeDirection.TurnRight,turnDepth);var turnU$=_this._cache$(node,Edge_1.EdgeDirection.TurnU,turnDepth);return Observable_1.Observable.merge(next$,prev$,forward$,backward$,left$,right$,pano$,turnLeft$,turnRight$,turnU$).distinct(function(n1,n2){return n1.key===n2.key})}).subscribe(function(n){return},function(e){console.error(e)})};CacheComponent.prototype._deactivate=function(){this._cacheSubscription.unsubscribe()};CacheComponent.prototype._cache$=function(node,direction,depth){var _this=this;return Observable_1.Observable.of([node,depth]).expand(function(nd){var n=nd[0];var d=nd[1];var nodes$=[];if(d>0){for(var _i=0,_a=n.edges;_i<_a.length;_i++){var edge=_a[_i];if(edge.data.direction===direction){nodes$.push(Observable_1.Observable.zip(_this._navigator.graphService.node$(edge.to),Observable_1.Observable.of(d-1)))}}}return Observable_1.Observable.from(nodes$).mergeAll()}).skip(1).map(function(nd){return nd[0]})};CacheComponent.componentName="cache";return CacheComponent}(Component_1.Component);exports.CacheComponent=CacheComponent;Component_1.ComponentService.register(CacheComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=CacheComponent},{"../Component":404,"../Edge":405,"rxjs/Observable":226,"rxjs/add/observable/combineLatest":234,"rxjs/add/observable/merge":239,"rxjs/add/observable/of":240,"rxjs/add/observable/zip":242,"rxjs/add/operator/distinct":248,"rxjs/add/operator/expand":251,"rxjs/add/operator/map":255,"rxjs/add/operator/mergeAll":257,"rxjs/add/operator/skip":265,"rxjs/add/operator/switchMap":269}],426:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Utils_1=require("../Utils");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/startWith");var BehaviorSubject_1=require("rxjs/BehaviorSubject");var Subject_1=require("rxjs/Subject");var Component=function(_super){__extends(Component,_super);function Component(name,container,navigator){_super.call(this);this._activated$=new BehaviorSubject_1.BehaviorSubject(false);this._configurationSubject$=new Subject_1.Subject;this._navigator=navigator;this._container=container;this._activated=false;this._name=name;this._configuration$=this._configurationSubject$.startWith(this.defaultConfiguration).scan(function(conf,newConf){for(var key in newConf){if(newConf.hasOwnProperty(key)){conf[key]=newConf[key]}}return conf}).publishReplay(1).refCount();this._configuration$.subscribe()}Object.defineProperty(Component.prototype,"activated",{get:function(){return this._activated},enumerable:true,configurable:true});Object.defineProperty(Component.prototype,"activated$",{get:function(){return this._activated$},enumerable:true,configurable:true});Object.defineProperty(Component.prototype,"defaultConfiguration",{get:function(){return{}},enumerable:true,configurable:true});Object.defineProperty(Component.prototype,"configuration$",{get:function(){return this._configuration$},enumerable:true,configurable:true});Component.prototype.activate=function(conf){if(this._activated){return}if(conf!==undefined){this._configurationSubject$.next(conf)}this._activate();this._activated=true;this._activated$.next(true)};Component.prototype.configure=function(conf){this._configurationSubject$.next(conf)};Component.prototype.deactivate=function(){if(!this._activated){return}this._deactivate();this._container.domRenderer.clear(this._name);this._container.glRenderer.clear(this._name);this._activated=false;this._activated$.next(false)};Component.prototype.resize=function(){return};Component.componentName="not_worthy";return Component}(Utils_1.EventEmitter);exports.Component=Component;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Component},{"../Utils":412,"rxjs/BehaviorSubject":223,"rxjs/Subject":230,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/startWith":268}],427:[function(require,module,exports){"use strict";var _=require("underscore");var Error_1=require("../Error");var ComponentService=function(){function ComponentService(container,navigator){this._components={};this._container=container;this._navigator=navigator;for(var _i=0,_a=_.values(ComponentService.registeredComponents);_i<_a.length;_i++){var component=_a[_i];this._components[component.componentName]={active:false,component:new component(component.componentName,container,navigator)}}this._coverComponent=new ComponentService.registeredCoverComponent("cover",container,navigator);this._coverComponent.activate();this._coverActivated=true}ComponentService.register=function(component){if(ComponentService.registeredComponents[component.componentName]===undefined){ComponentService.registeredComponents[component.componentName]=component}};ComponentService.registerCover=function(coverComponent){ComponentService.registeredCoverComponent=coverComponent};ComponentService.prototype.activateCover=function(){if(this._coverActivated){return}this._coverActivated=true;for(var _i=0,_a=_.values(this._components);_i<_a.length;_i++){var component=_a[_i];if(component.active){component.component.deactivate()}}return};ComponentService.prototype.deactivateCover=function(){if(!this._coverActivated){return}this._coverActivated=false;for(var _i=0,_a=_.values(this._components);_i<_a.length;_i++){var component=_a[_i];if(component.active){component.component.activate()}}return};ComponentService.prototype.activate=function(name){this._checkName(name);this._components[name].active=true;if(!this._coverActivated){this.get(name).activate()}};ComponentService.prototype.configure=function(name,conf){this._checkName(name);this.get(name).configure(conf)};ComponentService.prototype.deactivate=function(name){this._checkName(name);this._components[name].active=false;if(!this._coverActivated){this.get(name).deactivate()}};ComponentService.prototype.resize=function(){for(var _i=0,_a=_.values(this._components);_i<_a.length;_i++){var component=_a[_i];component.component.resize()}};ComponentService.prototype.get=function(name){return this._components[name].component};ComponentService.prototype.getCover=function(){return this._coverComponent};ComponentService.prototype._checkName=function(name){if(!(name in this._components)){throw new Error_1.ParameterMapillaryError("Component does not exist: "+name)}};ComponentService.registeredComponents={};return ComponentService}();exports.ComponentService=ComponentService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=ComponentService},{"../Error":406,underscore:355}],428:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/withLatestFrom");var Component_1=require("../Component");var CoverComponent=function(_super){__extends(CoverComponent,_super);function CoverComponent(name,container,navigator){_super.call(this,name,container,navigator)}CoverComponent.prototype._activate=function(){var _this=this;this._keyDisposable=this._navigator.stateService.currentNode$.withLatestFrom(this._configuration$,function(node,configuration){return[node,configuration]}).filter(function(nc){return nc[0].key!==nc[1].key}).map(function(nc){return nc[0]}).map(function(node){return{key:node.key,src:node.image.src}}).subscribe(this._configurationSubject$);this._disposable=this._configuration$.map(function(conf){if(!conf.key){return{name:_this._name,vnode:vd.h("div",[])}}if(!conf.visible){return{name:_this._name,vnode:vd.h("div.Cover.CoverDone",[_this._getCoverBackgroundVNode(conf)])}}return{name:_this._name,vnode:_this._getCoverButtonVNode(conf)}}).subscribe(this._container.domRenderer.render$)};CoverComponent.prototype._deactivate=function(){this._disposable.unsubscribe();this._keyDisposable.unsubscribe()};Object.defineProperty(CoverComponent.prototype,"defaultConfiguration",{get:function(){return{loading:false,visible:true}},enumerable:true,configurable:true});CoverComponent.prototype._getCoverButtonVNode=function(conf){var _this=this;var cover=conf.loading?"div.Cover.CoverLoading":"div.Cover";return vd.h(cover,[this._getCoverBackgroundVNode(conf),vd.h("button.CoverButton",{onclick:function(){_this.configure({loading:true})}},["Explore"]),vd.h("a.CoverLogo",{href:"https://www.mapillary.com",target:"_blank"},[])])};CoverComponent.prototype._getCoverBackgroundVNode=function(conf){var url=conf.src!=null?"url("+conf.src+")":"url(https://d1cuyjsrcm0gby.cloudfront.net/"+conf.key+"/thumb-640.jpg)";var properties={style:{backgroundImage:url}};var children=[];if(conf.loading){children.push(vd.h("div.Spinner",{},[]))}children.push(vd.h("div.CoverBackgroundGradient",{},[]));return vd.h("div.CoverBackground",properties,children)};CoverComponent.componentName="cover";return CoverComponent}(Component_1.Component);exports.CoverComponent=CoverComponent;Component_1.ComponentService.registerCover(CoverComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=CoverComponent},{"../Component":404,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/withLatestFrom":272,"virtual-dom":360}],429:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var _=require("underscore");var vd=require("virtual-dom");var BehaviorSubject_1=require("rxjs/BehaviorSubject");require("rxjs/add/operator/combineLatest");var Component_1=require("../Component");var DebugComponent=function(_super){__extends(DebugComponent,_super);function DebugComponent(name,container,navigator){_super.call(this,name,container,navigator);this._open$=new BehaviorSubject_1.BehaviorSubject(false);this._displaying=false}DebugComponent.prototype._activate=function(){var _this=this;this._disposable=this._navigator.stateService.currentState$.combineLatest(this._open$,this._navigator.graphService.imageLoadingService.loadstatus$,function(frame,open,loadStatus){return{name:_this._name,vnode:_this._getDebugVNode(open,_this._getDebugInfo(frame,loadStatus))}}).subscribe(this._container.domRenderer.render$)};DebugComponent.prototype._deactivate=function(){this._disposable.unsubscribe()};DebugComponent.prototype._getDebugInfo=function(frame,loadStatus){var ret=[];ret.push(vd.h("h2","Node"));if(frame.state.currentNode){ret.push(vd.h("p","currentNode: "+frame.state.currentNode.key))}if(frame.state.previousNode){ret.push(vd.h("p","previousNode: "+frame.state.previousNode.key))}ret.push(vd.h("h2","Loading"));var total=0;var loaded=0;var loading=0;for(var _i=0,_a=_.values(loadStatus);_i<_a.length;_i++){var loadStat=_a[_i];total+=loadStat.loaded;if(loadStat.loaded!==loadStat.total){loading++}else{loaded++}}ret.push(vd.h("p","Loaded Images: "+loaded));ret.push(vd.h("p","Loading Images: "+loading));ret.push(vd.h("p","Total bytes loaded: "+total));ret.push(vd.h("h2","Camera"));ret.push(vd.h("p","camera.position.x: "+frame.state.camera.position.x));ret.push(vd.h("p","camera.position.y: "+frame.state.camera.position.y));ret.push(vd.h("p","camera.position.z: "+frame.state.camera.position.z));ret.push(vd.h("p","camera.lookat.x: "+frame.state.camera.lookat.x));ret.push(vd.h("p","camera.lookat.y: "+frame.state.camera.lookat.y));ret.push(vd.h("p","camera.lookat.z: "+frame.state.camera.lookat.z));ret.push(vd.h("p","camera.up.x: "+frame.state.camera.up.x));ret.push(vd.h("p","camera.up.y: "+frame.state.camera.up.y));ret.push(vd.h("p","camera.up.z: "+frame.state.camera.up.z));return ret};DebugComponent.prototype._getDebugVNode=function(open,info){if(open){return vd.h("div.Debug",{},[vd.h("h2",{},["Debug"]),this._getDebugVNodeButton(open),vd.h("pre",{},info)])}else{return this._getDebugVNodeButton(open)}};DebugComponent.prototype._getDebugVNodeButton=function(open){var buttonText=open?"Disable Debug":"D";var buttonCssClass=open?"":".DebugButtonFixed";if(open){return vd.h("button.DebugButton"+buttonCssClass,{onclick:this._closeDebugElement.bind(this)},[buttonText])}else{return vd.h("button.DebugButton"+buttonCssClass,{onclick:this._openDebugElement.bind(this)},[buttonText])}};DebugComponent.prototype._closeDebugElement=function(open){this._open$.next(false)};DebugComponent.prototype._openDebugElement=function(){this._open$.next(true)};DebugComponent.componentName="debug";return DebugComponent}(Component_1.Component);exports.DebugComponent=DebugComponent;Component_1.ComponentService.register(DebugComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=DebugComponent},{"../Component":404,"rxjs/BehaviorSubject":223,"rxjs/add/operator/combineLatest":244,underscore:355,"virtual-dom":360}],430:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeMap");var Component_1=require("../Component");var DetectionComponent=function(_super){__extends(DetectionComponent,_super);function DetectionComponent(name,container,navigator){_super.call(this,name,container,navigator);this._apiV3=navigator.apiV3}DetectionComponent.prototype._activate=function(){var _this=this;this.renderSubscription=this._navigator.stateService.currentNode$.mergeMap(function(node){return _this._apiV3.model.get(["imageByKey",node.key,"ors",{from:0,to:20},["key","obj","rect","value","package","score"]])}).map(function(ors){var detections=[];delete ors.json.imageByKey.$__path;ors=ors.json.imageByKey[Object.keys(ors.json.imageByKey)[0]].ors;delete ors.$__path;for(var key in ors){if(ors.hasOwnProperty(key)){var or=ors[key];if(!or){continue}var r=[];r[0]=or.rect.geometry.coordinates[1][0];r[1]=or.rect.geometry.coordinates[1][1];r[2]=or.rect.geometry.coordinates[3][0];r[3]=or.rect.geometry.coordinates[3][1];var rect={key:or.key,object:or.obj,package:or.package,rect:r,score:or.score,value:or.value};detections.push(rect)}}return{name:_this._name,vnode:_this._getRects(detections)}}).subscribe(this._container.domRenderer.renderAdaptive$)};DetectionComponent.prototype._deactivate=function(){this.renderSubscription.unsubscribe()};DetectionComponent.prototype._getRects=function(detections){var _this=this;var vRects=[];detections.forEach(function(r){var adjustedRect=_this._coordsToCss(r.rect);var rectMapped=adjustedRect.map(function(el){return el*100+"%"});var properties={style:{bottom:rectMapped[3],left:rectMapped[0],right:rectMapped[2],top:rectMapped[1]}};vRects.push(vd.h("div.Rect",properties,[vd.h("span",{style:{color:"red"},textContent:r.value},[])]))});return vd.h("div.rectContainer",{},vRects)};DetectionComponent.prototype._coordsToCss=function(rects){var adjustedCoords=rects.concat();adjustedCoords[2]=1-adjustedCoords[2];adjustedCoords[3]=1-adjustedCoords[3];return adjustedCoords};DetectionComponent.componentName="detection";return DetectionComponent}(Component_1.Component);exports.DetectionComponent=DetectionComponent;Component_1.ComponentService.register(DetectionComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=DetectionComponent},{"../Component":404,"rxjs/add/operator/map":255,"rxjs/add/operator/mergeMap":258,"virtual-dom":360}],431:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");require("rxjs/add/operator/combineLatest");var Component_1=require("../Component");var ImageComponent=function(_super){__extends(ImageComponent,_super);function ImageComponent(name,container,navigator){_super.call(this,name,container,navigator);this._canvasId=container.id+"-"+this._name}ImageComponent.prototype._activate=function(){var _this=this;this.drawSubscription=this._container.domRenderer.element$.combineLatest(this._navigator.stateService.currentNode$,function(element,node){
var canvas=document.getElementById(_this._canvasId);return{canvas:canvas,node:node}}).subscribe(function(canvasNode){var canvas=canvasNode.canvas;var node=canvasNode.node;if(!node||!canvas){return null}var adaptableDomRenderer=canvas.parentElement;var width=adaptableDomRenderer.offsetWidth;var height=adaptableDomRenderer.offsetHeight;canvas.width=width;canvas.height=height;var ctx=canvas.getContext("2d");ctx.drawImage(node.image,0,0,width,height)});this._container.domRenderer.renderAdaptive$.next({name:this._name,vnode:vd.h("canvas#"+this._canvasId,[])})};ImageComponent.prototype._deactivate=function(){this.drawSubscription.unsubscribe()};ImageComponent.componentName="image";return ImageComponent}(Component_1.Component);exports.ImageComponent=ImageComponent;Component_1.ComponentService.register(ImageComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=ImageComponent},{"../Component":404,"rxjs/add/operator/combineLatest":244,"virtual-dom":360}],432:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("rxjs/Observable");require("rxjs/add/observable/fromEvent");require("rxjs/add/operator/withLatestFrom");var Edge_1=require("../Edge");var Component_1=require("../Component");var Geo_1=require("../Geo");var KeyboardComponent=function(_super){__extends(KeyboardComponent,_super);function KeyboardComponent(name,container,navigator){_super.call(this,name,container,navigator);this._spatial=new Geo_1.Spatial;this._perspectiveDirections=[Edge_1.EdgeDirection.StepForward,Edge_1.EdgeDirection.StepBackward,Edge_1.EdgeDirection.StepLeft,Edge_1.EdgeDirection.StepRight,Edge_1.EdgeDirection.TurnLeft,Edge_1.EdgeDirection.TurnRight,Edge_1.EdgeDirection.TurnU]}KeyboardComponent.prototype._activate=function(){var _this=this;this._disposable=Observable_1.Observable.fromEvent(document,"keydown").withLatestFrom(this._navigator.stateService.currentState$,function(event,frame){return{event:event,frame:frame}}).subscribe(function(kf){if(!kf.frame.state.currentNode.pano){_this._navigatePerspective(kf.event,kf.frame.state.currentNode)}else{_this._navigatePanorama(kf.event,kf.frame.state.currentNode,kf.frame.state.camera)}})};KeyboardComponent.prototype._deactivate=function(){this._disposable.unsubscribe()};KeyboardComponent.prototype._navigatePanorama=function(event,node,camera){var navigationAngle=0;var stepDirection=null;var sequenceDirection=null;var phi=this._rotationFromCamera(camera).phi;switch(event.keyCode){case 37:if(event.shiftKey||event.altKey){break}navigationAngle=Math.PI/2+phi;stepDirection=Edge_1.EdgeDirection.StepLeft;break;case 38:if(event.shiftKey){break}if(event.altKey){sequenceDirection=Edge_1.EdgeDirection.Next;break}navigationAngle=phi;stepDirection=Edge_1.EdgeDirection.StepForward;break;case 39:if(event.shiftKey||event.altKey){break}navigationAngle=-Math.PI/2+phi;stepDirection=Edge_1.EdgeDirection.StepRight;break;case 40:if(event.shiftKey){break}if(event.altKey){sequenceDirection=Edge_1.EdgeDirection.Prev;break}navigationAngle=Math.PI+phi;stepDirection=Edge_1.EdgeDirection.StepBackward;break;default:return}event.preventDefault();if(sequenceDirection!=null){this._moveDir(sequenceDirection,node);return}if(stepDirection==null){return}navigationAngle=this._spatial.wrapAngle(navigationAngle);var threshold=Math.PI/4;var edges=node.edges.filter(function(e){return e.data.direction===Edge_1.EdgeDirection.Pano||e.data.direction===stepDirection});var smallestAngle=Number.MAX_VALUE;var toKey=null;for(var _i=0,edges_1=edges;_i<edges_1.length;_i++){var edge=edges_1[_i];var angle=Math.abs(this._spatial.wrapAngle(edge.data.worldMotionAzimuth-navigationAngle));if(angle<Math.min(smallestAngle,threshold)){smallestAngle=angle;toKey=edge.to}}if(toKey==null){return}this._navigator.moveToKey(toKey).subscribe(function(n){return},function(e){console.error(e)})};KeyboardComponent.prototype._rotationFromCamera=function(camera){var direction=camera.lookat.clone().sub(camera.position);var upProjection=direction.clone().dot(camera.up);var planeProjection=direction.clone().sub(camera.up.clone().multiplyScalar(upProjection));var phi=Math.atan2(planeProjection.y,planeProjection.x);var theta=Math.PI/2-this._spatial.angleToPlane(direction.toArray(),[0,0,1]);return{phi:phi,theta:theta}};KeyboardComponent.prototype._navigatePerspective=function(event,node){var direction=null;switch(event.keyCode){case 37:if(event.altKey){break}direction=event.shiftKey?Edge_1.EdgeDirection.TurnLeft:Edge_1.EdgeDirection.StepLeft;break;case 38:if(event.altKey){direction=Edge_1.EdgeDirection.Next;break}direction=event.shiftKey?Edge_1.EdgeDirection.Pano:Edge_1.EdgeDirection.StepForward;break;case 39:if(event.altKey){break}direction=event.shiftKey?Edge_1.EdgeDirection.TurnRight:Edge_1.EdgeDirection.StepRight;break;case 40:if(event.altKey){direction=Edge_1.EdgeDirection.Prev;break}direction=event.shiftKey?Edge_1.EdgeDirection.TurnU:Edge_1.EdgeDirection.StepBackward;break;default:return}event.preventDefault();this._moveDir(direction,node)};KeyboardComponent.prototype._moveDir=function(direction,node){if(direction==null){return}var directionExist=node.edges.some(function(edge){return edge.data.direction===direction});if(!directionExist){return}this._navigator.moveDir(direction).subscribe(function(n){return},function(e){console.error(e)})};KeyboardComponent.componentName="keyboard";return KeyboardComponent}(Component_1.Component);exports.KeyboardComponent=KeyboardComponent;Component_1.ComponentService.register(KeyboardComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=KeyboardComponent},{"../Component":404,"../Edge":405,"../Geo":407,"rxjs/Observable":226,"rxjs/add/observable/fromEvent":237,"rxjs/add/operator/withLatestFrom":272}],433:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var _=require("underscore");var vd=require("virtual-dom");require("rxjs/add/operator/combineLatest");var Component_1=require("../Component");var LoadingComponent=function(_super){__extends(LoadingComponent,_super);function LoadingComponent(name,container,navigator){_super.call(this,name,container,navigator)}LoadingComponent.prototype._activate=function(){var _this=this;this._loadingSubscription=this._navigator.loadingService.loading$.combineLatest(this._navigator.graphService.imageLoadingService.loadstatus$,function(loading,loadStatus){if(!loading){return{name:"loading",vnode:_this._getBarVNode(100)}}var total=0;var loaded=0;for(var _i=0,_a=_.values(loadStatus);_i<_a.length;_i++){var loadStat=_a[_i];if(loadStat.loaded!==loadStat.total){loaded+=loadStat.loaded;total+=loadStat.total}}var percentage=100;if(total!==0){percentage=loaded/total*100}return{name:_this._name,vnode:_this._getBarVNode(percentage)}}).subscribe(this._container.domRenderer.render$)};LoadingComponent.prototype._deactivate=function(){this._loadingSubscription.unsubscribe()};LoadingComponent.prototype._getBarVNode=function(percentage){var loadingBarStyle={};var loadingContainerStyle={};if(percentage!==100){loadingBarStyle.width=percentage.toFixed(0)+"%";loadingBarStyle.opacity="1"}else{loadingBarStyle.width="100%";loadingBarStyle.opacity="0"}return vd.h("div.Loading",{style:loadingContainerStyle},[vd.h("div.LoadingBar",{style:loadingBarStyle},[])])};LoadingComponent.componentName="loading";return LoadingComponent}(Component_1.Component);exports.LoadingComponent=LoadingComponent;Component_1.ComponentService.register(LoadingComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=LoadingComponent},{"../Component":404,"rxjs/add/operator/combineLatest":244,underscore:355,"virtual-dom":360}],434:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=require("three");var vd=require("virtual-dom");var Observable_1=require("rxjs/Observable");require("rxjs/add/observable/merge");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/withLatestFrom");var Component_1=require("../Component");var Geo_1=require("../Geo");var MouseComponent=function(_super){__extends(MouseComponent,_super);function MouseComponent(name,container,navigator){_super.call(this,name,container,navigator);this._spatial=new Geo_1.Spatial}MouseComponent.prototype._activate=function(){var _this=this;var draggingStarted=this._container.mouseService.mouseDragStart$.map(function(event){return true});var draggingStopped=this._container.mouseService.mouseDragEnd$.map(function(event){return false});this._cursorSubscription=Observable_1.Observable.merge(draggingStarted,draggingStopped).startWith(false).map(function(dragging){var className=dragging?"MouseContainerGrabbing":"MouseContainerGrab";var vNode=vd.h("div."+className,{},[]);return{name:_this._name,vnode:vNode}}).subscribe(this._container.domRenderer.render$);var mouseMovement$=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).map(function(e){return{clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY}});var touchMovement$=this._container.touchService.singleTouchMove$.map(function(touch){return{clientX:touch.clientX,clientY:touch.clientY,movementX:touch.movementX,movementY:touch.movementY}});this._movementSubscription=Observable_1.Observable.merge(mouseMovement$,touchMovement$).withLatestFrom(this._navigator.stateService.currentState$,function(m,f){return[m,f]}).filter(function(args){var state=args[1].state;return state.currentNode.fullPano||state.nodesAhead<1}).map(function(args){return args[0]}).withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.stateService.currentCamera$,function(m,r,t,c){return[m,r,t,c]}).map(function(args){var movement=args[0];var render=args[1];var transform=args[2];var camera=args[3].clone();var element=_this._container.element;var offsetWidth=element.offsetWidth;var offsetHeight=element.offsetHeight;var clientRect=element.getBoundingClientRect();var canvasX=movement.clientX-clientRect.left;var canvasY=movement.clientY-clientRect.top;var currentDirection=_this._unproject(canvasX,canvasY,offsetWidth,offsetHeight,render.perspective).sub(render.perspective.position);var directionX=_this._unproject(canvasX-movement.movementX,canvasY,offsetWidth,offsetHeight,render.perspective).sub(render.perspective.position);var directionY=_this._unproject(canvasX,canvasY-movement.movementY,offsetWidth,offsetHeight,render.perspective).sub(render.perspective.position);var deltaPhi=(movement.movementX>0?1:-1)*directionX.angleTo(currentDirection);var deltaTheta=(movement.movementY>0?-1:1)*directionY.angleTo(currentDirection);var upQuaternion=(new THREE.Quaternion).setFromUnitVectors(camera.up,new THREE.Vector3(0,0,1));var upQuaternionInverse=upQuaternion.clone().inverse();var offset=new THREE.Vector3;offset.copy(camera.lookat).sub(camera.position);offset.applyQuaternion(upQuaternion);var length=offset.length();var phi=Math.atan2(offset.y,offset.x);phi+=deltaPhi;var theta=Math.atan2(Math.sqrt(offset.x*offset.x+offset.y*offset.y),offset.z);theta+=deltaTheta;theta=Math.max(.01,Math.min(Math.PI-.01,theta));offset.x=Math.sin(theta)*Math.cos(phi);offset.y=Math.sin(theta)*Math.sin(phi);offset.z=Math.cos(theta);offset.applyQuaternion(upQuaternionInverse);var lookat=(new THREE.Vector3).copy(camera.position).add(offset.multiplyScalar(length));var basic=transform.projectBasic(lookat.toArray());var original=transform.projectBasic(camera.lookat.toArray());var x=basic[0]-original[0];var y=basic[1]-original[1];if(Math.abs(x)>1){x=0}else if(x>.5){x=x-1}else if(x<-.5){x=x+1}return[x,y]}).subscribe(function(basicRotation){_this._navigator.stateService.rotateBasic(basicRotation)});this._mouseWheelSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseWheel$).withLatestFrom(this._navigator.stateService.currentState$,function(w,f){return[w,f]}).filter(function(args){var state=args[1].state;return state.currentNode.fullPano||state.nodesAhead<1}).map(function(args){return args[0]}).withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,function(w,r,t){return[w,r,t]}).subscribe(function(args){var event=args[0];var render=args[1];var transform=args[2];var element=_this._container.element;var offsetWidth=element.offsetWidth;var offsetHeight=element.offsetHeight;var clientRect=element.getBoundingClientRect();var canvasX=event.clientX-clientRect.left;var canvasY=event.clientY-clientRect.top;var unprojected=_this._unproject(canvasX,canvasY,offsetWidth,offsetHeight,render.perspective);var reference=transform.projectBasic(unprojected.toArray());var deltaY=event.deltaY;if(event.deltaMode===1){deltaY=40*deltaY}else if(event.deltaMode===2){deltaY=800*deltaY}var zoom=-3*deltaY/offsetHeight;_this._navigator.stateService.zoomIn(zoom,reference)});this._pinchSubscription=this._container.touchService.pinch$.withLatestFrom(this._navigator.stateService.currentState$,function(p,f){return[p,f]}).filter(function(args){var state=args[1].state;return state.currentNode.fullPano||state.nodesAhead<1}).map(function(args){return args[0]}).withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,function(p,r,t){return[p,r,t]}).subscribe(function(args){var pinch=args[0];var render=args[1];var transform=args[2];var element=_this._container.element;var offsetWidth=element.offsetWidth;var offsetHeight=element.offsetHeight;var clientRect=element.getBoundingClientRect();var unprojected=_this._unproject(pinch.centerClientX-clientRect.left,pinch.centerClientY-clientRect.top,offsetWidth,offsetHeight,render.perspective);var reference=transform.projectBasic(unprojected.toArray());var zoom=3*pinch.distanceChange/Math.min(offsetHeight,offsetWidth);_this._navigator.stateService.zoomIn(zoom,reference)});this._container.mouseService.claimMouse(this._name,0)};MouseComponent.prototype._deactivate=function(){this._container.mouseService.unclaimMouse(this._name);this._cursorSubscription.unsubscribe();this._movementSubscription.unsubscribe();this._fullPanoMovementSubscription.unsubscribe();this._mouseWheelSubscription.unsubscribe();this._pinchSubscription.unsubscribe()};MouseComponent.prototype._unproject=function(canvasX,canvasY,offsetWidth,offsetHeight,perspectiveCamera){var projectedX=2*canvasX/offsetWidth-1;var projectedY=1-2*canvasY/offsetHeight;return new THREE.Vector3(projectedX,projectedY,1).unproject(perspectiveCamera)};MouseComponent.componentName="mouse";return MouseComponent}(Component_1.Component);exports.MouseComponent=MouseComponent;Component_1.ComponentService.register(MouseComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=MouseComponent},{"../Component":404,"../Geo":407,"rxjs/Observable":226,"rxjs/add/observable/merge":239,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/withLatestFrom":272,three:354,"virtual-dom":360}],435:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");require("rxjs/add/operator/map");require("rxjs/add/operator/first");var Edge_1=require("../Edge");var Component_1=require("../Component");var NavigationComponent=function(_super){__extends(NavigationComponent,_super);function NavigationComponent(name,container,navigator){_super.call(this,name,container,navigator);this._dirNames={};this._dirNames[Edge_1.EdgeDirection.StepForward]="Forward";this._dirNames[Edge_1.EdgeDirection.StepBackward]="Backward";this._dirNames[Edge_1.EdgeDirection.StepLeft]="Left";this._dirNames[Edge_1.EdgeDirection.StepRight]="Right";this._dirNames[Edge_1.EdgeDirection.TurnLeft]="Turnleft";this._dirNames[Edge_1.EdgeDirection.TurnRight]="Turnright";this._dirNames[Edge_1.EdgeDirection.TurnU]="Turnaround"}NavigationComponent.prototype._activate=function(){var _this=this;this._renderSubscription=this._navigator.stateService.currentNode$.map(function(node){var btns=[];if(!node.pano){for(var _i=0,_a=node.edges;_i<_a.length;_i++){var edge=_a[_i];var direction=edge.data.direction;var name_1=_this._dirNames[direction];if(name_1==null){continue}btns.push(_this._createVNode(direction,name_1))}}return{name:_this._name,vnode:vd.h("div.NavigationComponent",btns)}}).subscribe(this._container.domRenderer.render$)};NavigationComponent.prototype._deactivate=function(){this._renderSubscription.unsubscribe()};NavigationComponent.prototype._createVNode=function(direction,name){var _this=this;return vd.h("span.Direction.Direction"+name,{onclick:function(ev){_this._navigator.moveDir(direction).first().subscribe()}},[])};NavigationComponent.componentName="navigation";return NavigationComponent}(Component_1.Component);exports.NavigationComponent=NavigationComponent;Component_1.ComponentService.register(NavigationComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=NavigationComponent},{"../Component":404,"../Edge":405,"rxjs/add/operator/first":254,"rxjs/add/operator/map":255,"virtual-dom":360}],436:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Component_1=require("../Component");var NoneComponent=function(_super){__extends(NoneComponent,_super);function NoneComponent(){_super.apply(this,arguments)}NoneComponent.prototype._activate=function(){return};NoneComponent.prototype._deactivate=function(){return};NoneComponent.componentName="none";return NoneComponent}(Component_1.Component);exports.NoneComponent=NoneComponent;Component_1.ComponentService.register(NoneComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=NoneComponent},{"../Component":404}],437:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var _=require("underscore");var vd=require("virtual-dom");var Observable_1=require("rxjs/Observable");require("rxjs/add/observable/fromPromise");require("rxjs/add/observable/of");require("rxjs/add/operator/combineLatest");require("rxjs/add/operator/distinct");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/pluck");require("rxjs/add/operator/scan");var Component_1=require("../Component");var DescriptionState=function(){function DescriptionState(){}return DescriptionState}();var RouteState=function(){function RouteState(){}return RouteState}();var RouteTrack=function(){function RouteTrack(){this.nodeInstructions=[];this.nodeInstructionsOrdered=[]}return RouteTrack}();var RouteComponent=function(_super){__extends(RouteComponent,_super);function RouteComponent(name,container,navigator){_super.call(this,name,container,navigator)}RouteComponent.prototype._activate=function(){var _this=this;var _slowedStream$;_slowedStream$=this._navigator.stateService.currentState$.filter(function(frame){return frame.id%2===0}).filter(function(frame){return frame.state.nodesAhead<15}).distinctUntilChanged(undefined,function(frame){return frame.state.lastNode.key});var _routeTrack$;_routeTrack$=this.configuration$.mergeMap(function(conf){return Observable_1.Observable.from(conf.paths)}).distinct(function(p1,p2){return p1.sequenceKey===p2.sequenceKey}).mergeMap(function(path){return Observable_1.Observable.fromPromise(_this._navigator.apiV2.s.get(path.sequenceKey))}).combineLatest(this.configuration$,function(apiSGet,conf){var i=0;var instructionPlaces=[];for(var _i=0,_a=conf.paths;_i<_a.length;_i++){var path=_a[_i];if(path.sequenceKey===apiSGet.key){var nodeInstructions=[];var saveKey=false;for(var _b=0,_c=apiSGet.keys;_b<_c.length;_b++){var key=_c[_b];if(path.startKey===key){saveKey=true}if(saveKey){var description=null;for(var _d=0,_e=path.infoKeys;_d<_e.length;_d++){var infoKey=_e[_d];if(infoKey.key===key){description=infoKey.description}}nodeInstructions.push({description:description,key:key})}if(path.stopKey===key){saveKey=false}}instructionPlaces.push({nodeInstructions:nodeInstructions,place:i})}i++}return instructionPlaces}).scan(function(routeTrack,instructionPlaces){for(var _i=0,instructionPlaces_1=instructionPlaces;_i<instructionPlaces_1.length;_i++){var instructionPlace=instructionPlaces_1[_i];routeTrack.nodeInstructionsOrdered[instructionPlace.place]=instructionPlace.nodeInstructions}routeTrack.nodeInstructions=_.flatten(routeTrack.nodeInstructionsOrdered);return routeTrack},new RouteTrack);this._disposable=_slowedStream$.combineLatest(_routeTrack$,this.configuration$,function(frame,routeTrack,conf){return{conf:conf,frame:frame,routeTrack:routeTrack}}).scan(function(routeState,rtAndFrame){if(rtAndFrame.conf.playing===undefined||rtAndFrame.conf.playing){routeState.routeTrack=rtAndFrame.routeTrack;routeState.currentNode=rtAndFrame.frame.state.currentNode;routeState.lastNode=rtAndFrame.frame.state.lastNode;routeState.playing=true}else{_this._navigator.stateService.cutNodes();routeState.playing=false}return routeState},new RouteState).filter(function(routeState){return routeState.playing}).filter(function(routeState){for(var _i=0,_a=routeState.routeTrack.nodeInstructions;_i<_a.length;_i++){var nodeInstruction=_a[_i];if(!nodeInstruction){continue}if(nodeInstruction.key===routeState.lastNode.key){return true}}return false}).distinctUntilChanged(undefined,function(routeState){return routeState.lastNode.key}).mergeMap(function(routeState){var i=0;for(var _i=0,_a=routeState.routeTrack.nodeInstructions;_i<_a.length;_i++){var nodeInstruction=_a[_i];if(nodeInstruction.key===routeState.lastNode.key){break}i++}var nextInstruction=routeState.routeTrack.nodeInstructions[i+1];if(!nextInstruction){return Observable_1.Observable.of(null)}return _this._navigator.graphService.node$(nextInstruction.key)}).combineLatest(this.configuration$,function(node,conf){return{conf:conf,node:node}}).filter(function(cAN){return cAN.node!==null&&cAN.conf.playing}).pluck("node").subscribe(this._navigator.stateService.appendNode$);this._disposableDescription=this._navigator.stateService.currentNode$.combineLatest(_routeTrack$,this.configuration$,function(node,routeTrack,conf){if(conf.playing!==undefined&&!conf.playing){return"quit"}var description=null;for(var _i=0,_a=routeTrack.nodeInstructions;_i<_a.length;_i++){var nodeInstruction=_a[_i];if(nodeInstruction.key===node.key){description=nodeInstruction.description;break}}return description}).scan(function(descriptionState,description){if(description!==descriptionState.description&&description!==null){descriptionState.description=description;descriptionState.showsLeft=6}else{descriptionState.showsLeft--}if(description==="quit"){descriptionState.description=null}return descriptionState},new DescriptionState).map(function(descriptionState){if(descriptionState.showsLeft>0&&descriptionState.description){return{name:_this._name,vnode:_this._getRouteAnnotationNode(descriptionState.description)}}else{return{name:_this._name,vnode:vd.h("div",[])}}}).subscribe(this._container.domRenderer.render$)};RouteComponent.prototype._deactivate=function(){this._disposable.unsubscribe();this._disposableDescription.unsubscribe()};RouteComponent.prototype.play=function(){this.configure({playing:true})};RouteComponent.prototype.stop=function(){this.configure({playing:false})};RouteComponent.prototype._getRouteAnnotationNode=function(description){return vd.h("div.RouteFrame",{},[vd.h("p",{textContent:description},[])])};RouteComponent.componentName="route";return RouteComponent}(Component_1.Component);exports.RouteComponent=RouteComponent;Component_1.ComponentService.register(RouteComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=RouteComponent},{"../Component":404,"rxjs/Observable":226,"rxjs/add/observable/fromPromise":238,"rxjs/add/observable/of":240,"rxjs/add/operator/combineLatest":244,"rxjs/add/operator/distinct":248,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/pluck":260,"rxjs/add/operator/scan":263,underscore:355,"virtual-dom":360}],438:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};require("rxjs/add/operator/buffer");require("rxjs/add/operator/debounceTime");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/scan");var Component_1=require("../Component");var StatsComponent=function(_super){__extends(StatsComponent,_super);function StatsComponent(name,container,navigator){_super.call(this,name,container,navigator)}StatsComponent.prototype._activate=function(){var _this=this;this._sequenceSubscription=this._navigator.stateService.currentNode$.scan(function(keys,node){var sKey=node.sequence.key;keys.report=[];if(!(sKey in keys.reported)){keys.report=[sKey];keys.reported[sKey]=true}return keys},{report:[],reported:{}}).filter(function(keys){return keys.report.length>0}).subscribe(function(keys){_this._navigator.apiV3.modelMagic.call(["sequenceViewAdd"],[keys.report]).subscribe()});this._imageSubscription=this._navigator.stateService.currentNode$.map(function(node){return node.key}).buffer(this._navigator.stateService.currentNode$.debounceTime(5e3)).scan(function(keys,newKeys){keys.report=[];for(var _i=0,newKeys_1=newKeys;_i<newKeys_1.length;_i++){var key=newKeys_1[_i];if(!(key in keys.reported)){keys.report.push(key);keys.reported[key]=true}}return keys},{report:[],reported:{}}).filter(function(keys){return keys.report.length>0}).subscribe(function(keys){_this._navigator.apiV3.modelMagic.call(["imageViewAdd"],[keys.report]).subscribe()})};StatsComponent.prototype._deactivate=function(){this._sequenceSubscription.unsubscribe();this._imageSubscription.unsubscribe()};StatsComponent.componentName="stats";return StatsComponent}(Component_1.Component);exports.StatsComponent=StatsComponent;Component_1.ComponentService.register(StatsComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=StatsComponent},{"../Component":404,"rxjs/add/operator/buffer":243,"rxjs/add/operator/debounceTime":246,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/scan":263}],439:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/combineLatest");require("rxjs/add/operator/do");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/share");var Component_1=require("../../Component");var DirectionComponent=function(_super){__extends(DirectionComponent,_super);function DirectionComponent(name,container,navigator){_super.call(this,name,container,navigator);this._renderer=new Component_1.DirectionDOMRenderer(this.defaultConfiguration,container.element);this._hoveredKeySubject$=new Subject_1.Subject;this._hoveredKey$=this._hoveredKeySubject$.share()}Object.defineProperty(DirectionComponent.prototype,"defaultConfiguration",{get:function(){return{distinguishSequence:false,maxWidth:460,minWidth:260}},enumerable:true,configurable:true});Object.defineProperty(DirectionComponent.prototype,"hoveredKey$",{get:function(){return this._hoveredKey$},enumerable:true,configurable:true});DirectionComponent.prototype.setHighlightKey=function(highlightKey){this.configure({highlightKey:highlightKey})};DirectionComponent.prototype.setMinWidth=function(minWidth){this.configure({minWidth:minWidth})};DirectionComponent.prototype.setMaxWidth=function(maxWidth){this.configure({maxWidth:maxWidth})};DirectionComponent.prototype.resize=function(){this._renderer.resize(this._container.element)};DirectionComponent.prototype._activate=function(){var _this=this;this._configurationSubscription=this._configuration$.subscribe(function(configuration){_this._renderer.setConfiguration(configuration)});this._nodeSubscription=this._navigator.stateService.currentNode$.do(function(node){_this._container.domRenderer.render$.next({name:_this._name,vnode:vd.h("div",{},[])})}).subscribe(function(node){_this._renderer.setNode(node)});this._renderCameraSubscription=this._container.renderService.renderCameraFrame$.do(function(renderCamera){_this._renderer.setRenderCamera(renderCamera)}).map(function(renderCamera){return _this._renderer}).filter(function(renderer){return renderer.needsRender}).map(function(renderer){return{name:_this._name,vnode:renderer.render(_this._navigator)}}).subscribe(this._container.domRenderer.render$);this._hoveredKeySubscription=Observable_1.Observable.combineLatest([this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.startWith(null),this._container.mouseService.mouseUp$.startWith(null)],function(e,rc,mm,mu){return e}).map(function(element){var elements=element.getElementsByClassName("DirectionsPerspective");for(var i=0;i<elements.length;i++){var hovered=elements.item(i).querySelector(":hover");if(hovered!=null&&hovered.hasAttribute("data-key")){return hovered.getAttribute("data-key")}}return null}).distinctUntilChanged().subscribe(this._hoveredKeySubject$)};DirectionComponent.prototype._deactivate=function(){this._configurationSubscription.unsubscribe();this._nodeSubscription.unsubscribe();this._renderCameraSubscription.unsubscribe();this._hoveredKeySubscription.unsubscribe()};DirectionComponent.componentName="direction";return DirectionComponent}(Component_1.Component);exports.DirectionComponent=DirectionComponent;Component_1.ComponentService.register(DirectionComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=DirectionComponent},{"../../Component":404,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/combineLatest":234,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/do":250,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/share":264,"virtual-dom":360}],440:[function(require,module,exports){"use strict";var Geo_1=require("../../Geo");var DirectionDOMCalculator=function(){function DirectionDOMCalculator(configuration,element){this._spatial=new Geo_1.Spatial;this._minThresholdWidth=320;this._maxThresholdWidth=1480;this._minThresholdHeight=240;this._maxThresholdHeight=820;this._configure(configuration);this._resize(element);this._reset()}Object.defineProperty(DirectionDOMCalculator.prototype,"minWidth",{get:function(){return this._minWidth},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"maxWidth",{get:function(){
return this._maxWidth},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"containerWidth",{get:function(){return this._containerWidth},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"containerWidthCss",{get:function(){return this._containerWidthCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"containerMarginCss",{get:function(){return this._containerMarginCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"containerLeftCss",{get:function(){return this._containerLeftCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"containerHeight",{get:function(){return this._containerHeight},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"containerHeightCss",{get:function(){return this._containerHeightCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"containerBottomCss",{get:function(){return this._containerBottomCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"stepCircleSize",{get:function(){return this._stepCircleSize},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"stepCircleSizeCss",{get:function(){return this._stepCircleSizeCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"stepCircleMarginCss",{get:function(){return this._stepCircleMarginCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"turnCircleSize",{get:function(){return this._turnCircleSize},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"turnCircleSizeCss",{get:function(){return this._turnCircleSizeCss},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"outerRadius",{get:function(){return this._outerRadius},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"innerRadius",{get:function(){return this._innerRadius},enumerable:true,configurable:true});Object.defineProperty(DirectionDOMCalculator.prototype,"shadowOffset",{get:function(){return this._shadowOffset},enumerable:true,configurable:true});DirectionDOMCalculator.prototype.configure=function(configuration){this._configure(configuration);this._reset()};DirectionDOMCalculator.prototype.resize=function(element){this._resize(element);this._reset()};DirectionDOMCalculator.prototype.angleToCoordinates=function(angle){return[Math.cos(angle),Math.sin(angle)]};DirectionDOMCalculator.prototype.relativeAngleToCoordiantes=function(first,second){var relativeAngle=this._spatial.wrapAngle(first-second);return this.angleToCoordinates(relativeAngle)};DirectionDOMCalculator.prototype._configure=function(configuration){this._minWidth=configuration.minWidth;this._maxWidth=this._getMaxWidth(configuration.minWidth,configuration.maxWidth)};DirectionDOMCalculator.prototype._resize=function(element){this._elementWidth=element.offsetWidth;this._elementHeight=element.offsetHeight};DirectionDOMCalculator.prototype._reset=function(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight);this._containerHeight=this._getContainerHeight(this.containerWidth);this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight);this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight);this._outerRadius=this._getOuterRadius(this._containerHeight);this._innerRadius=this._getInnerRadius(this._containerHeight);this._shadowOffset=3;this._containerWidthCss=this._numberToCssPixels(this._containerWidth);this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth);this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth));this._containerHeightCss=this._numberToCssPixels(this._containerHeight);this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight));this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize);this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize);this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)};DirectionDOMCalculator.prototype._getContainerWidth=function(elementWidth,elementHeight){var relativeWidth=(elementWidth-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth);var relativeHeight=(elementHeight-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);var coeff=Math.max(0,Math.min(1,Math.min(relativeWidth,relativeHeight)));coeff=.04*Math.round(25*coeff);return this._minWidth+coeff*(this._maxWidth-this._minWidth)};DirectionDOMCalculator.prototype._getContainerHeight=function(containerWidth){return.77*containerWidth};DirectionDOMCalculator.prototype._getStepCircleDiameter=function(containerHeight){return.34*containerHeight};DirectionDOMCalculator.prototype._getTurnCircleDiameter=function(containerHeight){return.3*containerHeight};DirectionDOMCalculator.prototype._getOuterRadius=function(containerHeight){return.31*containerHeight};DirectionDOMCalculator.prototype._getInnerRadius=function(containerHeight){return.125*containerHeight};DirectionDOMCalculator.prototype._numberToCssPixels=function(value){return value+"px"};DirectionDOMCalculator.prototype._getMaxWidth=function(value,minWidth){return value>minWidth?value:minWidth};return DirectionDOMCalculator}();exports.DirectionDOMCalculator=DirectionDOMCalculator;Object.defineProperty(exports,"__esModule",{value:true});exports.default=DirectionDOMCalculator},{"../../Geo":407}],441:[function(require,module,exports){"use strict";var vd=require("virtual-dom");var Component_1=require("../../Component");var Edge_1=require("../../Edge");var Geo_1=require("../../Geo");var DirectionDOMRenderer=function(){function DirectionDOMRenderer(configuration,element){this._isEdge=false;this._spatial=new Geo_1.Spatial;this._calculator=new Component_1.DirectionDOMCalculator(configuration,element);this._node=null;this._rotation={phi:0,theta:0};this._epsilon=.5*Math.PI/180;this._highlightKey=null;this._distinguishSequence=false;this._needsRender=false;this._stepEdges=[];this._turnEdges=[];this._panoEdges=[];this._sequenceEdgeKeys=[];this._stepDirections=[Edge_1.EdgeDirection.StepForward,Edge_1.EdgeDirection.StepBackward,Edge_1.EdgeDirection.StepLeft,Edge_1.EdgeDirection.StepRight];this._turnDirections=[Edge_1.EdgeDirection.TurnLeft,Edge_1.EdgeDirection.TurnRight,Edge_1.EdgeDirection.TurnU];this._turnNames={};this._turnNames[Edge_1.EdgeDirection.TurnLeft]="TurnLeft";this._turnNames[Edge_1.EdgeDirection.TurnRight]="TurnRight";this._turnNames[Edge_1.EdgeDirection.TurnU]="TurnAround";var isIE=false||!!document.documentMode;this._isEdge=!isIE&&!!window.StyleMedia}Object.defineProperty(DirectionDOMRenderer.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});DirectionDOMRenderer.prototype.render=function(navigator){this._needsRender=false;var rotation=this._rotation;var steps=[];var turns=[];if(this._node.pano){steps=steps.concat(this._createPanoArrows(navigator,rotation))}else{steps=steps.concat(this._createPerspectiveToPanoArrows(navigator,rotation));steps=steps.concat(this._createStepArrows(navigator,rotation));turns=turns.concat(this._createTurnArrows(navigator))}return this._getContainer(steps,turns,rotation,this._node.pano)};DirectionDOMRenderer.prototype.setNode=function(node){this._node=node;this._setEdges(node);this._setNeedsRender()};DirectionDOMRenderer.prototype.setRenderCamera=function(renderCamera){var camera=renderCamera.camera;var direction=this._directionFromCamera(camera);var rotation=this._getRotation(direction,camera.up);if(Math.abs(rotation.phi-this._rotation.phi)<this._epsilon){return}this._rotation=rotation;this._setNeedsRender()};DirectionDOMRenderer.prototype.setConfiguration=function(configuration){var needsRender=false;if(this._highlightKey!==configuration.highlightKey||this._distinguishSequence!==configuration.distinguishSequence){this._highlightKey=configuration.highlightKey;this._distinguishSequence=configuration.distinguishSequence;needsRender=true}if(this._calculator.minWidth!==configuration.minWidth||this._calculator.maxWidth!==configuration.maxWidth){this._calculator.configure(configuration);needsRender=true}if(needsRender){this._setNeedsRender()}};DirectionDOMRenderer.prototype.resize=function(element){this._calculator.resize(element);this._setNeedsRender()};DirectionDOMRenderer.prototype._setNeedsRender=function(){if(this._node!=null){this._needsRender=true}};DirectionDOMRenderer.prototype._setEdges=function(node){this._stepEdges=[];this._turnEdges=[];this._panoEdges=[];this._sequenceEdgeKeys=[];for(var _i=0,_a=node.edges;_i<_a.length;_i++){var edge=_a[_i];var direction=edge.data.direction;if(this._stepDirections.indexOf(direction)>-1){this._stepEdges.push(edge);continue}if(this._turnDirections.indexOf(direction)>-1){this._turnEdges.push(edge);continue}if(edge.data.direction===Edge_1.EdgeDirection.Pano){this._panoEdges.push(edge)}}if(this._distinguishSequence){var edges=this._panoEdges.concat(this._stepEdges).concat(this._turnEdges);for(var _b=0,edges_1=edges;_b<edges_1.length;_b++){var edge=edges_1[_b];var edgeKey=edge.to;for(var _c=0,_d=this._node.sequence.keys;_c<_d.length;_c++){var sequenceKey=_d[_c];if(sequenceKey===edgeKey){this._sequenceEdgeKeys.push(edgeKey);break}}}}};DirectionDOMRenderer.prototype._directionFromCamera=function(camera){return camera.lookat.clone().sub(camera.position)};DirectionDOMRenderer.prototype._getRotation=function(direction,up){var upProjection=direction.clone().dot(up);var planeProjection=direction.clone().sub(up.clone().multiplyScalar(upProjection));var phi=Math.atan2(planeProjection.y,planeProjection.x);var theta=Math.PI/2-this._spatial.angleToPlane(direction.toArray(),[0,0,1]);return{phi:phi,theta:theta}};DirectionDOMRenderer.prototype._createPanoArrows=function(navigator,rotation){var arrows=[];for(var _i=0,_a=this._panoEdges;_i<_a.length;_i++){var panoEdge=_a[_i];arrows.push(this._createVNodeByKey(navigator,panoEdge.to,panoEdge.data.worldMotionAzimuth,rotation,this._calculator.outerRadius,"DirectionsArrowPano"))}for(var _b=0,_c=this._stepEdges;_b<_c.length;_b++){var stepEdge=_c[_b];arrows.push(this._createPanoToPerspectiveArrow(navigator,stepEdge.to,stepEdge.data.worldMotionAzimuth,rotation,stepEdge.data.direction))}return arrows};DirectionDOMRenderer.prototype._createPanoToPerspectiveArrow=function(navigator,key,azimuth,rotation,direction){var threshold=Math.PI/8;var relativePhi=rotation.phi;switch(direction){case Edge_1.EdgeDirection.StepBackward:relativePhi=rotation.phi-Math.PI;break;case Edge_1.EdgeDirection.StepLeft:relativePhi=rotation.phi+Math.PI/2;break;case Edge_1.EdgeDirection.StepRight:relativePhi=rotation.phi-Math.PI/2;break;default:break}if(Math.abs(this._spatial.wrapAngle(azimuth-relativePhi))<threshold){return this._createVNodeByKey(navigator,key,azimuth,rotation,this._calculator.outerRadius,"DirectionsArrowStep")}return this._createVNodeDisabled(key,azimuth,rotation)};DirectionDOMRenderer.prototype._createPerspectiveToPanoArrows=function(navigator,rotation){var arrows=[];for(var _i=0,_a=this._panoEdges;_i<_a.length;_i++){var panoEdge=_a[_i];arrows.push(this._createVNodeByKey(navigator,panoEdge.to,panoEdge.data.worldMotionAzimuth,rotation,this._calculator.innerRadius,"DirectionsArrowPano",true))}return arrows};DirectionDOMRenderer.prototype._createStepArrows=function(navigator,rotation){var arrows=[];for(var _i=0,_a=this._stepEdges;_i<_a.length;_i++){var stepEdge=_a[_i];arrows.push(this._createVNodeByDirection(navigator,stepEdge.to,stepEdge.data.worldMotionAzimuth,rotation,stepEdge.data.direction))}return arrows};DirectionDOMRenderer.prototype._createTurnArrows=function(navigator){var turns=[];for(var _i=0,_a=this._turnEdges;_i<_a.length;_i++){var turnEdge=_a[_i];var direction=turnEdge.data.direction;var name_1=this._turnNames[direction];turns.push(this._createVNodeByTurn(navigator,turnEdge.to,name_1,direction))}return turns};DirectionDOMRenderer.prototype._createVNodeByKey=function(navigator,key,azimuth,rotation,offset,className,shiftVertically){var onClick=function(e){navigator.moveToKey(key).subscribe()};return this._createVNode(key,azimuth,rotation,offset,className,"DirectionsCircle",onClick,shiftVertically)};DirectionDOMRenderer.prototype._createVNodeByDirection=function(navigator,key,azimuth,rotation,direction){var onClick=function(e){navigator.moveDir(direction).subscribe()};return this._createVNode(key,azimuth,rotation,this._calculator.outerRadius,"DirectionsArrowStep","DirectionsCircle",onClick)};DirectionDOMRenderer.prototype._createVNodeByTurn=function(navigator,key,className,direction){var onClick=function(e){navigator.moveDir(direction).subscribe()};var style={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(direction){case Edge_1.EdgeDirection.TurnLeft:style.left="5px";style.top="5px";break;case Edge_1.EdgeDirection.TurnRight:style.right="5px";style.top="5px";break;case Edge_1.EdgeDirection.TurnU:style.left="5px";style.bottom="5px";break;default:break}var circleProperties={attributes:{"data-key":key},onclick:onClick,style:style};var circleClassName="TurnCircle";if(this._sequenceEdgeKeys.indexOf(key)>-1){circleClassName+="Sequence"}if(this._highlightKey===key){circleClassName+="Highlight"}var turn=vd.h("div."+className,{},[]);return vd.h("div."+circleClassName,circleProperties,[turn])};DirectionDOMRenderer.prototype._createVNodeDisabled=function(key,azimuth,rotation){return this._createVNode(key,azimuth,rotation,this._calculator.outerRadius,"DirectionsArrowDisabled","DirectionsCircleDisabled")};DirectionDOMRenderer.prototype._createVNode=function(key,azimuth,rotation,radius,className,circleClassName,onClick,shiftVertically){var translation=this._calculator.angleToCoordinates(azimuth-rotation.phi);var translationX=Math.round(-radius*translation[1]+.5*this._calculator.containerWidth);var translationY=Math.round(-radius*translation[0]+.5*this._calculator.containerHeight);var shadowTranslation=this._calculator.relativeAngleToCoordiantes(azimuth,rotation.phi);var shadowOffset=this._calculator.shadowOffset;var shadowTranslationX=-shadowOffset*shadowTranslation[1];var shadowTranslationY=shadowOffset*shadowTranslation[0];var filter="drop-shadow("+shadowTranslationX+"px "+shadowTranslationY+"px 1px rgba(0,0,0,0.8))";var properties={style:{"-webkit-filter":filter,filter:filter}};var chevron=vd.h("div."+className,properties,[]);var azimuthDeg=-this._spatial.radToDeg(azimuth-rotation.phi);var circleTransform=shiftVertically?"translate("+translationX+"px, "+translationY+"px) rotate("+azimuthDeg+"deg) translateZ(-0.01px)":"translate("+translationX+"px, "+translationY+"px) rotate("+azimuthDeg+"deg)";var circleProperties={attributes:{"data-key":key},onclick:onClick,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:circleTransform,width:this._calculator.stepCircleSizeCss}};if(this._sequenceEdgeKeys.indexOf(key)>-1){circleClassName+="Sequence"}if(this._highlightKey===key){circleClassName+="Highlight"}return vd.h("div."+circleClassName,circleProperties,[chevron])};DirectionDOMRenderer.prototype._getContainer=function(steps,turns,rotation,pano){var transform=this._isEdge?"rotateX(60deg)":"perspective("+this._calculator.containerWidthCss+") rotateX(60deg)";var perspectiveStyle={bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:transform,width:this._calculator.containerWidthCss};return vd.h("div.DirectionsPerspective",{style:perspectiveStyle},turns.concat(steps))};return DirectionDOMRenderer}();exports.DirectionDOMRenderer=DirectionDOMRenderer;Object.defineProperty(exports,"__esModule",{value:true});exports.default=DirectionDOMRenderer},{"../../Component":404,"../../Edge":405,"../../Geo":407,"virtual-dom":360}],442:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/of");require("rxjs/add/operator/delay");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/scan");require("rxjs/add/operator/switchMap");var Component_1=require("../../Component");var Render_1=require("../../Render");var Graph_1=require("../../Graph");var Utils_1=require("../../Utils");var ImagePlaneComponent=function(_super){__extends(ImagePlaneComponent,_super);function ImagePlaneComponent(name,container,navigator){_super.call(this,name,container,navigator);this._rendererOperation$=new Subject_1.Subject;this._rendererCreator$=new Subject_1.Subject;this._rendererDisposer$=new Subject_1.Subject;this._renderer$=this._rendererOperation$.scan(function(renderer,operation){return operation(renderer)},null).filter(function(renderer){return renderer!=null}).distinctUntilChanged(undefined,function(renderer){return renderer.frameId});this._rendererCreator$.map(function(){return function(renderer){if(renderer!=null){throw new Error("Multiple image plane states can not be created at the same time")}return new Component_1.ImagePlaneGLRenderer}}).subscribe(this._rendererOperation$);this._rendererDisposer$.map(function(){return function(renderer){renderer.dispose();return null}}).subscribe(this._rendererOperation$)}ImagePlaneComponent.prototype._activate=function(){var _this=this;this._rendererSubscription=this._renderer$.map(function(renderer){var renderHash={name:_this._name,render:{frameId:renderer.frameId,needsRender:renderer.needsRender,render:renderer.render.bind(renderer),stage:Render_1.GLRenderStage.Background}};renderer.clearNeedsRender();return renderHash}).subscribe(this._container.glRenderer.render$);this._rendererCreator$.next(null);this._stateSubscription=this._navigator.stateService.currentState$.map(function(frame){return function(renderer){renderer.updateFrame(frame);return renderer}}).subscribe(this._rendererOperation$);this._nodeSubscription=this._navigator.stateService.currentNode$.filter(function(node){return node.pano?Utils_1.Settings.maxImageSize>Utils_1.Settings.basePanoramaSize:Utils_1.Settings.maxImageSize>Utils_1.Settings.baseImageSize}).debounceTime(1e3).switchMap(function(node){return Graph_1.ImageLoader.load(node.key,Utils_1.Settings.maxImageSize).filter(function(statusObject){return statusObject.object!=null}).first().map(function(statusObject){return statusObject.object}).zip(Observable_1.Observable.of(node),function(i,n){return[i,n]})}).map(function(imn){return function(renderer){renderer.updateTexture(imn[0],imn[1]);return renderer}}).subscribe(this._rendererOperation$)};ImagePlaneComponent.prototype._deactivate=function(){this._rendererDisposer$.next(null);this._rendererSubscription.unsubscribe();this._stateSubscription.unsubscribe();this._nodeSubscription.unsubscribe()};ImagePlaneComponent.componentName="imageplane";return ImagePlaneComponent}(Component_1.Component);exports.ImagePlaneComponent=ImagePlaneComponent;Component_1.ComponentService.register(ImagePlaneComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=ImagePlaneComponent},{"../../Component":404,"../../Graph":408,"../../Render":410,"../../Utils":412,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/of":240,"rxjs/add/operator/delay":247,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/scan":263,"rxjs/add/operator/switchMap":269}],443:[function(require,module,exports){"use strict";var THREE=require("three");var Component_1=require("../../Component");var ImagePlaneFactory=function(){function ImagePlaneFactory(imagePlaneDepth,imageSphereRadius){this._imagePlaneDepth=imagePlaneDepth!=null?imagePlaneDepth:200;this._imageSphereRadius=imageSphereRadius!=null?imageSphereRadius:200}ImagePlaneFactory.prototype.createMesh=function(node,transform){var mesh=node.pano?this._createImageSphere(node,transform):this._createImagePlane(node,transform);return mesh};ImagePlaneFactory.prototype._createImageSphere=function(node,transform){var texture=this._createTexture(node.image);var materialParameters=this._createSphereMaterialParameters(transform,texture);var material=new THREE.ShaderMaterial(materialParameters);var mesh=this._useMesh(transform,node)?new THREE.Mesh(this._getImageSphereGeo(transform,node),material):new THREE.Mesh(this._getFlatImageSphereGeo(transform),material);return mesh};ImagePlaneFactory.prototype._createImagePlane=function(node,transform){var texture=this._createTexture(node.image);var materialParameters=this._createPlaneMaterialParameters(transform,texture);var material=new THREE.ShaderMaterial(materialParameters);var geometry=this._useMesh(transform,node)?this._getImagePlaneGeo(transform,node):this._getFlatImagePlaneGeo(transform);return new THREE.Mesh(geometry,material)};ImagePlaneFactory.prototype._createSphereMaterialParameters=function(transform,texture){var gpano=transform.gpano;var halfCroppedWidth=(gpano.FullPanoWidthPixels-gpano.CroppedAreaImageWidthPixels)/2;var phiShift=2*Math.PI*(gpano.CroppedAreaLeftPixels-halfCroppedWidth)/gpano.FullPanoWidthPixels;var phiLength=2*Math.PI*gpano.CroppedAreaImageWidthPixels/gpano.FullPanoWidthPixels;var halfCroppedHeight=(gpano.FullPanoHeightPixels-gpano.CroppedAreaImageHeightPixels)/2;var thetaShift=Math.PI*(halfCroppedHeight-gpano.CroppedAreaTopPixels)/gpano.FullPanoHeightPixels;var thetaLength=Math.PI*gpano.CroppedAreaImageHeightPixels/gpano.FullPanoHeightPixels;var materialParameters={depthWrite:false,fragmentShader:Component_1.ImagePlaneShaders.equirectangular.fragment,side:THREE.DoubleSide,transparent:true,uniforms:{opacity:{type:"f",value:1},phiLength:{type:"f",value:phiLength},phiShift:{type:"f",value:phiShift},projectorMat:{type:"m4",value:transform.rt},projectorTex:{type:"t",value:texture},thetaLength:{type:"f",value:thetaLength},thetaShift:{type:"f",value:thetaShift}},vertexShader:Component_1.ImagePlaneShaders.equirectangular.vertex};return materialParameters};ImagePlaneFactory.prototype._createPlaneMaterialParameters=function(transform,texture){var materialParameters={depthWrite:false,fragmentShader:Component_1.ImagePlaneShaders.perspective.fragment,side:THREE.DoubleSide,transparent:true,uniforms:{bbox:{type:"v4",value:new THREE.Vector4(0,0,1,1)},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:transform.projectorMatrix()},projectorTex:{type:"t",value:texture}},vertexShader:Component_1.ImagePlaneShaders.perspective.vertex};return materialParameters};ImagePlaneFactory.prototype._createTexture=function(image){var texture=new THREE.Texture(image);texture.minFilter=THREE.LinearFilter;texture.needsUpdate=true;return texture};ImagePlaneFactory.prototype._useMesh=function(transform,node){return node.mesh.vertices.length&&transform.scale>.01&&transform.scale<50};ImagePlaneFactory.prototype._getImageSphereGeo=function(transform,node){var t=(new THREE.Matrix4).getInverse(transform.srt);var minZ=5*transform.scale;var maxZ=this._imageSphereRadius*transform.scale;var vertices=node.mesh.vertices;var numVertices=vertices.length/3;var positions=new Float32Array(vertices.length);for(var i=0;i<numVertices;++i){var index=3*i;var x=vertices[index+0];var y=vertices[index+1];var z=vertices[index+2];var l=Math.sqrt(x*x+y*y+z*z);var boundedL=Math.max(minZ,Math.min(l,maxZ));var factor=boundedL/l;var p=new THREE.Vector3(x*factor,y*factor,z*factor);p.applyMatrix4(t);positions[index+0]=p.x;positions[index+1]=p.y;positions[index+2]=p.z}var faces=node.mesh.faces;var indices=new Uint16Array(faces.length);for(var i=0;i<faces.length;++i){indices[i]=faces[i]}var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(positions,3));geometry.setIndex(new THREE.BufferAttribute(indices,1));return geometry};ImagePlaneFactory.prototype._getImagePlaneGeo=function(transform,node){var t=(new THREE.Matrix4).getInverse(transform.srt);var minZ=5*transform.scale;var maxZ=this._imagePlaneDepth*transform.scale;var vertices=node.mesh.vertices;var numVertices=vertices.length/3;var positions=new Float32Array(vertices.length);for(var i=0;i<numVertices;++i){var index=3*i;var x=vertices[index+0];var y=vertices[index+1];var z=vertices[index+2];var boundedZ=Math.max(minZ,Math.min(z,maxZ));var factor=boundedZ/z;var p=new THREE.Vector3(x*factor,y*factor,boundedZ);p.applyMatrix4(t);positions[index+0]=p.x;positions[index+1]=p.y;positions[index+2]=p.z}var faces=node.mesh.faces;var indices=new Uint16Array(faces.length);for(var i=0;i<faces.length;++i){indices[i]=faces[i]}var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(positions,3));geometry.setIndex(new THREE.BufferAttribute(indices,1));return geometry};ImagePlaneFactory.prototype._getFlatImageSphereGeo=function(transform){var gpano=transform.gpano;var phiStart=2*Math.PI*gpano.CroppedAreaLeftPixels/gpano.FullPanoWidthPixels;var phiLength=2*Math.PI*gpano.CroppedAreaImageWidthPixels/gpano.FullPanoWidthPixels;var thetaStart=Math.PI*(gpano.FullPanoHeightPixels-gpano.CroppedAreaImageHeightPixels-gpano.CroppedAreaTopPixels)/gpano.FullPanoHeightPixels;var thetaLength=Math.PI*gpano.CroppedAreaImageHeightPixels/gpano.FullPanoHeightPixels;var geometry=new THREE.SphereGeometry(this._imageSphereRadius,20,40,phiStart-Math.PI/2,phiLength,thetaStart,thetaLength);geometry.applyMatrix((new THREE.Matrix4).getInverse(transform.rt));return geometry};ImagePlaneFactory.prototype._getFlatImagePlaneGeo=function(transform){var width=transform.width;var height=transform.height;var size=Math.max(width,height);var dx=width/2/size;var dy=height/2/size;var vertices=[];vertices.push(transform.pixelToVertex(-dx,-dy,this._imagePlaneDepth));vertices.push(transform.pixelToVertex(dx,-dy,this._imagePlaneDepth));vertices.push(transform.pixelToVertex(dx,dy,this._imagePlaneDepth));vertices.push(transform.pixelToVertex(-dx,dy,this._imagePlaneDepth));var positions=new Float32Array(12);for(var i=0;i<vertices.length;i++){var index=3*i;positions[index+0]=vertices[i].x;positions[index+1]=vertices[i].y;positions[index+2]=vertices[i].z}var indices=new Uint16Array(6);indices[0]=0;indices[1]=1;indices[2]=3;indices[3]=1;indices[4]=2;indices[5]=3;var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(positions,3));geometry.setIndex(new THREE.BufferAttribute(indices,1));return geometry};return ImagePlaneFactory}();exports.ImagePlaneFactory=ImagePlaneFactory;Object.defineProperty(exports,"__esModule",{value:true});exports.default=ImagePlaneFactory},{"../../Component":404,three:354}],444:[function(require,module,exports){"use strict";var Component_1=require("../../Component");var Geo_1=require("../../Geo");var ImagePlaneGLRenderer=function(){function ImagePlaneGLRenderer(){this._imagePlaneFactory=new Component_1.ImagePlaneFactory;this._imagePlaneScene=new Component_1.ImagePlaneScene;this._alpha=0;this._alphaOld=0;this._fadeOutSpeed=.05;this._lastCamera=new Geo_1.Camera;this._epsilon=1e-6;this._currentKey=null;this._previousKey=null;this._frameId=0;this._needsRender=false}Object.defineProperty(ImagePlaneGLRenderer.prototype,"frameId",{get:function(){return this._frameId},enumerable:true,configurable:true});Object.defineProperty(ImagePlaneGLRenderer.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});ImagePlaneGLRenderer.prototype.updateFrame=function(frame){this._updateFrameId(frame.id);this._needsRender=this._updateAlpha(frame.state.alpha)||this._needsRender;this._needsRender=this._updateAlphaOld(frame.state.alpha)||this._needsRender;this._needsRender=this._updateImagePlanes(frame.state)||this._needsRender};ImagePlaneGLRenderer.prototype.updateTexture=function(image,node){if(this._currentKey!==node.key){return}this._needsRender=true;for(var _i=0,_a=this._imagePlaneScene.imagePlanes;_i<_a.length;_i++){var plane=_a[_i];var material=plane.material;var texture=material.uniforms.projectorTex.value;texture.image=image;texture.needsUpdate=true}};ImagePlaneGLRenderer.prototype.render=function(perspectiveCamera,renderer){var planeAlpha=this._imagePlaneScene.imagePlanesOld.length?1:this._alpha;for(var _i=0,_a=this._imagePlaneScene.imagePlanes;_i<_a.length;_i++){var plane=_a[_i];plane.material.uniforms.opacity.value=planeAlpha}for(var _b=0,_c=this._imagePlaneScene.imagePlanesOld;_b<_c.length;_b++){var plane=_c[_b];plane.material.uniforms.opacity.value=this._alphaOld}renderer.render(this._imagePlaneScene.scene,perspectiveCamera);renderer.render(this._imagePlaneScene.sceneOld,perspectiveCamera);for(var _d=0,_e=this._imagePlaneScene.imagePlanes;_d<_e.length;_d++){var plane=_e[_d];plane.material.uniforms.opacity.value=this._alpha}renderer.render(this._imagePlaneScene.scene,perspectiveCamera)};ImagePlaneGLRenderer.prototype.clearNeedsRender=function(){this._needsRender=false};ImagePlaneGLRenderer.prototype.dispose=function(){this._imagePlaneScene.clear()};ImagePlaneGLRenderer.prototype._updateFrameId=function(frameId){this._frameId=frameId};ImagePlaneGLRenderer.prototype._updateAlpha=function(alpha){if(alpha===this._alpha){return false}this._alpha=alpha;return true};ImagePlaneGLRenderer.prototype._updateAlphaOld=function(alpha){if(alpha<1||this._alphaOld===0){return false}this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed);return true};ImagePlaneGLRenderer.prototype._updateImagePlanes=function(state){if(state.currentNode==null||state.currentNode.key===this._currentKey){return false}this._previousKey=state.previousNode!=null?state.previousNode.key:null;if(this._previousKey!=null){if(this._previousKey!==this._currentKey){var previousMesh=this._imagePlaneFactory.createMesh(state.previousNode,state.previousTransform);this._imagePlaneScene.updateImagePlanes([previousMesh])}}this._currentKey=state.currentNode.key;var currentMesh=this._imagePlaneFactory.createMesh(state.currentNode,state.currentTransform);this._imagePlaneScene.updateImagePlanes([currentMesh]);this._alphaOld=1;return true};return ImagePlaneGLRenderer}();exports.ImagePlaneGLRenderer=ImagePlaneGLRenderer;Object.defineProperty(exports,"__esModule",{value:true});exports.default=ImagePlaneGLRenderer},{"../../Component":404,"../../Geo":407}],445:[function(require,module,exports){"use strict";var THREE=require("three");var ImagePlaneScene=function(){function ImagePlaneScene(){this.scene=new THREE.Scene;this.sceneOld=new THREE.Scene;this.imagePlanes=[];this.imagePlanesOld=[]}ImagePlaneScene.prototype.updateImagePlanes=function(planes){this._dispose(this.imagePlanesOld,this.sceneOld);for(var _i=0,_a=this.imagePlanes;_i<_a.length;_i++){var plane=_a[_i];this.scene.remove(plane);this.sceneOld.add(plane)}for(var _b=0,planes_1=planes;_b<planes_1.length;_b++){var plane=planes_1[_b];this.scene.add(plane)}this.imagePlanesOld=this.imagePlanes;this.imagePlanes=planes};ImagePlaneScene.prototype.addImagePlanes=function(planes){for(var _i=0,planes_2=planes;_i<planes_2.length;_i++){var plane=planes_2[_i];this.scene.add(plane);this.imagePlanes.push(plane)}};ImagePlaneScene.prototype.addImagePlanesOld=function(planes){for(var _i=0,planes_3=planes;_i<planes_3.length;_i++){var plane=planes_3[_i];this.sceneOld.add(plane);this.imagePlanesOld.push(plane)}};ImagePlaneScene.prototype.setImagePlanes=function(planes){this._clear();this.addImagePlanes(planes);
};ImagePlaneScene.prototype.setImagePlanesOld=function(planes){this._clearOld();this.addImagePlanesOld(planes)};ImagePlaneScene.prototype.clear=function(){this._clear();this._clearOld()};ImagePlaneScene.prototype._clear=function(){this._dispose(this.imagePlanes,this.scene);this.imagePlanes.length=0};ImagePlaneScene.prototype._clearOld=function(){this._dispose(this.imagePlanesOld,this.sceneOld);this.imagePlanesOld.length=0};ImagePlaneScene.prototype._dispose=function(planes,scene){for(var _i=0,planes_4=planes;_i<planes_4.length;_i++){var plane=planes_4[_i];scene.remove(plane);plane.geometry.dispose();plane.material.dispose();var texture=plane.material.uniforms.projectorTex.value;if(texture!=null){texture.dispose()}}};return ImagePlaneScene}();exports.ImagePlaneScene=ImagePlaneScene;Object.defineProperty(exports,"__esModule",{value:true});exports.default=ImagePlaneScene},{three:354}],446:[function(require,module,exports){"use strict";var path=require("path");var ImagePlaneShaders=function(){function ImagePlaneShaders(){}ImagePlaneShaders.equirectangular={fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float phiLength;\nuniform float phiShift;\nuniform float thetaLength;\nuniform float thetaShift;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lon = atan(b.x, b.z);\n    float x = (lon - phiShift) / phiLength + 0.5;\n    float y = (lat - thetaShift) / thetaLength + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};ImagePlaneShaders.perspective={fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform vec4 bbox;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.w;\n    float y = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (x > bbox[0] && y > bbox[1] && x < bbox[2] && y < bbox[3]) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};return ImagePlaneShaders}();exports.ImagePlaneShaders=ImagePlaneShaders},{path:184}],447:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/combineLatest");require("rxjs/add/observable/fromEvent");require("rxjs/add/observable/of");require("rxjs/add/observable/zip");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/first");require("rxjs/add/operator/map");require("rxjs/add/operator/merge");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/scan");require("rxjs/add/operator/switchMap");require("rxjs/add/operator/withLatestFrom");require("rxjs/add/operator/zip");var Graph_1=require("../../Graph");var State_1=require("../../State");var Render_1=require("../../Render");var Utils_1=require("../../Utils");var Component_1=require("../../Component");var SliderState=function(){function SliderState(){this._imagePlaneFactory=new Component_1.ImagePlaneFactory;this._imagePlaneScene=new Component_1.ImagePlaneScene;this._currentKey=null;this._previousKey=null;this._currentPano=false;this._frameId=0;this._glNeedsRender=false;this._domNeedsRender=true;this._motionless=false;this._curtain=1}Object.defineProperty(SliderState.prototype,"frameId",{get:function(){return this._frameId},enumerable:true,configurable:true});Object.defineProperty(SliderState.prototype,"curtain",{get:function(){return this._curtain},enumerable:true,configurable:true});Object.defineProperty(SliderState.prototype,"glNeedsRender",{get:function(){return this._glNeedsRender},enumerable:true,configurable:true});Object.defineProperty(SliderState.prototype,"domNeedsRender",{get:function(){return this._domNeedsRender},enumerable:true,configurable:true});Object.defineProperty(SliderState.prototype,"sliderVisible",{get:function(){return this._sliderVisible},set:function(value){this._sliderVisible=value;this._domNeedsRender=true},enumerable:true,configurable:true});Object.defineProperty(SliderState.prototype,"disabled",{get:function(){return this._currentKey==null||this._previousKey==null||this._motionless||this._currentPano},enumerable:true,configurable:true});SliderState.prototype.update=function(frame){this._updateFrameId(frame.id);var needsRender=this._updateImagePlanes(frame.state);needsRender=this._updateCurtain(frame.state.alpha)||needsRender;this._glNeedsRender=needsRender||this._glNeedsRender;this._domNeedsRender=needsRender||this._domNeedsRender};SliderState.prototype.updateTexture=function(image,node){var imagePlanes=node.key===this._currentKey?this._imagePlaneScene.imagePlanes:node.key===this._previousKey?this._imagePlaneScene.imagePlanesOld:[];if(imagePlanes.length===0){return}this._glNeedsRender=true;for(var _i=0,imagePlanes_1=imagePlanes;_i<imagePlanes_1.length;_i++){var plane=imagePlanes_1[_i];var material=plane.material;var texture=material.uniforms.projectorTex.value;texture.image=image;texture.needsUpdate=true}};SliderState.prototype.render=function(perspectiveCamera,renderer){if(!this.disabled){renderer.render(this._imagePlaneScene.sceneOld,perspectiveCamera)}renderer.render(this._imagePlaneScene.scene,perspectiveCamera)};SliderState.prototype.dispose=function(){this._imagePlaneScene.clear()};SliderState.prototype.clearGLNeedsRender=function(){this._glNeedsRender=false};SliderState.prototype.clearDomNeedsRender=function(){this._domNeedsRender=false};SliderState.prototype._updateFrameId=function(frameId){this._frameId=frameId};SliderState.prototype._updateImagePlanes=function(state){if(state.currentNode==null){return}var needsRender=false;if(state.previousNode!=null&&this._previousKey!==state.previousNode.key){needsRender=true;this._previousKey=state.previousNode.key;this._motionless=state.motionless;this._imagePlaneScene.setImagePlanesOld([this._imagePlaneFactory.createMesh(state.previousNode,state.previousTransform)])}if(this._currentKey!==state.currentNode.key){needsRender=true;this._currentKey=state.currentNode.key;this._currentPano=state.currentNode.pano;this._motionless=state.motionless;this._imagePlaneScene.setImagePlanes([this._imagePlaneFactory.createMesh(state.currentNode,state.currentTransform)])}return needsRender};SliderState.prototype._updateCurtain=function(alpha){if(this.disabled||Math.abs(this._curtain-alpha)<.001){return false}this._curtain=alpha;for(var _i=0,_a=this._imagePlaneScene.imagePlanes;_i<_a.length;_i++){var plane=_a[_i];var shaderMaterial=plane.material;var bbox=shaderMaterial.uniforms.bbox.value;bbox.z=this._curtain}return true};return SliderState}();var SliderComponent=function(_super){__extends(SliderComponent,_super);function SliderComponent(name,container,navigator){_super.call(this,name,container,navigator);this._sliderStateOperation$=new Subject_1.Subject;this._sliderStateCreator$=new Subject_1.Subject;this._sliderStateDisposer$=new Subject_1.Subject;this._sliderState$=this._sliderStateOperation$.scan(function(sliderState,operation){return operation(sliderState)},null).filter(function(sliderState){return sliderState!=null}).distinctUntilChanged(undefined,function(sliderState){return sliderState.frameId});this._sliderStateCreator$.map(function(){return function(sliderState){if(sliderState!=null){throw new Error("Multiple slider states can not be created at the same time")}return new SliderState}}).subscribe(this._sliderStateOperation$);this._sliderStateDisposer$.map(function(){return function(sliderState){sliderState.dispose();return null}}).subscribe(this._sliderStateOperation$)}SliderComponent.prototype.setKeys=function(keys){this.configure({keys:keys})};SliderComponent.prototype.setInitialPosition=function(initialPosition){this.configure({initialPosition:initialPosition})};SliderComponent.prototype.setSliderVisible=function(sliderVisible){this.configure({sliderVisible:sliderVisible})};SliderComponent.prototype._activate=function(){var _this=this;this._container.mouseService.preventDefaultMouseDown$.next(false);this._container.touchService.preventDefaultTouchMove$.next(false);Observable_1.Observable.combineLatest(this._navigator.stateService.state$,this._configuration$).first().subscribe(function(stateConfig){if(stateConfig[0]===State_1.State.Traversing){_this._navigator.stateService.wait();var position=stateConfig[1].initialPosition;_this._navigator.stateService.moveTo(position!=null?position:1)}});this._glRenderSubscription=this._sliderState$.map(function(sliderState){var renderHash={name:_this._name,render:{frameId:sliderState.frameId,needsRender:sliderState.glNeedsRender,render:sliderState.render.bind(sliderState),stage:Render_1.GLRenderStage.Background}};sliderState.clearGLNeedsRender();return renderHash}).subscribe(this._container.glRenderer.render$);this._domRenderSubscription=this._sliderState$.filter(function(sliderState){return sliderState.domNeedsRender}).map(function(sliderState){var sliderInput=vd.h("input.SliderControl",{max:1e3,min:0,type:"range",value:1e3*sliderState.curtain},[]);var vNode=sliderState.disabled||!sliderState.sliderVisible?null:vd.h("div.SliderWrapper",{},[sliderInput]);var hash={name:_this._name,vnode:vNode};sliderState.clearDomNeedsRender();return hash}).subscribe(this._container.domRenderer.render$);this._elementSubscription=this._container.domRenderer.element$.map(function(e){var nodeList=e.getElementsByClassName("SliderControl");var slider=nodeList.length>0?nodeList[0]:null;return slider}).filter(function(input){return input!=null}).switchMap(function(input){return Observable_1.Observable.fromEvent(input,"input")}).map(function(e){return Number(e.target.value)/1e3}).subscribe(function(curtain){_this._navigator.stateService.moveTo(curtain)});this._sliderStateCreator$.next(null);this._stateSubscription=this._navigator.stateService.currentState$.map(function(frame){return function(sliderState){sliderState.update(frame);return sliderState}}).subscribe(this._sliderStateOperation$);this._setSliderVisibleSubscription=this._configuration$.map(function(configuration){return configuration.sliderVisible==null||configuration.sliderVisible}).distinctUntilChanged().map(function(sliderVisible){return function(sliderState){sliderState.sliderVisible=sliderVisible;return sliderState}}).subscribe(this._sliderStateOperation$);this._setKeysSubscription=this._configuration$.filter(function(configuration){return configuration.keys!=null}).switchMap(function(configuration){return Observable_1.Observable.zip([_this._navigator.graphService.node$(configuration.keys.background),_this._navigator.graphService.node$(configuration.keys.foreground)],function(background,foreground){return{background:background,foreground:foreground}}).withLatestFrom(_this._navigator.stateService.currentState$,function(nodes,frame){return{nodes:nodes,state:frame.state}})}).subscribe(function(co){if(co.state.currentNode!=null&&co.state.previousNode!=null&&co.state.currentNode.key===co.nodes.foreground.key&&co.state.previousNode.key===co.nodes.background.key){return}if(co.state.currentNode.key===co.nodes.background.key){_this._navigator.stateService.setNodes([co.nodes.foreground]);return}if(co.state.currentNode.key===co.nodes.foreground.key&&co.state.trajectory.length===1){_this._navigator.stateService.prependNodes([co.nodes.background]);return}_this._navigator.stateService.setNodes([co.nodes.background]);_this._navigator.stateService.setNodes([co.nodes.foreground])},function(e){console.log(e)});var previousNode$=this._navigator.stateService.currentState$.map(function(frame){return frame.state.previousNode}).filter(function(node){return node!=null}).distinctUntilChanged(undefined,function(node){return node.key});this._nodeSubscription=Observable_1.Observable.merge(previousNode$,this._navigator.stateService.currentNode$).filter(function(node){return node.pano?Utils_1.Settings.maxImageSize>Utils_1.Settings.basePanoramaSize:Utils_1.Settings.maxImageSize>Utils_1.Settings.baseImageSize}).mergeMap(function(node){return Graph_1.ImageLoader.load(node.key,Utils_1.Settings.maxImageSize).filter(function(statusObject){return statusObject.object!=null}).first().map(function(statusObject){return statusObject.object}).zip(Observable_1.Observable.of(node),function(t,n){return[t,n]})}).map(function(imn){return function(sliderState){sliderState.updateTexture(imn[0],imn[1]);return sliderState}}).subscribe(this._sliderStateOperation$)};SliderComponent.prototype._deactivate=function(){var _this=this;this._container.mouseService.preventDefaultMouseDown$.next(true);this._container.touchService.preventDefaultTouchMove$.next(true);this._navigator.stateService.state$.first().subscribe(function(state){if(state===State_1.State.Waiting){_this._navigator.stateService.traverse()}});this._sliderStateDisposer$.next(null);this._setKeysSubscription.unsubscribe();this._setSliderVisibleSubscription.unsubscribe();this._elementSubscription.unsubscribe();this._stateSubscription.unsubscribe();this._glRenderSubscription.unsubscribe();this._domRenderSubscription.unsubscribe();this._nodeSubscription.unsubscribe();this.configure({keys:null})};SliderComponent.componentName="slider";return SliderComponent}(Component_1.Component);exports.SliderComponent=SliderComponent;Component_1.ComponentService.register(SliderComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=SliderComponent},{"../../Component":404,"../../Graph":408,"../../Render":410,"../../State":411,"../../Utils":412,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/combineLatest":234,"rxjs/add/observable/fromEvent":237,"rxjs/add/observable/of":240,"rxjs/add/observable/zip":242,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/filter":252,"rxjs/add/operator/first":254,"rxjs/add/operator/map":255,"rxjs/add/operator/merge":256,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/scan":263,"rxjs/add/operator/switchMap":269,"rxjs/add/operator/withLatestFrom":272,"rxjs/add/operator/zip":273,"virtual-dom":360}],448:[function(require,module,exports){"use strict";var Marker=function(){function Marker(latLonAlt,markerOptions){this.visibleInKeys=[];this._id=markerOptions.id;this._latLonAlt=latLonAlt;this._markerOptions=markerOptions;this._type=markerOptions.type}Object.defineProperty(Marker.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(Marker.prototype,"type",{get:function(){return this._type},enumerable:true,configurable:true});Object.defineProperty(Marker.prototype,"latLonAlt",{get:function(){return this._latLonAlt},enumerable:true,configurable:true});return Marker}();exports.Marker=Marker;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Marker},{}],449:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var _=require("underscore");var THREE=require("three");var rbush=require("rbush");var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/combineLatest");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/switchMap");var Component_1=require("../../Component");var Render_1=require("../../Render");var Geo_1=require("../../Geo");var MarkerSet=function(){function MarkerSet(){this._create$=new Subject_1.Subject;this._remove$=new Subject_1.Subject;this._update$=new Subject_1.Subject;this._markers$=this._update$.scan(function(markers,operation){return operation(markers)},{hash:{},spatial:rbush(16,[".lon",".lat",".lon",".lat"])}).map(function(markers){return markers.spatial}).publishReplay(1).refCount();this._create$.map(function(marker){return function(markers){if(markers.hash[marker.id]){markers.spatial.remove(markers.hash[marker.id])}var rbushObj={id:marker.id,lat:marker.latLonAlt.lat,lon:marker.latLonAlt.lon,marker:marker};markers.spatial.insert(rbushObj);markers.hash[marker.id]=rbushObj;return markers}}).subscribe(this._update$);this._remove$.map(function(id){return function(markers){var rbushObj=markers.hash[id];markers.spatial.remove(rbushObj);delete markers.hash[id];return markers}}).subscribe(this._update$)}MarkerSet.prototype.addMarker=function(marker){this._create$.next(marker)};MarkerSet.prototype.removeMarker=function(id){this._remove$.next(id)};Object.defineProperty(MarkerSet.prototype,"markers$",{get:function(){return this._markers$},enumerable:true,configurable:true});return MarkerSet}();exports.MarkerSet=MarkerSet;var MarkerComponent=function(_super){__extends(MarkerComponent,_super);function MarkerComponent(name,container,navigator){_super.call(this,name,container,navigator)}MarkerComponent.prototype._activate=function(){var _this=this;this._scene=new THREE.Scene;this._markerSet=new MarkerSet;this._markerObjects={};this._disposable=Observable_1.Observable.combineLatest([this._navigator.stateService.currentState$,this._markerSet.markers$],function(frame,markers){return{frame:frame,markers:markers}}).distinctUntilChanged(undefined,function(args){return args.frame.id}).map(function(args){return _this._renderHash(args)}).subscribe(this._container.glRenderer.render$);this._disposableConfiguration=this.configuration$.filter(function(conf){return conf.mapillaryObjects}).switchMap(function(conf){return _this._navigator.graphService.vectorTilesService.mapillaryObjects$.map(function(mapillaryObject){var views=_.map(mapillaryObject.rects,function(rect){return rect.image_key});var latLonAlt={alt:mapillaryObject.alt,lat:mapillaryObject.latLon.lat,lon:mapillaryObject.latLon.lon};var options={id:"mapillary-object-"+mapillaryObject.key,style:{ballColor:"#00FF00",ballOpacity:1,color:"#FF0000",opacity:.2},type:"marker"};var marker=_this.createMarker(latLonAlt,options);marker.visibleInKeys=views;return marker})}).subscribe(function(marker){_this.addMarker(marker)})};MarkerComponent.prototype._deactivate=function(){this._disposeScene();this._disposable.unsubscribe();this._disposableConfiguration.unsubscribe()};MarkerComponent.prototype.createMarker=function(latLonAlt,markerOptions){if(markerOptions.type==="marker"){return new Component_1.SimpleMarker(latLonAlt,markerOptions)}return null};MarkerComponent.prototype.addMarker=function(marker){this._markerSet.addMarker(marker)};Object.defineProperty(MarkerComponent.prototype,"markers$",{get:function(){return this._markerSet.markers$},enumerable:true,configurable:true});MarkerComponent.prototype.removeMarker=function(id){this._markerSet.removeMarker(id)};MarkerComponent.prototype._renderHash=function(args){var needsRender=this._updateScene(args);return{name:this._name,render:{frameId:args.frame.id,needsRender:needsRender,render:this._render.bind(this),stage:Render_1.GLRenderStage.Foreground}}};MarkerComponent.prototype._updateScene=function(args){if(!args.frame||!args.markers||!args.frame.state.currentNode){return false}var needRender=false;var oldObjects=this._markerObjects;var node=args.frame.state.currentNode;this._markerObjects={};var boxWidth=.001;var minLon=node.latLon.lon-boxWidth/2;var minLat=node.latLon.lat-boxWidth/2;var maxLon=node.latLon.lon+boxWidth/2;var maxLat=node.latLon.lat+boxWidth/2;var markers=_.map(args.markers.search({maxX:maxLon,maxY:maxLat,minX:minLon,minY:minLat}),function(item){return item.marker}).filter(function(marker){return marker.visibleInKeys.length===0||_.contains(marker.visibleInKeys,node.key)});for(var _i=0,markers_1=markers;_i<markers_1.length;_i++){var marker=markers_1[_i];if(marker.id in oldObjects){this._markerObjects[marker.id]=oldObjects[marker.id];delete oldObjects[marker.id]}else{var reference=args.frame.state.reference;var p=(new Geo_1.GeoCoords).geodeticToEnu(marker.latLonAlt.lat,marker.latLonAlt.lon,marker.latLonAlt.alt,reference.lat,reference.lon,reference.alt);var o=marker.createGeometry();o.position.set(p[0],p[1],p[2]);this._scene.add(o);this._markerObjects[marker.id]=o;needRender=true}}for(var i in oldObjects){if(oldObjects.hasOwnProperty(i)){this._disposeObject(oldObjects[i]);needRender=true}}return needRender};MarkerComponent.prototype._render=function(perspectiveCamera,renderer){renderer.render(this._scene,perspectiveCamera)};MarkerComponent.prototype._disposeObject=function(object){this._scene.remove(object);for(var i=0;i<object.children.length;++i){var c=object.children[i];c.geometry.dispose();c.material.dispose()}};MarkerComponent.prototype._disposeScene=function(){for(var i in this._markerObjects){if(this._markerObjects.hasOwnProperty(i)){this._disposeObject(this._markerObjects[i])}}this._markerObjects={}};MarkerComponent.componentName="marker";return MarkerComponent}(Component_1.Component);exports.MarkerComponent=MarkerComponent;Component_1.ComponentService.register(MarkerComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=MarkerComponent},{"../../Component":404,"../../Geo":407,"../../Render":410,rbush:195,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/combineLatest":234,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/switchMap":269,three:354,underscore:355}],450:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=require("three");var Component_1=require("../../Component");var SimpleMarker=function(_super){__extends(SimpleMarker,_super);function SimpleMarker(latLonAlt,markerOptions){_super.call(this,latLonAlt,markerOptions);this._circleToRayAngle=2;this._simpleMarkerStyle=markerOptions.style}SimpleMarker.prototype.createGeometry=function(){var radius=2;var cone=new THREE.Mesh(this._markerGeometry(radius,16,8),new THREE.MeshBasicMaterial({color:this._stringToRBG(this._simpleMarkerStyle.color),depthWrite:false,opacity:this._simpleMarkerStyle.opacity,shading:THREE.SmoothShading,transparent:true}));var ball=new THREE.Mesh(new THREE.SphereGeometry(radius/2,16,8),new THREE.MeshBasicMaterial({color:this._stringToRBG(this._simpleMarkerStyle.ballColor),depthWrite:false,opacity:this._simpleMarkerStyle.ballOpacity,shading:THREE.SmoothShading,transparent:true}));ball.position.z=this._markerHeight(radius);var group=new THREE.Object3D;group.add(ball);group.add(cone);return group};SimpleMarker.prototype._markerHeight=function(radius){var t=Math.tan(Math.PI-this._circleToRayAngle);return radius*Math.sqrt(1+t*t)};SimpleMarker.prototype._markerGeometry=function(radius,widthSegments,heightSegments){var geometry=new THREE.Geometry;widthSegments=Math.max(3,Math.floor(widthSegments)||8);heightSegments=Math.max(2,Math.floor(heightSegments)||6);var height=this._markerHeight(radius);var vertices=[];for(var y=0;y<=heightSegments;++y){var verticesRow=[];for(var x=0;x<=widthSegments;++x){var u=x/widthSegments*Math.PI*2;var v=y/heightSegments*Math.PI;var r=void 0;if(v<this._circleToRayAngle){r=radius}else{var t=Math.tan(v-this._circleToRayAngle);r=radius*Math.sqrt(1+t*t)}var vertex=new THREE.Vector3;vertex.x=r*Math.cos(u)*Math.sin(v);vertex.y=r*Math.sin(u)*Math.sin(v);vertex.z=r*Math.cos(v)+height;geometry.vertices.push(vertex);verticesRow.push(geometry.vertices.length-1)}vertices.push(verticesRow)}for(var y=0;y<heightSegments;++y){for(var x=0;x<widthSegments;++x){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=vertices[y+1][x];var v4=vertices[y+1][x+1];var n1=geometry.vertices[v1].clone().normalize();var n2=geometry.vertices[v2].clone().normalize();var n3=geometry.vertices[v3].clone().normalize();var n4=geometry.vertices[v4].clone().normalize();geometry.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));geometry.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]))}}geometry.computeFaceNormals();geometry.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius+height);return geometry};SimpleMarker.prototype._stringToRBG=function(str){var ret=0;for(var i=0;i<str.length;i++){ret=str.charCodeAt(i)+((ret<<5)-ret)}return ret};return SimpleMarker}(Component_1.Marker);exports.SimpleMarker=SimpleMarker;Object.defineProperty(exports,"__esModule",{value:true});exports.default=SimpleMarker},{"../../Component":404,three:354}],451:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/combineLatest");require("rxjs/add/observable/of");require("rxjs/add/operator/concat");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/finally");require("rxjs/add/operator/first");require("rxjs/add/operator/map");require("rxjs/add/operator/scan");require("rxjs/add/operator/share");require("rxjs/add/operator/switchMap");require("rxjs/add/operator/takeUntil");require("rxjs/add/operator/withLatestFrom");var Component_1=require("../../Component");var Edge_1=require("../../Edge");var SequenceComponent=function(_super){__extends(SequenceComponent,_super);function SequenceComponent(name,container,navigator){_super.call(this,name,container,navigator);this._nodesAhead=5;this._configurationOperation$=new Subject_1.Subject;this._sequenceDOMRenderer=new Component_1.SequenceDOMRenderer(container.element);this._sequenceDOMInteraction=new Component_1.SequenceDOMInteraction;this._containerWidth$=new Subject_1.Subject;this._hoveredKeySubject$=new Subject_1.Subject;this._hoveredKey$=this._hoveredKeySubject$.share()}Object.defineProperty(SequenceComponent.prototype,"defaultConfiguration",{get:function(){return{direction:Edge_1.EdgeDirection.Next,maxWidth:117,minWidth:70,playing:false,visible:true}},enumerable:true,configurable:true});Object.defineProperty(SequenceComponent.prototype,"hoveredKey$",{get:function(){return this._hoveredKey$},enumerable:true,configurable:true});SequenceComponent.prototype.play=function(){this.configure({playing:true})};SequenceComponent.prototype.stop=function(){this.configure({playing:false})};SequenceComponent.prototype.setDirection=function(direction){this.configure({direction:direction})};SequenceComponent.prototype.setHighlightKey=function(highlightKey){this.configure({highlightKey:highlightKey})};SequenceComponent.prototype.setMaxWidth=function(maxWidth){this.configure({maxWidth:maxWidth})};SequenceComponent.prototype.setMinWidth=function(minWidth){this.configure({minWidth:minWidth})};SequenceComponent.prototype.setVisible=function(visible){this.configure({visible:visible})};SequenceComponent.prototype.resize=function(){var _this=this;this._configuration$.first().map(function(configuration){return _this._sequenceDOMRenderer.getContainerWidth(_this._container.element,configuration)}).subscribe(function(containerWidth){_this._containerWidth$.next(containerWidth)})};SequenceComponent.prototype._activate=function(){var _this=this;this._renderSubscription=Observable_1.Observable.combineLatest(this._navigator.stateService.currentNode$,this._configuration$,this._containerWidth$).map(function(nc){var node=nc[0];var configuration=nc[1];var containerWidth=nc[2];var vNode=_this._sequenceDOMRenderer.render(node,configuration,containerWidth,_this,_this._sequenceDOMInteraction,_this._navigator);return{name:_this._name,vnode:vNode}}).subscribe(this._container.domRenderer.render$);this._containerWidthSubscription=this._configuration$.distinctUntilChanged(function(value1,value2){return value1[0]===value2[0]&&value1[1]===value2[1]},function(configuration){return[configuration.minWidth,configuration.maxWidth]}).map(function(configuration){return _this._sequenceDOMRenderer.getContainerWidth(_this._container.element,configuration)}).subscribe(this._containerWidth$);this._configurationSubscription=this._configurationOperation$.scan(function(configuration,operation){return operation(configuration)},{playing:false}).finally(function(){if(_this._playingSubscription!=null){_this._navigator.stateService.cutNodes();_this._stop()}}).subscribe();this._configuration$.map(function(newConfiguration){return function(configuration){if(newConfiguration.playing!==configuration.playing){_this._navigator.stateService.cutNodes();if(newConfiguration.playing){_this._play()}else{_this._stop()}}configuration.playing=newConfiguration.playing;return configuration}}).subscribe(this._configurationOperation$);this._stopSubscription=this._configuration$.switchMap(function(configuration){var node$=configuration.playing?_this._navigator.stateService.currentNode$:Observable_1.Observable.empty();var edgeDirection$=Observable_1.Observable.of(configuration.direction);return Observable_1.Observable.combineLatest(node$,edgeDirection$)}).map(function(ne){var node=ne[0];var direction=ne[1];for(var _i=0,_a=node.edges;_i<_a.length;_i++){var edge=_a[_i];if(edge.data.direction===direction){return true}}return false}).filter(function(hasEdge){return!hasEdge}).map(function(hasEdge){return{playing:false}}).subscribe(this._configurationSubject$);this._hoveredKeySubscription=this._sequenceDOMInteraction.mouseEnterDirection$.switchMap(function(direction){return _this._navigator.stateService.currentNode$.map(function(node){for(var _i=0,_a=node.edges;_i<_a.length;_i++){var edge=_a[_i];if(edge.data.direction===direction){return edge.to}}return null}).takeUntil(_this._sequenceDOMInteraction.mouseLeaveDirection$).concat(Observable_1.Observable.of(null))}).distinctUntilChanged().subscribe(this._hoveredKeySubject$)};SequenceComponent.prototype._deactivate=function(){this._stopSubscription.unsubscribe();this._renderSubscription.unsubscribe();this._configurationSubscription.unsubscribe();this._containerWidthSubscription.unsubscribe();this._hoveredKeySubscription.unsubscribe();this.stop()};SequenceComponent.prototype._play=function(){var _this=this;this._playingSubscription=this._navigator.stateService.currentState$.filter(function(frame){return frame.state.nodesAhead<_this._nodesAhead}).map(function(frame){return frame.state.lastNode}).distinctUntilChanged(undefined,function(lastNode){return lastNode.key}).withLatestFrom(this._configuration$,function(lastNode,configuration){return[lastNode,configuration.direction]}).map(function(nd){var direction=nd[1];for(var _i=0,_a=nd[0].edges;_i<_a.length;_i++){var edge=_a[_i];if(edge.data.direction===direction){return edge.to}}return null}).filter(function(key){return key!=null}).switchMap(function(key){return _this._navigator.graphService.node$(key)}).subscribe(function(node){_this._navigator.stateService.appendNodes([node])},function(error){_this.stop()});this.fire(SequenceComponent.playingchanged,true);
};SequenceComponent.prototype._stop=function(){this._playingSubscription.unsubscribe();this._playingSubscription=null;this.fire(SequenceComponent.playingchanged,false)};SequenceComponent.componentName="sequence";SequenceComponent.playingchanged="playingchanged";return SequenceComponent}(Component_1.Component);exports.SequenceComponent=SequenceComponent;Component_1.ComponentService.register(SequenceComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=SequenceComponent},{"../../Component":404,"../../Edge":405,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/combineLatest":234,"rxjs/add/observable/of":240,"rxjs/add/operator/concat":245,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/filter":252,"rxjs/add/operator/finally":253,"rxjs/add/operator/first":254,"rxjs/add/operator/map":255,"rxjs/add/operator/scan":263,"rxjs/add/operator/share":264,"rxjs/add/operator/switchMap":269,"rxjs/add/operator/takeUntil":271,"rxjs/add/operator/withLatestFrom":272}],452:[function(require,module,exports){"use strict";var Subject_1=require("rxjs/Subject");var SequenceDOMInteraction=function(){function SequenceDOMInteraction(){this._mouseEnterDirection$=new Subject_1.Subject;this._mouseLeaveDirection$=new Subject_1.Subject}Object.defineProperty(SequenceDOMInteraction.prototype,"mouseEnterDirection$",{get:function(){return this._mouseEnterDirection$},enumerable:true,configurable:true});Object.defineProperty(SequenceDOMInteraction.prototype,"mouseLeaveDirection$",{get:function(){return this._mouseLeaveDirection$},enumerable:true,configurable:true});return SequenceDOMInteraction}();exports.SequenceDOMInteraction=SequenceDOMInteraction;Object.defineProperty(exports,"__esModule",{value:true});exports.default=SequenceDOMInteraction},{"rxjs/Subject":230}],453:[function(require,module,exports){"use strict";var vd=require("virtual-dom");var Edge_1=require("../../Edge");var SequenceDOMRenderer=function(){function SequenceDOMRenderer(element){this._minThresholdWidth=320;this._maxThresholdWidth=1480;this._minThresholdHeight=240;this._maxThresholdHeight=820}SequenceDOMRenderer.prototype.render=function(node,configuration,containerWidth,component,interaction,navigator){if(configuration.visible===false){return vd.h("div.SequenceContainer",{},[])}var nextKey=null;var prevKey=null;for(var _i=0,_a=node.edges;_i<_a.length;_i++){var edge=_a[_i];if(edge.data.direction===Edge_1.EdgeDirection.Next){nextKey=edge.to}if(edge.data.direction===Edge_1.EdgeDirection.Prev){prevKey=edge.to}}var playingButton=this._createPlayingButton(nextKey,prevKey,configuration,component);var arrows=this._createSequenceArrows(nextKey,prevKey,node,configuration,interaction,navigator);var containerProperties={style:{height:.27*containerWidth+"px",width:containerWidth+"px"}};return vd.h("div.SequenceContainer",containerProperties,arrows.concat([playingButton]))};SequenceDOMRenderer.prototype.getContainerWidth=function(element,configuration){var elementWidth=element.offsetWidth;var elementHeight=element.offsetHeight;var minWidth=configuration.minWidth;var maxWidth=configuration.maxWidth;if(maxWidth<minWidth){maxWidth=minWidth}var relativeWidth=(elementWidth-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth);var relativeHeight=(elementHeight-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);var coeff=Math.max(0,Math.min(1,Math.min(relativeWidth,relativeHeight)));return minWidth+coeff*(maxWidth-minWidth)};SequenceDOMRenderer.prototype._createPlayingButton=function(nextKey,prevKey,configuration,component){var canPlay=configuration.direction===Edge_1.EdgeDirection.Next&&nextKey!=null||configuration.direction===Edge_1.EdgeDirection.Prev&&prevKey!=null;var onclick=configuration.playing?function(e){component.stop()}:canPlay?function(e){component.play()}:null;var buttonProperties={onclick:onclick,style:{}};var iconClass=configuration.playing?"Stop":canPlay?"Play":"PlayDisabled";var icon=vd.h("div.SequenceComponentIcon",{className:iconClass},[]);var buttonClass=canPlay?"SequencePlay":"SequencePlayDisabled";return vd.h("div."+buttonClass,buttonProperties,[icon])};SequenceDOMRenderer.prototype._createSequenceArrows=function(nextKey,prevKey,node,configuration,interaction,navigator){var nextProperties={onclick:nextKey!=null?function(e){navigator.moveDir(Edge_1.EdgeDirection.Next).subscribe()}:null,onmouseenter:function(e){interaction.mouseEnterDirection$.next(Edge_1.EdgeDirection.Next)},onmouseleave:function(e){interaction.mouseLeaveDirection$.next(Edge_1.EdgeDirection.Next)},style:{}};var prevProperties={onclick:prevKey!=null?function(e){navigator.moveDir(Edge_1.EdgeDirection.Prev).subscribe()}:null,onmouseenter:function(e){interaction.mouseEnterDirection$.next(Edge_1.EdgeDirection.Prev)},onmouseleave:function(e){interaction.mouseLeaveDirection$.next(Edge_1.EdgeDirection.Prev)},style:{}};var nextClass=this._getStepClassName(Edge_1.EdgeDirection.Next,nextKey,configuration.highlightKey);var prevClass=this._getStepClassName(Edge_1.EdgeDirection.Prev,prevKey,configuration.highlightKey);var nextIcon=vd.h("div.SequenceComponentIcon",[]);var prevIcon=vd.h("div.SequenceComponentIcon",[]);return[vd.h("div."+nextClass,nextProperties,[nextIcon]),vd.h("div."+prevClass,prevProperties,[prevIcon])]};SequenceDOMRenderer.prototype._getStepClassName=function(direction,key,highlightKey){var className=direction===Edge_1.EdgeDirection.Next?"SequenceStepNext":"SequenceStepPrev";if(key==null){className+="Disabled"}else{if(highlightKey===key){className+="Highlight"}}return className};return SequenceDOMRenderer}();exports.SequenceDOMRenderer=SequenceDOMRenderer;Object.defineProperty(exports,"__esModule",{value:true});exports.default=SequenceDOMRenderer},{"../../Edge":405,"virtual-dom":360}],454:[function(require,module,exports){"use strict";var GeometryTagError_1=require("./error/GeometryTagError");exports.GeometryTagError=GeometryTagError_1.GeometryTagError;var PointGeometry_1=require("./geometry/PointGeometry");exports.PointGeometry=PointGeometry_1.PointGeometry;var RectGeometry_1=require("./geometry/RectGeometry");exports.RectGeometry=RectGeometry_1.RectGeometry;var PolygonGeometry_1=require("./geometry/PolygonGeometry");exports.PolygonGeometry=PolygonGeometry_1.PolygonGeometry;var OutlineTag_1=require("./tag/OutlineTag");exports.OutlineTag=OutlineTag_1.OutlineTag;var SpotTag_1=require("./tag/SpotTag");exports.SpotTag=SpotTag_1.SpotTag;var Alignment_1=require("./tag/Alignment");exports.Alignment=Alignment_1.Alignment;var TagComponent_1=require("./TagComponent");exports.TagComponent=TagComponent_1.TagComponent},{"./TagComponent":455,"./error/GeometryTagError":461,"./geometry/PointGeometry":463,"./geometry/PolygonGeometry":464,"./geometry/RectGeometry":465,"./tag/Alignment":467,"./tag/OutlineTag":469,"./tag/SpotTag":470}],455:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=require("three");var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/combineLatest");require("rxjs/add/observable/empty");require("rxjs/add/observable/from");require("rxjs/add/observable/merge");require("rxjs/add/observable/of");require("rxjs/add/operator/combineLatest");require("rxjs/add/operator/concat");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/do");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/merge");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/share");require("rxjs/add/operator/skip");require("rxjs/add/operator/skipUntil");require("rxjs/add/operator/startWith");require("rxjs/add/operator/switchMap");require("rxjs/add/operator/take");require("rxjs/add/operator/takeUntil");require("rxjs/add/operator/withLatestFrom");var Component_1=require("../../Component");var Render_1=require("../../Render");var TagComponent=function(_super){__extends(TagComponent,_super);function TagComponent(name,container,navigator){var _this=this;_super.call(this,name,container,navigator);this._tagDomRenderer=new Component_1.TagDOMRenderer;this._tagSet=new Component_1.TagSet;this._tagCreator=new Component_1.TagCreator;this._tagGlRendererOperation$=new Subject_1.Subject;this._tagGlRenderer$=this._tagGlRendererOperation$.startWith(function(renderer){return renderer}).scan(function(renderer,operation){return operation(renderer)},new Component_1.TagGLRenderer);this._tags$=this._tagSet.tagData$.map(function(tagData){var tags=[];for(var _i=0,_a=Object.keys(tagData).sort();_i<_a.length;_i++){var key=_a[_i];tags.push(tagData[key])}return tags}).share();this._tagChanged$=this._tags$.switchMap(function(tags){return Observable_1.Observable.from(tags).mergeMap(function(tag){return Observable_1.Observable.merge(tag.changed$,tag.geometryChanged$)})}).share();this._tagInterationInitiated$=this._tags$.switchMap(function(tags){return Observable_1.Observable.from(tags).mergeMap(function(tag){return tag.interact$.map(function(interaction){return interaction.tag.id})})}).share();this._tagInteractionAbort$=Observable_1.Observable.merge(this._container.mouseService.mouseUp$,this._container.mouseService.mouseLeave$).map(function(e){return}).share();this._activeTag$=this._tags$.switchMap(function(tags){return Observable_1.Observable.from(tags).mergeMap(function(tag){return tag.interact$})}).merge(this._tagInteractionAbort$.map(function(){return{offsetX:0,offsetY:0,operation:Component_1.TagOperation.None,tag:null}})).share();this._createGeometryChanged$=this._tagCreator.tag$.switchMap(function(tag){return tag!=null?tag.geometryChanged$:Observable_1.Observable.empty()}).share();this._tagCreated$=this._tagCreator.tag$.switchMap(function(tag){return tag!=null?tag.created$:Observable_1.Observable.empty()}).share();this._vertexGeometryCreated$=this._tagCreated$.map(function(tag){return tag.geometry}).share();this._pointGeometryCreated$=new Subject_1.Subject;this._geometryCreated$=Observable_1.Observable.merge(this._vertexGeometryCreated$,this._pointGeometryCreated$).share();this._basicClick$=this._container.mouseService.staticClick$.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,function(event,renderCamera,transform){return[event,renderCamera,transform]}).map(function(ert){var event=ert[0];var camera=ert[1];var transform=ert[2];var basic=_this._mouseEventToBasic(event,_this._container.element,camera,transform);return basic}).share();this._validBasicClick$=this._basicClick$.filter(function(basic){var x=basic[0];var y=basic[1];return 0<=x&&x<=1&&0<=y&&y<=1}).share();this._creatingConfiguration$=this._configuration$.distinctUntilChanged(function(c1,c2){return c1.creating===c2.creating&&c1.createType===c2.createType},function(configuration){return{createColor:configuration.createColor,createType:configuration.createType,creating:configuration.creating}}).publishReplay(1).refCount();this._creating$=this._creatingConfiguration$.map(function(configuration){return configuration.creating}).publishReplay(1).refCount();this._creating$.subscribe(function(creating){_this.fire(TagComponent.creatingchanged,creating)})}Object.defineProperty(TagComponent.prototype,"defaultConfiguration",{get:function(){return{createColor:16777215,creating:false}},enumerable:true,configurable:true});Object.defineProperty(TagComponent.prototype,"tags$",{get:function(){return this._tags$},enumerable:true,configurable:true});Object.defineProperty(TagComponent.prototype,"geometryCreated$",{get:function(){return this._geometryCreated$},enumerable:true,configurable:true});TagComponent.prototype.setTags=function(tags){this._tagSet.set$.next(tags)};TagComponent.prototype.startCreate=function(geometryType){this.configure({createType:geometryType,creating:true})};TagComponent.prototype.stopCreate=function(){this.configure({createType:null,creating:false})};TagComponent.prototype._activate=function(){var _this=this;this._geometryCreatedEventSubscription=this._geometryCreated$.subscribe(function(geometry){_this.fire(TagComponent.geometrycreated,geometry)});this._tagsChangedEventSubscription=this._tags$.subscribe(function(tags){_this.fire(TagComponent.tagschanged,tags)});var nodeChanged$=this.configuration$.switchMap(function(configuration){return configuration.creating?_this._navigator.stateService.currentNode$.skip(1).take(1).map(function(n){return null}):Observable_1.Observable.empty()});var tagAborted$=this._tagCreator.tag$.switchMap(function(tag){return tag!=null?tag.aborted$.map(function(t){return null}):Observable_1.Observable.empty()});var tagCreated$=this._tagCreated$.map(function(t){return null});var pointGeometryCreated$=this._pointGeometryCreated$.map(function(p){return null});this._stopCreateSubscription=Observable_1.Observable.merge(nodeChanged$,tagAborted$,tagCreated$,pointGeometryCreated$).subscribe(function(){_this.stopCreate()});this._creatorConfigurationSubscription=this._configuration$.subscribe(this._tagCreator.configuration$);this._createSubscription=this._creatingConfiguration$.switchMap(function(configuration){return configuration.creating&&configuration.createType==="rect"||configuration.createType==="polygon"?_this._validBasicClick$.take(1):Observable_1.Observable.empty()}).subscribe(this._tagCreator.create$);this._createPointSubscription=this._creatingConfiguration$.switchMap(function(configuration){return configuration.creating&&configuration.createType==="point"?_this._validBasicClick$.take(1):Observable_1.Observable.empty()}).map(function(basic){return new Component_1.PointGeometry(basic)}).subscribe(this._pointGeometryCreated$);this._setCreateVertexSubscription=Observable_1.Observable.combineLatest(this._container.mouseService.mouseMove$,this._tagCreator.tag$,this._container.renderService.renderCamera$).filter(function(etr){return etr[1]!=null}).withLatestFrom(this._navigator.stateService.currentTransform$,function(etr,transform){return[etr[0],etr[1],etr[2],transform]}).subscribe(function(etrt){var event=etrt[0];var tag=etrt[1];var camera=etrt[2];var transform=etrt[3];var basic=_this._mouseEventToBasic(event,_this._container.element,camera,transform);if(tag.geometry instanceof Component_1.RectGeometry){tag.geometry.setVertex2d(3,basic,transform)}else if(tag.geometry instanceof Component_1.PolygonGeometry){tag.geometry.setVertex2d(tag.geometry.polygon.length-2,basic,transform)}});this._addPointSubscription=this._creatingConfiguration$.switchMap(function(configuration){var createType=configuration.createType;return configuration.creating&&(createType==="rect"||createType==="polygon")?_this._basicClick$.skipUntil(_this._validBasicClick$).skip(1):Observable_1.Observable.empty()}).withLatestFrom(this._tagCreator.tag$,function(basic,tag){return[basic,tag]}).subscribe(function(bt){var basic=bt[0];var tag=bt[1];tag.addPoint(basic)});this._deleteCreatedSubscription=this._creating$.subscribe(function(creating){_this._tagCreator.delete$.next(null)});this._setGLCreateTagSubscription=Observable_1.Observable.merge(this._tagCreator.tag$,this._createGeometryChanged$).withLatestFrom(this._navigator.stateService.currentTransform$,function(tag,transform){return[tag,transform]}).map(function(tt){return function(renderer){var tag=tt[0];var transform=tt[1];if(tag==null){renderer.removeCreateTag()}else{renderer.setCreateTag(tag,transform)}return renderer}}).subscribe(this._tagGlRendererOperation$);this._claimMouseSubscription=this._tagInterationInitiated$.switchMap(function(id){return _this._container.mouseService.mouseMove$.takeUntil(_this._tagInteractionAbort$).take(1)}).subscribe(function(e){_this._container.mouseService.claimMouse(_this._name,1)});this._mouseDragSubscription=this._activeTag$.withLatestFrom(this._container.mouseService.mouseMove$,function(a,e){return[a,e]}).switchMap(function(args){var activeTag=args[0];var mouseMove=args[1];if(activeTag.operation===Component_1.TagOperation.None){return Observable_1.Observable.empty()}var mouseDrag$=Observable_1.Observable.of(mouseMove).concat(_this._container.mouseService.filtered$(_this._name,_this._container.mouseService.mouseDrag$));return Observable_1.Observable.combineLatest(mouseDrag$,_this._container.renderService.renderCamera$).withLatestFrom(Observable_1.Observable.of(activeTag),_this._navigator.stateService.currentTransform$,function(ec,a,t){return[ec[0],ec[1],a,t]})}).subscribe(function(args){var mouseEvent=args[0];var renderCamera=args[1];var activeTag=args[2];var transform=args[3];if(activeTag.operation===Component_1.TagOperation.None){return}var basic=_this._mouseEventToBasic(mouseEvent,_this._container.element,renderCamera,transform,activeTag.offsetX,activeTag.offsetY);if(activeTag.operation===Component_1.TagOperation.Centroid){activeTag.tag.geometry.setCentroid2d(basic,transform)}else if(activeTag.operation===Component_1.TagOperation.Vertex){var vertexGeometry=activeTag.tag.geometry;vertexGeometry.setVertex2d(activeTag.vertexIndex,basic,transform)}});this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).subscribe(function(e){_this._container.mouseService.unclaimMouse(_this._name)});this._setTagsSubscription=this._tags$.withLatestFrom(this._navigator.stateService.currentTransform$,function(tags,transform){return[tags,transform]}).map(function(tt){return function(renderer){renderer.setTags(tt[0],tt[1]);return renderer}}).subscribe(this._tagGlRendererOperation$);this._updateTagSubscription=this._tagChanged$.withLatestFrom(this._navigator.stateService.currentTransform$,function(tag,transform){return[tag,transform]}).map(function(tt){return function(renderer){renderer.updateTag(tt[0],tt[1]);return renderer}}).subscribe(this._tagGlRendererOperation$);this._domSubscription=this.tags$.startWith([]).do(function(tags){_this._container.domRenderer.render$.next({name:_this._name,vnode:_this._tagDomRenderer.clear()})}).combineLatest(this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._tagChanged$.startWith(null),this._tagCreator.tag$.merge(this._createGeometryChanged$).startWith(null),this._configuration$,function(tags,rc,atlas,tag,ct,c){return[rc,atlas,tags,tag,ct,c]}).withLatestFrom(this._navigator.stateService.currentTransform$,function(args,transform){return[args[0],args[1],args[2],args[3],args[4],args[5],transform]}).map(function(args){return{name:_this._name,vnode:_this._tagDomRenderer.render(args[2],args[4],args[1],args[0].perspective,args[6],args[5])}}).subscribe(this._container.domRenderer.render$);this._glSubscription=this._navigator.stateService.currentState$.withLatestFrom(this._tagGlRenderer$,function(frame,renderer){return[frame,renderer]}).map(function(fr){var frame=fr[0];var renderer=fr[1];return{name:_this._name,render:{frameId:frame.id,needsRender:renderer.needsRender,render:renderer.render.bind(renderer),stage:Render_1.GLRenderStage.Foreground}}}).subscribe(this._container.glRenderer.render$)};TagComponent.prototype._deactivate=function(){this._tagGlRendererOperation$.next(function(renderer){renderer.dispose();return renderer});this._tagSet.set$.next([]);this._tagCreator.delete$.next(null);this._claimMouseSubscription.unsubscribe();this._mouseDragSubscription.unsubscribe();this._unclaimMouseSubscription.unsubscribe();this._setTagsSubscription.unsubscribe();this._updateTagSubscription.unsubscribe();this._stopCreateSubscription.unsubscribe();this._creatorConfigurationSubscription.unsubscribe();this._createSubscription.unsubscribe();this._createPointSubscription.unsubscribe();this._setCreateVertexSubscription.unsubscribe();this._addPointSubscription.unsubscribe();this._deleteCreatedSubscription.unsubscribe();this._setGLCreateTagSubscription.unsubscribe();this._domSubscription.unsubscribe();this._glSubscription.unsubscribe();this._geometryCreatedEventSubscription.unsubscribe();this._tagsChangedEventSubscription.unsubscribe()};TagComponent.prototype._mouseEventToBasic=function(event,element,camera,transform,offsetX,offsetY){offsetX=offsetX!=null?offsetX:0;offsetY=offsetY!=null?offsetY:0;var clientRect=element.getBoundingClientRect();var canvasX=event.clientX-clientRect.left-offsetX;var canvasY=event.clientY-clientRect.top-offsetY;var projectedX=2*canvasX/element.offsetWidth-1;var projectedY=1-2*canvasY/element.offsetHeight;var unprojected=new THREE.Vector3(projectedX,projectedY,1).unproject(camera.perspective);var basic=transform.projectBasic(unprojected.toArray());return basic};TagComponent.componentName="tag";TagComponent.creatingchanged="creatingchanged";TagComponent.geometrycreated="geometrycreated";TagComponent.tagschanged="tagschanged";return TagComponent}(Component_1.Component);exports.TagComponent=TagComponent;Component_1.ComponentService.register(TagComponent);Object.defineProperty(exports,"__esModule",{value:true});exports.default=TagComponent},{"../../Component":404,"../../Render":410,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/combineLatest":234,"rxjs/add/observable/empty":235,"rxjs/add/observable/from":236,"rxjs/add/observable/merge":239,"rxjs/add/observable/of":240,"rxjs/add/operator/combineLatest":244,"rxjs/add/operator/concat":245,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/do":250,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/merge":256,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/share":264,"rxjs/add/operator/skip":265,"rxjs/add/operator/skipUntil":266,"rxjs/add/operator/startWith":268,"rxjs/add/operator/switchMap":269,"rxjs/add/operator/take":270,"rxjs/add/operator/takeUntil":271,"rxjs/add/operator/withLatestFrom":272,three:354}],456:[function(require,module,exports){"use strict";var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/map");require("rxjs/add/operator/scan");require("rxjs/add/operator/share");require("rxjs/add/operator/withLatestFrom");var Component_1=require("../../Component");var TagCreator=function(){function TagCreator(){this._tagOperation$=new Subject_1.Subject;this._create$=new Subject_1.Subject;this._delete$=new Subject_1.Subject;this._configuration$=new Subject_1.Subject;this._tag$=this._tagOperation$.scan(function(tag,operation){return operation(tag)},null).share();this._create$.withLatestFrom(this._configuration$,function(coordinate,type){return[coordinate,type]}).map(function(ct){return function(tag){var coordinate=ct[0];var configuration=ct[1];if(configuration.createType==="rect"){var geometry=new Component_1.RectGeometry([coordinate[0],coordinate[1],coordinate[0],coordinate[1]]);return new Component_1.OutlineCreateTag(geometry,{color:configuration.createColor})}else if(configuration.createType==="polygon"){var geometry=new Component_1.PolygonGeometry([[coordinate[0],coordinate[1]],[coordinate[0],coordinate[1]],[coordinate[0],coordinate[1]]]);return new Component_1.OutlineCreateTag(geometry,{color:configuration.createColor})}return null}}).subscribe(this._tagOperation$);this._delete$.map(function(){return function(tag){return null}}).subscribe(this._tagOperation$)}Object.defineProperty(TagCreator.prototype,"create$",{get:function(){return this._create$},enumerable:true,configurable:true});Object.defineProperty(TagCreator.prototype,"delete$",{get:function(){return this._delete$},enumerable:true,configurable:true});Object.defineProperty(TagCreator.prototype,"configuration$",{get:function(){return this._configuration$},enumerable:true,configurable:true});Object.defineProperty(TagCreator.prototype,"tag$",{get:function(){return this._tag$},enumerable:true,configurable:true});return TagCreator}();exports.TagCreator=TagCreator;Object.defineProperty(exports,"__esModule",{value:true});exports.default=TagCreator},{"../../Component":404,"rxjs/Subject":230,"rxjs/add/operator/map":255,"rxjs/add/operator/scan":263,"rxjs/add/operator/share":264,"rxjs/add/operator/withLatestFrom":272}],457:[function(require,module,exports){"use strict";var THREE=require("three");var vd=require("virtual-dom");var TagDOMRenderer=function(){function TagDOMRenderer(){}TagDOMRenderer.prototype.render=function(tags,createTag,atlas,camera,transform,configuration){var matrixWorldInverse=(new THREE.Matrix4).getInverse(camera.matrixWorld);var projectionMatrix=camera.projectionMatrix;var vNodes=[];for(var _i=0,tags_1=tags;_i<tags_1.length;_i++){var tag=tags_1[_i];vNodes=vNodes.concat(tag.getDOMObjects(transform,atlas,matrixWorldInverse,projectionMatrix))}if(createTag!=null){vNodes=vNodes.concat(createTag.getDOMObjects(transform,matrixWorldInverse,projectionMatrix))}var properties={style:{"pointer-events":configuration.creating?"all":"none"}};return vd.h("div.TagContainer",properties,vNodes)};TagDOMRenderer.prototype.clear=function(){return vd.h("div",{},[])};return TagDOMRenderer}();exports.TagDOMRenderer=TagDOMRenderer},{three:354,"virtual-dom":360}],458:[function(require,module,exports){"use strict";var THREE=require("three");var TagGLRenderer=function(){function TagGLRenderer(){this._scene=new THREE.Scene;this._tags={};this._createTag=null;this._needsRender=false}Object.defineProperty(TagGLRenderer.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});TagGLRenderer.prototype.render=function(perspectiveCamera,renderer){renderer.render(this._scene,perspectiveCamera);this._needsRender=false};TagGLRenderer.prototype.setCreateTag=function(tag,transform){this._disposeCreateTag();this._addCreateTag(tag,transform);this._needsRender=true};TagGLRenderer.prototype.removeCreateTag=function(){this._disposeCreateTag();this._needsRender=true};TagGLRenderer.prototype.setTags=function(tags,transform){this._disposeTags();for(var _i=0,tags_1=tags;_i<tags_1.length;_i++){var tag=tags_1[_i];this._addTag(tag,transform)}this._needsRender=true};TagGLRenderer.prototype.updateTag=function(tag,transform){this._disposeTag(tag.id);this._addTag(tag,transform);this._needsRender=true};TagGLRenderer.prototype.dispose=function(){this._disposeTags();this._disposeCreateTag();this._needsRender=false};TagGLRenderer.prototype._addTag=function(tag,transform){var objects=tag.getGLObjects(transform);this._tags[tag.id]=[];for(var _i=0,objects_1=objects;_i<objects_1.length;_i++){var object=objects_1[_i];this._tags[tag.id].push(object);this._scene.add(object)}};TagGLRenderer.prototype._addCreateTag=function(tag,transform){var object=tag.getGLObject(transform);this._createTag=object;this._scene.add(object)};TagGLRenderer.prototype._disposeTags=function(){for(var _i=0,_a=Object.keys(this._tags);_i<_a.length;_i++){var key=_a[_i];this._disposeTag(key)}};TagGLRenderer.prototype._disposeTag=function(id){var objects=this._tags[id];for(var _i=0,objects_2=objects;_i<objects_2.length;_i++){var object=objects_2[_i];var mesh=object;this._scene.remove(mesh);mesh.geometry.dispose();mesh.material.dispose()}delete this._tags[id]};TagGLRenderer.prototype._disposeCreateTag=function(){if(this._createTag==null){return}var mesh=this._createTag;this._scene.remove(mesh);mesh.geometry.dispose();mesh.material.dispose();this._createTag=null};return TagGLRenderer}();exports.TagGLRenderer=TagGLRenderer},{three:354}],459:[function(require,module,exports){"use strict";(function(TagOperation){TagOperation[TagOperation["None"]=0]="None";TagOperation[TagOperation["Centroid"]=1]="Centroid";TagOperation[TagOperation["Vertex"]=2]="Vertex"})(exports.TagOperation||(exports.TagOperation={}));var TagOperation=exports.TagOperation;Object.defineProperty(exports,"__esModule",{value:true});exports.default=TagOperation},{}],460:[function(require,module,exports){"use strict";var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/map");require("rxjs/add/operator/scan");require("rxjs/add/operator/share");var TagSet=function(){function TagSet(){this._tagDataOperation$=new Subject_1.Subject;this._set$=new Subject_1.Subject;this._tagData$=this._tagDataOperation$.scan(function(tagData,operation){return operation(tagData)},{}).share();this._set$.map(function(tags){return function(tagData){for(var _i=0,_a=Object.keys(tagData);_i<_a.length;_i++){var key=_a[_i];delete tagData[key]}for(var _b=0,tags_1=tags;_b<tags_1.length;_b++){var tag=tags_1[_b];tagData[tag.id]=tag}return tagData}}).subscribe(this._tagDataOperation$)}Object.defineProperty(TagSet.prototype,"tagData$",{get:function(){return this._tagData$},enumerable:true,configurable:true});Object.defineProperty(TagSet.prototype,"set$",{get:function(){return this._set$},enumerable:true,configurable:true});return TagSet}();exports.TagSet=TagSet;Object.defineProperty(exports,"__esModule",{value:true});exports.default=TagSet},{"rxjs/Subject":230,"rxjs/add/operator/map":255,"rxjs/add/operator/scan":263,"rxjs/add/operator/share":264}],461:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Error_1=require("../../../Error");var GeometryTagError=function(_super){__extends(GeometryTagError,_super);function GeometryTagError(message){_super.call(this);this.name="GeometryTagError";this.message=message!=null?message:"The provided geometry value is incorrect"}return GeometryTagError}(Error_1.MapillaryError);exports.GeometryTagError=GeometryTagError;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Error_1.MapillaryError},{"../../../Error":406}],462:[function(require,module,exports){"use strict";var Subject_1=require("rxjs/Subject");var Geometry=function(){function Geometry(){this._notifyChanged$=new Subject_1.Subject}Object.defineProperty(Geometry.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:true,configurable:true});return Geometry}();exports.Geometry=Geometry;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Geometry},{"rxjs/Subject":230}],463:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Component_1=require("../../../Component");var PointGeometry=function(_super){__extends(PointGeometry,_super);function PointGeometry(point){_super.call(this);var x=point[0];var y=point[1];if(x<0||x>1||y<0||y>1){throw new Component_1.GeometryTagError("Basic coordinates must be on the interval [0, 1].")}this._point=point.slice()}Object.defineProperty(PointGeometry.prototype,"point",{get:function(){return this._point},enumerable:true,configurable:true});PointGeometry.prototype.getCentroid3d=function(transform){return transform.unprojectBasic(this._point,200)};PointGeometry.prototype.setCentroid2d=function(value,transform){var changed=[Math.max(0,Math.min(1,value[0])),Math.max(0,Math.min(1,value[1]))];this._point[0]=changed[0];this._point[1]=changed[1];this._notifyChanged$.next(this)};return PointGeometry}(Component_1.Geometry);exports.PointGeometry=PointGeometry},{"../../../Component":404}],464:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Component_1=require("../../../Component");var PolygonGeometry=function(_super){__extends(PolygonGeometry,_super);function PolygonGeometry(polygon,holes){_super.call(this);var polygonLength=polygon.length;if(polygonLength<3){throw new Component_1.GeometryTagError("A polygon must have three or more positions.")}if(polygon[0][0]!==polygon[polygonLength-1][0]||polygon[0][1]!==polygon[polygonLength-1][1]){
throw new Component_1.GeometryTagError("First and last positions must be equivalent.")}this._polygon=[];for(var _i=0,polygon_1=polygon;_i<polygon_1.length;_i++){var vertex=polygon_1[_i];if(vertex[0]<0||vertex[0]>1||vertex[1]<0||vertex[1]>1){throw new Component_1.GeometryTagError("Basic coordinate of polygon must be on the interval [0, 1].")}this._polygon.push(vertex.slice())}this._holes=[];if(holes==null){return}for(var i=0;i<holes.length;i++){var hole=holes[i];var holeLength=hole.length;if(holeLength<3){throw new Component_1.GeometryTagError("A polygon hole must have three or more positions.")}if(hole[0][0]!==hole[holeLength-1][0]||hole[0][1]!==hole[holeLength-1][1]){throw new Component_1.GeometryTagError("First and last positions of hole must be equivalent.")}this._holes.push([]);for(var _a=0,hole_1=hole;_a<hole_1.length;_a++){var vertex=hole_1[_a];if(vertex[0]<0||vertex[0]>1||vertex[1]<0||vertex[1]>1){throw new Component_1.GeometryTagError("Basic coordinate of hole must be on the interval [0, 1].")}this._holes[i].push(vertex.slice())}}}Object.defineProperty(PolygonGeometry.prototype,"polygon",{get:function(){return this._polygon},enumerable:true,configurable:true});Object.defineProperty(PolygonGeometry.prototype,"holes",{get:function(){return this._holes},enumerable:true,configurable:true});PolygonGeometry.prototype.addVertex2d=function(vertex){var clamped=[Math.max(0,Math.min(1,vertex[0])),Math.max(0,Math.min(1,vertex[1]))];this._polygon.splice(this._polygon.length-1,0,clamped);this._notifyChanged$.next(this)};PolygonGeometry.prototype.removeVertex2d=function(index){if(index<0||index>=this._polygon.length||this._polygon.length<4){throw new Component_1.GeometryTagError("Index for removed vertex must be valid.")}if(index>0&&index<this._polygon.length-1){this._polygon.splice(index,1)}else{this._polygon.splice(0,1);this._polygon.pop();var closing=this._polygon[0].slice();this._polygon.push(closing)}this._notifyChanged$.next(this)};PolygonGeometry.prototype.setVertex2d=function(index,value,transform){var changed=[Math.max(0,Math.min(1,value[0])),Math.max(0,Math.min(1,value[1]))];if(index===0||index===this._polygon.length-1){this._polygon[0]=changed.slice();this._polygon[this._polygon.length-1]=changed.slice()}else{this._polygon[index]=changed.slice()}this._notifyChanged$.next(this)};PolygonGeometry.prototype.setCentroid2d=function(value,transform){var xs=this._polygon.map(function(point){return point[0]});var ys=this._polygon.map(function(point){return point[1]});var minX=Math.min.apply(Math,xs);var maxX=Math.max.apply(Math,xs);var minY=Math.min.apply(Math,ys);var maxY=Math.max.apply(Math,ys);var centroid=this._getCentroid2d();var minTranslationX=-minX;var maxTranslationX=1-maxX;var minTranslationY=-minY;var maxTranslationY=1-maxY;var translationX=Math.max(minTranslationX,Math.min(maxTranslationX,value[0]-centroid[0]));var translationY=Math.max(minTranslationY,Math.min(maxTranslationY,value[1]-centroid[1]));for(var _i=0,_a=this._polygon;_i<_a.length;_i++){var point=_a[_i];point[0]+=translationX;point[1]+=translationY}this._notifyChanged$.next(this)};PolygonGeometry.prototype.getPoints3d=function(transform){return this.getVertices3d(transform)};PolygonGeometry.prototype.getVertex3d=function(index,transform){return transform.unprojectBasic(this._polygon[index],200)};PolygonGeometry.prototype.getVertices3d=function(transform){return this._polygon.map(function(point){return transform.unprojectBasic(point,200)})};PolygonGeometry.prototype.getHoleVertices3d=function(transform){var holes3d=[];for(var _i=0,_a=this._holes;_i<_a.length;_i++){var hole=_a[_i];var hole3d=hole.map(function(point){return transform.unprojectBasic(point,200)});holes3d.push(hole3d)}return holes3d};PolygonGeometry.prototype.getCentroid3d=function(transform){var centroid2d=this._getCentroid2d();return transform.unprojectBasic(centroid2d,200)};PolygonGeometry.prototype.getTriangles3d=function(transform){return this._triangulate(this._polygon,this.getPoints3d(transform),this._holes,this.getHoleVertices3d(transform))};PolygonGeometry.prototype._getCentroid2d=function(){var polygon=this._polygon;var area=0;var centroidX=0;var centroidY=0;for(var i=0;i<polygon.length-1;i++){var xi=polygon[i][0];var yi=polygon[i][1];var xi1=polygon[i+1][0];var yi1=polygon[i+1][1];var a=xi*yi1-xi1*yi;area+=a;centroidX+=(xi+xi1)*a;centroidY+=(yi+yi1)*a}area/=2;centroidX/=6*area;centroidY/=6*area;return[centroidX,centroidY]};return PolygonGeometry}(Component_1.VertexGeometry);exports.PolygonGeometry=PolygonGeometry;Object.defineProperty(exports,"__esModule",{value:true});exports.default=PolygonGeometry},{"../../../Component":404}],465:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var Component_1=require("../../../Component");var RectGeometry=function(_super){__extends(RectGeometry,_super);function RectGeometry(rect){_super.call(this);if(rect[1]>rect[3]){throw new Component_1.GeometryTagError("Basic Y coordinate values can not be inverted.")}for(var _i=0,rect_1=rect;_i<rect_1.length;_i++){var coord=rect_1[_i];if(coord<0||coord>1){throw new Component_1.GeometryTagError("Basic coordinates must be on the interval [0, 1].")}}this._rect=rect.slice(0,4);if(this._rect[0]>this._rect[2]){this._inverted=true}}Object.defineProperty(RectGeometry.prototype,"rect",{get:function(){return this._rect},enumerable:true,configurable:true});RectGeometry.prototype.setVertex2d=function(index,value,transform){var original=this._rect.slice();var changed=[Math.max(0,Math.min(1,value[0])),Math.max(0,Math.min(1,value[1]))];var rect=[];if(index===0){rect[0]=changed[0];rect[1]=original[1];rect[2]=original[2];rect[3]=changed[1]}else if(index===1){rect[0]=changed[0];rect[1]=changed[1];rect[2]=original[2];rect[3]=original[3]}else if(index===2){rect[0]=original[0];rect[1]=changed[1];rect[2]=changed[0];rect[3]=original[3]}else if(index===3){rect[0]=original[0];rect[1]=original[1];rect[2]=changed[0];rect[3]=changed[1]}if(transform.gpano){var passingBoundaryLeft=index<2&&changed[0]>.75&&original[0]<.25||index>=2&&this._inverted&&changed[0]>.75&&original[2]<.25;var passingBoundaryRight=index<2&&this._inverted&&changed[0]<.25&&original[0]>.75||index>=2&&changed[0]<.25&&original[2]>.75;if(passingBoundaryLeft||passingBoundaryRight){this._inverted=!this._inverted}else{if(rect[0]-original[0]<-.25){rect[0]=original[0]}if(rect[2]-original[2]>.25){rect[2]=original[2]}}if(!this._inverted&&rect[0]>rect[2]||this._inverted&&rect[0]<rect[2]){rect[0]=original[0];rect[2]=original[2]}}else{if(rect[0]>rect[2]){rect[0]=original[0];rect[2]=original[2]}}if(rect[1]>rect[3]){rect[1]=original[1];rect[3]=original[3]}this._rect[0]=rect[0];this._rect[1]=rect[1];this._rect[2]=rect[2];this._rect[3]=rect[3];this._notifyChanged$.next(this)};RectGeometry.prototype.setCentroid2d=function(value,transform){var original=this._rect.slice();var x0=original[0];var x1=this._inverted?original[2]+1:original[2];var y0=original[1];var y1=original[3];var centerX=x0+(x1-x0)/2;var centerY=y0+(y1-y0)/2;var translationX=0;if(transform.gpano!=null&&transform.gpano.CroppedAreaImageWidthPixels===transform.gpano.FullPanoWidthPixels){translationX=this._inverted?value[0]+1-centerX:value[0]-centerX}else{var minTranslationX=-x0;var maxTranslationX=1-x1;translationX=Math.max(minTranslationX,Math.min(maxTranslationX,value[0]-centerX))}var minTranslationY=-y0;var maxTranslationY=1-y1;var translationY=Math.max(minTranslationY,Math.min(maxTranslationY,value[1]-centerY));this._rect[0]=original[0]+translationX;this._rect[1]=original[1]+translationY;this._rect[2]=original[2]+translationX;this._rect[3]=original[3]+translationY;if(this._rect[0]<0){this._rect[0]+=1;this._inverted=!this._inverted}else if(this._rect[0]>1){this._rect[0]-=1;this._inverted=!this._inverted}if(this._rect[2]<0){this._rect[2]+=1;this._inverted=!this._inverted}else if(this._rect[2]>1){this._rect[2]-=1;this._inverted=!this._inverted}this._notifyChanged$.next(this)};RectGeometry.prototype.getPoints3d=function(transform){return this._getPoints2d(transform).map(function(point){return transform.unprojectBasic(point,200)})};RectGeometry.prototype.getVertex3d=function(index,transform){return transform.unprojectBasic(this._rectToVertices2d(this._rect)[index],200)};RectGeometry.prototype.getVertices3d=function(transform){return this._rectToVertices2d(this._rect).map(function(vertex){return transform.unprojectBasic(vertex,200)})};RectGeometry.prototype.getCentroid3d=function(transform){var rect=this._rect;var x0=rect[0];var x1=this._inverted?rect[2]+1:rect[2];var y0=rect[1];var y1=rect[3];var centroidX=x0+(x1-x0)/2;var centroidY=y0+(y1-y0)/2;return transform.unprojectBasic([centroidX,centroidY],200)};RectGeometry.prototype.getTriangles3d=function(transform){return this._triangulate(this._rectToVertices2d(this._rect),this.getVertices3d(transform))};RectGeometry.prototype.validate=function(bottomRight){var rect=this._rect;if(!this._inverted&&bottomRight[0]<rect[0]||bottomRight[0]-rect[2]>.25||bottomRight[1]<rect[1]){return false}return true};RectGeometry.prototype._getPoints2d=function(transform){var vertices2d=this._rectToVertices2d(this._rect);var sides=vertices2d.length-1;var sections=10;var points2d=[];for(var i=0;i<sides;++i){var startX=vertices2d[i][0];var startY=vertices2d[i][1];var endX=vertices2d[i+1][0];var endY=vertices2d[i+1][1];var intervalX=(endX-startX)/(sections-1);var intervalY=(endY-startY)/(sections-1);for(var j=0;j<sections;++j){var point=[startX+j*intervalX,startY+j*intervalY];points2d.push(point)}}return points2d};RectGeometry.prototype._rectToVertices2d=function(rect){return[[rect[0],rect[3]],[rect[0],rect[1]],[this._inverted?rect[2]+1:rect[2],rect[1]],[this._inverted?rect[2]+1:rect[2],rect[3]],[rect[0],rect[3]]]};return RectGeometry}(Component_1.VertexGeometry);exports.RectGeometry=RectGeometry;Object.defineProperty(exports,"__esModule",{value:true});exports.default=RectGeometry},{"../../../Component":404}],466:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var earcut=require("earcut");var Component_1=require("../../../Component");var VertexGeometry=function(_super){__extends(VertexGeometry,_super);function VertexGeometry(){_super.call(this)}VertexGeometry.prototype._triangulate=function(points2d,points3d,holes2d,holes3d){var data=[points2d.slice(0,-1)];for(var _i=0,_a=holes2d!=null?holes2d:[];_i<_a.length;_i++){var hole2d=_a[_i];data.push(hole2d.slice(0,-1))}var points=points3d.slice(0,-1);for(var _b=0,_c=holes3d!=null?holes3d:[];_b<_c.length;_b++){var hole3d=_c[_b];points=points.concat(hole3d.slice(0,-1))}var flattened=earcut.flatten(data);var indices=earcut(flattened.vertices,flattened.holes,flattened.dimensions);var triangles=[];for(var i=0;i<indices.length;++i){var point=points[indices[i]];triangles.push(point[0]);triangles.push(point[1]);triangles.push(point[2])}return triangles};return VertexGeometry}(Component_1.Geometry);exports.VertexGeometry=VertexGeometry;Object.defineProperty(exports,"__esModule",{value:true});exports.default=VertexGeometry},{"../../../Component":404,earcut:8}],467:[function(require,module,exports){"use strict";(function(Alignment){Alignment[Alignment["Center"]=0]="Center";Alignment[Alignment["Outer"]=1]="Outer"})(exports.Alignment||(exports.Alignment={}));var Alignment=exports.Alignment;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Alignment},{}],468:[function(require,module,exports){"use strict";var THREE=require("three");var vd=require("virtual-dom");var Subject_1=require("rxjs/Subject");var Component_1=require("../../../Component");var OutlineCreateTag=function(){function OutlineCreateTag(geometry,options){this._geometry=geometry;this._options={color:options.color==null?16777215:options.color};this._created$=new Subject_1.Subject;this._aborted$=new Subject_1.Subject}Object.defineProperty(OutlineCreateTag.prototype,"geometry",{get:function(){return this._geometry},enumerable:true,configurable:true});Object.defineProperty(OutlineCreateTag.prototype,"created$",{get:function(){return this._created$},enumerable:true,configurable:true});Object.defineProperty(OutlineCreateTag.prototype,"aborted$",{get:function(){return this._aborted$},enumerable:true,configurable:true});Object.defineProperty(OutlineCreateTag.prototype,"geometryChanged$",{get:function(){var _this=this;return this._geometry.changed$.map(function(geometry){return _this})},enumerable:true,configurable:true});OutlineCreateTag.prototype.getGLObject=function(transform){var polygon3d=this._geometry.getPoints3d(transform);var positions=this._getPositions(polygon3d);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(positions,3));var material=new THREE.LineBasicMaterial({color:this._options.color,linewidth:1});return new THREE.Line(geometry,material)};OutlineCreateTag.prototype.getDOMObjects=function(transform,matrixWorldInverse,projectionMatrix){var _this=this;var vNodes=[];var abort=function(e){e.stopPropagation();_this._aborted$.next(_this)};if(this._geometry instanceof Component_1.RectGeometry){var topLeftPoint3d=this._geometry.getVertex3d(1,transform);var topLeftCameraSpace=this._convertToCameraSpace(topLeftPoint3d,matrixWorldInverse);if(topLeftCameraSpace.z<0){var centerCanvas=this._projectToCanvas(topLeftCameraSpace,projectionMatrix);var centerCss=centerCanvas.map(function(coord){return 100*coord+"%"});var pointProperties={style:{background:"#"+("000000"+this._options.color.toString(16)).substr(-6),left:centerCss[0],position:"absolute",top:centerCss[1]}};var completerProperties={onclick:abort,style:{left:centerCss[0],position:"absolute",top:centerCss[1]}};vNodes.push(vd.h("div.TagInteractor",completerProperties,[]));vNodes.push(vd.h("div.TagVertex",pointProperties,[]))}}else if(this._geometry instanceof Component_1.PolygonGeometry){var polygonGeometry_1=this._geometry;var firstVertex3d=this._geometry.getVertex3d(0,transform);var firstCameraSpace=this._convertToCameraSpace(firstVertex3d,matrixWorldInverse);if(firstCameraSpace.z<0){var centerCanvas=this._projectToCanvas(firstCameraSpace,projectionMatrix);var centerCss=centerCanvas.map(function(coord){return 100*coord+"%"});var firstOnclick=polygonGeometry_1.polygon.length>4?function(e){e.stopPropagation();polygonGeometry_1.removeVertex2d(polygonGeometry_1.polygon.length-2);_this._created$.next(_this)}:abort;var completerProperties={onclick:firstOnclick,style:{left:centerCss[0],position:"absolute",top:centerCss[1]}};var firstClass=polygonGeometry_1.polygon.length>4?"TagCompleter":"TagInteractor";vNodes.push(vd.h("div."+firstClass,completerProperties,[]))}if(polygonGeometry_1.polygon.length>3){var lastVertex3d=this._geometry.getVertex3d(polygonGeometry_1.polygon.length-3,transform);var lastCameraSpace=this._convertToCameraSpace(lastVertex3d,matrixWorldInverse);if(lastCameraSpace.z<0){var centerCanvas=this._projectToCanvas(lastCameraSpace,projectionMatrix);var centerCss=centerCanvas.map(function(coord){return 100*coord+"%"});var remove=function(e){e.stopPropagation();polygonGeometry_1.removeVertex2d(polygonGeometry_1.polygon.length-3)};var completerProperties={onclick:remove,style:{left:centerCss[0],position:"absolute",top:centerCss[1]}};vNodes.push(vd.h("div.TagInteractor",completerProperties,[]))}}var vertices3d=this._geometry.getVertices3d(transform);vertices3d.splice(-2,2);for(var _i=0,vertices3d_1=vertices3d;_i<vertices3d_1.length;_i++){var vertex=vertices3d_1[_i];var vertexCameraSpace=this._convertToCameraSpace(vertex,matrixWorldInverse);if(vertexCameraSpace.z<0){var centerCanvas=this._projectToCanvas(vertexCameraSpace,projectionMatrix);var centerCss=centerCanvas.map(function(coord){return 100*coord+"%"});var pointProperties={style:{background:"#"+("000000"+this._options.color.toString(16)).substr(-6),left:centerCss[0],position:"absolute",top:centerCss[1]}};vNodes.push(vd.h("div.TagVertex",pointProperties,[]))}}}return vNodes};OutlineCreateTag.prototype.addPoint=function(point){if(this._geometry instanceof Component_1.RectGeometry){var rectGeometry=this._geometry;if(!rectGeometry.validate(point)){return}this._created$.next(this)}else if(this._geometry instanceof Component_1.PolygonGeometry){var polygonGeometry=this._geometry;polygonGeometry.addVertex2d(point)}};OutlineCreateTag.prototype._getPositions=function(polygon3d){var length=polygon3d.length;var positions=new Float32Array(length*3);for(var i=0;i<length;++i){var index=3*i;var position=polygon3d[i];positions[index]=position[0];positions[index+1]=position[1];positions[index+2]=position[2]}return positions};OutlineCreateTag.prototype._projectToCanvas=function(point,projectionMatrix){var projected=new THREE.Vector3(point.x,point.y,point.z).applyProjection(projectionMatrix);return[(projected.x+1)/2,(-projected.y+1)/2]};OutlineCreateTag.prototype._convertToCameraSpace=function(point,matrixWorldInverse){return new THREE.Vector3(point[0],point[1],point[2]).applyMatrix4(matrixWorldInverse)};return OutlineCreateTag}();exports.OutlineCreateTag=OutlineCreateTag;Object.defineProperty(exports,"__esModule",{value:true});exports.default=OutlineCreateTag},{"../../../Component":404,"rxjs/Subject":230,three:354,"virtual-dom":360}],469:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=require("three");var vd=require("virtual-dom");var Subject_1=require("rxjs/Subject");var Component_1=require("../../../Component");var Viewer_1=require("../../../Viewer");var OutlineTag=function(_super){__extends(OutlineTag,_super);function OutlineTag(id,geometry,options){var _this=this;_super.call(this,id,geometry);this._editable=options.editable==null?false:options.editable;this._fillColor=options.fillColor==null?16777215:options.fillColor;this._fillOpacity=options.fillOpacity==null?0:options.fillOpacity;this._icon=options.icon===undefined?null:options.icon;this._iconAlignment=options.iconAlignment==null?Component_1.Alignment.Outer:options.iconAlignment;this._iconIndex=options.iconIndex==null?3:options.iconIndex;this._indicateVertices=options.indicateVertices==null?true:options.indicateVertices;this._lineColor=options.lineColor==null?16777215:options.lineColor;this._lineWidth=options.lineWidth==null?1:options.lineWidth;this._text=options.text===undefined?null:options.text;this._textColor=options.textColor==null?16777215:options.textColor;this._click$=new Subject_1.Subject;this._click$.subscribe(function(t){_this.fire(OutlineTag.click,_this)})}Object.defineProperty(OutlineTag.prototype,"click$",{get:function(){return this._click$},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"editable",{get:function(){return this._editable},set:function(value){this._editable=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"fillColor",{get:function(){return this._fillColor},set:function(value){this._fillColor=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"fillOpacity",{get:function(){return this._fillOpacity},set:function(value){this._fillOpacity=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"icon",{get:function(){return this._icon},set:function(value){this._icon=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"iconAlignment",{get:function(){return this._iconAlignment},set:function(value){this._iconAlignment=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"iconIndex",{get:function(){return this._iconIndex},set:function(value){this._iconIndex=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"indicateVertices",{get:function(){return this._indicateVertices},set:function(value){this._indicateVertices=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"lineColor",{get:function(){return this._lineColor},set:function(value){this._lineColor=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(value){this._lineWidth=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"text",{get:function(){return this._text},set:function(value){this._text=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(OutlineTag.prototype,"textColor",{get:function(){return this._textColor},set:function(value){this._textColor=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});OutlineTag.prototype.setOptions=function(options){this._editable=options.editable==null?this._editable:options.editable;this._icon=options.icon===undefined?this._icon:options.icon;this._iconAlignment=options.iconAlignment==null?this._iconAlignment:options.iconAlignment;this._iconIndex=options.iconIndex==null?this._iconIndex:options.iconIndex;this._indicateVertices=options.indicateVertices==null?this._indicateVertices:options.indicateVertices;this._lineColor=options.lineColor==null?this._lineColor:options.lineColor;this._lineWidth=options.lineWidth==null?this._lineWidth:options.lineWidth;this._fillColor=options.fillColor==null?this._fillColor:options.fillColor;this._fillOpacity=options.fillOpacity==null?this._fillOpacity:options.fillOpacity;this._text=options.text===undefined?this._text:options.text;this._textColor=options.textColor==null?this._textColor:options.textColor;this._notifyChanged$.next(this)};OutlineTag.prototype.getGLObjects=function(transform){var objects=[];if(this._lineWidth>0){for(var _i=0,_a=this._getGLLines(transform);_i<_a.length;_i++){var line=_a[_i];objects.push(line)}}if(this._fillOpacity>0&&!transform.gpano){objects.push(this._getGLMesh(transform))}return objects};OutlineTag.prototype.getDOMObjects=function(transform,atlas,matrixWorldInverse,projectionMatrix){var _this=this;var vNodes=[];if(this._geometry instanceof Component_1.RectGeometry){if(this._icon!=null){var iconVertex=this._geometry.getVertex3d(this._iconIndex,transform);var iconCameraSpace=this._convertToCameraSpace(iconVertex,matrixWorldInverse);if(iconCameraSpace.z<0){var interact=function(e){_this._interact$.next({offsetX:0,offsetY:0,operation:Component_1.TagOperation.None,tag:_this})};if(atlas.loaded){var spriteAlignments=this._getSpriteAlignment(this._iconIndex,this._iconAlignment);var sprite=atlas.getDOMSprite(this._icon,spriteAlignments[0],spriteAlignments[1]);var click=function(e){e.stopPropagation();_this._click$.next(_this)};var iconCanvas=this._projectToCanvas(iconCameraSpace,projectionMatrix);var iconCss=iconCanvas.map(function(coord){return 100*coord+"%"});var properties={onclick:click,onmousedown:interact,style:{left:iconCss[0],pointerEvents:"all",position:"absolute",top:iconCss[1]}};vNodes.push(vd.h("div.TagSymbol",properties,[sprite]))}}}else if(this._text!=null){var textVertex=this._geometry.getVertex3d(3,transform);var textCameraSpace=this._convertToCameraSpace(textVertex,matrixWorldInverse);if(textCameraSpace.z<0){var interact=function(e){_this._interact$.next({offsetX:0,offsetY:0,operation:Component_1.TagOperation.None,tag:_this})};var labelCanvas=this._projectToCanvas(textCameraSpace,projectionMatrix);var labelCss=labelCanvas.map(function(coord){return 100*coord+"%"});var properties={onmousedown:interact,style:{color:"#"+("000000"+this._textColor.toString(16)).substr(-6),left:labelCss[0],pointerEvents:"all",position:"absolute",top:labelCss[1]},textContent:this._text};vNodes.push(vd.h("span.TagSymbol",properties,[]))}}}if(!this._editable){return vNodes}var lineColor="#"+("000000"+this._lineColor.toString(16)).substr(-6);if(this._geometry instanceof Component_1.RectGeometry){var centroid3d=this._geometry.getCentroid3d(transform);var centroidCameraSpace=this._convertToCameraSpace(centroid3d,matrixWorldInverse);if(centroidCameraSpace.z<0){var interact=this._interact(Component_1.TagOperation.Centroid);var centerCanvas=this._projectToCanvas(centroidCameraSpace,projectionMatrix);var centerCss=centerCanvas.map(function(coord){return 100*coord+"%"});var properties={onmousedown:interact,style:{background:lineColor,left:centerCss[0],position:"absolute",top:centerCss[1]}};vNodes.push(vd.h("div.TagMover",properties,[]))}}var vertices3d=this._geometry.getVertices3d(transform);for(var i=0;i<vertices3d.length-1;i++){var isRectGeometry=this._geometry instanceof Component_1.RectGeometry;if(isRectGeometry&&(this._icon!=null&&i===this._iconIndex||this._icon==null&&this._text!=null&&i===3)){continue}var vertexCameraSpace=this._convertToCameraSpace(vertices3d[i],matrixWorldInverse);if(vertexCameraSpace.z>0){continue}var interact=this._interact(Component_1.TagOperation.Vertex,i);var vertexCanvas=this._projectToCanvas(vertexCameraSpace,projectionMatrix);var vertexCss=vertexCanvas.map(function(coord){return 100*coord+"%"});var properties={onmousedown:interact,style:{background:lineColor,left:vertexCss[0],position:"absolute",top:vertexCss[1]}};if(isRectGeometry){properties.style.cursor=i%2===0?"nesw-resize":"nwse-resize"}vNodes.push(vd.h("div.TagResizer",properties,[]));if(!this._indicateVertices){continue}var pointProperties={style:{background:lineColor,left:vertexCss[0],position:"absolute",top:vertexCss[1]}};vNodes.push(vd.h("div.TagVertex",pointProperties,[]))}return vNodes};OutlineTag.prototype._interact=function(operation,vertexIndex){var _this=this;return function(e){var offsetX=e.offsetX-e.target.offsetWidth/2;var offsetY=e.offsetY-e.target.offsetHeight/2;_this._interact$.next({offsetX:offsetX,offsetY:offsetY,operation:operation,tag:_this,vertexIndex:vertexIndex})}};OutlineTag.prototype._getLinePositions=function(points3d){var length=points3d.length;var positions=new Float32Array(length*3);for(var i=0;i<length;++i){var index=3*i;var position=points3d[i];positions[index+0]=position[0];positions[index+1]=position[1];positions[index+2]=position[2]}return positions};OutlineTag.prototype._getGLLine=function(points3d,transform){var positions=this._getLinePositions(points3d);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(positions,3));var material=new THREE.LineBasicMaterial({color:this._lineColor,linewidth:this._lineWidth});return new THREE.Line(geometry,material)};OutlineTag.prototype._getGLLines=function(transform){var objects=[];var points3d=this._geometry.getPoints3d(transform);var outline=this._getGLLine(points3d,transform);objects.push(outline);if(this._geometry instanceof Component_1.PolygonGeometry){var polygonGeometry=this._geometry;var holes3d=polygonGeometry.getHoleVertices3d(transform);for(var _i=0,holes3d_1=holes3d;_i<holes3d_1.length;_i++){var hole3d=holes3d_1[_i];var hole=this._getGLLine(hole3d,transform);objects.push(hole)}}return objects};OutlineTag.prototype._getGLMesh=function(transform){var triangles=this._geometry.getTriangles3d(transform);var positions=new Float32Array(triangles);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(positions,3));var material=new THREE.MeshBasicMaterial({color:this._fillColor,opacity:this._fillOpacity,side:THREE.DoubleSide,transparent:true});return new THREE.Mesh(geometry,material)};OutlineTag.prototype._getSpriteAlignment=function(index,alignment){var horizontalAlignment=Viewer_1.SpriteAlignment.Center;var verticalAlignment=Viewer_1.SpriteAlignment.Center;if(alignment===Component_1.Alignment.Outer){switch(index){case 0:horizontalAlignment=Viewer_1.SpriteAlignment.End;verticalAlignment=Viewer_1.SpriteAlignment.Start;break;case 1:horizontalAlignment=Viewer_1.SpriteAlignment.End;verticalAlignment=Viewer_1.SpriteAlignment.End;break;case 2:horizontalAlignment=Viewer_1.SpriteAlignment.Start;verticalAlignment=Viewer_1.SpriteAlignment.End;break;case 3:horizontalAlignment=Viewer_1.SpriteAlignment.Start;verticalAlignment=Viewer_1.SpriteAlignment.Start;break;default:break}}return[horizontalAlignment,verticalAlignment]};OutlineTag.click="click";return OutlineTag}(Component_1.Tag);exports.OutlineTag=OutlineTag;Object.defineProperty(exports,"__esModule",{value:true});exports.default=OutlineTag},{"../../../Component":404,"../../../Viewer":413,"rxjs/Subject":230,three:354,"virtual-dom":360}],470:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var vd=require("virtual-dom");var Component_1=require("../../../Component");var Viewer_1=require("../../../Viewer");var SpotTag=function(_super){__extends(SpotTag,_super);function SpotTag(id,geometry,options){_super.call(this,id,geometry);this._color=options.color==null?16777215:options.color;this._editable=options.editable==null?false:options.editable;this._icon=options.icon===undefined?null:options.icon;this._text=options.text===undefined?null:options.text;this._textColor=options.textColor==null?16777215:options.textColor}Object.defineProperty(SpotTag.prototype,"color",{get:function(){return this._color},set:function(value){this._color=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(SpotTag.prototype,"editable",{get:function(){return this._editable},set:function(value){this._editable=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(SpotTag.prototype,"icon",{get:function(){return this._icon},set:function(value){this._icon=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(SpotTag.prototype,"text",{get:function(){return this._text},set:function(value){this._text=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(SpotTag.prototype,"textColor",{get:function(){return this._textColor},set:function(value){this._textColor=value;this._notifyChanged$.next(this)},enumerable:true,configurable:true});SpotTag.prototype.setOptions=function(options){this._color=options.color==null?this._color:options.color;this._editable=options.editable==null?this._editable:options.editable;this._icon=options.icon===undefined?this._icon:options.icon;this._text=options.text===undefined?this._text:options.text;this._textColor=options.textColor==null?this._textColor:options.textColor;this._notifyChanged$.next(this)};SpotTag.prototype.getGLObjects=function(transform){return[]};SpotTag.prototype.getDOMObjects=function(transform,atlas,matrixWorldInverse,projectionMatrix){var _this=this;var vNodes=[];var centroid3d=this._geometry.getCentroid3d(transform);var centroidCameraSpace=this._convertToCameraSpace(centroid3d,matrixWorldInverse);if(centroidCameraSpace.z<0){var centroidCanvas=this._projectToCanvas(centroidCameraSpace,projectionMatrix);var centroidCss=centroidCanvas.map(function(coord){return 100*coord+"%"});var interactNone=function(e){_this._interact$.next({offsetX:0,offsetY:0,operation:Component_1.TagOperation.None,tag:_this})};if(this._icon!=null){if(atlas.loaded){var sprite=atlas.getDOMSprite(this._icon,Viewer_1.SpriteAlignment.Center,Viewer_1.SpriteAlignment.End);var properties={onmousedown:interactNone,style:{bottom:100*(1-centroidCanvas[1])+"%",
left:centroidCss[0],pointerEvents:"all",position:"absolute",transform:"translate(0px, -8px)"}};vNodes.push(vd.h("div",properties,[sprite]))}}else if(this._text!=null){var properties={onmousedown:interactNone,style:{bottom:100*(1-centroidCanvas[1])+"%",color:"#"+("000000"+this._textColor.toString(16)).substr(-6),left:centroidCss[0],pointerEvents:"all",position:"absolute",transform:"translate(-50%, -7px)"},textContent:this._text};vNodes.push(vd.h("span.TagSymbol",properties,[]))}var interact=this._interact(Component_1.TagOperation.Centroid);var background="#"+("000000"+this.color.toString(16)).substr(-6);if(this._editable){var interactorProperties={onmousedown:interact,style:{background:background,left:centroidCss[0],pointerEvents:"all",position:"absolute",top:centroidCss[1]}};vNodes.push(vd.h("div.TagSpotInteractor",interactorProperties,[]))}var pointProperties={style:{background:background,left:centroidCss[0],position:"absolute",top:centroidCss[1]}};vNodes.push(vd.h("div.TagVertex",pointProperties,[]))}return vNodes};SpotTag.prototype._interact=function(operation,vertexIndex){var _this=this;return function(e){var offsetX=e.offsetX-e.target.offsetWidth/2;var offsetY=e.offsetY-e.target.offsetHeight/2;_this._interact$.next({offsetX:offsetX,offsetY:offsetY,operation:operation,tag:_this,vertexIndex:vertexIndex})}};return SpotTag}(Component_1.Tag);exports.SpotTag=SpotTag;Object.defineProperty(exports,"__esModule",{value:true});exports.default=SpotTag},{"../../../Component":404,"../../../Viewer":413,"virtual-dom":360}],471:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=require("three");var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/map");require("rxjs/add/operator/share");var Utils_1=require("../../../Utils");var Tag=function(_super){__extends(Tag,_super);function Tag(id,geometry){var _this=this;_super.call(this);this._id=id;this._geometry=geometry;this._interact$=new Subject_1.Subject;this._notifyChanged$=new Subject_1.Subject;this._notifyChanged$.subscribe(function(t){_this.fire(Tag.changed,_this)});this._geometry.changed$.subscribe(function(g){_this.fire(Tag.geometrychanged,_this)})}Object.defineProperty(Tag.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(Tag.prototype,"geometry",{get:function(){return this._geometry},enumerable:true,configurable:true});Object.defineProperty(Tag.prototype,"interact$",{get:function(){return this._interact$},enumerable:true,configurable:true});Object.defineProperty(Tag.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:true,configurable:true});Object.defineProperty(Tag.prototype,"geometryChanged$",{get:function(){var _this=this;return this._geometry.changed$.map(function(geometry){return _this}).share()},enumerable:true,configurable:true});Tag.prototype._projectToCanvas=function(point,projectionMatrix){var projected=new THREE.Vector3(point.x,point.y,point.z).applyProjection(projectionMatrix);return[(projected.x+1)/2,(-projected.y+1)/2]};Tag.prototype._convertToCameraSpace=function(point,matrixWorldInverse){return new THREE.Vector3(point[0],point[1],point[2]).applyMatrix4(matrixWorldInverse)};Tag.changed="changed";Tag.geometrychanged="geometrychanged";return Tag}(Utils_1.EventEmitter);exports.Tag=Tag;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Tag},{"../../../Utils":412,"rxjs/Subject":230,"rxjs/add/operator/map":255,"rxjs/add/operator/share":264,three:354}],472:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var MapillaryError_1=require("./MapillaryError");var InitializationMapillaryError=function(_super){__extends(InitializationMapillaryError,_super);function InitializationMapillaryError(){_super.call(this);this.name="InitializationMapillaryError";this.message="Could not initialize"}return InitializationMapillaryError}(MapillaryError_1.MapillaryError);exports.InitializationMapillaryError=InitializationMapillaryError;Object.defineProperty(exports,"__esModule",{value:true});exports.default=InitializationMapillaryError},{"./MapillaryError":473}],473:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var MapillaryError=function(_super){__extends(MapillaryError,_super);function MapillaryError(){_super.call(this)}return MapillaryError}(Error);exports.MapillaryError=MapillaryError;Object.defineProperty(exports,"__esModule",{value:true});exports.default=MapillaryError},{}],474:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var MapillaryError_1=require("./MapillaryError");var MoveTypeMapillaryError=function(_super){__extends(MoveTypeMapillaryError,_super);function MoveTypeMapillaryError(){_super.call(this);this.name="MoveTypeMapillaryError";this.message="The type of ui you use does not support this move"}return MoveTypeMapillaryError}(MapillaryError_1.MapillaryError);exports.MoveTypeMapillaryError=MoveTypeMapillaryError;Object.defineProperty(exports,"__esModule",{value:true});exports.default=MoveTypeMapillaryError},{"./MapillaryError":473}],475:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var MapillaryError_1=require("./MapillaryError");var NotImplementedMapillaryError=function(_super){__extends(NotImplementedMapillaryError,_super);function NotImplementedMapillaryError(){_super.call(this);this.name="NotImplementedMapillaryError";this.message="This function has not yet been implemented"}return NotImplementedMapillaryError}(MapillaryError_1.MapillaryError);exports.NotImplementedMapillaryError=NotImplementedMapillaryError;Object.defineProperty(exports,"__esModule",{value:true});exports.default=NotImplementedMapillaryError},{"./MapillaryError":473}],476:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var MapillaryError_1=require("./MapillaryError");var ParameterMapillaryError=function(_super){__extends(ParameterMapillaryError,_super);function ParameterMapillaryError(message){_super.call(this);this.name="ParameterMapillaryError";this.message=message!=null?message:"The function was not called with correct parameters"}return ParameterMapillaryError}(MapillaryError_1.MapillaryError);exports.ParameterMapillaryError=ParameterMapillaryError;Object.defineProperty(exports,"__esModule",{value:true});exports.default=ParameterMapillaryError},{"./MapillaryError":473}],477:[function(require,module,exports){"use strict";var THREE=require("three");var Camera=function(){function Camera(transform){if(transform!=null){this._position=transform.pixelToVertex(0,0,0);this._lookat=transform.pixelToVertex(0,0,10);this._up=transform.upVector();this._focal=this._getFocal(transform)}else{this._position=new THREE.Vector3(0,0,0);this._lookat=new THREE.Vector3(0,0,1);this._up=new THREE.Vector3(0,(-1),0);this._focal=1}}Object.defineProperty(Camera.prototype,"position",{get:function(){return this._position},enumerable:true,configurable:true});Object.defineProperty(Camera.prototype,"lookat",{get:function(){return this._lookat},enumerable:true,configurable:true});Object.defineProperty(Camera.prototype,"up",{get:function(){return this._up},enumerable:true,configurable:true});Object.defineProperty(Camera.prototype,"focal",{get:function(){return this._focal},set:function(value){this._focal=value},enumerable:true,configurable:true});Camera.prototype.lerpCameras=function(a,b,alpha){this._position.subVectors(b.position,a.position).multiplyScalar(alpha).add(a.position);this._lookat.subVectors(b.lookat,a.lookat).multiplyScalar(alpha).add(a.lookat);this._up.subVectors(b.up,a.up).multiplyScalar(alpha).add(a.up);this._focal=(1-alpha)*a.focal+alpha*b.focal};Camera.prototype.copy=function(other){this._position.copy(other.position);this._lookat.copy(other.lookat);this._up.copy(other.up);this._focal=other.focal};Camera.prototype.clone=function(){var camera=new Camera;camera.position.copy(this._position);camera.lookat.copy(this._lookat);camera.up.copy(this._up);camera.focal=this._focal;return camera};Camera.prototype.diff=function(other){var pd=this._position.distanceToSquared(other.position);var ld=this._lookat.distanceToSquared(other.lookat);var ud=this._up.distanceToSquared(other.up);var fd=100*Math.abs(this._focal-other.focal);return Math.max(pd,ld,ud,fd)};Camera.prototype._getFocal=function(transform){return transform.gpano==null?transform.focal:.5};return Camera}();exports.Camera=Camera},{three:354}],478:[function(require,module,exports){"use strict";var GeoCoords=function(){function GeoCoords(){this._wgs84a=6378137;this._wgs84b=6356752.31424518}GeoCoords.prototype.geodeticToEnu=function(lat,lon,alt,refLat,refLon,refAlt){var ecef=this.geodeticToEcef(lat,lon,alt);return this.ecefToEnu(ecef[0],ecef[1],ecef[2],refLat,refLon,refAlt)};GeoCoords.prototype.enuToGeodetic=function(x,y,z,refLat,refLon,refAlt){var ecef=this.enuToEcef(x,y,z,refLat,refLon,refAlt);return this.ecefToGeodetic(ecef[0],ecef[1],ecef[2])};GeoCoords.prototype.ecefToEnu=function(X,Y,Z,refLat,refLon,refAlt){var refEcef=this.geodeticToEcef(refLat,refLon,refAlt);var V=[X-refEcef[0],Y-refEcef[1],Z-refEcef[2]];refLat=refLat*Math.PI/180;refLon=refLon*Math.PI/180;var cosLat=Math.cos(refLat);var sinLat=Math.sin(refLat);var cosLon=Math.cos(refLon);var sinLon=Math.sin(refLon);var x=-sinLon*V[0]+cosLon*V[1];var y=-sinLat*cosLon*V[0]-sinLat*sinLon*V[1]+cosLat*V[2];var z=cosLat*cosLon*V[0]+cosLat*sinLon*V[1]+sinLat*V[2];return[x,y,z]};GeoCoords.prototype.enuToEcef=function(x,y,z,refLat,refLon,refAlt){var refEcef=this.geodeticToEcef(refLat,refLon,refAlt);refLat=refLat*Math.PI/180;refLon=refLon*Math.PI/180;var cosLat=Math.cos(refLat);var sinLat=Math.sin(refLat);var cosLon=Math.cos(refLon);var sinLon=Math.sin(refLon);var X=-sinLon*x-sinLat*cosLon*y+cosLat*cosLon*z+refEcef[0];var Y=cosLon*x-sinLat*sinLon*y+cosLat*sinLon*z+refEcef[1];var Z=cosLat*y+sinLat*z+refEcef[2];return[X,Y,Z]};GeoCoords.prototype.geodeticToEcef=function(lat,lon,alt){var a=this._wgs84a;var b=this._wgs84b;lat=lat*Math.PI/180;lon=lon*Math.PI/180;var cosLat=Math.cos(lat);var sinLat=Math.sin(lat);var cosLon=Math.cos(lon);var sinLon=Math.sin(lon);var a2=a*a;var b2=b*b;var L=1/Math.sqrt(a2*cosLat*cosLat+b2*sinLat*sinLat);var nhcl=(a2*L+alt)*cosLat;var X=nhcl*cosLon;var Y=nhcl*sinLon;var Z=(b2*L+alt)*sinLat;return[X,Y,Z]};GeoCoords.prototype.ecefToGeodetic=function(X,Y,Z){var a=this._wgs84a;var b=this._wgs84b;var a2=a*a;var b2=b*b;var a2mb2=a2-b2;var ea=Math.sqrt(a2mb2/a2);var eb=Math.sqrt(a2mb2/b2);var p=Math.sqrt(X*X+Y*Y);var theta=Math.atan2(Z*a,p*b);var sinTheta=Math.sin(theta);var cosTheta=Math.cos(theta);var lon=Math.atan2(Y,X);var lat=Math.atan2(Z+eb*eb*b*sinTheta*sinTheta*sinTheta,p-ea*ea*a*cosTheta*cosTheta*cosTheta);var sinLat=Math.sin(lat);var cosLat=Math.cos(lat);var N=a/Math.sqrt(1-ea*ea*sinLat*sinLat);var alt=p/cosLat-N;return[lat*180/Math.PI,lon*180/Math.PI,alt]};return GeoCoords}();exports.GeoCoords=GeoCoords;Object.defineProperty(exports,"__esModule",{value:true});exports.default=GeoCoords},{}],479:[function(require,module,exports){"use strict";var THREE=require("three");var Spatial=function(){function Spatial(){this._epsilon=1e-9}Spatial.prototype.degToRad=function(deg){return Math.PI*deg/180};Spatial.prototype.radToDeg=function(rad){return 180*rad/Math.PI};Spatial.prototype.rotationMatrix=function(angleAxis){var axis=new THREE.Vector3(angleAxis[0],angleAxis[1],angleAxis[2]);var angle=axis.length();axis.normalize();return(new THREE.Matrix4).makeRotationAxis(axis,angle)};Spatial.prototype.rotate=function(vector,angleAxis){var v=new THREE.Vector3(vector[0],vector[1],vector[2]);var rotationMatrix=this.rotationMatrix(angleAxis);v.applyMatrix4(rotationMatrix);return v};Spatial.prototype.opticalCenter=function(rotation,translation){var angleAxis=[-rotation[0],-rotation[1],-rotation[2]];var vector=[-translation[0],-translation[1],-translation[2]];return this.rotate(vector,angleAxis)};Spatial.prototype.viewingDirection=function(rotation){var angleAxis=[-rotation[0],-rotation[1],-rotation[2]];return this.rotate([0,0,1],angleAxis)};Spatial.prototype.wrap=function(value,min,max){if(max<min){throw new Error("Invalid arguments: max must be larger than min.")}var interval=max-min;while(value>max||value<min){if(value>max){value=value-interval}else if(value<min){value=value+interval}}return value};Spatial.prototype.wrapAngle=function(angle){return this.wrap(angle,-Math.PI,Math.PI)};Spatial.prototype.clamp=function(value,min,max){if(value<min){return min}if(value>max){return max}return value};Spatial.prototype.angleBetweenVector2=function(x1,y1,x2,y2){var angle=Math.atan2(y2,x2)-Math.atan2(y1,x1);return this.wrapAngle(angle)};Spatial.prototype.angleDifference=function(angle1,angle2){var angle=angle2-angle1;return this.wrapAngle(angle)};Spatial.prototype.relativeRotationAngle=function(rotation1,rotation2){var R1T=this.rotationMatrix([-rotation1[0],-rotation1[1],-rotation1[2]]);var R2=this.rotationMatrix(rotation2);var R=R1T.multiply(R2);var elements=R.elements;var theta=Math.acos((elements[0]+elements[5]+elements[10]-1)/2);return theta};Spatial.prototype.angleToPlane=function(vector,planeNormal){var v=(new THREE.Vector3).fromArray(vector);var norm=v.length();if(norm<this._epsilon){return 0}var projection=v.dot((new THREE.Vector3).fromArray(planeNormal));return Math.asin(projection/norm)};Spatial.prototype.distanceFromLatLon=function(lat1,lon1,lat2,lon2){var r=6371e3;var dLat=this.degToRad(lat2-lat1);var dLon=this.degToRad(lon2-lon1);var hav=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2);var d=2*r*Math.atan2(Math.sqrt(hav),Math.sqrt(1-hav));return d};return Spatial}();exports.Spatial=Spatial;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Spatial},{three:354}],480:[function(require,module,exports){"use strict";var THREE=require("three");var Transform=function(){function Transform(node,translation){this._orientation=this._getValue(node.apiNavImIm.orientation,1);var imageWidth=node.image!=null?node.image.width:4;var imageHeight=node.image!=null?node.image.height:3;var keepOrientation=this._orientation<5;this._width=this._getValue(node.apiNavImIm.width,keepOrientation?imageWidth:imageHeight);this._height=this._getValue(node.apiNavImIm.height,keepOrientation?imageHeight:imageWidth);this._basicAspect=keepOrientation?this._width/this._height:this._height/this._width;this._focal=this._getValue(node.apiNavImIm.cfocal,1);this._scale=this._getValue(node.apiNavImIm.atomic_scale,0);this._gpano=node.apiNavImIm.gpano?node.apiNavImIm.gpano:null;this._rt=this._getRt(node,translation);this._srt=this._getSrt(this._rt,this._scale)}Object.defineProperty(Transform.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"focal",{get:function(){return this._focal},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"orientation",{get:function(){return this._orientation},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"scale",{get:function(){return this._scale},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"basicAspect",{get:function(){return this._basicAspect},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"gpano",{get:function(){return this._gpano},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"rt",{get:function(){return this._rt},enumerable:true,configurable:true});Object.defineProperty(Transform.prototype,"srt",{get:function(){return this._srt},enumerable:true,configurable:true});Transform.prototype.pixelToVertex=function(x,y,depth){var v=new THREE.Vector4(x/this._focal*depth,y/this._focal*depth,depth,1);v.applyMatrix4((new THREE.Matrix4).getInverse(this._rt));return new THREE.Vector3(v.x/v.w,v.y/v.w,v.z/v.w)};Transform.prototype.upVector=function(){var rte=this._rt.elements;switch(this._orientation){case 1:return new THREE.Vector3((-rte[1]),(-rte[5]),(-rte[9]));case 3:return new THREE.Vector3(rte[1],rte[5],rte[9]);case 6:return new THREE.Vector3((-rte[0]),(-rte[4]),(-rte[8]));case 8:return new THREE.Vector3(rte[0],rte[4],rte[8]);default:return new THREE.Vector3((-rte[1]),(-rte[5]),(-rte[9]))}};Transform.prototype.projectorMatrix=function(){var projector=this._normalizedToTextureMatrix();var f=this._focal;var projection=(new THREE.Matrix4).set(f,0,0,0,0,f,0,0,0,0,0,0,0,0,1,0);projector.multiply(projection);projector.multiply(this._rt);return projector};Transform.prototype.projectBasic=function(point){var sfm=this.projectSfM(point);return this._sfmToBasic(sfm)};Transform.prototype.unprojectBasic=function(pixel,distance){var sfm=this._basicToSfm(pixel);return this.unprojectSfM(sfm,distance)};Transform.prototype.projectSfM=function(point){var v=new THREE.Vector4(point[0],point[1],point[2],1);v.applyMatrix4(this._rt);return this._bearingToPixel([v.x,v.y,v.z])};Transform.prototype.unprojectSfM=function(pixel,distance){var bearing=this._pixelToBearing(pixel);var v=new THREE.Vector4(distance*bearing[0],distance*bearing[1],distance*bearing[2],1);v.applyMatrix4((new THREE.Matrix4).getInverse(this._rt));return[v.x/v.w,v.y/v.w,v.z/v.w]};Transform.prototype._pixelToBearing=function(pixel){if(this._fullPano()){var lon=pixel[0]*2*Math.PI;var lat=-pixel[1]*2*Math.PI;var x=Math.cos(lat)*Math.sin(lon);var y=-Math.sin(lat);var z=Math.cos(lat)*Math.cos(lon);return[x,y,z]}else if(this._gpano){var size=Math.max(this.gpano.CroppedAreaImageWidthPixels,this.gpano.CroppedAreaImageHeightPixels);var fullPanoPixel=[pixel[0]*size+this.gpano.CroppedAreaImageWidthPixels/2+this.gpano.CroppedAreaLeftPixels,pixel[1]*size+this.gpano.CroppedAreaImageHeightPixels/2+this.gpano.CroppedAreaTopPixels];var lon=2*Math.PI*(fullPanoPixel[0]/this.gpano.FullPanoWidthPixels-.5);var lat=-Math.PI*(fullPanoPixel[1]/this.gpano.FullPanoHeightPixels-.5);var x=Math.cos(lat)*Math.sin(lon);var y=-Math.sin(lat);var z=Math.cos(lat)*Math.cos(lon);return[x,y,z]}else{var v=new THREE.Vector3(pixel[0],pixel[1],this._focal);v.normalize();return[v.x,v.y,v.z]}};Transform.prototype._bearingToPixel=function(bearing){if(this._fullPano()){var x=bearing[0];var y=bearing[1];var z=bearing[2];var lon=Math.atan2(x,z);var lat=Math.atan2(-y,Math.sqrt(x*x+z*z));return[lon/(2*Math.PI),-lat/(2*Math.PI)]}else if(this._gpano){var x=bearing[0];var y=bearing[1];var z=bearing[2];var lon=Math.atan2(x,z);var lat=Math.atan2(-y,Math.sqrt(x*x+z*z));var fullPanoPixel=[(lon/(2*Math.PI)+.5)*this.gpano.FullPanoWidthPixels,(-lat/Math.PI+.5)*this.gpano.FullPanoHeightPixels];var size=Math.max(this.gpano.CroppedAreaImageWidthPixels,this.gpano.CroppedAreaImageHeightPixels);return[(fullPanoPixel[0]-this.gpano.CroppedAreaLeftPixels-this.gpano.CroppedAreaImageWidthPixels/2)/size,(fullPanoPixel[1]-this.gpano.CroppedAreaTopPixels-this.gpano.CroppedAreaImageHeightPixels/2)/size]}else{return[bearing[0]*this._focal/bearing[2],bearing[1]*this._focal/bearing[2]]}};Transform.prototype._basicToSfm=function(point){var rotatedX;var rotatedY;switch(this._orientation){case 1:rotatedX=point[0];rotatedY=point[1];break;case 3:rotatedX=1-point[0];rotatedY=1-point[1];break;case 6:rotatedX=point[1];rotatedY=1-point[0];break;case 8:rotatedX=1-point[1];rotatedY=point[0];break;default:rotatedX=point[0];rotatedY=point[1];break}var w=this._width;var h=this._height;var s=Math.max(w,h);var sfmX=rotatedX*w/s-w/s/2;var sfmY=rotatedY*h/s-h/s/2;return[sfmX,sfmY]};Transform.prototype._sfmToBasic=function(point){var w=this._width;var h=this._height;var s=Math.max(w,h);var rotatedX=(point[0]+w/s/2)/w*s;var rotatedY=(point[1]+h/s/2)/h*s;var basicX;var basicY;switch(this._orientation){case 1:basicX=rotatedX;basicY=rotatedY;break;case 3:basicX=1-rotatedX;basicY=1-rotatedY;break;case 6:basicX=1-rotatedY;basicY=rotatedX;break;case 8:basicX=rotatedY;basicY=1-rotatedX;break;default:basicX=rotatedX;basicY=rotatedY;break}return[basicX,basicY]};Transform.prototype._fullPano=function(){return this.gpano!=null&&this.gpano.CroppedAreaLeftPixels===0&&this.gpano.CroppedAreaTopPixels===0&&this.gpano.CroppedAreaImageWidthPixels===this.gpano.FullPanoWidthPixels&&this.gpano.CroppedAreaImageHeightPixels===this.gpano.FullPanoHeightPixels};Transform.prototype._getValue=function(value,fallback){return value!=null&&value>0?value:fallback};Transform.prototype._getRt=function(node,translation){var axis=new THREE.Vector3(node.apiNavImIm.rotation[0],node.apiNavImIm.rotation[1],node.apiNavImIm.rotation[2]);var angle=axis.length();axis.normalize();var rt=new THREE.Matrix4;rt.makeRotationAxis(axis,angle);rt.setPosition(new THREE.Vector3(translation[0],translation[1],translation[2]));return rt};Transform.prototype._getSrt=function(rt,scale){var srt=rt.clone();var elements=srt.elements;elements[12]=scale*elements[12];elements[13]=scale*elements[13];elements[14]=scale*elements[14];srt.scale(new THREE.Vector3(scale,scale,scale));return srt};Transform.prototype._normalizedToTextureMatrix=function(){var size=Math.max(this._width,this._height);var w=size/this._width;var h=size/this._height;switch(this._orientation){case 1:return(new THREE.Matrix4).set(w,0,0,.5,0,-h,0,.5,0,0,1,0,0,0,0,1);case 3:return(new THREE.Matrix4).set(-w,0,0,.5,0,h,0,.5,0,0,1,0,0,0,0,1);case 6:return(new THREE.Matrix4).set(0,-h,0,.5,-w,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new THREE.Matrix4).set(0,h,0,.5,w,0,0,.5,0,0,1,0,0,0,0,1);default:return(new THREE.Matrix4).set(w,0,0,.5,0,-h,0,.5,0,0,1,0,0,0,0,1)}};return Transform}();exports.Transform=Transform},{three:354}],481:[function(require,module,exports){"use strict";var Geo_1=require("../Geo");var WebMercator=function(){function WebMercator(){this._spatial=new Geo_1.Spatial;this._tileSize=256}WebMercator.prototype.getTile=function(latLon,zoom){var scale=Math.pow(2,zoom);var point=this._latLonToPoint(latLon);return{x:Math.floor(scale*point.x/this._tileSize),y:Math.floor(scale*point.y/this._tileSize),z:zoom}};WebMercator.prototype.getBounds=function(tile){tile=this._normalize(tile);var scale=Math.pow(2,tile.z);var s=this._tileSize/scale;var sw={x:tile.x*s,y:tile.y*s+s};var ne={x:tile.x*s+s,y:tile.y*s};return{ne:this._pointToLatLon(ne),sw:this._pointToLatLon(sw)}};WebMercator.prototype._normalize=function(tile){var scale=Math.pow(2,tile.z);tile.x=(tile.x%scale+scale)%scale;tile.y=(tile.y%scale+scale)%scale;return tile};WebMercator.prototype._latLonToPoint=function(latLon){var siny=Math.sin(this._spatial.degToRad(latLon.lat));return{x:this._tileSize*(.5+latLon.lon/360),y:this._tileSize*(.5-Math.log((1+siny)/(1-siny))/(4*Math.PI))}};WebMercator.prototype._pointToLatLon=function(point){return{lat:this._spatial.radToDeg(2*Math.atan(Math.exp(2*Math.PI*(.5-point.y/this._tileSize))))-90,lon:360*(point.x/this._tileSize-.5)}};return WebMercator}();exports.WebMercator=WebMercator;Object.defineProperty(exports,"__esModule",{value:true});exports.default=WebMercator},{"../Geo":407}],482:[function(require,module,exports){"use strict";var _=require("underscore");var graphlib=require("graphlib");var rbush=require("rbush");var THREE=require("three");var geohash=require("latlon-geohash");var Edge_1=require("../Edge");var Geo_1=require("../Geo");var Graph_1=require("../Graph");var GeoHashDirections=function(){function GeoHashDirections(){}GeoHashDirections.n="n";GeoHashDirections.nw="nw";GeoHashDirections.w="w";GeoHashDirections.sw="sw";GeoHashDirections.s="s";GeoHashDirections.se="se";GeoHashDirections.e="e";GeoHashDirections.ne="ne";return GeoHashDirections}();var Graph=function(){function Graph(){this._boxWidth=.001;this._defaultAlt=2;this._sequences={};this._sequenceHashes={};this._nodeIndex=rbush(16,[".lon",".lat",".lon",".lat"]);this._graph=new graphlib.Graph({multigraph:true});this._cachedNodes={};this._unWorthyNodes={};this._edgeCalculator=new Edge_1.EdgeCalculator;this._spatial=new Geo_1.Spatial;this._geoCoords=new Geo_1.GeoCoords}Graph.prototype.addNodesFromAPI=function(data,tiles){var _this=this;if(data===undefined){return}var h=data.hs[0];var bounds=geohash.bounds(h);var neighbours=geohash.neighbours(h);var hSequenceHashes=[];for(var _i=0,_a=data.ss;_i<_a.length;_i++){var s=_a[_i];var skey=s.key;if(skey in this._sequences){hSequenceHashes.push(this._sequenceHashes[skey]);continue}var sequence=new Graph_1.Sequence(s);this._sequences[skey]=sequence;var sequenceHash={};for(var _b=0,_c=s.keys;_b<_c.length;_b++){var key=_c[_b];sequenceHash[key]=sequence}this._sequenceHashes[skey]=sequenceHash;hSequenceHashes.push(sequenceHash)}var nodes=_.map(data.ims,function(im){var lat=im.lat;if(im.clat!=null){lat=im.clat}var lon=im.lon;if(im.clon!=null){lon=im.clon}var ca=im.ca;if(im.cca!=null){ca=im.cca}if(im.calt==null){im.calt=_this._defaultAlt}var latLon={lat:lat,lon:lon};if(im.rotation==null){im.rotation=_this._computeRotation(im.ca,im.orientation)}var hs=_this._computeHs(latLon,bounds.sw,bounds.ne,h,neighbours);var sequence=null;for(var _i=0,hSequenceHashes_1=hSequenceHashes;_i<hSequenceHashes_1.length;_i++){var ts=hSequenceHashes_1[_i];if(im.key in ts){sequence=ts[im.key];break}}var node=new Graph_1.Node(ca,latLon,false,sequence,im,hs);_this._unWorthyNodes[im.key]=true;return node});this.insertNodes(nodes);this.makeNodesWorthy(tiles)};Graph.prototype.makeNodesWorthy=function(tiles){var worthy;var worthyKeys=[];for(var key in this._unWorthyNodes){if(!this._unWorthyNodes.hasOwnProperty(key)){continue}if(!this._unWorthyNodes[key]){worthyKeys.push(key);continue}var node=this.getNode(key);var hs=node.hs;worthy=true;_.each(hs,function(h){worthy=worthy&&!!tiles[h]});if(worthy){node.worthy=true;this._unWorthyNodes[key]=false;worthyKeys.push(key)}}for(var _i=0,worthyKeys_1=worthyKeys;_i<worthyKeys_1.length;_i++){var key=worthyKeys_1[_i];delete this._unWorthyNodes[key]}};Graph.prototype.getNode=function(key){return this._graph.node(key)};Graph.prototype.getEdges=function(node){var _this=this;var outEdges=this._graph.outEdges(node.key);return _.map(outEdges,function(outEdge){var edge=_this._graph.edge(outEdge);return{data:edge,from:outEdge.v,to:outEdge.w}})};Graph.prototype.cacheNode=function(node){this.computeEdges(node);node.cached=true;node.lastUsed=(new Date).getTime();this._cachedNodes[node.key]=true};Graph.prototype.evictNodeCache=function(){if(Object.keys(this._cachedNodes).length<30){return}return};Graph.prototype.unCacheNode=function(node){delete this._cachedNodes[node.key];node.lastCacheEvict=(new Date).getTime()};Graph.prototype.computeEdges=function(node){if(!node.worthy){return false}var edges=this._edgeCalculator.computeSequenceEdges(node);var fallbackKeys=_.map(edges,function(edge){return edge.to});var minLon=node.latLon.lon-this._boxWidth/2;var minLat=node.latLon.lat-this._boxWidth/2;var maxLon=node.latLon.lon+this._boxWidth/2;var maxLat=node.latLon.lat+this._boxWidth/2;var nodes=_.map(this._nodeIndex.search({maxX:maxLon,maxY:maxLat,minX:minLon,minY:minLat}),function(item){return item.node});var potentialEdges=this._edgeCalculator.getPotentialEdges(node,nodes,fallbackKeys);edges=edges.concat(this._edgeCalculator.computeStepEdges(node,potentialEdges,node.findPrevKeyInSequence(),node.findNextKeyInSequence()));edges=edges.concat(this._edgeCalculator.computeTurnEdges(node,potentialEdges));edges=edges.concat(this._edgeCalculator.computePanoEdges(node,potentialEdges));edges=edges.concat(this._edgeCalculator.computePerspectiveToPanoEdges(node,potentialEdges));this._addEdgesToNode(node,edges);node.edges=this.getEdges(node);return true};Graph.prototype.insertNodes=function(nodes){var _this=this;_.each(nodes,function(node){_this.insertNode(node)})};Graph.prototype.insertNode=function(node){if(this.getNode(node.key)!=null){return}this._nodeIndex.insert({lat:node.latLon.lat,lon:node.latLon.lon,node:node});this._graph.setNode(node.key,node)};Graph.prototype.nextNode=function(node,dir){var key=this.nextKey(node,dir);return key==null?null:this.getNode(key)};Graph.prototype.nextKey=function(node,dir){var outEdges=this._graph.outEdges(node.key);for(var _i=0,outEdges_1=outEdges;_i<outEdges_1.length;_i++){var outEdge=outEdges_1[_i];var edgeData=this._graph.edge(outEdge);if(edgeData.direction===dir){return outEdge.w}}return null};Graph.prototype._computeHs=function(latLon,sw,ne,h,neighbours){var hs=[h];var bl=[0,0,0];var tr=this._geoCoords.geodeticToEnu(ne.lat,ne.lon,0,sw.lat,sw.lon,0);var position=this._geoCoords.geodeticToEnu(latLon.lat,latLon.lon,0,sw.lat,sw.lon,0);var left=position[0]-bl[0];var right=tr[0]-position[0];var bottom=position[1]-bl[1];var top=tr[1]-position[1];var l=left<20;var r=right<20;var b=bottom<20;var t=top<20;if(t){hs.push(neighbours[GeoHashDirections.n])}if(t&&l){hs.push(neighbours[GeoHashDirections.nw])}if(l){hs.push(neighbours[GeoHashDirections.w])}if(l&&b){hs.push(neighbours[GeoHashDirections.sw])}if(b){hs.push(neighbours[GeoHashDirections.s])}if(b&&r){hs.push(neighbours[GeoHashDirections.se])}if(r){hs.push(neighbours[GeoHashDirections.e])}if(r&&t){hs.push(neighbours[GeoHashDirections.ne])}return hs};Graph.prototype._computeRotation=function(compassAngle,orientation){var x=0;var y=0;var z=0;switch(orientation){case 1:x=Math.PI/2;break;case 3:x=-Math.PI/2;z=Math.PI;break;case 6:y=-Math.PI/2;z=-Math.PI/2;break;case 8:y=Math.PI/2;z=Math.PI/2;break;default:break}var rz=(new THREE.Matrix4).makeRotationZ(z);var euler=new THREE.Euler(x,y,compassAngle*Math.PI/180,"XYZ");var re=(new THREE.Matrix4).makeRotationFromEuler(euler);var rotation=(new THREE.Vector4).setAxisAngleFromRotationMatrix(re.multiply(rz));return rotation.multiplyScalar(rotation.w).toArray().slice(0,3)};Graph.prototype._addEdgesToNode=function(node,edges){var outEdges=this._graph.outEdges(node.key);for(var i in outEdges){if(outEdges.hasOwnProperty(i)){var e=outEdges[i];this._graph.removeEdge(e)}}for(var _i=0,edges_1=edges;_i<edges_1.length;_i++){var edge=edges_1[_i];this._graph.setEdge(node.key,edge.to,edge.data,node.key+edge.to+edge.data.direction)}};return Graph}();exports.Graph=Graph;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Graph},{"../Edge":405,"../Geo":407,"../Graph":408,graphlib:157,"latlon-geohash":182,rbush:195,three:354,underscore:355}],483:[function(require,module,exports){"use strict";var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/throw");require("rxjs/add/operator/distinct");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/publish");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/skipWhile");require("rxjs/add/operator/take");var Graph_1=require("../Graph");var GraphService=function(){function GraphService(apiV2,apiV3){this._updates$=new Subject_1.Subject;this._cache$=new Subject_1.Subject;this._tilesService=new Graph_1.TilesService(apiV2);
this._vectorTilesService=new Graph_1.VectorTilesService(apiV3);this._imageLoadingService=new Graph_1.ImageLoadingService;this._graph$=this._updates$.scan(function(graph,operation){var newGraph=operation(graph);newGraph.evictNodeCache();return newGraph},new Graph_1.Graph).publishReplay(1).refCount();this._graph$.subscribe();this._updates$.next(function(graph){return graph});this._loadingNode$=this._cache$.distinct(function(n1,n2){return n1.key===n2.key}).mergeMap(function(node){return node.cacheAssets()}).publish();this._loadingNode$.connect();this._loadingNode$.subscribe(this._imageLoadingService.loadnode$);this._cachedNode$=this._loadingNode$.filter(function(node){return!!node.image&&!!node.mesh}).publish();this._cachedNode$.connect();this._cachedNode$.subscribe(this._vectorTilesService.cacheNode$);this._cachedNode$.map(function(node){return function(graph){graph.cacheNode(node);return graph}}).subscribe(this._updates$);var lastData;this._tilesService.tiles$.combineLatest(this._tilesService.cachedTiles$,function(data,tiles){return function(graph){if(lastData===data){return graph}lastData=data;graph.addNodesFromAPI(data,tiles);return graph}}).subscribe(this._updates$)}Object.defineProperty(GraphService.prototype,"graph$",{get:function(){return this._graph$},enumerable:true,configurable:true});Object.defineProperty(GraphService.prototype,"imageLoadingService",{get:function(){return this._imageLoadingService},enumerable:true,configurable:true});Object.defineProperty(GraphService.prototype,"vectorTilesService",{get:function(){return this._vectorTilesService},enumerable:true,configurable:true});GraphService.prototype.node$=function(key){var _this=this;return this._graph$.skipWhile(function(graph){var node=graph.getNode(key);if(node==null){_this._tilesService.cacheIm$.next(key);return true}if(!node.worthy){_this._tilesService.cacheNodeH$.next(node);return true}if(!node.cached){_this._cache$.next(node);return true}return false}).map(function(graph){return graph.getNode(key)}).take(1)};GraphService.prototype.nextNode$=function(node,dir){var _this=this;if(!node.cached){Observable_1.Observable.throw(new Error("node is not yet cached"))}return this._graph$.map(function(graph){return graph.nextKey(node,dir)}).distinct().mergeMap(function(key){return key==null?Observable_1.Observable.throw(new Error("no Image in direction")):_this.node$(key)})};return GraphService}();exports.GraphService=GraphService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=GraphService},{"../Graph":408,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/throw":241,"rxjs/add/operator/distinct":248,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/publish":261,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/skipWhile":267,"rxjs/add/operator/take":270}],484:[function(require,module,exports){"use strict";var Observable_1=require("rxjs/Observable");var Utils_1=require("../Utils");var ImageLoader=function(){function ImageLoader(){}ImageLoader.load=function(key,imageSize){return Observable_1.Observable.create(function(subscriber){var image=new Image;image.crossOrigin="Anonymous";var xmlHTTP=new XMLHttpRequest;xmlHTTP.open("GET",Utils_1.Urls.image(key,imageSize),true);xmlHTTP.responseType="arraybuffer";xmlHTTP.onload=function(pe){if(xmlHTTP.status!==200){console.warn("Image could not be loaded for key "+key,xmlHTTP.status,xmlHTTP.statusText);subscriber.next({loaded:{loaded:0,total:0},object:null});subscriber.complete();return}image.onload=function(e){subscriber.next({loaded:{loaded:pe.loaded,total:pe.total},object:image});subscriber.complete()};image.onerror=function(error){console.warn("Image could not be loaded for key "+key,error.error);subscriber.complete()};var blob=new Blob([xmlHTTP.response]);image.src=window.URL.createObjectURL(blob)};xmlHTTP.onprogress=function(pe){subscriber.next({loaded:{loaded:pe.loaded,total:pe.total},object:null})};xmlHTTP.send()})};return ImageLoader}();exports.ImageLoader=ImageLoader;Object.defineProperty(exports,"__esModule",{value:true});exports.default=ImageLoader},{"../Utils":412,"rxjs/Observable":226}],485:[function(require,module,exports){"use strict";var Subject_1=require("rxjs/Subject");var ImageLoadingService=function(){function ImageLoadingService(){this._loadnode$=new Subject_1.Subject;this._loadstatus$=this._loadnode$.scan(function(nodes,node){nodes[node.key]=node.loadStatus;return nodes},{}).publishReplay(1).refCount();this._loadstatus$.subscribe()}Object.defineProperty(ImageLoadingService.prototype,"loadnode$",{get:function(){return this._loadnode$},enumerable:true,configurable:true});Object.defineProperty(ImageLoadingService.prototype,"loadstatus$",{get:function(){return this._loadstatus$},enumerable:true,configurable:true});return ImageLoadingService}();exports.ImageLoadingService=ImageLoadingService},{"rxjs/Subject":230}],486:[function(require,module,exports){"use strict";var MapillaryObject=function(){function MapillaryObject(alt,firstSeenAt,latLon,key,lastSeenAt,rects,dPackage,value){this._alt=alt;this._firstSeenAt=firstSeenAt;this._latLon=latLon;this._key=key;this._lastSeenAt=lastSeenAt;this._rects=rects;this._dPackage=dPackage;this._value=value}Object.defineProperty(MapillaryObject.prototype,"alt",{get:function(){return this._alt},enumerable:true,configurable:true});Object.defineProperty(MapillaryObject.prototype,"firstSeenAt",{get:function(){return this._firstSeenAt},enumerable:true,configurable:true});Object.defineProperty(MapillaryObject.prototype,"latLon",{get:function(){return this._latLon},enumerable:true,configurable:true});Object.defineProperty(MapillaryObject.prototype,"key",{get:function(){return this._key},enumerable:true,configurable:true});Object.defineProperty(MapillaryObject.prototype,"lastSeenAt",{get:function(){return this._lastSeenAt},enumerable:true,configurable:true});Object.defineProperty(MapillaryObject.prototype,"rects",{get:function(){return this._rects},enumerable:true,configurable:true});Object.defineProperty(MapillaryObject.prototype,"dPackage",{get:function(){return this._dPackage},enumerable:true,configurable:true});Object.defineProperty(MapillaryObject.prototype,"value",{get:function(){return this._value},enumerable:true,configurable:true});return MapillaryObject}();exports.MapillaryObject=MapillaryObject;Object.defineProperty(exports,"__esModule",{value:true});exports.default=MapillaryObject},{}],487:[function(require,module,exports){"use strict";var MapillaryRect=function(){function MapillaryRect(capturedAt,imageKey,rectKey){this._capturedAt=capturedAt;this._imageKey=imageKey;this._rectKey=rectKey}Object.defineProperty(MapillaryRect.prototype,"capturedAt",{get:function(){return this._capturedAt},enumerable:true,configurable:true});Object.defineProperty(MapillaryRect.prototype,"imageKey",{get:function(){return this._imageKey},enumerable:true,configurable:true});Object.defineProperty(MapillaryRect.prototype,"rectKey",{get:function(){return this._rectKey},enumerable:true,configurable:true});return MapillaryRect}();exports.MapillaryRect=MapillaryRect;Object.defineProperty(exports,"__esModule",{value:true});exports.default=MapillaryRect},{}],488:[function(require,module,exports){"use strict";var Pbf=require("pbf");var MeshReader=function(){function MeshReader(){}MeshReader.read=function(buffer){var pbf=new Pbf(buffer);return pbf.readFields(MeshReader._readMeshField,{faces:[],vertices:[]})};MeshReader._readMeshField=function(tag,mesh,pbf){if(tag===1){mesh.vertices.push(pbf.readFloat())}else if(tag===2){mesh.faces.push(pbf.readVarint())}};return MeshReader}();exports.MeshReader=MeshReader},{pbf:186}],489:[function(require,module,exports){(function(Buffer){"use strict";var Observable_1=require("rxjs/Observable");require("rxjs/add/observable/combineLatest");var Graph_1=require("../Graph");var Utils_1=require("../Utils");var Node=function(){function Node(ca,latLon,worthy,sequence,apiNavImIm,hs){this._apiNavImIm=apiNavImIm;this._key=apiNavImIm.key;this._ca=ca;this._latLon=latLon;this._sequence=sequence;this._hs=hs;this._image=null;this._mesh=null;this._edges=null;this.worthy=worthy;this.cached=false;this.lastCacheEvict=0;this.lastUsed=(new Date).getTime();this._loadStatus={loaded:0,total:100}}Object.defineProperty(Node.prototype,"apiNavImIm",{get:function(){return this._apiNavImIm},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"user",{get:function(){return this._apiNavImIm.user},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"capturedAt",{get:function(){return this._apiNavImIm.captured_at},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"key",{get:function(){return this._key},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"ca",{get:function(){return this._ca},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"latLon",{get:function(){return this._latLon},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"sequence",{get:function(){return this._sequence},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"hs",{get:function(){return this._hs},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"image",{get:function(){return this._image},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"mesh",{get:function(){return this._mesh},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"edges",{get:function(){return this._edges},set:function(value){this._edges=value},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"loaded",{get:function(){return this.cached&&this._image!=null},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"merged",{get:function(){return this.apiNavImIm!=null&&this.apiNavImIm.merge_version!=null&&this.apiNavImIm.merge_version>0},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"pano",{get:function(){return this.apiNavImIm.gpano!=null&&this.apiNavImIm.gpano.FullPanoWidthPixels!=null},enumerable:true,configurable:true});Object.defineProperty(Node.prototype,"fullPano",{get:function(){return this.apiNavImIm.gpano!=null&&this.apiNavImIm.gpano.CroppedAreaLeftPixels===0&&this.apiNavImIm.gpano.CroppedAreaTopPixels===0&&this.apiNavImIm.gpano.CroppedAreaImageWidthPixels===this.apiNavImIm.gpano.FullPanoWidthPixels&&this.apiNavImIm.gpano.CroppedAreaImageHeightPixels===this.apiNavImIm.gpano.FullPanoHeightPixels},enumerable:true,configurable:true});Node.prototype.findNextKeyInSequence=function(){if(this.sequence===undefined){return null}return this.sequence.findNextKey(this.key)};Node.prototype.findPrevKeyInSequence=function(){if(this.sequence===undefined){return null}return this.sequence.findPrevKey(this.key)};Node.prototype.cacheAssets=function(){var _this=this;return Observable_1.Observable.combineLatest(this.cacheImage(),this.cacheMesh(),function(imageStatus,meshStatus){_this._loadStatus.loaded=0;_this._loadStatus.total=0;if(meshStatus){_this._mesh=meshStatus.object;_this._loadStatus.loaded+=meshStatus.loaded.loaded;_this._loadStatus.total+=meshStatus.loaded.total}if(imageStatus){_this._image=imageStatus.object;_this._loadStatus.loaded+=imageStatus.loaded.loaded;_this._loadStatus.total+=imageStatus.loaded.total}return _this})};Node.prototype.cacheImage=function(){var imageSize=this.pano?Utils_1.Settings.basePanoramaSize:Utils_1.Settings.baseImageSize;return Graph_1.ImageLoader.load(this.key,imageSize)};Node.prototype.cacheMesh=function(){var _this=this;return Observable_1.Observable.create(function(subscriber){if(!_this.merged){subscriber.next({loaded:{loaded:0,total:0},object:{faces:[],vertices:[]}});subscriber.complete();return}var xmlHTTP=new XMLHttpRequest;xmlHTTP.open("GET",Utils_1.Urls.proto_mesh(_this.key),true);xmlHTTP.responseType="arraybuffer";xmlHTTP.onload=function(pe){var mesh=xmlHTTP.status===200?Graph_1.MeshReader.read(new Buffer(xmlHTTP.response)):{faces:[],vertices:[]};subscriber.next({loaded:{loaded:pe.loaded,total:pe.total},object:mesh});subscriber.complete()};xmlHTTP.onprogress=function(pe){subscriber.next({loaded:{loaded:pe.loaded,total:pe.total},object:null})};xmlHTTP.send(null)})};return Node}();exports.Node=Node;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Node}).call(this,require("buffer").Buffer)},{"../Graph":408,"../Utils":412,buffer:7,"rxjs/Observable":226,"rxjs/add/observable/combineLatest":234}],490:[function(require,module,exports){"use strict";var _=require("underscore");var Sequence=function(){function Sequence(response){this._response=response;this.key=response.key;this.keys=response.keys;this.path=response.path}Sequence.prototype.findNextKey=function(key){var i=_.indexOf(this.keys,key);if(i+1>=this.keys.length||i===-1){return null}else{return this.keys[i+1]}};Sequence.prototype.findPrevKey=function(key){var i=_.indexOf(this.keys,key);if(i===0||i===-1){return null}else{return this.keys[i-1]}};return Sequence}();exports.Sequence=Sequence;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Sequence},{underscore:355}],491:[function(require,module,exports){"use strict";var _=require("underscore");var geohash=require("latlon-geohash");var Subject_1=require("rxjs/Subject");var Observable_1=require("rxjs/Observable");require("rxjs/add/observable/from");require("rxjs/add/observable/fromPromise");require("rxjs/add/operator/distinct");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/merge");require("rxjs/add/operator/publish");require("rxjs/add/operator/publishReplay");var Geo_1=require("../Geo");var TilesService=function(){function TilesService(apiV2){var _this=this;this._updates$=new Subject_1.Subject;this._cacheH$=new Subject_1.Subject;this._cacheNodeH$=new Subject_1.Subject;this._cacheIm$=new Subject_1.Subject;this._cacheNode$=new Subject_1.Subject;this._spatialLib=new Geo_1.Spatial;this._apiV2=apiV2;this._cachedTiles$=this._updates$.scan(function(tilesCache,operation){return operation(tilesCache)},{}).publishReplay(1).refCount();this._imTiles$=this._cacheIm$.distinct().mergeMap(function(im){return Observable_1.Observable.fromPromise(_this._apiV2.nav.im(im))});this._hTiles$=this._cacheH$.distinct().mergeMap(function(h){return Observable_1.Observable.fromPromise(_this._apiV2.nav.h(h))});this._cacheNodeH$.distinct(function(n1,n2){return n1.key===n2.key}).mergeMap(function(node){return Observable_1.Observable.from(node.hs)}).subscribe(this._cacheH$);this._tiles$=this._imTiles$.merge(this._hTiles$).publish();this._tiles$.connect();this._tiles$.map(function(data){return function(tilesCache){if(data!==undefined){_.each(data.hs,function(h){tilesCache[h]=true})}return tilesCache}}).subscribe(this._updates$);this._cacheNode$.mergeMap(function(node){var hs=[];var h=geohash.encode(node.latLon.lat,node.latLon.lon,7);hs.push(h);_.each(geohash.neighbours(h),function(nh){hs.push(nh)});return Observable_1.Observable.from(hs)}).subscribe(this._cacheH$)}Object.defineProperty(TilesService.prototype,"cacheH$",{get:function(){return this._cacheH$},enumerable:true,configurable:true});Object.defineProperty(TilesService.prototype,"cacheNodeH$",{get:function(){return this._cacheNodeH$},enumerable:true,configurable:true});Object.defineProperty(TilesService.prototype,"cacheIm$",{get:function(){return this._cacheIm$},enumerable:true,configurable:true});Object.defineProperty(TilesService.prototype,"cacheNode$",{get:function(){return this._cacheNode$},enumerable:true,configurable:true});Object.defineProperty(TilesService.prototype,"cachedTiles$",{get:function(){return this._cachedTiles$},enumerable:true,configurable:true});Object.defineProperty(TilesService.prototype,"tiles$",{get:function(){return this._tiles$},enumerable:true,configurable:true});return TilesService}();exports.TilesService=TilesService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=TilesService},{"../Geo":407,"latlon-geohash":182,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/from":236,"rxjs/add/observable/fromPromise":238,"rxjs/add/operator/distinct":248,"rxjs/add/operator/map":255,"rxjs/add/operator/merge":256,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/publish":261,"rxjs/add/operator/publishReplay":262,underscore:355}],492:[function(require,module,exports){"use strict";var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/from");require("rxjs/add/operator/distinct");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/publishReplay");var Geo_1=require("../Geo");var Graph_1=require("../Graph");var VectorTilesService=function(){function VectorTilesService(apiV3){var _this=this;this._cacheNode$=new Subject_1.Subject;this._apiV3=apiV3;this._webMercator=new Geo_1.WebMercator;this._mapillaryObjects$=this._cacheNode$.map(function(node){return _this._webMercator.getTile(node.latLon,17)}).distinct(function(t1,t2){return t1.x===t2.x&&t1.y===t2.y&&t1.z===t2.z}).mergeMap(function(tile){return _this._apiV3.model.get(["tile","all",tile.z,tile.x,tile.y,"objects",{from:0,to:100},["key","value","package","l","alt","rects","last_seen_at","first_seen_at"]])}).mergeMap(function(tile){var z=parseInt(Object.keys(tile.json.tile.all)[0],10);var x=parseInt(Object.keys(tile.json.tile.all[z])[0],10);var y=parseInt(Object.keys(tile.json.tile.all[z][x])[0],10);var objects=tile.json.tile.all[z][x][y].objects;var ret=[];for(var k in objects){if(!objects.hasOwnProperty(k)){continue}var object=objects[k];delete object.$__path;if(object.rects&&object.rects.length>1){var mapillaryRects=[];for(var l in object.rects){if(object.rects.hasOwnProperty(l)){var rect=object.rects[l];var mapillaryRect=new Graph_1.MapillaryRect(rect.capturedAt,rect.imageKey,rect.rectKey);mapillaryRects.push(mapillaryRect)}}var mapillaryObject=new Graph_1.MapillaryObject(object.alt,object.first_seen_at,object.l,object.key,object.lastSeenAt,object.rects,object.dPackage,object.value);ret.push(mapillaryObject)}}return Observable_1.Observable.from(ret)}).publishReplay(1).refCount()}Object.defineProperty(VectorTilesService.prototype,"cacheNode$",{get:function(){return this._cacheNode$},enumerable:true,configurable:true});Object.defineProperty(VectorTilesService.prototype,"mapillaryObjects$",{get:function(){return this._mapillaryObjects$},enumerable:true,configurable:true});return VectorTilesService}();exports.VectorTilesService=VectorTilesService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=VectorTilesService},{"../Geo":407,"../Graph":408,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/from":236,"rxjs/add/operator/distinct":248,"rxjs/add/operator/map":255,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/publishReplay":262}],493:[function(require,module,exports){"use strict";var THREE=require("three");var Edge_1=require("../../Edge");var Geo_1=require("../../Geo");var EdgeCalculator=function(){function EdgeCalculator(settings,directions,coefficients){this._spatial=new Geo_1.Spatial;this._geoCoords=new Geo_1.GeoCoords;this._settings=settings!=null?settings:new Edge_1.EdgeCalculatorSettings;this._directions=directions!=null?directions:new Edge_1.EdgeCalculatorDirections;this._coefficients=coefficients!=null?coefficients:new Edge_1.EdgeCalculatorCoefficients}EdgeCalculator.prototype.getPotentialEdges=function(node,nodes,fallbackKeys){if(!node.worthy||!node.merged){return[]}var currentDirection=this._spatial.viewingDirection(node.apiNavImIm.rotation);var currentVerticalDirection=this._spatial.angleToPlane(currentDirection.toArray(),[0,0,1]);var potentialEdges=[];for(var _i=0,nodes_1=nodes;_i<nodes_1.length;_i++){var potential=nodes_1[_i];if(!potential.merged||potential.key===node.key){continue}var enu=this._geoCoords.geodeticToEnu(potential.latLon.lat,potential.latLon.lon,potential.apiNavImIm.calt,node.latLon.lat,node.latLon.lon,node.apiNavImIm.calt);var motion=new THREE.Vector3(enu[0],enu[1],enu[2]);var distance=motion.length();if(distance>this._settings.maxDistance&&fallbackKeys.indexOf(potential.key)<0){continue}var motionChange=this._spatial.angleBetweenVector2(currentDirection.x,currentDirection.y,motion.x,motion.y);var verticalMotion=this._spatial.angleToPlane(motion.toArray(),[0,0,1]);var direction=this._spatial.viewingDirection(potential.apiNavImIm.rotation);var directionChange=this._spatial.angleBetweenVector2(currentDirection.x,currentDirection.y,direction.x,direction.y);var verticalDirection=this._spatial.angleToPlane(direction.toArray(),[0,0,1]);var verticalDirectionChange=verticalDirection-currentVerticalDirection;var rotation=this._spatial.relativeRotationAngle(node.apiNavImIm.rotation,potential.apiNavImIm.rotation);var worldMotionAzimuth=this._spatial.angleBetweenVector2(1,0,motion.x,motion.y);var sameSequence=potential.sequence!=null&&node.sequence!=null&&potential.sequence.key===node.sequence.key;var sameMergeCc=potential.apiNavImIm.merge_cc==null&&node.apiNavImIm.merge_cc==null||potential.apiNavImIm.merge_cc===node.apiNavImIm.merge_cc;var potentialEdge={apiNavImIm:potential.apiNavImIm,directionChange:directionChange,distance:distance,fullPano:potential.fullPano,motionChange:motionChange,rotation:rotation,sameMergeCc:sameMergeCc,sameSequence:sameSequence,verticalDirectionChange:verticalDirectionChange,verticalMotion:verticalMotion,worldMotionAzimuth:worldMotionAzimuth};potentialEdges.push(potentialEdge)}return potentialEdges};EdgeCalculator.prototype.computeSequenceEdges=function(node){if(!node.worthy){return[]}var edges=[];var nextKey=node.findNextKeyInSequence();if(nextKey!=null){edges.push({data:{direction:Edge_1.EdgeDirection.Next,worldMotionAzimuth:Number.NaN},from:node.apiNavImIm.key,to:nextKey})}var prevKey=node.findPrevKeyInSequence();if(prevKey!=null){edges.push({data:{direction:Edge_1.EdgeDirection.Prev,worldMotionAzimuth:Number.NaN},from:node.apiNavImIm.key,to:prevKey})}return edges};EdgeCalculator.prototype.computeStepEdges=function(node,potentialEdges,prevKey,nextKey){var edges=[];if(node.fullPano){return edges}for(var k in this._directions.steps){if(!this._directions.steps.hasOwnProperty(k)){continue}var step=this._directions.steps[k];var lowestScore=Number.MAX_VALUE;var edge=null;var fallback=null;for(var _i=0,potentialEdges_1=potentialEdges;_i<potentialEdges_1.length;_i++){var potential=potentialEdges_1[_i];if(potential.fullPano){continue}if(Math.abs(potential.directionChange)>this._settings.stepMaxDirectionChange){continue}var motionDifference=this._spatial.angleDifference(step.motionChange,potential.motionChange);var directionMotionDifference=this._spatial.angleDifference(potential.directionChange,motionDifference);var drift=Math.max(Math.abs(motionDifference),Math.abs(directionMotionDifference));if(Math.abs(drift)>this._settings.stepMaxDrift){continue}var potentialKey=potential.apiNavImIm.key;if(step.useFallback&&(potentialKey===prevKey||potentialKey===nextKey)){fallback=potential}if(potential.distance>this._settings.stepMaxDistance){continue}motionDifference=Math.sqrt(motionDifference*motionDifference+potential.verticalMotion*potential.verticalMotion);var score=this._coefficients.stepPreferredDistance*Math.abs(potential.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*motionDifference/this._settings.stepMaxDrift+this._coefficients.stepRotation*potential.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(potential.sameSequence?0:1)+this._coefficients.stepMergeCcPenalty*(potential.sameMergeCc?0:1);if(score<lowestScore){lowestScore=score;edge=potential}}edge=edge==null?fallback:edge;if(edge!=null){edges.push({data:{direction:step.direction,worldMotionAzimuth:edge.worldMotionAzimuth},from:node.key,to:edge.apiNavImIm.key})}}return edges};EdgeCalculator.prototype.computeTurnEdges=function(node,potentialEdges){var edges=[];if(node.fullPano){return edges}for(var k in this._directions.turns){if(!this._directions.turns.hasOwnProperty(k)){continue}var turn=this._directions.turns[k];var lowestScore=Number.MAX_VALUE;var edge=null;for(var _i=0,potentialEdges_2=potentialEdges;_i<potentialEdges_2.length;_i++){var potential=potentialEdges_2[_i];if(potential.fullPano){continue}if(potential.distance>this._settings.turnMaxDistance){continue}var rig=turn.direction!==Edge_1.EdgeDirection.TurnU&&potential.distance<this._settings.turnMaxRigDistance&&Math.abs(potential.directionChange)>this._settings.turnMinRigDirectionChange;var directionDifference=this._spatial.angleDifference(turn.directionChange,potential.directionChange);var score=void 0;if(rig&&potential.directionChange*turn.directionChange>0&&Math.abs(potential.directionChange)<Math.abs(turn.directionChange)){score=-Math.PI/2+Math.abs(potential.directionChange)}else{if(Math.abs(directionDifference)>this._settings.turnMaxDirectionChange){continue}var motionDifference=turn.motionChange?this._spatial.angleDifference(turn.motionChange,potential.motionChange):0;motionDifference=Math.sqrt(motionDifference*motionDifference+potential.verticalMotion*potential.verticalMotion);score=this._coefficients.turnDistance*potential.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*motionDifference/Math.PI+this._coefficients.turnSequencePenalty*(potential.sameSequence?0:1)+this._coefficients.turnMergeCcPenalty*(potential.sameMergeCc?0:1)}if(score<lowestScore){lowestScore=score;edge=potential}}if(edge!=null){edges.push({data:{direction:turn.direction,worldMotionAzimuth:edge.worldMotionAzimuth},from:node.key,to:edge.apiNavImIm.key})}}return edges};EdgeCalculator.prototype.computePerspectiveToPanoEdges=function(node,potentialEdges){if(node.fullPano){return[]}var lowestScore=Number.MAX_VALUE;var edge=null;for(var _i=0,potentialEdges_3=potentialEdges;_i<potentialEdges_3.length;_i++){var potential=potentialEdges_3[_i];if(!potential.fullPano){continue}var score=this._coefficients.panoPreferredDistance*Math.abs(potential.distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(potential.motionChange)/Math.PI+this._coefficients.panoMergeCcPenalty*(potential.sameMergeCc?0:1);if(score<lowestScore){lowestScore=score;edge=potential}}if(edge==null){return[]}return[{data:{direction:Edge_1.EdgeDirection.Pano,worldMotionAzimuth:edge.worldMotionAzimuth},from:node.key,to:edge.apiNavImIm.key}]};EdgeCalculator.prototype.computeRotationEdges=function(node,potentialEdges){var edges=[];if(node.fullPano){return edges}for(var k in this._directions.rotations){if(!this._directions.rotations.hasOwnProperty(k)){continue}var rotation=this._directions.rotations[k];var lowestScore=Number.MAX_VALUE;var edge=null;for(var _i=0,potentialEdges_4=potentialEdges;_i<potentialEdges_4.length;_i++){var potential=potentialEdges_4[_i];if(potential.fullPano){continue}if(potential.distance>this._settings.rotationMaxDistance||potential.directionChange*rotation.directionChangeSign<0||Math.abs(potential.directionChange)>this._settings.rotationMaxDirectionChange||Math.abs(potential.verticalDirectionChange)>this._settings.rotationMaxVerticalDirectionChange){continue}var score=Math.abs(potential.directionChange);if(score<lowestScore){lowestScore=score;edge=potential}}if(edge!=null){edges.push({data:{direction:rotation.direction,worldMotionAzimuth:edge.worldMotionAzimuth},from:node.key,to:edge.apiNavImIm.key})}}return edges};EdgeCalculator.prototype.computePanoEdges=function(node,potentialEdges){if(!node.fullPano){return[]}var panoEdges=[];var potentialPanos=[];var potentialSteps=[];for(var _i=0,potentialEdges_5=potentialEdges;_i<potentialEdges_5.length;_i++){var potential=potentialEdges_5[_i];if(potential.distance>this._settings.panoMaxDistance){continue}if(potential.fullPano){if(potential.distance<this._settings.panoMinDistance){continue}potentialPanos.push(potential)}else{for(var k in this._directions.panos){if(!this._directions.panos.hasOwnProperty(k)){continue}var pano=this._directions.panos[k];var turn=this._spatial.angleDifference(potential.directionChange,potential.motionChange);var turnChange=this._spatial.angleDifference(pano.directionChange,turn);if(Math.abs(turnChange)>this._settings.panoMaxStepTurnChange){continue}potentialSteps.push([pano.direction,potential]);break}}}var maxRotationDifference=Math.PI/this._settings.panoMaxItems;var occupiedAngles=[];var stepAngles=[];for(var index=0;index<this._settings.panoMaxItems;index++){var rotation=index/this._settings.panoMaxItems*2*Math.PI;var lowestScore=Number.MAX_VALUE;var edge=null;for(var _a=0,potentialPanos_1=potentialPanos;_a<potentialPanos_1.length;_a++){var potential=potentialPanos_1[_a];var motionDifference=this._spatial.angleDifference(rotation,potential.motionChange);if(Math.abs(motionDifference)>maxRotationDifference){continue}var occupiedDifference=Number.MAX_VALUE;for(var _b=0,occupiedAngles_1=occupiedAngles;_b<occupiedAngles_1.length;_b++){var occupiedAngle=occupiedAngles_1[_b];var difference=Math.abs(this._spatial.angleDifference(occupiedAngle,potential.motionChange));if(difference<occupiedDifference){occupiedDifference=difference}}if(occupiedDifference<=maxRotationDifference){continue}var score=this._coefficients.panoPreferredDistance*Math.abs(potential.distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(motionDifference)/maxRotationDifference+this._coefficients.panoSequencePenalty*(potential.sameSequence?0:1)+this._coefficients.panoMergeCcPenalty*(potential.sameMergeCc?0:1);if(score<lowestScore){lowestScore=score;edge=potential}}if(edge!=null){occupiedAngles.push(edge.motionChange);panoEdges.push({data:{direction:Edge_1.EdgeDirection.Pano,worldMotionAzimuth:edge.worldMotionAzimuth},from:node.key,to:edge.apiNavImIm.key})}else{stepAngles.push(rotation)}}var occupiedStepAngles={};occupiedStepAngles[Edge_1.EdgeDirection.Pano]=occupiedAngles;occupiedStepAngles[Edge_1.EdgeDirection.StepForward]=[];occupiedStepAngles[Edge_1.EdgeDirection.StepLeft]=[];occupiedStepAngles[Edge_1.EdgeDirection.StepBackward]=[];occupiedStepAngles[Edge_1.EdgeDirection.StepRight]=[];for(var _c=0,stepAngles_1=stepAngles;_c<stepAngles_1.length;_c++){var stepAngle=stepAngles_1[_c];var occupations=[];for(var k in this._directions.panos){if(!this._directions.panos.hasOwnProperty(k)){continue}var pano=this._directions.panos[k];var allOccupiedAngles=occupiedStepAngles[Edge_1.EdgeDirection.Pano].concat(occupiedStepAngles[pano.direction]).concat(occupiedStepAngles[pano.prev]).concat(occupiedStepAngles[pano.next]);var lowestScore=Number.MAX_VALUE;var edge=null;for(var _d=0,potentialSteps_1=potentialSteps;_d<potentialSteps_1.length;_d++){var potential=potentialSteps_1[_d];if(potential[0]!==pano.direction){continue}var motionChange=this._spatial.angleDifference(stepAngle,potential[1].motionChange);if(Math.abs(motionChange)>maxRotationDifference){continue}var minOccupiedDifference=Number.MAX_VALUE;for(var _e=0,allOccupiedAngles_1=allOccupiedAngles;_e<allOccupiedAngles_1.length;_e++){var occupiedAngle=allOccupiedAngles_1[_e];var occupiedDifference=Math.abs(this._spatial.angleDifference(occupiedAngle,potential[1].motionChange));if(occupiedDifference<minOccupiedDifference){minOccupiedDifference=occupiedDifference}}if(minOccupiedDifference<=maxRotationDifference){continue}var score=this._coefficients.panoPreferredDistance*Math.abs(potential[1].distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(motionChange)/maxRotationDifference+this._coefficients.panoMergeCcPenalty*(potential[1].sameMergeCc?0:1);if(score<lowestScore){lowestScore=score;edge=potential}}if(edge!=null){occupations.push(edge);
panoEdges.push({data:{direction:edge[0],worldMotionAzimuth:edge[1].worldMotionAzimuth},from:node.key,to:edge[1].apiNavImIm.key})}}for(var _f=0,occupations_1=occupations;_f<occupations_1.length;_f++){var occupation=occupations_1[_f];occupiedStepAngles[occupation[0]].push(occupation[1].motionChange)}}return panoEdges};return EdgeCalculator}();exports.EdgeCalculator=EdgeCalculator;Object.defineProperty(exports,"__esModule",{value:true});exports.default=EdgeCalculator},{"../../Edge":405,"../../Geo":407,three:354}],494:[function(require,module,exports){"use strict";var EdgeCalculatorCoefficients=function(){function EdgeCalculatorCoefficients(){this.stepPreferredDistance=4;this.stepMotion=3;this.stepRotation=4;this.stepSequencePenalty=2;this.stepMergeCcPenalty=6;this.turnDistance=4;this.turnMotion=2;this.turnSequencePenalty=1;this.turnMergeCcPenalty=4;this.panoPreferredDistance=2;this.panoMotion=2;this.panoSequencePenalty=1;this.panoMergeCcPenalty=4}return EdgeCalculatorCoefficients}();exports.EdgeCalculatorCoefficients=EdgeCalculatorCoefficients;Object.defineProperty(exports,"__esModule",{value:true});exports.default=EdgeCalculatorCoefficients},{}],495:[function(require,module,exports){"use strict";var Edge_1=require("../../Edge");var EdgeCalculatorDirections=function(){function EdgeCalculatorDirections(){this.steps={};this.turns={};this.panos={};this.rotations={};this.steps[Edge_1.EdgeDirection.StepForward]={direction:Edge_1.EdgeDirection.StepForward,motionChange:0,useFallback:true};this.steps[Edge_1.EdgeDirection.StepBackward]={direction:Edge_1.EdgeDirection.StepBackward,motionChange:Math.PI,useFallback:true};this.steps[Edge_1.EdgeDirection.StepLeft]={direction:Edge_1.EdgeDirection.StepLeft,motionChange:Math.PI/2,useFallback:false};this.steps[Edge_1.EdgeDirection.StepRight]={direction:Edge_1.EdgeDirection.StepRight,motionChange:-Math.PI/2,useFallback:false};this.turns[Edge_1.EdgeDirection.TurnLeft]={direction:Edge_1.EdgeDirection.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4};this.turns[Edge_1.EdgeDirection.TurnRight]={direction:Edge_1.EdgeDirection.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4};this.turns[Edge_1.EdgeDirection.TurnU]={direction:Edge_1.EdgeDirection.TurnU,directionChange:Math.PI,motionChange:null};this.panos[Edge_1.EdgeDirection.StepForward]={direction:Edge_1.EdgeDirection.StepForward,directionChange:0,next:Edge_1.EdgeDirection.StepLeft,prev:Edge_1.EdgeDirection.StepRight};this.panos[Edge_1.EdgeDirection.StepBackward]={direction:Edge_1.EdgeDirection.StepBackward,directionChange:Math.PI,next:Edge_1.EdgeDirection.StepRight,prev:Edge_1.EdgeDirection.StepLeft};this.panos[Edge_1.EdgeDirection.StepLeft]={direction:Edge_1.EdgeDirection.StepLeft,directionChange:Math.PI/2,next:Edge_1.EdgeDirection.StepBackward,prev:Edge_1.EdgeDirection.StepForward};this.panos[Edge_1.EdgeDirection.StepRight]={direction:Edge_1.EdgeDirection.StepRight,directionChange:-Math.PI/2,next:Edge_1.EdgeDirection.StepForward,prev:Edge_1.EdgeDirection.StepBackward};this.rotations[Edge_1.EdgeDirection.RotateLeft]={direction:Edge_1.EdgeDirection.RotateLeft,directionChangeSign:1};this.rotations[Edge_1.EdgeDirection.RotateRight]={direction:Edge_1.EdgeDirection.RotateRight,directionChangeSign:-1}}return EdgeCalculatorDirections}();exports.EdgeCalculatorDirections=EdgeCalculatorDirections},{"../../Edge":405}],496:[function(require,module,exports){"use strict";var EdgeCalculatorSettings=function(){function EdgeCalculatorSettings(){this.stepMaxDistance=20;this.stepMaxDirectionChange=Math.PI/6;this.stepMaxDrift=Math.PI/6;this.stepPreferredDistance=4;this.turnMaxDistance=15;this.turnMaxDirectionChange=2*Math.PI/9;this.turnMaxRigDistance=.65;this.turnMinRigDirectionChange=Math.PI/6;this.panoMinDistance=.1;this.panoMaxDistance=20;this.panoPreferredDistance=5;this.panoMaxItems=4;this.panoMaxStepTurnChange=Math.PI/8;this.rotationMaxDistance=this.turnMaxRigDistance;this.rotationMaxDirectionChange=Math.PI/6;this.rotationMaxVerticalDirectionChange=Math.PI/8}Object.defineProperty(EdgeCalculatorSettings.prototype,"maxDistance",{get:function(){return Math.max(this.panoMaxDistance,Math.max(this.stepMaxDistance,this.turnMaxDistance))},enumerable:true,configurable:true});return EdgeCalculatorSettings}();exports.EdgeCalculatorSettings=EdgeCalculatorSettings;Object.defineProperty(exports,"__esModule",{value:true});exports.default=EdgeCalculatorSettings},{}],497:[function(require,module,exports){"use strict";(function(EdgeDirection){EdgeDirection[EdgeDirection["Next"]=0]="Next";EdgeDirection[EdgeDirection["Prev"]=1]="Prev";EdgeDirection[EdgeDirection["StepLeft"]=2]="StepLeft";EdgeDirection[EdgeDirection["StepRight"]=3]="StepRight";EdgeDirection[EdgeDirection["StepForward"]=4]="StepForward";EdgeDirection[EdgeDirection["StepBackward"]=5]="StepBackward";EdgeDirection[EdgeDirection["TurnLeft"]=6]="TurnLeft";EdgeDirection[EdgeDirection["TurnRight"]=7]="TurnRight";EdgeDirection[EdgeDirection["TurnU"]=8]="TurnU";EdgeDirection[EdgeDirection["RotateLeft"]=9]="RotateLeft";EdgeDirection[EdgeDirection["RotateRight"]=10]="RotateRight";EdgeDirection[EdgeDirection["Pano"]=11]="Pano"})(exports.EdgeDirection||(exports.EdgeDirection={}));var EdgeDirection=exports.EdgeDirection},{}],498:[function(require,module,exports){"use strict";var _=require("underscore");var vd=require("virtual-dom");var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/combineLatest");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/pluck");require("rxjs/add/operator/scan");var Render_1=require("../Render");var DOMRenderer=function(){function DOMRenderer(element,renderService,currentFrame$){this._adaptiveOperation$=new Subject_1.Subject;this._render$=new Subject_1.Subject;this._renderAdaptive$=new Subject_1.Subject;this._renderService=renderService;this._currentFrame$=currentFrame$;var rootNode=vd.create(vd.h("div.domRenderer",[]));element.appendChild(rootNode);this._offset$=this._adaptiveOperation$.scan(function(adaptive,operation){return operation(adaptive)},{elementHeight:element.offsetHeight,elementWidth:element.offsetWidth,imageAspect:0,renderMode:Render_1.RenderMode.Letterbox}).filter(function(adaptive){return adaptive.imageAspect>0&&adaptive.elementWidth>0&&adaptive.elementHeight>0}).map(function(adaptive){var elementAspect=adaptive.elementWidth/adaptive.elementHeight;var ratio=adaptive.imageAspect/elementAspect;var verticalOffset=0;var horizontalOffset=0;if(adaptive.renderMode===Render_1.RenderMode.Letterbox){if(adaptive.imageAspect>elementAspect){verticalOffset=adaptive.elementHeight*(1-1/ratio)/2}else{horizontalOffset=adaptive.elementWidth*(1-ratio)/2}}else{if(adaptive.imageAspect>elementAspect){horizontalOffset=-adaptive.elementWidth*(ratio-1)/2}else{verticalOffset=-adaptive.elementHeight*(1/ratio-1)/2}}return{bottom:verticalOffset,left:horizontalOffset,right:horizontalOffset,top:verticalOffset}});this._currentFrame$.filter(function(frame){return frame.state.currentNode!=null}).distinctUntilChanged(function(k1,k2){return k1===k2},function(frame){return frame.state.currentNode.key}).map(function(frame){return frame.state.currentTransform.basicAspect}).map(function(aspect){return function(adaptive){adaptive.imageAspect=aspect;return adaptive}}).subscribe(this._adaptiveOperation$);this._renderAdaptive$.scan(function(vNodeHashes,vNodeHash){if(vNodeHash.vnode==null){delete vNodeHashes[vNodeHash.name]}else{vNodeHashes[vNodeHash.name]=vNodeHash.vnode}return vNodeHashes},{}).combineLatest(this._offset$).map(function(vo){var vNodes=_.values(vo[0]);var offset=vo[1];var properties={style:{bottom:offset.bottom+"px",left:offset.left+"px",position:"absolute",right:offset.right+"px",top:offset.top+"px",zIndex:-1}};return{name:"adaptiveDomRenderer",vnode:vd.h("div.adaptiveDomRenderer",properties,vNodes)}}).subscribe(this._render$);this._vNode$=this._render$.scan(function(vNodeHashes,vNodeHash){if(vNodeHash.vnode==null){delete vNodeHashes[vNodeHash.name]}else{vNodeHashes[vNodeHash.name]=vNodeHash.vnode}return vNodeHashes},{}).map(function(vNodeHashes){var vNodes=_.values(vNodeHashes);return vd.h("div.domRenderer",vNodes)});this._vPatch$=this._vNode$.scan(function(nodePatch,vNode){nodePatch.vpatch=vd.diff(nodePatch.vnode,vNode);nodePatch.vnode=vNode;return nodePatch},{vnode:vd.h("div.domRenderer",[]),vpatch:null}).pluck("vpatch");this._element$=this._vPatch$.scan(function(oldElement,vPatch){return vd.patch(oldElement,vPatch)},rootNode).publishReplay(1).refCount();this._element$.subscribe();this._renderService.size$.map(function(size){return function(adaptive){adaptive.elementWidth=size.width;adaptive.elementHeight=size.height;return adaptive}}).subscribe(this._adaptiveOperation$);this._renderService.renderMode$.map(function(renderMode){return function(adaptive){adaptive.renderMode=renderMode;return adaptive}}).subscribe(this._adaptiveOperation$)}Object.defineProperty(DOMRenderer.prototype,"element$",{get:function(){return this._element$},enumerable:true,configurable:true});Object.defineProperty(DOMRenderer.prototype,"render$",{get:function(){return this._render$},enumerable:true,configurable:true});Object.defineProperty(DOMRenderer.prototype,"renderAdaptive$",{get:function(){return this._renderAdaptive$},enumerable:true,configurable:true});DOMRenderer.prototype.clear=function(name){this._renderAdaptive$.next({name:name,vnode:null});this._render$.next({name:name,vnode:null})};return DOMRenderer}();exports.DOMRenderer=DOMRenderer;Object.defineProperty(exports,"__esModule",{value:true});exports.default=DOMRenderer},{"../Render":410,"rxjs/Subject":230,"rxjs/add/operator/combineLatest":244,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/pluck":260,"rxjs/add/operator/scan":263,underscore:355,"virtual-dom":360}],499:[function(require,module,exports){"use strict";(function(GLRenderStage){GLRenderStage[GLRenderStage["Background"]=0]="Background";GLRenderStage[GLRenderStage["Foreground"]=1]="Foreground"})(exports.GLRenderStage||(exports.GLRenderStage={}));var GLRenderStage=exports.GLRenderStage;Object.defineProperty(exports,"__esModule",{value:true});exports.default=GLRenderStage},{}],500:[function(require,module,exports){"use strict";var THREE=require("three");var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/combineLatest");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/filter");require("rxjs/add/operator/first");require("rxjs/add/operator/map");require("rxjs/add/operator/merge");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/scan");require("rxjs/add/operator/share");require("rxjs/add/operator/startWith");var Render_1=require("../Render");var GLRenderer=function(){function GLRenderer(renderService){var _this=this;this._renderFrame$=new Subject_1.Subject;this._renderCameraOperation$=new Subject_1.Subject;this._render$=new Subject_1.Subject;this._clear$=new Subject_1.Subject;this._renderOperation$=new Subject_1.Subject;this._rendererOperation$=new Subject_1.Subject;this._eraserOperation$=new Subject_1.Subject;this._renderService=renderService;this._renderer$=this._rendererOperation$.scan(function(renderer,operation){return operation(renderer)},{needsRender:false,renderer:null});this._renderCollection$=this._renderOperation$.scan(function(hashes,operation){return operation(hashes)},{}).share();this._renderCamera$=this._renderCameraOperation$.scan(function(rc,operation){return operation(rc)},{frameId:-1,needsRender:false,perspective:null});this._eraser$=this._eraserOperation$.startWith(function(eraser){return eraser}).scan(function(eraser,operation){return operation(eraser)},{needsRender:false});Observable_1.Observable.combineLatest([this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$],function(renderer,hashes,rc,eraser){var renders=Object.keys(hashes).map(function(key){return hashes[key]});return{camera:rc,eraser:eraser,renderer:renderer,renders:renders}}).filter(function(co){var needsRender=co.renderer.needsRender||co.camera.needsRender||co.eraser.needsRender;var frameId=co.camera.frameId;for(var _i=0,_a=co.renders;_i<_a.length;_i++){var render=_a[_i];if(render.frameId!==frameId){return false}needsRender=needsRender||render.needsRender}return needsRender}).distinctUntilChanged(function(n1,n2){return n1===n2},function(co){return co.eraser.needsRender?-1:co.camera.frameId}).subscribe(function(co){co.renderer.needsRender=false;co.camera.needsRender=false;co.eraser.needsRender=false;var perspectiveCamera=co.camera.perspective;var backgroundRenders=[];var foregroundRenders=[];for(var _i=0,_a=co.renders;_i<_a.length;_i++){var render=_a[_i];if(render.stage===Render_1.GLRenderStage.Background){backgroundRenders.push(render.render)}else if(render.stage===Render_1.GLRenderStage.Foreground){foregroundRenders.push(render.render)}}var renderer=co.renderer.renderer;renderer.autoClear=false;renderer.clear();for(var _b=0,backgroundRenders_1=backgroundRenders;_b<backgroundRenders_1.length;_b++){var render=backgroundRenders_1[_b];render(perspectiveCamera,renderer)}renderer.clearDepth();for(var _c=0,foregroundRenders_1=foregroundRenders;_c<foregroundRenders_1.length;_c++){var render=foregroundRenders_1[_c];render(perspectiveCamera,renderer)}});this._renderFrame$.map(function(rc){return function(irc){irc.frameId=rc.frameId;irc.perspective=rc.perspective;if(rc.changed===true){irc.needsRender=true}return irc}}).subscribe(this._renderCameraOperation$);this._renderFrameSubscribe();var renderHash$=this._render$.map(function(hash){return function(hashes){hashes[hash.name]=hash.render;return hashes}});var clearHash$=this._clear$.map(function(name){return function(hashes){delete hashes[name];return hashes}});Observable_1.Observable.merge(renderHash$,clearHash$).subscribe(this._renderOperation$);var createRenderer$=this._render$.first().map(function(hash){return function(renderer){var webGLRenderer=new THREE.WebGLRenderer;var element=renderService.element;webGLRenderer.setSize(element.offsetWidth,element.offsetHeight);webGLRenderer.setClearColor(new THREE.Color(2105376),1);webGLRenderer.sortObjects=false;webGLRenderer.domElement.style.width="100%";webGLRenderer.domElement.style.height="100%";element.appendChild(webGLRenderer.domElement);renderer.needsRender=true;renderer.renderer=webGLRenderer;return renderer}});var resizeRenderer$=this._renderService.size$.map(function(size){return function(renderer){if(renderer.renderer==null){return renderer}renderer.renderer.setSize(size.width,size.height);renderer.needsRender=true;return renderer}});var clearRenderer$=this._clear$.map(function(name){return function(renderer){if(renderer.renderer==null){return renderer}renderer.needsRender=true;return renderer}});Observable_1.Observable.merge(createRenderer$,resizeRenderer$,clearRenderer$).subscribe(this._rendererOperation$);var renderCollectionEmpty$=this._renderCollection$.filter(function(hashes){return Object.keys(hashes).length===0}).share();renderCollectionEmpty$.subscribe(function(hashes){if(_this._renderFrameSubscription==null){return}_this._renderFrameSubscription.unsubscribe();_this._renderFrameSubscription=null;_this._renderFrameSubscribe()});renderCollectionEmpty$.map(function(hashes){return function(eraser){eraser.needsRender=true;return eraser}}).subscribe(this._eraserOperation$)}Object.defineProperty(GLRenderer.prototype,"render$",{get:function(){return this._render$},enumerable:true,configurable:true});GLRenderer.prototype.clear=function(name){this._clear$.next(name)};GLRenderer.prototype._renderFrameSubscribe=function(){var _this=this;this._render$.first().map(function(renderHash){return function(irc){irc.needsRender=true;return irc}}).subscribe(function(operation){_this._renderCameraOperation$.next(operation)});this._renderFrameSubscription=this._render$.first().mergeMap(function(hash){return _this._renderService.renderCameraFrame$}).subscribe(this._renderFrame$)};return GLRenderer}();exports.GLRenderer=GLRenderer;Object.defineProperty(exports,"__esModule",{value:true});exports.default=GLRenderer},{"../Render":410,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/combineLatest":234,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/filter":252,"rxjs/add/operator/first":254,"rxjs/add/operator/map":255,"rxjs/add/operator/merge":256,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/scan":263,"rxjs/add/operator/share":264,"rxjs/add/operator/startWith":268,three:354}],501:[function(require,module,exports){"use strict";var THREE=require("three");var Geo_1=require("../Geo");var Render_1=require("../Render");var RenderCamera=function(){function RenderCamera(perspectiveCameraAspect,renderMode){this.alpha=-1;this.zoom=0;this._frameId=-1;this._changed=false;this._changedForFrame=-1;this.currentAspect=1;this.currentPano=false;this.previousAspect=1;this.previousPano=false;this.renderMode=renderMode;this._camera=new Geo_1.Camera;this._perspective=new THREE.PerspectiveCamera(50,perspectiveCameraAspect,.4,1e4)}Object.defineProperty(RenderCamera.prototype,"perspective",{get:function(){return this._perspective},enumerable:true,configurable:true});Object.defineProperty(RenderCamera.prototype,"camera",{get:function(){return this._camera},enumerable:true,configurable:true});Object.defineProperty(RenderCamera.prototype,"changed",{get:function(){return this.frameId===this._changedForFrame},enumerable:true,configurable:true});Object.defineProperty(RenderCamera.prototype,"frameId",{get:function(){return this._frameId},set:function(value){this._frameId=value;if(this._changed){this._changed=false;this._changedForFrame=value}},enumerable:true,configurable:true});RenderCamera.prototype.updateProjection=function(){var currentAspect=this._getAspect(this.currentAspect,this.currentPano,this.perspective.aspect);var previousAspect=this._getAspect(this.previousAspect,this.previousPano,this.perspective.aspect);var aspect=(1-this.alpha)*previousAspect+this.alpha*currentAspect;var verticalFov=this._getVerticalFov(aspect,this._camera.focal,this.zoom);this._perspective.fov=verticalFov;this._perspective.updateProjectionMatrix();this._changed=true};RenderCamera.prototype.updatePerspective=function(camera){this._perspective.up.copy(camera.up);this._perspective.position.copy(camera.position);this._perspective.lookAt(camera.lookat);this._changed=true};RenderCamera.prototype._getVerticalFov=function(aspect,focal,zoom){return 2*Math.atan(.5/(Math.pow(2,zoom)*aspect*focal))*180/Math.PI};RenderCamera.prototype._getAspect=function(nodeAspect,pano,perspectiveCameraAspect){if(pano){return 1}var coeff=Math.max(1,1/nodeAspect);var usePerspective=this.renderMode===Render_1.RenderMode.Letterbox?nodeAspect>perspectiveCameraAspect:nodeAspect<perspectiveCameraAspect;var aspect=usePerspective?coeff*perspectiveCameraAspect:coeff*nodeAspect;return aspect};return RenderCamera}();exports.RenderCamera=RenderCamera;Object.defineProperty(exports,"__esModule",{value:true});exports.default=RenderCamera},{"../Geo":407,"../Render":410,three:354}],502:[function(require,module,exports){"use strict";(function(RenderMode){RenderMode[RenderMode["Letterbox"]=0]="Letterbox";RenderMode[RenderMode["Fill"]=1]="Fill"})(exports.RenderMode||(exports.RenderMode={}));var RenderMode=exports.RenderMode;Object.defineProperty(exports,"__esModule",{value:true});exports.default=RenderMode},{}],503:[function(require,module,exports){"use strict";var Subject_1=require("rxjs/Subject");var BehaviorSubject_1=require("rxjs/BehaviorSubject");require("rxjs/add/observable/combineLatest");require("rxjs/add/operator/do");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/skip");require("rxjs/add/operator/startWith");require("rxjs/add/operator/withLatestFrom");var Render_1=require("../Render");var RenderService=function(){function RenderService(element,currentFrame$,renderMode){var _this=this;this._element=element;this._currentFrame$=currentFrame$;renderMode=renderMode!=null?renderMode:Render_1.RenderMode.Letterbox;this._resize$=new Subject_1.Subject;this._renderCameraOperation$=new Subject_1.Subject;this._size$=new BehaviorSubject_1.BehaviorSubject({height:this._element.offsetHeight,width:this._element.offsetWidth});this._resize$.map(function(){return{height:_this._element.offsetHeight,width:_this._element.offsetWidth}}).subscribe(this._size$);this._renderMode$=new BehaviorSubject_1.BehaviorSubject(renderMode);this._renderCameraHolder$=this._renderCameraOperation$.startWith(function(rc){return rc}).scan(function(rc,operation){return operation(rc)},new Render_1.RenderCamera(this._element.offsetWidth/this._element.offsetHeight,renderMode)).publishReplay(1).refCount();this._renderCameraFrame$=this._currentFrame$.withLatestFrom(this._renderCameraHolder$,function(frame,renderCamera){return[frame,renderCamera]}).do(function(args){var frame=args[0];var rc=args[1];var camera=frame.state.camera;if(rc.alpha!==frame.state.alpha||rc.zoom!==frame.state.zoom||rc.camera.diff(camera)>1e-5){var currentTransform=frame.state.currentTransform;var previousTransform=frame.state.previousTransform!=null?frame.state.previousTransform:frame.state.currentTransform;var previousNode=frame.state.previousNode!=null?frame.state.previousNode:frame.state.currentNode;rc.currentAspect=currentTransform.basicAspect;rc.currentPano=frame.state.currentNode.pano;rc.previousAspect=previousTransform.basicAspect;rc.previousPano=previousNode.pano;rc.alpha=frame.state.alpha;rc.zoom=frame.state.zoom;rc.camera.copy(camera);rc.updatePerspective(camera);rc.updateProjection()}rc.frameId=frame.id}).map(function(args){return args[1]}).publishReplay(1).refCount();this._renderCamera$=this._renderCameraFrame$.filter(function(rc){return rc.changed}).publishReplay(1).refCount();this._size$.skip(1).map(function(size){return function(rc){rc.perspective.aspect=size.width/size.height;rc.updateProjection();return rc}}).subscribe(this._renderCameraOperation$);this._renderMode$.skip(1).map(function(rm){return function(rc){rc.renderMode=rm;rc.updateProjection();return rc}}).subscribe(this._renderCameraOperation$);this._renderCameraHolder$.subscribe();this._size$.subscribe();this._renderMode$.subscribe()}Object.defineProperty(RenderService.prototype,"element",{get:function(){return this._element},enumerable:true,configurable:true});Object.defineProperty(RenderService.prototype,"resize$",{get:function(){return this._resize$},enumerable:true,configurable:true});Object.defineProperty(RenderService.prototype,"size$",{get:function(){return this._size$},enumerable:true,configurable:true});Object.defineProperty(RenderService.prototype,"renderMode$",{get:function(){return this._renderMode$},enumerable:true,configurable:true});Object.defineProperty(RenderService.prototype,"renderCameraFrame$",{get:function(){return this._renderCameraFrame$},enumerable:true,configurable:true});Object.defineProperty(RenderService.prototype,"renderCamera$",{get:function(){return this._renderCamera$},enumerable:true,configurable:true});return RenderService}();exports.RenderService=RenderService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=RenderService},{"../Render":410,"rxjs/BehaviorSubject":223,"rxjs/Subject":230,"rxjs/add/observable/combineLatest":234,"rxjs/add/operator/do":250,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/skip":265,"rxjs/add/operator/startWith":268,"rxjs/add/operator/withLatestFrom":272}],504:[function(require,module,exports){"use strict";var FrameGenerator=function(){function FrameGenerator(){if(window.requestAnimationFrame){this._requestAnimationFrame=window.requestAnimationFrame;this._cancelAnimationFrame=window.cancelAnimationFrame}else if(window.mozRequestAnimationFrame){this._requestAnimationFrame=window.mozRequestAnimationFrame;this._cancelAnimationFrame=window.mozCancelAnimationFrame}else if(window.webkitRequestAnimationFrame){this._requestAnimationFrame=window.webkitRequestAnimationFrame;this._cancelAnimationFrame=window.webkitCancelAnimationFrame}else if(window.msRequestAnimationFrame){this._requestAnimationFrame=window.msRequestAnimationFrame;this._cancelAnimationFrame=window.msCancelRequestAnimationFrame}else if(window.oRequestAnimationFrame){this._requestAnimationFrame=window.oRequestAnimationFrame;this._cancelAnimationFrame=window.oCancelAnimationFrame}else{this._requestAnimationFrame=function(callback){return window.setTimeout(callback,1e3/60)};this._cancelAnimationFrame=window.clearTimeout}}FrameGenerator.prototype.requestAnimationFrame=function(callback){return this._requestAnimationFrame.call(window,callback)};FrameGenerator.prototype.cancelAnimationFrame=function(id){this._cancelAnimationFrame.call(window,id)};return FrameGenerator}();exports.FrameGenerator=FrameGenerator},{}],505:[function(require,module,exports){"use strict";(function(State){State[State["Traversing"]=0]="Traversing";State[State["Waiting"]=1]="Waiting"})(exports.State||(exports.State={}));var State=exports.State;Object.defineProperty(exports,"__esModule",{value:true});exports.default=State},{}],506:[function(require,module,exports){"use strict";var State_1=require("../State");var Geo_1=require("../Geo");var StateContext=function(){function StateContext(){this._state=new State_1.TraversingState({alpha:1,camera:new Geo_1.Camera,currentIndex:-1,reference:{alt:0,lat:0,lon:0},trajectory:[],zoom:0})}StateContext.prototype.traverse=function(){this._state=this._state.traverse()};StateContext.prototype.wait=function(){this._state=this._state.wait()};Object.defineProperty(StateContext.prototype,"state",{get:function(){if(this._state instanceof State_1.TraversingState){return State_1.State.Traversing}else if(this._state instanceof State_1.WaitingState){return State_1.State.Waiting}throw new Error("Invalid state")},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"reference",{get:function(){return this._state.reference},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"alpha",{get:function(){return this._state.alpha},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"camera",{get:function(){return this._state.camera},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"zoom",{get:function(){return this._state.zoom},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"currentNode",{get:function(){return this._state.currentNode},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"previousNode",{get:function(){return this._state.previousNode},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"currentCamera",{get:function(){return this._state.currentCamera},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"currentTransform",{get:function(){return this._state.currentTransform},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"previousTransform",{get:function(){return this._state.previousTransform},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"trajectory",{get:function(){return this._state.trajectory},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"currentIndex",{get:function(){return this._state.currentIndex},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"lastNode",{get:function(){return this._state.trajectory[this._state.trajectory.length-1]},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"nodesAhead",{get:function(){return this._state.trajectory.length-1-this._state.currentIndex},enumerable:true,configurable:true});Object.defineProperty(StateContext.prototype,"motionless",{get:function(){return this._state.motionless},enumerable:true,configurable:true});StateContext.prototype.update=function(fps){this._state.update(fps)};StateContext.prototype.append=function(nodes){this._state.append(nodes)};StateContext.prototype.prepend=function(nodes){this._state.prepend(nodes)};StateContext.prototype.remove=function(n){this._state.remove(n)};StateContext.prototype.cut=function(){this._state.cut()};StateContext.prototype.set=function(nodes){this._state.set(nodes)};StateContext.prototype.rotate=function(delta){this._state.rotate(delta)};StateContext.prototype.rotateBasic=function(basicRotation){this._state.rotateBasic(basicRotation)};StateContext.prototype.rotateToBasic=function(basic){this._state.rotateToBasic(basic)};StateContext.prototype.move=function(delta){this._state.move(delta)};StateContext.prototype.moveTo=function(delta){this._state.moveTo(delta)};StateContext.prototype.zoomIn=function(delta,reference){this._state.zoomIn(delta,reference)};return StateContext}();exports.StateContext=StateContext},{"../Geo":407,"../State":411}],507:[function(require,module,exports){"use strict";var BehaviorSubject_1=require("rxjs/BehaviorSubject");var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/do");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/pairwise");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/startWith");require("rxjs/add/operator/switchMap");require("rxjs/add/operator/withLatestFrom");var State_1=require("../State");var StateService=function(){function StateService(){var _this=this;this._appendNode$=new Subject_1.Subject;this._start$=new Subject_1.Subject;this._frame$=new Subject_1.Subject;this._fpsSampleRate=30;this._contextOperation$=new BehaviorSubject_1.BehaviorSubject(function(context){return context});this._context$=this._contextOperation$.scan(function(context,operation){return operation(context)},new State_1.StateContext).publishReplay(1).refCount();this._state$=this._context$.map(function(context){return context.state}).distinctUntilChanged().publishReplay(1).refCount();this._fps$=this._start$.switchMap(function(){return _this._frame$.filter(function(frameId){return frameId%_this._fpsSampleRate===0}).map(function(frameId){return(new Date).getTime()}).pairwise().map(function(times){return Math.max(20,1e3*_this._fpsSampleRate/(times[1]-times[0]))}).startWith(60)}).share();this._currentState$=this._frame$.withLatestFrom(this._fps$,this._context$,function(frameId,fps,context){return[frameId,fps,context]}).filter(function(fc){return fc[2].currentNode!=null}).do(function(fc){fc[2].update(fc[1])}).map(function(fc){return{fps:fc[1],id:fc[0],state:fc[2]}}).share();var nodeChanged$=this._currentState$.distinctUntilChanged(undefined,function(f){return f.state.currentNode.key}).publishReplay(1).refCount();var nodeChangedSubject$=new Subject_1.Subject;nodeChanged$.subscribe(nodeChangedSubject$);this._currentNode$=nodeChangedSubject$.map(function(f){return f.state.currentNode}).publishReplay(1).refCount();this._currentCamera$=nodeChangedSubject$.map(function(f){return f.state.currentCamera}).publishReplay(1).refCount();this._currentTransform$=nodeChangedSubject$.map(function(f){return f.state.currentTransform}).publishReplay(1).refCount();this._reference$=nodeChangedSubject$.map(function(f){return f.state.reference}).distinctUntilChanged(function(r1,r2){return r1.lat===r2.lat&&r1.lon===r2.lon},function(reference){return{lat:reference.lat,lon:reference.lon}}).publishReplay(1).refCount();this._currentNodeExternal$=nodeChanged$.map(function(f){return f.state.currentNode}).publishReplay(1).refCount();this._appendNode$.map(function(node){return function(context){context.append([node]);return context}}).subscribe(this._contextOperation$);this._state$.subscribe();
this._currentNode$.subscribe();this._currentCamera$.subscribe();this._currentTransform$.subscribe();this._reference$.subscribe();this._currentNodeExternal$.subscribe();this._frameId=null;this._frameGenerator=new State_1.FrameGenerator}Object.defineProperty(StateService.prototype,"currentState$",{get:function(){return this._currentState$},enumerable:true,configurable:true});Object.defineProperty(StateService.prototype,"currentNode$",{get:function(){return this._currentNode$},enumerable:true,configurable:true});Object.defineProperty(StateService.prototype,"currentNodeExternal$",{get:function(){return this._currentNodeExternal$},enumerable:true,configurable:true});Object.defineProperty(StateService.prototype,"currentCamera$",{get:function(){return this._currentCamera$},enumerable:true,configurable:true});Object.defineProperty(StateService.prototype,"currentTransform$",{get:function(){return this._currentTransform$},enumerable:true,configurable:true});Object.defineProperty(StateService.prototype,"state$",{get:function(){return this._state$},enumerable:true,configurable:true});Object.defineProperty(StateService.prototype,"reference$",{get:function(){return this._reference$},enumerable:true,configurable:true});Object.defineProperty(StateService.prototype,"appendNode$",{get:function(){return this._appendNode$},enumerable:true,configurable:true});StateService.prototype.traverse=function(){this._invokeContextOperation(function(context){context.traverse()})};StateService.prototype.wait=function(){this._invokeContextOperation(function(context){context.wait()})};StateService.prototype.appendNodes=function(nodes){this._invokeContextOperation(function(context){context.append(nodes)})};StateService.prototype.prependNodes=function(nodes){this._invokeContextOperation(function(context){context.prepend(nodes)})};StateService.prototype.removeNodes=function(n){this._invokeContextOperation(function(context){context.remove(n)})};StateService.prototype.cutNodes=function(){this._invokeContextOperation(function(context){context.cut()})};StateService.prototype.setNodes=function(nodes){this._invokeContextOperation(function(context){context.set(nodes)})};StateService.prototype.rotate=function(delta){this._invokeContextOperation(function(context){context.rotate(delta)})};StateService.prototype.rotateBasic=function(basicRotation){this._invokeContextOperation(function(context){context.rotateBasic(basicRotation)})};StateService.prototype.rotateToBasic=function(basic){this._invokeContextOperation(function(context){context.rotateToBasic(basic)})};StateService.prototype.move=function(delta){this._invokeContextOperation(function(context){context.move(delta)})};StateService.prototype.moveTo=function(position){this._invokeContextOperation(function(context){context.moveTo(position)})};StateService.prototype.zoomIn=function(delta,reference){this._invokeContextOperation(function(context){context.zoomIn(delta,reference)})};StateService.prototype.start=function(){if(this._frameId==null){this._start$.next(null);this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this));this._frame$.next(this._frameId)}};StateService.prototype.stop=function(){if(this._frameId!=null){this._frameGenerator.cancelAnimationFrame(this._frameId);this._frameId=null}};StateService.prototype._invokeContextOperation=function(action){this._contextOperation$.next(function(context){action(context);return context})};StateService.prototype._frame=function(time){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this));this._frame$.next(this._frameId)};return StateService}();exports.StateService=StateService},{"../State":411,"rxjs/BehaviorSubject":223,"rxjs/Subject":230,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/do":250,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/pairwise":259,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/startWith":268,"rxjs/add/operator/switchMap":269,"rxjs/add/operator/withLatestFrom":272}],508:[function(require,module,exports){"use strict";var Error_1=require("../../Error");var Geo_1=require("../../Geo");var StateBase=function(){function StateBase(state){this._spatial=new Geo_1.Spatial;this._geoCoords=new Geo_1.GeoCoords;this._referenceThreshold=.01;this._reference=state.reference;this._alpha=state.alpha;this._camera=state.camera.clone();this._zoom=state.zoom;this._currentIndex=state.currentIndex;this._trajectory=state.trajectory.slice();this._trajectoryTransforms=[];this._trajectoryCameras=[];for(var _i=0,_a=this._trajectory;_i<_a.length;_i++){var node=_a[_i];var translation=this._nodeToTranslation(node);var transform=new Geo_1.Transform(node,translation);this._trajectoryTransforms.push(transform);this._trajectoryCameras.push(new Geo_1.Camera(transform))}this._currentNode=this._trajectory.length>0?this._trajectory[this._currentIndex]:null;this._previousNode=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null;this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new Geo_1.Camera;this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}Object.defineProperty(StateBase.prototype,"reference",{get:function(){return this._reference},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"alpha",{get:function(){return this._getAlpha()},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"camera",{get:function(){return this._camera},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"zoom",{get:function(){return this._zoom},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"trajectory",{get:function(){return this._trajectory},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"currentIndex",{get:function(){return this._currentIndex},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"currentNode",{get:function(){return this._currentNode},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"previousNode",{get:function(){return this._previousNode},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"currentCamera",{get:function(){return this._currentCamera},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"currentTransform",{get:function(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"previousTransform",{get:function(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null},enumerable:true,configurable:true});Object.defineProperty(StateBase.prototype,"motionless",{get:function(){return this._motionless},enumerable:true,configurable:true});StateBase.prototype.append=function(nodes){if(nodes.length<1){throw Error("Trajectory can not be empty")}if(this._currentIndex<0){this.set(nodes)}else{this._trajectory=this._trajectory.concat(nodes);this._appendToTrajectories(nodes)}};StateBase.prototype.prepend=function(nodes){if(nodes.length<1){throw Error("Trajectory can not be empty")}this._trajectory=nodes.slice().concat(this._trajectory);this._currentIndex+=nodes.length;this._setCurrentNode();var referenceReset=this._setReference(this._currentNode);if(referenceReset){this._setTrajectories()}else{this._prependToTrajectories(nodes)}this._setCurrentCamera()};StateBase.prototype.remove=function(n){if(n<0){throw Error("n must be a positive integer")}var length=this._trajectory.length;if(length-(this._currentIndex+1)<n){throw Error("Current node can not be removed")}for(var i=0;i<n;i++){this._trajectory.pop();this._trajectoryTransforms.pop();this._trajectoryCameras.pop()}};StateBase.prototype.cut=function(){while(this._trajectory.length-1>this._currentIndex){this._trajectory.pop();this._trajectoryTransforms.pop();this._trajectoryCameras.pop()}};StateBase.prototype.set=function(nodes){this._setTrajectory(nodes);this._setCurrentNode();this._setReference(this._currentNode);this._setTrajectories();this._setCurrentCamera()};StateBase.prototype._setCurrent=function(){this._setCurrentNode();var referenceReset=this._setReference(this._currentNode);if(referenceReset){this._setTrajectories()}this._setCurrentCamera()};StateBase.prototype._setCurrentCamera=function(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone();this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()};StateBase.prototype._motionlessTransition=function(){var nodesSet=this._currentNode!=null&&this._previousNode!=null;return nodesSet&&!(this._currentNode.merged&&this._previousNode.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent())};StateBase.prototype._setReference=function(node){if(Math.abs(node.latLon.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(node.latLon.lon-this.reference.lon)<this._referenceThreshold){return false}if(this._previousNode!=null&&!this._motionlessTransition()){return false}this._reference.lat=node.latLon.lat;this._reference.lon=node.latLon.lon;this._reference.alt=node.apiNavImIm.calt;return true};StateBase.prototype._setCurrentNode=function(){this._currentNode=this._trajectory.length>0?this._trajectory[this._currentIndex]:null;this._previousNode=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null};StateBase.prototype._setTrajectory=function(nodes){if(nodes.length<1){throw new Error_1.ParameterMapillaryError("Trajectory can not be empty")}if(this._currentNode!=null){this._trajectory=[this._currentNode].concat(nodes);this._currentIndex=1}else{this._trajectory=nodes.slice();this._currentIndex=0}};StateBase.prototype._setTrajectories=function(){this._trajectoryTransforms.length=0;this._trajectoryCameras.length=0;this._appendToTrajectories(this._trajectory)};StateBase.prototype._appendToTrajectories=function(nodes){for(var _i=0,nodes_1=nodes;_i<nodes_1.length;_i++){var node=nodes_1[_i];if(!node.loaded){throw new Error_1.ParameterMapillaryError("Node must be loaded when added to trajectory")}var translation=this._nodeToTranslation(node);var transform=new Geo_1.Transform(node,translation);this._trajectoryTransforms.push(transform);this._trajectoryCameras.push(new Geo_1.Camera(transform))}};StateBase.prototype._prependToTrajectories=function(nodes){for(var _i=0,_a=nodes.reverse();_i<_a.length;_i++){var node=_a[_i];if(!node.loaded){throw new Error_1.ParameterMapillaryError("Node must be loaded when added to trajectory")}var translation=this._nodeToTranslation(node);var transform=new Geo_1.Transform(node,translation);this._trajectoryTransforms.unshift(transform);this._trajectoryCameras.unshift(new Geo_1.Camera(transform))}};StateBase.prototype._nodeToTranslation=function(node){var C=this._geoCoords.geodeticToEnu(node.latLon.lat,node.latLon.lon,node.apiNavImIm.calt,this._reference.lat,this._reference.lon,this._reference.alt);var RC=this._spatial.rotate(C,node.apiNavImIm.rotation);return[-RC.x,-RC.y,-RC.z]};StateBase.prototype._sameConnectedComponent=function(){var current=this._currentNode;var previous=this._previousNode;if(!current||!current.apiNavImIm.merge_cc||!previous||!previous.apiNavImIm.merge_cc){return true}return current.apiNavImIm.merge_cc===previous.apiNavImIm.merge_cc};StateBase.prototype._withinOriginalDistance=function(){var current=this._currentNode;var previous=this._previousNode;if(!current||!previous){return true}var distance=this._spatial.distanceFromLatLon(current.apiNavImIm.lat,current.apiNavImIm.lon,previous.apiNavImIm.lat,previous.apiNavImIm.lon);return distance<25};return StateBase}();exports.StateBase=StateBase},{"../../Error":406,"../../Geo":407}],509:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=require("three");var UnitBezier=require("unitbezier");var State_1=require("../../State");var RotationDelta=function(){function RotationDelta(phi,theta){this._phi=phi;this._theta=theta}Object.defineProperty(RotationDelta.prototype,"phi",{get:function(){return this._phi},set:function(value){this._phi=value},enumerable:true,configurable:true});Object.defineProperty(RotationDelta.prototype,"theta",{get:function(){return this._theta},set:function(value){this._theta=value},enumerable:true,configurable:true});Object.defineProperty(RotationDelta.prototype,"isZero",{get:function(){return this._phi===0&&this._theta===0},enumerable:true,configurable:true});RotationDelta.prototype.copy=function(delta){this._phi=delta.phi;this._theta=delta.theta};RotationDelta.prototype.lerp=function(other,alpha){this._phi=(1-alpha)*this._phi+alpha*other.phi;this._theta=(1-alpha)*this._theta+alpha*other.theta};RotationDelta.prototype.multiply=function(value){this._phi*=value;this._theta*=value};RotationDelta.prototype.threshold=function(value){this._phi=Math.abs(this._phi)>value?this._phi:0;this._theta=Math.abs(this._theta)>value?this._theta:0};RotationDelta.prototype.lengthSquared=function(){return this._phi*this._phi+this._theta*this._theta};RotationDelta.prototype.reset=function(){this._phi=0;this._theta=0};return RotationDelta}();var TraversingState=function(_super){__extends(TraversingState,_super);function TraversingState(state){_super.call(this,state);this._motionless=this._motionlessTransition();this._baseAlpha=this._alpha;this._animationSpeed=.025;this._unitBezier=new UnitBezier(.74,.67,.38,.96);this._useBezier=false;this._rotationDelta=new RotationDelta(0,0);this._requestedRotationDelta=null;this._basicRotation=[0,0];this._requestedBasicRotation=null;this._rotationAcceleration=.86;this._rotationIncreaseAlpha=.97;this._rotationDecreaseAlpha=.9;this._rotationThreshold=.001;this._desiredZoom=state.zoom;this._minZoom=0;this._maxZoom=3;this._desiredLookat=null}TraversingState.prototype.traverse=function(){throw new Error("Not implemented")};TraversingState.prototype.wait=function(){return new State_1.WaitingState(this)};TraversingState.prototype.append=function(nodes){if(this._trajectory.length===0){this._resetTransition()}_super.prototype.append.call(this,nodes)};TraversingState.prototype.prepend=function(nodes){if(this._trajectory.length===0){this._resetTransition()}_super.prototype.prepend.call(this,nodes)};TraversingState.prototype.set=function(nodes){_super.prototype.set.call(this,nodes);this._desiredZoom=this._currentNode.fullPano?this._zoom:0;this._desiredLookat=null;this._resetTransition();this._clearRotation();if(this._trajectory.length<3){this._useBezier=true}};TraversingState.prototype.move=function(delta){throw new Error("Not implemented")};TraversingState.prototype.moveTo=function(delta){throw new Error("Not implemented")};TraversingState.prototype.rotate=function(rotationDelta){if(this._currentNode==null){return}this._desiredZoom=this._zoom;this._desiredLookat=null;this._requestedBasicRotation=null;if(this._requestedRotationDelta!=null){this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+rotationDelta.phi;this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+rotationDelta.theta}else{this._requestedRotationDelta=new RotationDelta(rotationDelta.phi,rotationDelta.theta)}};TraversingState.prototype.rotateBasic=function(basicRotation){if(this._currentNode==null){return}this._desiredZoom=this._zoom;this._desiredLookat=null;this._requestedRotationDelta=null;if(this._requestedBasicRotation!=null){this._requestedBasicRotation[0]+=basicRotation[0];this._requestedBasicRotation[1]+=basicRotation[1]}else{this._requestedBasicRotation=basicRotation.slice()}};TraversingState.prototype.rotateToBasic=function(basic){if(this._currentNode==null){return}this._desiredZoom=this._zoom;this._desiredLookat=null;basic[0]=this._spatial.clamp(basic[0],0,1);basic[1]=this._spatial.clamp(basic[1],0,1);var lookat=this.currentTransform.unprojectBasic(basic,10);this._currentCamera.lookat.fromArray(lookat)};TraversingState.prototype.zoomIn=function(delta,reference){if(this._currentNode==null){return}this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+delta));var currentCenter=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray());var currentCenterX=currentCenter[0];var currentCenterY=currentCenter[1];var zoom0=Math.pow(2,this._zoom);var zoom1=Math.pow(2,this._desiredZoom);var refX=reference[0];var refY=reference[1];if(this.currentTransform.gpano!=null&&this.currentTransform.gpano.CroppedAreaImageWidthPixels===this.currentTransform.gpano.FullPanoWidthPixels){if(refX-currentCenterX>.5){refX=refX-1}else if(currentCenterX-refX>.5){refX=1+refX}}var newCenterX=refX-zoom0/zoom1*(refX-currentCenterX);var newCenterY=refY-zoom0/zoom1*(refY-currentCenterY);var gpano=this.currentTransform.gpano;if(this._currentNode.fullPano){newCenterX=this._spatial.wrap(newCenterX+this._basicRotation[0],0,1);newCenterY=this._spatial.clamp(newCenterY+this._basicRotation[1],.05,.95)}else if(gpano!=null&&this.currentTransform.gpano.CroppedAreaImageWidthPixels===this.currentTransform.gpano.FullPanoWidthPixels){newCenterX=this._spatial.wrap(newCenterX+this._basicRotation[0],0,1);newCenterY=this._spatial.clamp(newCenterY+this._basicRotation[1],0,1)}else{newCenterX=this._spatial.clamp(newCenterX,0,1);newCenterY=this._spatial.clamp(newCenterY,0,1)}this._desiredLookat=(new THREE.Vector3).fromArray(this.currentTransform.unprojectBasic([newCenterX,newCenterY],10))};TraversingState.prototype.update=function(fps){if(this._alpha===1&&this._currentIndex+this._alpha<this._trajectory.length){this._currentIndex+=1;this._useBezier=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length;this._setCurrent();this._resetTransition();this._clearRotation();this._desiredZoom=this._currentNode.fullPano?this._zoom:0;this._desiredLookat=null}var animationSpeed=this._animationSpeed*(60/fps);this._baseAlpha=Math.min(1,this._baseAlpha+animationSpeed);if(this._useBezier){this._alpha=this._unitBezier.solve(this._baseAlpha)}else{this._alpha=this._baseAlpha}this._updateRotation();if(!this._rotationDelta.isZero){this._applyRotation(this._previousCamera);this._applyRotation(this._currentCamera)}this._updateRotationBasic();if(this._basicRotation[0]!==0||this._basicRotation[1]!==0){this._applyRotationBasic()}this._updateZoom(animationSpeed);this._updateLookat(animationSpeed);this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)};TraversingState.prototype._getAlpha=function(){return this._motionless?Math.ceil(this._alpha):this._alpha};TraversingState.prototype._setCurrentCamera=function(){_super.prototype._setCurrentCamera.call(this);if(this._previousNode!=null){var lookat=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(lookat.clone().add(this._previousCamera.position));if(this._currentNode.fullPano){this._currentCamera.lookat.copy(lookat.clone().add(this._currentCamera.position))}}};TraversingState.prototype._resetTransition=function(){this._alpha=0;this._baseAlpha=0;this._motionless=this._motionlessTransition()};TraversingState.prototype._applyRotation=function(camera){if(camera==null){return}var q=(new THREE.Quaternion).setFromUnitVectors(camera.up,new THREE.Vector3(0,0,1));var qInverse=q.clone().inverse();var offset=new THREE.Vector3;offset.copy(camera.lookat).sub(camera.position);offset.applyQuaternion(q);var length=offset.length();var phi=Math.atan2(offset.y,offset.x);phi+=this._rotationDelta.phi;var theta=Math.atan2(Math.sqrt(offset.x*offset.x+offset.y*offset.y),offset.z);theta+=this._rotationDelta.theta;theta=Math.max(.1,Math.min(Math.PI-.1,theta));offset.x=Math.sin(theta)*Math.cos(phi);offset.y=Math.sin(theta)*Math.sin(phi);offset.z=Math.cos(theta);offset.applyQuaternion(qInverse);camera.lookat.copy(camera.position).add(offset.multiplyScalar(length))};TraversingState.prototype._applyRotationBasic=function(){var currentNode=this._currentNode;var previousNode=this._previousNode!=null?this.previousNode:this.currentNode;var currentCamera=this._currentCamera;var previousCamera=this._previousCamera;var currentTransform=this.currentTransform;var previousTransform=this.previousTransform!=null?this.previousTransform:this.currentTransform;var currentBasic=currentTransform.projectBasic(currentCamera.lookat.toArray());var previousBasic=previousTransform.projectBasic(previousCamera.lookat.toArray());var currentGPano=currentTransform.gpano;var previousGPano=previousTransform.gpano;if(currentNode.fullPano){currentBasic[0]=this._spatial.wrap(currentBasic[0]+this._basicRotation[0],0,1);currentBasic[1]=this._spatial.clamp(currentBasic[1]+this._basicRotation[1],.05,.95)}else if(currentGPano!=null&&currentTransform.gpano.CroppedAreaImageWidthPixels===currentTransform.gpano.FullPanoWidthPixels){currentBasic[0]=this._spatial.wrap(currentBasic[0]+this._basicRotation[0],0,1);currentBasic[1]=this._spatial.clamp(currentBasic[1]+this._basicRotation[1],0,1)}else{currentBasic[0]=this._spatial.clamp(currentBasic[0]+this._basicRotation[0],0,1);currentBasic[1]=this._spatial.clamp(currentBasic[1]+this._basicRotation[1],0,1)}if(previousNode.fullPano){previousBasic[0]=this._spatial.wrap(previousBasic[0]+this._basicRotation[0],0,1);previousBasic[1]=this._spatial.clamp(previousBasic[1]+this._basicRotation[1],.05,.95)}else if(previousGPano!=null&&previousTransform.gpano.CroppedAreaImageWidthPixels===previousTransform.gpano.FullPanoWidthPixels){previousBasic[0]=this._spatial.wrap(previousBasic[0]+this._basicRotation[0],0,1);previousBasic[1]=this._spatial.clamp(previousBasic[1]+this._basicRotation[1],0,1)}else{previousBasic[0]=this._spatial.clamp(previousBasic[0]+this._basicRotation[0],0,1);previousBasic[1]=this._spatial.clamp(currentBasic[1]+this._basicRotation[1],0,1)}var currentLookat=currentTransform.unprojectBasic(currentBasic,10);currentCamera.lookat.fromArray(currentLookat);var previousLookat=previousTransform.unprojectBasic(previousBasic,10);previousCamera.lookat.fromArray(previousLookat)};TraversingState.prototype._updateZoom=function(animationSpeed){var diff=this._desiredZoom-this._zoom;if(diff===0){return}else if(Math.abs(diff)<1e-4){this._zoom=this._desiredZoom}else{this._zoom+=5*animationSpeed*diff}};TraversingState.prototype._updateLookat=function(animationSpeed){if(this._desiredLookat===null){return}var diff=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);if(Math.abs(diff)<1e-5){this._currentCamera.lookat.copy(this._desiredLookat);this._desiredLookat=null}else{this._currentCamera.lookat.lerp(this._desiredLookat,5*animationSpeed)}};TraversingState.prototype._updateRotation=function(){if(this._requestedRotationDelta!=null){var length_1=this._rotationDelta.lengthSquared();var requestedLength=this._requestedRotationDelta.lengthSquared();if(requestedLength>length_1){this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha)}else{this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha)}this._requestedRotationDelta=null;return}if(this._rotationDelta.isZero){return}this._rotationDelta.multiply(this._rotationAcceleration);this._rotationDelta.threshold(this._rotationThreshold)};TraversingState.prototype._updateRotationBasic=function(){if(this._requestedBasicRotation!=null){var x=this._basicRotation[0];var y=this._basicRotation[1];var lengthSquared=x*x+y*y;var reqX=this._requestedBasicRotation[0];var reqY=this._requestedBasicRotation[1];var reqLengthSquared=reqX*reqX+reqY*reqY;if(reqLengthSquared>lengthSquared){this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*x+this._rotationIncreaseAlpha*reqX;this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*y+this._rotationIncreaseAlpha*reqY}else{this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*x+this._rotationDecreaseAlpha*reqX;this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*y+this._rotationDecreaseAlpha*reqY}this._requestedBasicRotation=null;return}if(this._basicRotation[0]===0&&this._basicRotation[1]===0){return}this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0];this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1];if(Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)){this._basicRotation=[0,0]}};TraversingState.prototype._clearRotation=function(){if(this._currentNode.fullPano){return}if(this._requestedRotationDelta!=null){this._requestedRotationDelta=null}if(!this._rotationDelta.isZero){this._rotationDelta.reset()}if(this._requestedBasicRotation!=null){this._requestedBasicRotation=null}if(this._basicRotation[0]>0||this._basicRotation[1]>0){this._basicRotation=[0,0]}};return TraversingState}(State_1.StateBase);exports.TraversingState=TraversingState},{"../../State":411,three:354,unitbezier:356}],510:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var State_1=require("../../State");var WaitingState=function(_super){__extends(WaitingState,_super);function WaitingState(state){_super.call(this,state);this._motionless=this._motionlessTransition()}WaitingState.prototype.traverse=function(){return new State_1.TraversingState(this)};WaitingState.prototype.wait=function(){throw new Error("Not implemented")};WaitingState.prototype.prepend=function(nodes){_super.prototype.prepend.call(this,nodes);this._motionless=this._motionlessTransition()};WaitingState.prototype.set=function(nodes){_super.prototype.set.call(this,nodes);this._motionless=this._motionlessTransition()};WaitingState.prototype.rotate=function(delta){return};WaitingState.prototype.rotateBasic=function(basicRotation){return};WaitingState.prototype.rotateToBasic=function(basic){return};WaitingState.prototype.zoomIn=function(delta,reference){return};WaitingState.prototype.move=function(delta){this._alpha=Math.max(0,Math.min(1,this._alpha+delta))};WaitingState.prototype.moveTo=function(position){this._alpha=Math.max(0,Math.min(1,position))};WaitingState.prototype.update=function(fps){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)};WaitingState.prototype._getAlpha=function(){return this._motionless?Math.ceil(this._alpha):this._alpha};WaitingState.prototype._setCurrentCamera=function(){_super.prototype._setCurrentCamera.call(this);if(this._previousNode!=null){var lookat=this._camera.lookat.clone().sub(this._camera.position);if(this._previousNode.pano){var lookat_1=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(lookat_1.clone().add(this._currentCamera.position))}if(this._currentNode.pano){this._currentCamera.lookat.copy(lookat.clone().add(this._currentCamera.position))}}};return WaitingState}(State_1.StateBase);exports.WaitingState=WaitingState},{"../../State":411}],511:[function(require,module,exports){"use strict";var EventEmitter=function(){function EventEmitter(){this._events={}}EventEmitter.prototype.on=function(eventType,fn){this._events[eventType]=this._events[eventType]||[];this._events[eventType].push(fn);return};EventEmitter.prototype.off=function(eventType,fn){if(!eventType){this._events={};return}if(!this._listens(eventType)){var idx=this._events[eventType].indexOf(fn);if(idx>=0){this._events[eventType].splice(idx,1)}if(this._events[eventType].length){delete this._events[eventType]}}else{delete this._events[eventType]}return};EventEmitter.prototype.fire=function(eventType,data){if(!this._listens(eventType)){return}for(var _i=0,_a=this._events[eventType];_i<_a.length;_i++){var fn=_a[_i];fn.call(this,data)}return};EventEmitter.prototype._listens=function(eventType){return!!(this._events&&this._events[eventType])};return EventEmitter}();exports.EventEmitter=EventEmitter;Object.defineProperty(exports,"__esModule",{value:true});exports.default=EventEmitter},{}],512:[function(require,module,exports){"use strict";var Viewer_1=require("../Viewer");var Settings=function(){function Settings(){}Settings.setOptions=function(options){Settings._baseImageSize=options.baseImageSize!=null?options.baseImageSize:Viewer_1.ImageSize.Size640;Settings._basePanoramaSize=options.basePanoramaSize!=null?options.basePanoramaSize:Viewer_1.ImageSize.Size2048;Settings._maxImageSize=options.maxImageSize!=null?options.maxImageSize:Viewer_1.ImageSize.Size2048};Object.defineProperty(Settings,"baseImageSize",{get:function(){return Settings._baseImageSize},enumerable:true,configurable:true});Object.defineProperty(Settings,"basePanoramaSize",{get:function(){return Settings._basePanoramaSize},enumerable:true,configurable:true});Object.defineProperty(Settings,"maxImageSize",{get:function(){return Settings._maxImageSize},enumerable:true,configurable:true});return Settings}();exports.Settings=Settings;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Settings},{"../Viewer":413}],513:[function(require,module,exports){"use strict";var Urls=function(){function Urls(){}Urls.image=function(key,size){return"https://d1cuyjsrcm0gby.cloudfront.net/"+key+"/thumb-"+size+".jpg?origin=mapillary.webgl"};Urls.falcorModel=function(clientId){return"http://mapillary-vector.mapillary.io/v3/model.json?client_id="+clientId};Urls.falcorModelMagic=function(clientId){return"https://a.mapillary.com/v3/model.json?client_id="+clientId};Urls.mesh=function(key){return"https://d1cuyjsrcm0gby.cloudfront.net/"+key+"/sfm/v1.0/atomic_mesh.json"};Urls.proto_mesh=function(key){return"https://d1brzeo354iq2l.cloudfront.net/v2/mesh/"+key};return Urls}();exports.Urls=Urls;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Urls},{}],514:[function(require,module,exports){"use strict";var Component_1=require("../Component");var ComponentController=function(){function ComponentController(container,navigator,key,options){var _this=this;this._container=container;this._navigator=navigator;this._options=options;this._key=key;this._componentService=new Component_1.ComponentService(this._container,this._navigator);this._coverComponent=this._componentService.getCover();this._initializeComponents();if(key){this._initilizeCoverComponent();this._subscribeCoverComponent()}else{this._navigator.movedToKey$.first().subscribe(function(movedToKey){_this._key=movedToKey;_this._componentService.deactivateCover();_this._coverComponent.configure({key:_this._key,loading:false,visible:false});_this._subscribeCoverComponent();_this._navigator.stateService.start()})}}ComponentController.prototype.get=function(name){return this._componentService.get(name)};ComponentController.prototype.activate=function(name){this._componentService.activate(name)};ComponentController.prototype.activateCover=function(){this._coverComponent.configure({loading:false,visible:true})};ComponentController.prototype.deactivate=function(name){this._componentService.deactivate(name)};ComponentController.prototype.deactivateCover=function(){this._coverComponent.configure({loading:true,visible:true})};ComponentController.prototype.resize=function(){this._componentService.resize()};ComponentController.prototype._initializeComponents=function(){var options=this._options;this._uFalse(options.background,"background");this._uFalse(options.debug,"debug");this._uFalse(options.detection,"detection");this._uFalse(options.image,"image");this._uFalse(options.marker,"marker");this._uFalse(options.navigation,"navigation");this._uFalse(options.route,"route");this._uFalse(options.slider,"slider");this._uFalse(options.stats,"stats");this._uFalse(options.tag,"tag");this._uTrue(options.attribution,"attribution");
this._uTrue(options.bearing,"bearing");this._uTrue(options.cache,"cache");this._uTrue(options.direction,"direction");this._uTrue(options.imageplane,"imageplane");this._uTrue(options.keyboard,"keyboard");this._uTrue(options.loading,"loading");this._uTrue(options.mouse,"mouse");this._uTrue(options.sequence,"sequence")};ComponentController.prototype._initilizeCoverComponent=function(){var options=this._options;this._coverComponent.configure({key:this._key});if(options.cover===undefined||options.cover){this.activateCover()}else{this.deactivateCover()}};ComponentController.prototype._subscribeCoverComponent=function(){var _this=this;this._coverComponent.configuration$.subscribe(function(conf){if(conf.loading){_this._navigator.moveToKey(conf.key).subscribe(function(node){_this._navigator.stateService.start();_this._coverComponent.configure({loading:false,visible:false});_this._componentService.deactivateCover()})}else if(conf.visible){_this._navigator.stateService.stop();_this._componentService.activateCover()}})};ComponentController.prototype._uFalse=function(option,name){if(option===undefined){this._componentService.deactivate(name);return}if(typeof option==="boolean"){if(option){this._componentService.activate(name)}else{this._componentService.deactivate(name)}return}this._componentService.configure(name,option);this._componentService.activate(name)};ComponentController.prototype._uTrue=function(option,name){if(option===undefined){this._componentService.activate(name);return}if(typeof option==="boolean"){if(option){this._componentService.activate(name)}else{this._componentService.deactivate(name)}return}this._componentService.configure(name,option);this._componentService.activate(name)};return ComponentController}();exports.ComponentController=ComponentController},{"../Component":404}],515:[function(require,module,exports){"use strict";var Render_1=require("../Render");var Viewer_1=require("../Viewer");var Container=function(){function Container(id,stateService,options){this.id=id;this.element=document.getElementById(id);this.element.classList.add("mapillary-js");this.renderService=new Render_1.RenderService(this.element,stateService.currentState$,options.renderMode);this.glRenderer=new Render_1.GLRenderer(this.renderService);this.domRenderer=new Render_1.DOMRenderer(this.element,this.renderService,stateService.currentState$);this.mouseService=new Viewer_1.MouseService(this.element);this.touchService=new Viewer_1.TouchService(this.element);this.spriteService=new Viewer_1.SpriteService(options.sprite)}return Container}();exports.Container=Container;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Container},{"../Render":410,"../Viewer":413}],516:[function(require,module,exports){"use strict";var EventLauncher=function(){function EventLauncher(eventEmitter,navigator){var _this=this;this._eventEmitter=eventEmitter;this._navigator=navigator;this._loadingSubscription=this._navigator.loadingService.loading$.subscribe(function(loading){_this._eventEmitter.fire("loadingchanged",loading)});this._stateSubscription=this._navigator.stateService.currentNodeExternal$.subscribe(function(node){_this._eventEmitter.fire("nodechanged",node)})}EventLauncher.prototype.dispose=function(){this._loadingSubscription.unsubscribe();this._stateSubscription.unsubscribe()};return EventLauncher}();exports.EventLauncher=EventLauncher;Object.defineProperty(exports,"__esModule",{value:true});exports.default=EventLauncher},{}],517:[function(require,module,exports){"use strict";(function(ImageSize){ImageSize[ImageSize["Size320"]=320]="Size320";ImageSize[ImageSize["Size640"]=640]="Size640";ImageSize[ImageSize["Size1024"]=1024]="Size1024";ImageSize[ImageSize["Size2048"]=2048]="Size2048"})(exports.ImageSize||(exports.ImageSize={}));var ImageSize=exports.ImageSize},{}],518:[function(require,module,exports){"use strict";var _=require("underscore");var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/debounceTime");require("rxjs/add/operator/distinctUntilChanged");require("rxjs/add/operator/map");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/startWith");var LoadingService=function(){function LoadingService(){this._loadersSubject$=new Subject_1.Subject;this._loaders$=this._loadersSubject$.scan(function(loaders,loader){if(loader.task!==undefined){loaders[loader.task]=loader.loading}return loaders},{}).startWith({}).publishReplay(1).refCount()}Object.defineProperty(LoadingService.prototype,"loading$",{get:function(){return this._loaders$.map(function(loaders){return _.reduce(loaders,function(loader,acc){return loader||acc},false)}).debounceTime(100).distinctUntilChanged()},enumerable:true,configurable:true});LoadingService.prototype.taskLoading$=function(task){return this._loaders$.map(function(loaders){return!!loaders[task]}).debounceTime(100).distinctUntilChanged()};LoadingService.prototype.startLoading=function(task){this._loadersSubject$.next({loading:true,task:task})};LoadingService.prototype.stopLoading=function(task){this._loadersSubject$.next({loading:false,task:task})};return LoadingService}();exports.LoadingService=LoadingService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=LoadingService},{"rxjs/Subject":230,"rxjs/add/operator/debounceTime":246,"rxjs/add/operator/distinctUntilChanged":249,"rxjs/add/operator/map":255,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/startWith":268,underscore:355}],519:[function(require,module,exports){"use strict";var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/fromEvent");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/merge");require("rxjs/add/operator/mergeMap");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/switchMap");require("rxjs/add/operator/withLatestFrom");var MouseService=function(){function MouseService(element){var _this=this;this._element=element;this._preventMouseDownOperation$=new Subject_1.Subject;this._preventMouseDown$=new Subject_1.Subject;this._mouseMoveOperation$=new Subject_1.Subject;this._claimMouse$=new Subject_1.Subject;this._mouseDown$=Observable_1.Observable.fromEvent(element,"mousedown");this._mouseLeave$=Observable_1.Observable.fromEvent(element,"mouseleave");this._mouseUp$=Observable_1.Observable.fromEvent(element,"mouseup");this._mouseOver$=Observable_1.Observable.fromEvent(element,"mouseover");this._click$=Observable_1.Observable.fromEvent(element,"click");this._mouseWheel$=Observable_1.Observable.fromEvent(element,"wheel");this._mouseWheel$.subscribe(function(event){event.preventDefault()});this._preventMouseDownOperation$.scan(function(prevent,operation){return operation(prevent)},true).subscribe();this._preventMouseDown$.map(function(prevent){return function(previous){return prevent}}).subscribe(this._preventMouseDownOperation$);this._mouseDown$.map(function(e){return function(prevent){if(prevent){e.preventDefault()}return prevent}}).subscribe(this._preventMouseDownOperation$);this._mouseMove$=this._mouseMoveOperation$.scan(function(e,operation){return operation(e)},null);Observable_1.Observable.fromEvent(element,"mousemove").map(function(e){return function(previous){if(previous==null){previous=e}if(e.movementX==null){e.movementX=e.clientX-previous.clientX}if(e.movementY==null){e.movementY=e.clientY-previous.clientY}return e}}).subscribe(this._mouseMoveOperation$);var dragStop$=Observable_1.Observable.merge(this._mouseLeave$,this._mouseUp$);this._mouseDragStart$=this._mouseDown$.mergeMap(function(e){return _this._mouseMove$.takeUntil(dragStop$).take(1)});this._mouseDrag$=this._mouseDown$.mergeMap(function(e){return _this._mouseMove$.skip(1).takeUntil(dragStop$)});this._mouseDragEnd$=this._mouseDragStart$.mergeMap(function(e){return dragStop$.first()});this._staticClick$=this._mouseDown$.switchMap(function(e){return _this._click$.takeUntil(_this._mouseMove$).take(1)});this._mouseOwner$=this._claimMouse$.scan(function(claims,mouseClaim){if(mouseClaim.zindex==null){delete claims[mouseClaim.name]}else{claims[mouseClaim.name]=mouseClaim.zindex}return claims},{}).map(function(claims){var owner=null;var curZ=-1;for(var name_1 in claims){if(claims.hasOwnProperty(name_1)){if(claims[name_1]>curZ){curZ=claims[name_1];owner=name_1}}}return owner}).publishReplay(1).refCount()}MouseService.prototype.claimMouse=function(name,zindex){this._claimMouse$.next({name:name,zindex:zindex})};MouseService.prototype.unclaimMouse=function(name){this._claimMouse$.next({name:name,zindex:null})};MouseService.prototype.filtered$=function(name,observable$){return observable$.withLatestFrom(this.mouseOwner$,function(event,owner){return[event,owner]}).filter(function(eo){return eo[1]===name}).map(function(eo){return eo[0]})};Object.defineProperty(MouseService.prototype,"mouseOwner$",{get:function(){return this._mouseOwner$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseDown$",{get:function(){return this._mouseDown$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseMove$",{get:function(){return this._mouseMove$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseLeave$",{get:function(){return this._mouseLeave$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseUp$",{get:function(){return this._mouseUp$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"click$",{get:function(){return this._click$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseWheel$",{get:function(){return this._mouseWheel$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseDragStart$",{get:function(){return this._mouseDragStart$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseDrag$",{get:function(){return this._mouseDrag$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"mouseDragEnd$",{get:function(){return this._mouseDragEnd$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"staticClick$",{get:function(){return this._staticClick$},enumerable:true,configurable:true});Object.defineProperty(MouseService.prototype,"preventDefaultMouseDown$",{get:function(){return this._preventMouseDown$},enumerable:true,configurable:true});return MouseService}();exports.MouseService=MouseService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=MouseService},{"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/fromEvent":237,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/merge":256,"rxjs/add/operator/mergeMap":258,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/switchMap":269,"rxjs/add/operator/withLatestFrom":272}],520:[function(require,module,exports){"use strict";var BehaviorSubject_1=require("rxjs/BehaviorSubject");var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/observable/fromPromise");require("rxjs/add/observable/of");require("rxjs/add/observable/throw");require("rxjs/add/operator/first");require("rxjs/add/operator/map");require("rxjs/add/operator/mergeMap");var API_1=require("../API");var Graph_1=require("../Graph");var State_1=require("../State");var Viewer_1=require("../Viewer");var Navigator=function(){function Navigator(clientId){this._keyRequested$=new BehaviorSubject_1.BehaviorSubject(null);this._movedToKey$=new Subject_1.Subject;this._dirRequested$=new BehaviorSubject_1.BehaviorSubject(null);this._latLonRequested$=new BehaviorSubject_1.BehaviorSubject(null);this.apiV2=new API_1.APIv2(clientId);this.apiV3=new API_1.APIv3(clientId);this.graphService=new Graph_1.GraphService(this.apiV2,this.apiV3);this.stateService=new State_1.StateService;this.loadingService=new Viewer_1.LoadingService}Object.defineProperty(Navigator.prototype,"keyRequested$",{get:function(){return this._keyRequested$},enumerable:true,configurable:true});Object.defineProperty(Navigator.prototype,"movedToKey$",{get:function(){return this._movedToKey$},enumerable:true,configurable:true});Navigator.prototype.auth=function(token,projectKey){this.apiV2.auth(token,projectKey)};Navigator.prototype.moveToKey=function(key){var _this=this;this.loadingService.startLoading("navigator");this._keyRequested$.next(key);return this.graphService.node$(key).map(function(node){_this.loadingService.stopLoading("navigator");_this.stateService.setNodes([node]);_this._movedToKey$.next(node.key);return node}).first()};Navigator.prototype.moveDir=function(dir){var _this=this;this.loadingService.startLoading("navigator");this._dirRequested$.next(dir);return this.stateService.currentNode$.first().mergeMap(function(currentNode){return _this.graphService.nextNode$(currentNode,dir).mergeMap(function(node){return node==null?Observable_1.Observable.of(null):_this.moveToKey(node.key)})}).first()};Navigator.prototype.moveCloseTo=function(lat,lon){var _this=this;this.loadingService.startLoading("navigator");this._latLonRequested$.next({lat:lat,lon:lon});return Observable_1.Observable.fromPromise(this.apiV2.search.im.close2(lat,lon)).mergeMap(function(data){return data.key==null?Observable_1.Observable.throw(new Error("no Image found")):_this.moveToKey(data.key)}).first()};return Navigator}();exports.Navigator=Navigator;Object.defineProperty(exports,"__esModule",{value:true});exports.default=Navigator},{"../API":403,"../Graph":408,"../State":411,"../Viewer":413,"rxjs/BehaviorSubject":223,"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/observable/fromPromise":238,"rxjs/add/observable/of":240,"rxjs/add/observable/throw":241,"rxjs/add/operator/first":254,"rxjs/add/operator/map":255,"rxjs/add/operator/mergeMap":258}],521:[function(require,module,exports){"use strict";(function(SpriteAlignment){SpriteAlignment[SpriteAlignment["Center"]=0]="Center";SpriteAlignment[SpriteAlignment["Start"]=1]="Start";SpriteAlignment[SpriteAlignment["End"]=2]="End"})(exports.SpriteAlignment||(exports.SpriteAlignment={}));var SpriteAlignment=exports.SpriteAlignment;Object.defineProperty(exports,"__esModule",{value:true});exports.default=SpriteAlignment},{}],522:[function(require,module,exports){"use strict";var THREE=require("three");var vd=require("virtual-dom");var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/publishReplay");require("rxjs/add/operator/scan");require("rxjs/add/operator/startWith");var Viewer_1=require("../Viewer");var SpriteAtlas=function(){function SpriteAtlas(){}Object.defineProperty(SpriteAtlas.prototype,"json",{set:function(value){this._json=value},enumerable:true,configurable:true});Object.defineProperty(SpriteAtlas.prototype,"image",{set:function(value){this._image=value;this._texture=new THREE.Texture(this._image);this._texture.minFilter=THREE.NearestFilter},enumerable:true,configurable:true});Object.defineProperty(SpriteAtlas.prototype,"loaded",{get:function(){return!!(this._image&&this._json)},enumerable:true,configurable:true});SpriteAtlas.prototype.getGLSprite=function(name){if(!this.loaded){throw new Error("Sprites cannot be retrieved before the atlas is loaded.")}var definition=this._json[name];if(!definition){console.warn("Sprite with key"+name+"does not exist in sprite definition.");return new THREE.Object3D}var texture=this._texture.clone();texture.needsUpdate=true;var width=this._image.width;var height=this._image.height;texture.offset.x=definition.x/width;texture.offset.y=(height-definition.y-definition.height)/height;texture.repeat.x=definition.width/width;texture.repeat.y=definition.height/height;var material=new THREE.SpriteMaterial({map:texture});return new THREE.Sprite(material)};SpriteAtlas.prototype.getDOMSprite=function(name,horizontalAlign,verticalAlign){if(!this.loaded){throw new Error("Sprites cannot be retrieved before the atlas is loaded.")}if(horizontalAlign==null){horizontalAlign=Viewer_1.SpriteAlignment.Start}if(verticalAlign==null){verticalAlign=Viewer_1.SpriteAlignment.Start}var definition=this._json[name];if(!definition){console.warn("Sprite with key"+name+"does not exist in sprite definition.");return vd.h("div",{},[])}var clipTop=definition.y;var clipRigth=definition.x+definition.width;var clipBottom=definition.y+definition.height;var clipLeft=definition.x;var left=-definition.x;var top=-definition.y;var height=this._image.height;var width=this._image.width;switch(horizontalAlign){case Viewer_1.SpriteAlignment.Center:left-=definition.width/2;break;case Viewer_1.SpriteAlignment.End:left-=definition.width;break;case Viewer_1.SpriteAlignment.Start:break;default:break}switch(verticalAlign){case Viewer_1.SpriteAlignment.Center:top-=definition.height/2;break;case Viewer_1.SpriteAlignment.End:top-=definition.height;break;case Viewer_1.SpriteAlignment.Start:break;default:break}var pixelRatioInverse=1/definition.pixelRatio;clipTop*=pixelRatioInverse;clipRigth*=pixelRatioInverse;clipBottom*=pixelRatioInverse;clipLeft*=pixelRatioInverse;left*=pixelRatioInverse;top*=pixelRatioInverse;height*=pixelRatioInverse;width*=pixelRatioInverse;var properties={src:this._image.src,style:{clip:"rect("+clipTop+"px, "+clipRigth+"px, "+clipBottom+"px, "+clipLeft+"px)",height:height+"px",left:left+"px",position:"absolute",top:top+"px",width:width+"px"}};return vd.h("img",properties,[])};return SpriteAtlas}();var SpriteService=function(){function SpriteService(sprite){var _this=this;this._retina=window.devicePixelRatio>1;this._spriteAtlasOperation$=new Subject_1.Subject;this._spriteAtlas$=this._spriteAtlasOperation$.startWith(function(atlas){return atlas}).scan(function(atlas,operation){return operation(atlas)},new SpriteAtlas).publishReplay(1).refCount();this._spriteAtlas$.subscribe();if(sprite==null){return}var format=this._retina?"@2x":"";var imageXmlHTTP=new XMLHttpRequest;imageXmlHTTP.open("GET",sprite+format+".png",true);imageXmlHTTP.responseType="arraybuffer";imageXmlHTTP.onload=function(){var image=new Image;image.onload=function(){_this._spriteAtlasOperation$.next(function(atlas){atlas.image=image;return atlas})};var blob=new Blob([imageXmlHTTP.response]);image.src=window.URL.createObjectURL(blob)};imageXmlHTTP.send();var jsonXmlHTTP=new XMLHttpRequest;jsonXmlHTTP.open("GET",sprite+format+".json",true);jsonXmlHTTP.responseType="text";jsonXmlHTTP.onload=function(){var json=JSON.parse(jsonXmlHTTP.response);_this._spriteAtlasOperation$.next(function(atlas){atlas.json=json;return atlas})};jsonXmlHTTP.send()}Object.defineProperty(SpriteService.prototype,"spriteAtlas$",{get:function(){return this._spriteAtlas$},enumerable:true,configurable:true});return SpriteService}();exports.SpriteService=SpriteService;Object.defineProperty(exports,"__esModule",{value:true});exports.default=SpriteService},{"../Viewer":413,"rxjs/Subject":230,"rxjs/add/operator/publishReplay":262,"rxjs/add/operator/scan":263,"rxjs/add/operator/startWith":268,three:354,"virtual-dom":360}],523:[function(require,module,exports){"use strict";var Observable_1=require("rxjs/Observable");var Subject_1=require("rxjs/Subject");require("rxjs/add/operator/filter");require("rxjs/add/operator/map");require("rxjs/add/operator/merge");require("rxjs/add/operator/scan");require("rxjs/add/operator/switchMap");var TouchMove=function(){function TouchMove(touch){this.movementX=0;this.movementY=0;if(touch==null){return}this.identifier=touch.identifier;this.clientX=touch.clientX;this.clientY=touch.clientY;this.pageX=touch.pageX;this.pageY=touch.pageY;this.screenX=touch.screenX;this.screenY=touch.screenY;this.target=touch.target}return TouchMove}();exports.TouchMove=TouchMove;var TouchService=function(){function TouchService(element){var _this=this;this._element=element;this._touchStart$=Observable_1.Observable.fromEvent(element,"touchstart");this._touchMove$=Observable_1.Observable.fromEvent(element,"touchmove");this._touchEnd$=Observable_1.Observable.fromEvent(element,"touchend");this._touchCancel$=Observable_1.Observable.fromEvent(element,"touchcancel");this._preventTouchMoveOperation$=new Subject_1.Subject;this._preventTouchMove$=new Subject_1.Subject;this._preventTouchMoveOperation$.scan(function(prevent,operation){return operation(prevent)},true).subscribe();this._preventTouchMove$.map(function(prevent){return function(previous){return prevent}}).subscribe(this._preventTouchMoveOperation$);this._touchMove$.map(function(te){return function(prevent){if(prevent){te.preventDefault()}return prevent}}).subscribe(this._preventTouchMoveOperation$);this._singleTouchMoveOperation$=new Subject_1.Subject;this._singleTouchMove$=this._singleTouchMoveOperation$.scan(function(touch,operation){return operation(touch)},new TouchMove);this._touchMove$.filter(function(te){return te.touches.length===1&&te.targetTouches.length===1}).map(function(te){return function(previous){var touch=te.touches[0];var current=new TouchMove(touch);current.movementX=touch.pageX-previous.pageX;current.movementY=touch.pageY-previous.pageY;return current}}).subscribe(this._singleTouchMoveOperation$);var singleTouchStart$=Observable_1.Observable.merge(this._touchStart$,this._touchEnd$,this._touchCancel$).filter(function(te){return te.touches.length===1&&te.targetTouches.length===1});var multipleTouchStart$=Observable_1.Observable.merge(this._touchStart$,this._touchEnd$,this._touchCancel$).filter(function(te){return te.touches.length>=1});var touchStop$=Observable_1.Observable.merge(this._touchEnd$,this._touchCancel$).filter(function(te){return te.touches.length===0});this._singleTouch$=singleTouchStart$.switchMap(function(te){return _this._singleTouchMove$.skip(1).takeUntil(Observable_1.Observable.merge(multipleTouchStart$,touchStop$))});var touchesChanged$=Observable_1.Observable.merge(this._touchStart$,this._touchEnd$,this._touchCancel$);var pinchStart$=touchesChanged$.filter(function(te){return te.touches.length===2&&te.targetTouches.length===2});var pinchStop$=touchesChanged$.filter(function(te){return te.touches.length!==2||te.targetTouches.length!==2});this._pinchOperation$=new Subject_1.Subject;this._pinch$=this._pinchOperation$.scan(function(pinch,operation){return operation(pinch)},{centerClientX:0,centerClientY:0,centerPageX:0,centerPageY:0,centerScreenX:0,centerScreenY:0,changeX:0,changeY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,touch1:null,touch2:null});this._touchMove$.filter(function(te){return te.touches.length===2&&te.targetTouches.length===2}).map(function(te){return function(previous){var touch1=te.touches[0];var touch2=te.touches[1];var minX=Math.min(touch1.clientX,touch2.clientX);var maxX=Math.max(touch1.clientX,touch2.clientX);var minY=Math.min(touch1.clientY,touch2.clientY);var maxY=Math.max(touch1.clientY,touch2.clientY);var centerClientX=minX+(maxX-minX)/2;var centerClientY=minY+(maxY-minY)/2;var centerPageX=centerClientX+touch1.pageX-touch1.clientX;var centerPageY=centerClientY+touch1.pageY-touch1.clientY;var centerScreenX=centerClientX+touch1.screenX-touch1.clientX;var centerScreenY=centerClientY+touch1.screenY-touch1.clientY;var distanceX=Math.abs(touch1.clientX-touch2.clientX);var distanceY=Math.abs(touch1.clientY-touch2.clientY);var distance=Math.sqrt(distanceX*distanceX+distanceY*distanceY);var distanceChange=distance-previous.distance;var changeX=distanceX-previous.distanceX;var changeY=distanceY-previous.distanceY;var current={centerClientX:centerClientX,centerClientY:centerClientY,centerPageX:centerPageX,centerPageY:centerPageY,centerScreenX:centerScreenX,centerScreenY:centerScreenY,changeX:changeX,changeY:changeY,distance:distance,distanceChange:distanceChange,distanceX:distanceX,distanceY:distanceY,touch1:touch1,touch2:touch2};return current}}).subscribe(this._pinchOperation$);this._pinchChange$=pinchStart$.switchMap(function(te){return _this._pinch$.skip(1).takeUntil(pinchStop$)})}Object.defineProperty(TouchService.prototype,"touchStart$",{get:function(){return this._touchStart$},enumerable:true,configurable:true});Object.defineProperty(TouchService.prototype,"touchMove$",{get:function(){return this._touchMove$},enumerable:true,configurable:true});Object.defineProperty(TouchService.prototype,"touchEnd$",{get:function(){return this._touchEnd$},enumerable:true,configurable:true});Object.defineProperty(TouchService.prototype,"touchCancel$",{get:function(){return this._touchCancel$},enumerable:true,configurable:true});Object.defineProperty(TouchService.prototype,"singleTouchMove$",{get:function(){return this._singleTouch$},enumerable:true,configurable:true});Object.defineProperty(TouchService.prototype,"pinch$",{get:function(){return this._pinchChange$},enumerable:true,configurable:true});Object.defineProperty(TouchService.prototype,"preventDefaultTouchMove$",{get:function(){return this._preventTouchMove$},enumerable:true,configurable:true});return TouchService}();exports.TouchService=TouchService},{"rxjs/Observable":226,"rxjs/Subject":230,"rxjs/add/operator/filter":252,"rxjs/add/operator/map":255,"rxjs/add/operator/merge":256,"rxjs/add/operator/scan":263,"rxjs/add/operator/switchMap":269}],524:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var when=require("when");var Viewer_1=require("../Viewer");var Utils_1=require("../Utils");var Viewer=function(_super){__extends(Viewer,_super);function Viewer(id,clientId,key,options){_super.call(this);if(options===undefined){options={}}Utils_1.Settings.setOptions(options);this._navigator=new Viewer_1.Navigator(clientId);this._eventLauncher=new Viewer_1.EventLauncher(this,this._navigator);this._container=new Viewer_1.Container(id,this._navigator.stateService,options);this._componentController=new Viewer_1.ComponentController(this._container,this._navigator,key,options)}Viewer.prototype.moveToKey=function(key){var _this=this;return when.promise(function(resolve,reject){_this._navigator.moveToKey(key).subscribe(function(node){resolve(node)},function(error){reject(error)})})};Viewer.prototype.moveDir=function(dir){var _this=this;return when.promise(function(resolve,reject){_this._navigator.moveDir(dir).subscribe(function(node){resolve(node)},function(error){reject(error)})})};Viewer.prototype.moveCloseTo=function(lat,lon){var _this=this;return when.promise(function(resolve,reject){_this._navigator.moveCloseTo(lat,lon).subscribe(function(node){resolve(node)},function(error){reject(error)})})};Viewer.prototype.resize=function(){this._container.renderService.resize$.next(null);this._componentController.resize()};Viewer.prototype.setRenderMode=function(renderMode){this._container.renderService.renderMode$.next(renderMode)};Viewer.prototype.activateComponent=function(name){this._componentController.activate(name)};Viewer.prototype.deactivateComponent=function(name){this._componentController.deactivate(name)};Viewer.prototype.getComponent=function(name){return this._componentController.get(name)};Viewer.prototype.activateCover=function(){this._componentController.activateCover()};Viewer.prototype.deactivateCover=function(){this._componentController.deactivateCover()};Viewer.prototype.auth=function(token,projectKey){this._navigator.auth(token,projectKey)};Viewer.nodechanged="nodechanged";Viewer.loadingchanged="loadingchanged";return Viewer}(Utils_1.EventEmitter);exports.Viewer=Viewer},{"../Utils":412,"../Viewer":413,when:401}]},{},[409])(409)});
